<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punk Voyage Adventures</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@sats-connect/core@latest/dist/bundles/sats-connect.js"></script>
    <style>
        :root {
        --body-bg-image-url: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/background.jpg');
            --border-color: #000000;
            --text-color: #000000;
            --label-color: #333333; 
            --header-text-color: #333333;
            --game-container-bg: rgba(255, 255, 255, 0.9); 
            --section-bg: rgba(255, 255, 255, 0.8);
            --adventure-block-bg: rgba(255, 255, 255, 0.75);
            --button-bg: #E0E0E0;
            --button-text-color: #000000;
            --button-border: #000000;
            --dropdown-bg: #FFFFFF;
            --twitter-feed-bg: rgba(255, 255, 255, 0.7);
            --highlight-color-pv: #00FF00; 
            --highlight-color-gold: #FFFF00;
            --highlight-color-diamond: #00BFFF; 
            --highlight-color-danger: #FF0000; 
            --highlight-color-connected: #4CAF50;
            --quest-available-outline: #00E676; /* Bright Green */
            --quest-completed-outline: #F44336; /* Red (similar to danger) */
            --orange-label: #FFA500; 
            --base-font-size: 18px;
            --item-icon-size: 40px; /* Consistent item icon size */
            --menu-icon-size: 1.1em; /* Consistent menu icon size */
            --item-placeholder-boots: #8B4513; --item-placeholder-amulet: #FFD700; 
            --item-placeholder-armour: #C0C0C0; --item-placeholder-helmet: #A9A9A9;
            --item-placeholder-ring: #B8860B; --item-placeholder-weapon: #778899;
            --item-placeholder-misc: #DA70D6; 
            --item-placeholder-pet: #32CD32; /* LimeGreen for Pet slot */
            --item-upgrade-plus1-border: #00FF00; /* Bright Green */
            --item-upgrade-plus2-border: #0000FF; /* Blue */
            --item-upgrade-plus3-border: #BF00BF; /* Bright Purple (MediumOrchid/DarkMagenta like) */
            --item-upgrade-plus4-border: #FFA500; /* Orange */
            --item-upgrade-plus5-border: #DC143C; /* Dark Red */
        }

        body {
            font-family: 'VT323', monospace;
            background-image: var(--body-bg-image-url); 
            background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed; 
            color: var(--text-color); 
            margin: 0; font-size: var(--base-font-size); 
            display: flex; flex-direction: column; 
            align-items: center; min-height: 100vh; box-sizing: border-box; 
            transition: color 0.3s, background-color 0.3s;
        }

        body.dark-mode {
            --border-color: #777777; 
            --text-color: #FFFFFF;
            --label-color: var(--orange-label); 
            --header-text-color: var(--orange-label); 
            --game-container-bg: rgba(20, 20, 20, 0.9); 
            --section-bg: rgba(30, 30, 30, 0.85);
            --adventure-block-bg: rgba(40, 40, 40, 0.8);
            --button-bg: #444444;
            --button-text-color: #FFFFFF;
            --button-border: #666666;
            --dropdown-bg: #333333;
            --twitter-feed-bg: rgba(25, 25, 25, 0.7);
--item-upgrade-plus1-border: #32CD32; /* LimeGreen for dark mode */
        --item-upgrade-plus2-border: #4169E1; /* RoyalBlue for dark mode */
        --item-upgrade-plus3-border: #DA70D6; /* Orchid for dark mode */
        --item-upgrade-plus4-border: #FF8C00; 
        --item-upgrade-plus5-border: #FF4500; 
        }
        
        #welcomeScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: var(--body-bg-image-url); 
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat;
            display: flex; 
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; text-align: center; padding: 20px; box-sizing: border-box;
            overflow-y: auto; 
        }
        #welcomeImageLarge { display: block; margin: 0 auto 20px auto; max-width: 80%; max-height: 50vh; object-fit: contain; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        #authFormContainer { background-color: var(--section-bg); padding: 20px 30px; border-radius: 10px; border: 2px solid var(--border-color); box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: background-color 0.3s, border-color 0.3s; z-index: 3001; width: 100%; max-width: 480px; }
        #authFormContainer h2 { margin-top: 0; margin-bottom: 15px; font-size: 1.8em; color: var(--label-color); transition: color 0.3s; }
        body.dark-mode #authFormContainer h2 {  color: var(--orange-label); }
        .auth-form-field { margin-bottom: 12px; text-align: left; }
        .auth-form-field label { display: block; margin-bottom: 4px; font-size: 1.0em; color: var(--label-color); font-weight: bold; transition: color 0.3s; }
        body.dark-mode .auth-form-field label {  color: var(--orange-label); }
        .auth-form-field input { font-family: 'VT323', monospace; font-size: 1.1em; padding: 8px; border: 2px solid var(--border-color); background-color: var(--dropdown-bg); color: var(--text-color); border-radius: 5px; width: calc(100% - 20px); box-sizing: border-box; transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
        .auth-buttons { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; margin-bottom: 10px; }
        #loginButton, #registerButton, #googleSignInButton { font-family: 'VT323', monospace; font-size: 1.2em; padding: 10px 15px; cursor: pointer; border-radius: 5px; transition: background-color 0.2s; width: 100%; box-sizing: border-box; }
        #loginButton, #registerButton { background-color: var(--highlight-color-connected); color: #FFFFFF; border: 2px solid #3c8c3c; }
        #loginButton:hover, #registerButton:hover { background-color: #3e8e41; }
        #googleSignInButton { background-color: #4285F4; color: white; border: 2px solid #3578E5; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #googleSignInButton:hover { background-color: #3367D6; }
        #googleSignInButton img {  height: 20px; width: 20px; background-color: white; border-radius: 2px; }
        .auth-links-container {  margin-top: 15px; }
        #authToggleLink, #forgotPasswordLink { display: inline-block; margin: 5px 10px; font-size: 0.9em; color: var(--highlight-color-pv); cursor: pointer; text-decoration: underline; }
        #authToggleLink:hover, #forgotPasswordLink:hover { color: var(--highlight-color-gold); }

        .hidden { display: none !important; }

        #customPopupOverlay, #itemSelectionModalOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8); 
            display: flex; 
            justify-content: center; align-items: center;
        }
        #customPopupOverlay { z-index: 2000; }
        #itemSelectionModalOverlay { z-index: 2005; } 

        #customPopup, #itemSelectionModal { 
            background-color: var(--section-bg); border: 3px solid var(--border-color);
            padding: 25px; border-radius: 10px; 
            text-align: center;
            min-width: 350px; max-width: 80%; width: auto; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.4); font-family: 'VT323', monospace;
            color: var(--text-color); box-sizing: border-box;
            position: fixed; 
            top: 50%; left: 50%;
            transform: translate(-50%, -50%); 
        }
        #customPopup { z-index: 2001; }
        #itemSelectionModal { 
            z-index: 2006; 
            max-width: 600px; 
            max-height: 70vh; 
            overflow-y: auto;
        }

        #customPopupTitle, #itemSelectionModalTitle { 
            font-size: 1.8em; margin-top: 0; margin-bottom: 15px;
            color: var(--label-color); 
        }
        #customPopupMessage { font-size: 1.1em; margin-bottom: 25px; line-height: 1.6; white-space: pre-wrap; text-align: left; }
        #customPopupButtons { display: flex; justify-content: center; gap: 15px;}
        #customPopupCloseBtn, #itemSelectionModalCloseBtn, #popupCraftAgainBtn, #customPopupConfirmBtn, #customPopupCancelBtn { font-size: 1.2em; padding: 10px 20px; min-width: 100px; margin-top: 15px; }
        #popupCraftAgainBtn, #customPopupConfirmBtn { background-color: var(--highlight-color-connected); color:white;}


        .game-container { width: 98%; max-width: none; margin: 10px auto; border: 3px solid var(--border-color); padding: 15px; background-color: var(--game-container-bg); box-shadow: 0px 0px 15px rgba(0,0,0,0.5); box-sizing: border-box; display: flex; flex-direction: column; transition: background-color 0.3s, border-color 0.3s; }
        header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); margin-bottom: 15px; width: 100%; transition: border-color 0.3s; }
        .header-title-container { display: flex; align-items: center; margin-right: auto; }
        .header-title-container img.header-logo { height: 80px; width: auto; margin-right: 15px; }
        header h1 { font-size: 2.5em; margin: 0; letter-spacing: 2px; color: var(--header-text-color); transition: color 0.3s; flex-shrink: 0; }
        .header-byline { font-size: 0.9em; color: white; margin-left: 10px; font-weight: normal; align-self: flex-end; padding-bottom: 5px; }
        body:not(.dark-mode) .header-byline { color: #333333; }

        .header-controls { display: flex; align-items: center; gap: 15px;  }
        .player-info-wallet { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        .player-stats { text-align: right; font-size: 1em; } 
        .player-stats .pv { color: var(--highlight-color-pv); font-weight: bold; } 
        .player-stats .gold { color: var(--highlight-color-gold); font-weight: bold; } 
        .player-stats .diamond { color: var(--highlight-color-diamond); font-weight: bold; }
        .player-stats .wallet-address { font-size: 0.9em; color: var(--highlight-color-connected); word-break: break-all; }
        .wallet-connector { position: relative; }
        .connect-wallet-btn, .menu-button, .social-btn-link button, .adventure-send-btn, .action-button, .craft-button, .equip-btn, .unequip-btn, .swap-btn, .raffle-action-btn, #signOutButton, #upgradeItemButton, .leaderboard-filter-btn, .use-rider-scroll-btn { background-color: var(--button-bg); border: 2px solid var(--button-border); padding: 6px 12px; color: var(--button-text-color); cursor: pointer; font-family: 'VT323', monospace; font-size: 1em; text-align: center; transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
        .connect-wallet-btn, .menu-button, #signOutButton { min-width: 160px; }
        #signOutButton { background-color: var(--highlight-color-danger); color: white; border-color: var(--highlight-color-danger); }
        body:not(.dark-mode) #signOutButton:hover { background-color: #cc0000; }
        body.dark-mode #signOutButton:hover { background-color: #dd0000; }
        .leaderboard-filter-btn.active { background-color: var(--highlight-color-connected); color: white; }
        .use-rider-scroll-btn { font-size: 0.85em; padding: 3px 6px; margin-top: 5px; }


        .header-controls .socials-nav { padding: 0; border: none; background-color: transparent; display: flex; align-items: center; gap: 10px; }
        .header-controls .socials-nav .social-title { font-size: 1.1em; margin-bottom: 0; }
        .header-controls .socials-nav .social-buttons { gap: 10px; display: flex; align-items: center; }
        .social-icon-link img { height: 30px; width: auto; vertical-align: middle; border: 1px solid var(--button-border); padding: 3px; background-color: var(--button-bg); border-radius: 4px; transition: filter 0.2s; }
        .social-icon-link img:hover { filter: brightness(0.85); }

        body:not(.dark-mode) .connect-wallet-btn:hover, body:not(.dark-mode) .menu-button:hover, body:not(.dark-mode) .social-btn-link button:hover, body:not(.dark-mode) .adventure-send-btn:hover, body:not(.dark-mode) .action-button:hover, body:not(.dark-mode) .craft-button:hover, body:not(.dark-mode) .equip-btn:hover, body:not(.dark-mode) .unequip-btn:hover, body:not(.dark-mode) .swap-btn:hover, body:not(.dark-mode) .raffle-action-btn:hover, body:not(.dark-mode) #upgradeItemButton:hover, body:not(.dark-mode) .leaderboard-filter-btn:not(.active):hover, body:not(.dark-mode) .use-rider-scroll-btn:hover { background-color: #cccccc; }
        body.dark-mode .connect-wallet-btn:hover, body.dark-mode .menu-button:hover, body.dark-mode .social-btn-link button:hover, body.dark-mode .adventure-send-btn:hover, body.dark-mode .action-button:hover, body.dark-mode .craft-button:hover, body.dark-mode .equip-btn:hover, body.dark-mode .unequip-btn:hover, body.dark-mode .swap-btn:hover, body.dark-mode .raffle-action-btn:hover, body.dark-mode #upgradeItemButton:hover, body.dark-mode .leaderboard-filter-btn:not(.active):hover, body.dark-mode .use-rider-scroll-btn:hover { background-color: #555555;}
        .connect-wallet-btn.connected { background-color: var(--highlight-color-connected); color: white; border-color: var(--highlight-color-connected); }
        .wallet-dropdown { display: none; position: absolute; top: 100%; right: 0; background-color: var(--dropdown-bg); color: var(--text-color); border: 2px solid var(--border-color); list-style: none; padding: 0; margin: 5px 0 0 0; width: 100%; z-index: 10; box-shadow: 0px 3px 7px rgba(0,0,0,0.2); transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
        .wallet-dropdown li { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid var(--border-color); text-align: center; transition: background-color 0.3s, border-color 0.3s; } .wallet-dropdown li:last-child { border-bottom: none; }
        body:not(.dark-mode) .wallet-dropdown li:hover { background-color: #f0f0f0; } body.dark-mode .wallet-dropdown li:hover { background-color: #4a4a4a; }
        .main-content { display: flex; gap: 20px; width: 100%; flex-grow: 1; }
        .left-sidebar { width: 300px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0; }
        .twitter-feed-container { border: 2px solid var(--border-color); padding: 10px; background-color: var(--twitter-feed-bg); height: auto; min-height: 250px; overflow-y: auto; display: flex; flex-direction: column; transition: background-color 0.3s, border-color 0.3s; margin-top: 20px; }
        .twitter-feed-container .twitter-timeline { width: 100% !important; }
        #availableAdventurersDisplay, .materials-display, #playerCombatStatsDisplay { border: 2px solid var(--border-color); padding: 10px; background-color: var(--section-bg); transition: background-color 0.3s, border-color 0.3s; }
        #availableAdventurersDisplay, #playerCombatStatsDisplay { text-align:center; font-size: 1.2em; } 
        #playerCombatStatsDisplay h4 {font-size: 1.2em; margin-top:0; margin-bottom: 8px; color: var(--label-color);}
        #playerCombatStatsDisplay p {font-size: 1em; margin: 5px 0;}

        .socials-nav .social-title, .adventure-controls label, .page-title, .materials-display h4, .adventures-label, #activeAdventuresDisplay_page h3, 
        .equipment-slots-container h4, #inventory-page > h4, .shop-section-wrapper h3, #crafting-page h2, .swap-section h3, #whitelist-page h3, #upgrade-page h3, #leaderboard-page h3, #dungeons-page h3 {  color: var(--label-color); font-weight: bold; transition: color 0.3s; }
        .materials-display h4 {font-size: 1.2em; margin-top:0; margin-bottom: 8px;} 
        .materials-display .material-tier-title, .materials-display .upgrade-scrolls-title { font-size: 1.1em; font-weight: bold; margin-top:10px; margin-bottom:5px; color: var(--label-color); }
        .materials-display .upgrade-scrolls-title { color: var(--highlight-color-pv); } 
        body.dark-mode .materials-display .upgrade-scrolls-title { color: var(--highlight-color-pv); }

        .materials-display ul { list-style: none; padding: 0; margin: 5px 0 0 0; font-size: 1em; } .materials-display li { margin-bottom: 3px; }
          #specialtiesListContainer ul {
        list-style: disc; /* Use disc bullets for specialties */
        padding-left: 20px; /* Indent list items */
        margin: 10px 0 5px 0; /* Adjust margins */
        font-size: 0.9em;   /* Slightly smaller font */
    }
    #specialtiesListContainer li {
        margin-bottom: 5px; /* Space between specialty items */
        line-height: 1.4;   /* Adjust line height for readability */
    }
    .specialty-source { /* To style the "(from Item Name)" part */
        font-size: 0.85em;
        opacity: 0.7;
        margin-left: 5px;
        font-style: italic;
    }
        .main-content-area { flex-grow: 1; display: flex; }
        .page-content { display: none; width: 100%; flex-direction: column; padding: 0 15px; box-sizing: border-box; overflow-y: auto; flex-grow: 1;} 
        .page-content.active { display: flex; }

        #adventures-page { flex-direction: row; align-items: flex-start; gap: 25px; padding:0; }
        .player-character-area { display: none; }
        .adventure-section-wrapper { display: flex; flex-direction: column; flex-grow: 1; align-items: center; } 
        .adventures-label { font-size: 2em; margin-bottom: 10px; text-align: center; width: 100%; }
        #adventureMilestoneInfo { text-align: center; font-size: 0.95em; margin-bottom: 15px; color: var(--highlight-color-diamond); }
        .adventure-locations { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .adventure { display: flex; align-items: center; gap: 20px; width: 100%; max-width: 800px; background-color: var(--adventure-block-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); box-sizing: border-box; transition: background-color 0.3s, border-color 0.3s; position: relative; }
        .adventure-lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(30, 30, 30, 0.85); color: var(--highlight-color-danger); display: flex; justify-content: center; align-items: center; text-align: center; font-size: 1.1em; font-weight: bold; padding: 15px; box-sizing: border-box; border-radius: 8px; z-index: 5; line-height: 1.4; }
        .adventure-lock-overlay.hidden { display: none; }
        .adventure.locked-by-progression .adventure-send-btn, .adventure.locked-by-progression .adventure-num-select { filter: grayscale(100%) opacity(0.7); cursor: not-allowed !important; }
        .adventure-icon { width: 150px; height: 150px; border: 2px solid var(--border-color); background-size: cover; background-position: center; background-repeat: no-repeat; flex-shrink: 0; border-radius: 5px; transition: border-color 0.3s; }
        .adventure-icon.tree { background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/adventure1.jpg'); } 
        .adventure-icon.mountain { background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/adventure2.jpg'); } 
        .adventure-icon.fire-fields { background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/adventure3.jpg'); }
        .adventure-icon.tomb { background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/adventure4.jpg'); }
        .adventure-icon.adventure-5-icon { background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/imgnew%20(2).jpg'); }
        .adventure-main-info { flex-grow: 1; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; } 
        .adventure-content { display: flex; flex-direction: column; gap: 10px; } 
        .adventure-details { font-size: 1.1em; line-height: 1.5; } 
        .adventure-details .prize { color: var(--highlight-color-pv); font-weight: bold; } 
        .adventure-details .chance-gold { color: var(--highlight-color-gold); font-weight: bold; } 
        .adventure-details .chance-diamond { color: var(--highlight-color-diamond); font-weight: bold; }
        .adventure-requirement { color: var(--highlight-color-danger); font-weight: bold; font-size: 0.9em; margin-top: 5px;}
        .adventure-controls { display: flex; align-items: center; gap: 12px; margin-top: 10px; } 
        .adventure-controls label { font-size: 1.1em; } 
        .adventure-num-select { font-family: 'VT323', monospace; font-size: 1em; padding: 4px; border: 2px solid var(--border-color); background-color: var(--dropdown-bg); color: var(--text-color); min-width: 40px; transition: background-color 0.3s, border-color 0.3s, color 0.3s; } 
        .adventure-send-btn { padding: 6px 10px; font-size: 1em; } 
        .adventure-send-btn.active-adv1 { background-color: var(--highlight-color-pv); color: black;} 
        .adventure-send-btn.active-adv2 { background-color: var(--highlight-color-gold); color: black;} 
        .adventure-send-btn.active-adv3, .adventure-send-btn.active-adv4 { background-color: var(--highlight-color-danger); color: white;}
        .adventure-drops-area { position: relative; align-self: flex-start; min-height: 100px; } 
        .adventure-drops-button { font-size: 1em; padding: 4px 10px; } 
        .drops-popover { display: none; position: absolute; top: calc(100% + 5px); left: 50%; transform: translateX(-50%); background-color: var(--section-bg); border: 1px solid var(--border-color); padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 20; width: 220px; min-width: 180px; font-size: 1em; text-align: left; transition: background-color 0.3s, border-color 0.3s; } 
        .drops-popover h5 { margin: 0 0 5px 0; color: var(--label-color); transition: color 0.3s;} 
        .drops-popover ul { list-style: none; padding: 0; margin: 0; } 
        .drops-popover li { margin-bottom: 3px; }
        
        #active-adventures-page .active-adventures-container { margin-top: 0; width:100%; max-width:none; padding: 10px; border: none; background-color: transparent; box-shadow:none; }
        #active-adventures-page .active-adventures-container h3 { font-size: 1.6em; text-align:left; margin-bottom:10px;}
        #active-adventures-page .active-adventure-item { font-size:1em; padding:10px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 8px;}
        #active-adventures-page .active-adventure-item p { margin: 4px 0; font-size: 1.1em; line-height: 1.6; }
        
        .right-sidebar-menu { width: 300px; flex-shrink: 0; display: flex; flex-direction: column; gap: 0; border: 2px solid var(--border-color); background-color: var(--section-bg); padding: 10px; box-sizing: border-box; transition: background-color 0.3s, border-color 0.3s; }
        .right-sidebar-menu .menu-button-container-fixed { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .right-sidebar-menu .menu-button { min-width: auto; width: 85%; padding: 10px 15px; font-size: 1.4em; }
        .sidebar-content-area { flex-grow: 1; overflow-y: auto; }
        .main-menu-nav-list { list-style: none; padding: 0; margin: 0; }
        .main-menu-nav-list li { padding: 12px 8px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: border-color 0.3s, background-color 0.3s; font-size: 1.25em; text-align: left; display: flex; align-items: center; justify-content: flex-start; gap: 8px;}
        .main-menu-nav-list li img.menu-item-icon { height: var(--menu-icon-size); width: var(--menu-icon-size); object-fit: contain; vertical-align: middle; }
        .main-menu-nav-list li:last-child { border-bottom: none; } body:not(.dark-mode) .main-menu-nav-list li:hover { background-color: #f0f0f0; } body.dark-mode .main-menu-nav-list li:hover { background-color: #4a4a4a; }
        
        .sidebar-active-adventures-container { padding-top: 10px; } 
        .sidebar-active-adventures-container h3 { font-size: 1.3em; text-align: center; margin-bottom: 10px; color: var(--label-color); }
        .sidebar-active-adventures-container .active-adventure-item { display: flex; justify-content: space-between; align-items: center; font-size: 0.95em; padding: 8px; margin-bottom: 8px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 4px; }
        .sidebar-active-adventures-container .active-adventure-item-info { flex-grow: 1; }
        .sidebar-active-adventures-container .active-adventure-item p { margin: 3px 0; }
        .cancel-adventure-btn { background-color: transparent; border: none; color: var(--highlight-color-danger); font-size: 1.5em; cursor: pointer; padding: 0 5px; line-height: 1; }
        .cancel-adventure-btn:hover { color: darkred; }


        .active-potions-display { padding-top: 15px; margin-top: 15px; border-top: 1px solid var(--border-color); }
        .active-potions-display h4 { font-size: 1.3em; text-align: center; margin-bottom: 10px; color: var(--label-color); }
        .active-potions-display .potion-item { font-size: 0.95em; padding: 8px; margin-bottom: 8px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 4px; }
        .active-potions-display .potion-item p { margin: 3px 0; }

        .dark-mode-switch { display: flex; align-items: center; gap: 8px; } .dark-mode-switch label { font-size: 1em; color: var(--text-color); cursor: pointer; transition: color 0.3s; } .switch { position: relative; display: inline-block; width: 50px; height: 24px; } .switch input { opacity: 0; width: 0; height: 0; } .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; } .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; } input:checked + .slider { background-color: var(--highlight-color-connected); } input:focus + .slider { box-shadow: 0 0 1px var(--highlight-color-connected); } input:checked + .slider:before { transform: translateX(26px); }
        .page-title { font-size: 2.2em; margin-bottom: 25px; text-align:center; width:100%; }
        
        #shop-page { align-items: center; flex-direction: column; }
        .shop-top-section {
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: flex-start;
            width: 100%;
            max-width: 900px; /* Adjusted for better spacing */
            margin-bottom: 30px;
            margin-left: auto;
            margin-right: auto;
        }
        .shop-image-container {
            flex: 1; /* Takes up available space */
            max-width: 350px; /* Max width for the image */
        }
        .shop-image-container img {
            width: 100%;
            height: auto;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            display: block;
            margin: 0 auto; /* Center image if container is wider */
        }
        .swap-section-container {
            flex: 1; /* Takes up available space */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center the swap-section div */
             max-width: 350px;
        }
        @media (max-width: 800px) {
            .shop-top-section {
                flex-direction: column;
                align-items: center;
            }
            .shop-image-container, .swap-section-container {
                max-width: 80%;
                margin-bottom: 20px;
            }
        }
        #reverseSwapDirectionBtn img {
            height: 24px; /* Adjust size as needed */
            width: auto;
            vertical-align: middle;
        }
        #reverseSwapDirectionBtn {
            padding: 6px 10px; /* Adjust padding if needed */
            line-height: 0; /* May help align icon if it has extra space */
        }


        #crafting-page { align-items: center; flex-direction: column; }
        .crafting-gif-container { flex: 1; max-width: 50%; margin: 0 auto 20px auto;}
        .crafting-gif-container img { width: 100%; max-width: 400px; height: auto; border: 2px solid var(--border-color); border-radius: 8px; display: block; margin: 0 auto; }
        
        .swap-section h3 { font-size: 1.8em; text-align: center; margin-bottom: 15px; }
        .shop-section-wrapper, .crafting-section-wrapper { width: 100%; max-width: 800px; margin-bottom:30px;} .shop-section-wrapper h3, #crafting-page h3 { font-size: 1.8em; text-align: center; margin-bottom: 20px; color: var(--label-color); }
        .quest-list, .shop-items, .crafting-items-container { display: flex; flex-direction: column; gap: 18px; width:100%; max-width:800px; margin:0 auto; }
        .quest-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px; /* Add some padding */
            border: 2px solid var(--border-color); /* Default border */
            border-radius: 8px;
            background-color: var(--adventure-block-bg); /* Consistent background */
            margin-bottom: 15px; /* Space between quest items */
            transition: border-color 0.3s, box-shadow 0.3s, opacity 0.3s; /* Smooth transitions */
        }

        .quest-item .quest-info {
            flex-grow: 1; /* Allows the info to take up available space */
            margin-right: 15px; /* Space before the actions */
        }
        .quest-item .quest-info p { /* Ensure quest text wraps nicely */
            margin: 0;
            white-space: normal; /* Allow text to wrap */
            word-break: break-word; /* Break long words if necessary */
        }


        .quest-item .quest-actions {
            display: flex; /* To align reward and button if needed */
            flex-direction: column; /* Stack reward and button vertically */
            align-items: flex-end; /* Align them to the right */
            text-align: right; /* Ensure text inside is right-aligned */
            flex-shrink: 0; /* Prevent actions from shrinking */
        }
        .quest-item .quest-actions .quest-reward {
            margin-bottom: 5px; /* Space between reward and button */
            font-size: 0.9em; /* Slightly smaller reward text */
        }
        .quest-item .quest-actions .claim-quest-btn {
            min-width: 80px; /* Give button a minimum width */
            padding: 6px 10px; /* Adjust padding */
        }

        /* Styling for completed but not claimed quests (AVAILABLE TO CLAIM) */
        .quest-item.available-to-claim {
            border-color: var(--quest-available-outline); /* Use your existing variable */
            box-shadow: 0 0 8px var(--quest-available-outline);
        }
        /* Make the claim button more prominent when available */
        .quest-item.available-to-claim .claim-quest-btn:not([disabled]) {
            background-color: var(--highlight-color-connected); /* Greenish button */
            color: white;
            border-color: var(--highlight-color-connected);
        }


        /* Styling for claimed quests (COMPLETED AND CLAIMED) */
        .quest-item.completed-and-claimed {
            border-color: var(--quest-completed-outline); /* Use your existing variable */
            box-shadow: 0 0 8px var(--quest-completed-outline);
            opacity: 0.7; /* Optional: make claimed quests less prominent */
        }
        /* Style for already claimed button */
        .quest-item.completed-and-claimed .claim-quest-btn[disabled] {
            background-color: var(--button-bg); /* Default button bg */
            color: var(--button-text-color);
            opacity: 0.6;
        }
        /* --- MODIFIED FOR INVENTORY GRID --- */
        .inventory-items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Adjust 280px for desired card width */
            gap: 15px;
            width: 100%;
            max-width: 900px; /* Can be wider for grid */
            margin: 0 auto;
            padding: 10px; /* Add some padding around the grid */
        }
        /* ... */
        .shop-item, .craftable-item-card { position:relative; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); padding: 18px; border-radius: 8px; display: flex; align-items: center; transition: background-color 0.3s, border-color 0.3s; gap: 15px; }
        /* --- MODIFIED FOR INVENTORY ITEM CARD IN GRID --- */
        .inventory-item-card {
            position: relative;
            background-color: var(--adventure-block-bg);
            border: 1px solid var(--border-color);
            padding: 12px; /* Slightly less padding for smaller cards */
            border-radius: 8px;
            display: flex;
            flex-direction: column; /* Stack elements vertically */
            align-items: center; /* Center content */
            text-align: center; /* Center text */
            transition: background-color 0.3s, border-color 0.3s;
            gap: 8px; /* Smaller gap for vertical stacking */
            min-height: 180px; /* Ensure a consistent height */
            justify-content: space-between; /* Distribute space for button at bottom */
        }
        .inventory-item-card .item-icon-placeholder {
            margin-right: 0; /* Remove margin as it's centered now */
            margin-bottom: 8px;
        }
        .inventory-item-card .item-info {
            flex-grow: 0; /* Don't let info section grow excessively */
            width: 100%;
        }
        .inventory-item-card .item-actions {
            margin-top: auto; /* Push actions to the bottom */
            width: 100%; /* Make actions take full width for centering button */
            display: flex;
            justify-content: center;
        }
        .quest-item p, .shop-item p, .craftable-item-card p, .inventory-item-card p { font-size: 1.05em; margin:3px 0; }
        .quest-item .quest-reward, .shop-item .shop-price, .craftable-item-card .crafting-cost, .inventory-item-card .item-type { margin-left: auto; white-space: nowrap; text-align: right; }
        .shop-item .shop-price { color: var(--highlight-color-pv); } .action-button { padding: 6px 12px; font-size: 0.9em; } 
        .shop-item .quantity-selector { font-family: 'VT323', monospace; font-size: 0.9em; padding: 4px; border: 1px solid var(--border-color); background-color: var(--dropdown-bg); color: var(--text-color); width: 50px; margin-right: 8px; }
        
        .help-content { width: 100%; max-width: 900px; margin: 0 auto; }
        .help-content p, .help-content ul, .help-content h3, .help-content h4 { font-size: 1.05em; margin-bottom: 10px; line-height: 1.7; }
        .help-content h3 { font-size: 1.5em; margin-top: 20px; color: var(--label-color); }
        .help-content h4 { font-size: 1.2em; margin-top: 15px; color: var(--label-color); }
        .help-content ul { list-style: disc; padding-left: 25px; }
        .help-content strong { color: var(--highlight-color-pv); }
        body.dark-mode .help-content strong { color: var(--highlight-color-gold); }
        .help-gif-container { text-align: center; margin: 25px 0; }
        .help-gif-container img { max-width: 80%; height: auto; border: 2px solid var(--border-color); border-radius: 8px; }

        .item-icon-placeholder { width: var(--item-icon-size); height: var(--item-icon-size); border: 1px solid var(--border-color); border-radius: 4px; margin-right: 10px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 0.7em; overflow:hidden; }
        .item-icon-placeholder img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .upgrade-slot .item-icon-placeholder { width: calc(var(--item-icon-size) + 10px) ; height: calc(var(--item-icon-size) + 10px); } 

        .craftable-item-card .item-info, .inventory-item-card .item-info { flex-grow: 1; }
        .crafting-cost small, .item-perk small { display: block; font-size: 0.9em; opacity: 0.8; }
        .equip-btn, .unequip-btn { font-size: 0.9em; padding: 4px 8px; margin-left: 5px; }
        .inventory-item-card .equipped-status { font-size: 0.9em; color: var(--highlight-color-connected); margin-left: 10px; }
        .inventory-item-card .use-btn { font-size: 0.9em; padding: 4px 8px; margin-left: 10px; background-color: var(--highlight-color-pv); color: black;}
        .inventory-item-card.item-level-plus4 { border: 2px solid var(--item-upgrade-plus4-border) !important; box-shadow: 0 0 8px var(--item-upgrade-plus4-border); }
        .inventory-item-card.item-level-plus5 { border: 2px solid var(--item-upgrade-plus5-border) !important; box-shadow: 0 0 10px var(--item-upgrade-plus5-border); }
        .inventory-item-card.item-level-plus1 { border: 2px solid var(--item-upgrade-plus1-border) !important; box-shadow: 0 0 6px var(--item-upgrade-plus1-border); }
        .inventory-item-card.item-level-plus2 { border: 2px solid var(--item-upgrade-plus2-border) !important; box-shadow: 0 0 7px var(--item-upgrade-plus2-border); }
        .inventory-item-card.item-level-plus3 { border: 2px solid var(--item-upgrade-plus3-border) !important; box-shadow: 0 0 7px var(--item-upgrade-plus3-border); }

        .equipment-slots-container { margin-bottom: 30px; padding: 15px; border: 1px dashed var(--border-color); border-radius: 5px; width: 100%; max-width: 800px; box-sizing: border-box; margin-left:auto; margin-right:auto; }
        .equipment-slots-container h4 { margin-top: 0; margin-bottom: 15px; text-align: center; color: var(--label-color); font-size: 1.8em; }
        .equipment-slots { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; } 
        .equipment-slot { border: 1px solid var(--border-color); background-color: var(--adventure-block-bg); padding: 10px; border-radius: 4px; text-align: center; min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: background-color 0.3s, border-color 0.3s; position: relative; } /* Added position relative for tooltip handling */
        .equipment-slot.locked .slot-name::after { content: ""; font-size: 0.8em; }
        .equipment-slot .slot-name { font-size: 1em; margin-bottom: 8px; color: var(--label-color); font-weight:normal; }
        .equipment-slot .item-icon-placeholder { margin-bottom: 5px; width: var(--item-icon-size); height: var(--item-icon-size); font-size: 0.7em; }
        .equipment-slot .equipped-item-name { font-size: 0.95em; font-weight: bold; margin-bottom: 5px; }
        .equipment-slot .equipped-item-container { /* New container for tooltip */ display: flex; flex-direction: column; align-items: center; cursor: default; /* Or pointer if interactive */ }
        .equipment-slot .empty-slot-text { font-size: 0.9em; opacity: 0.7; }
        .equipment-slot.item-level-plus4 { border: 2px solid var(--item-upgrade-plus4-border) !important; box-shadow: 0 0 8px var(--item-upgrade-plus4-border); }
        .equipment-slot.item-level-plus5 { border: 2px solid var(--item-upgrade-plus5-border) !important; box-shadow: 0 0 10px var(--item-upgrade-plus5-border); }
        .equipment-slot.item-level-plus1 { border: 2px solid var(--item-upgrade-plus1-border) !important; box-shadow: 0 0 6px var(--item-upgrade-plus1-border); }
        .equipment-slot.item-level-plus2 { border: 2px solid var(--item-upgrade-plus2-border) !important; box-shadow: 0 0 7px var(--item-upgrade-plus2-border); }
        .equipment-slot.item-level-plus3 { border: 2px solid var(--item-upgrade-plus3-border) !important; box-shadow: 0 0 7px var(--item-upgrade-plus3-border); }
        .dungeon-drops-area { 
            position: relative; 
            align-self: center; /* Center the button if its wrapper is full width */
        } 
        .dungeon-drops-button { 
            font-size: 0.9em; 
            padding: 4px 8px; 
        }

        #inventory-page { align-items: center; }
        #inventory-page > h4 { font-size: 1.8em; color: var(--label-color); margin-top: 25px; margin-bottom: 15px; text-align: center; width: 100%; max-width: 800px; margin-left:auto; margin-right:auto; }
        
        #daily-rewards-page .rewards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        #daily-rewards-page .reward-day { border: 1px solid var(--border-color); background-color: var(--adventure-block-bg); padding: 10px; border-radius: 5px; text-align: center; }
        #daily-rewards-page .reward-day h5 { margin: 0 0 5px 0; color: var(--label-color); }
        #daily-rewards-page .reward-day p { margin: 0; font-size: 0.9em; }
        #daily-rewards-page .reward-day button { margin-top: 8px; }

        .swap-section { margin-top:10px; text-align: center;} 
        .swap-section .swap-info { margin-bottom: 10px; font-size: 1.1em; }
        .swap-btn { padding: 8px 15px; font-size: 1.1em; }

        #upgrade-page { align-items: center; flex-direction: column; }
        .upgrade-main-image-container { text-align: center; margin-bottom: 20px; }
        .upgrade-main-image-container img { max-width: 250px; width: 100%; height: auto; }
        .upgrade-interface { display: flex; flex-direction: column; align-items: center; gap: 15px; padding: 20px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 8px; width: 100%; max-width: 500px; }
        .upgrade-slot { width: 120px; height: 120px; border: 2px dashed var(--border-color); border-radius: 5px; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 0.9em; background-color: var(--section-bg); color: var(--label-color); cursor: pointer; flex-direction: column; }
        .upgrade-slot img.icon-preview { max-width: var(--item-icon-size); max-height: var(--item-icon-size); margin-bottom: 5px; object-fit: contain; } 
        .upgrade-slot.filled { border-style: solid; }
        #selectedItemForUpgradeDisplay, #selectedScrollForUpgradeDisplay { font-size: 1em; text-align: center; display: flex; flex-direction:column; align-items: center; justify-content: center; gap: 5px; }
        #upgradeSuccessRateDisplay { margin-top: 10px; font-size: 1.1em; font-weight: bold; color: var(--label-color); }
        #upgradeResultDisplay { margin-top: 10px; font-size: 1.1em; font-weight: bold; }

        #whitelist-page { align-items: center; } 
        #adminRafflePanel { background-color: var(--section-bg); padding: 20px; border: 2px solid var(--border-color); border-radius: 8px; margin-bottom: 30px; width: 100%; max-width: 700px; box-shadow: 0 3px 10px rgba(0,0,0,0.15); }
        #adminRafflePanel h3 { text-align: center; margin-bottom: 15px; font-size: 1.6em; }
        .admin-form-group { margin-bottom: 12px; }
        .admin-form-group label { display: block; margin-bottom: 5px; font-size: 1.1em; color: var(--label-color); }
        .admin-form-group input[type="text"], .admin-form-group input[type="number"], .admin-form-group textarea { width: calc(100% - 20px); padding: 8px; font-family: 'VT323', monospace; font-size: 1em; border: 1px solid var(--border-color); background-color: var(--dropdown-bg); color: var(--text-color); border-radius: 4px; }
        .admin-form-group textarea { min-height: 60px; }
        #whitelistRafflesContainer { display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 800px; }
        .raffle-card { background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; display: flex; gap: 20px; align-items: flex-start; }
        .raffle-card-image { width: 120px; height: 120px; background-size: cover; background-position: center; border: 1px solid var(--border-color); border-radius: 5px; flex-shrink: 0; }
        .raffle-card-image.placeholder { display: flex; align-items: center; justify-content: center; background-color: #555; color: white; font-size: 0.9em; }
        .raffle-card-content { flex-grow: 1; }
        .raffle-card-content h4 { margin: 0 0 10px 0; font-size: 1.5em; color: var(--label-color); }
        .raffle-card-content p { margin: 5px 0; font-size: 1em; line-height: 1.5; }
        .raffle-card-description { margin-bottom: 10px !important; }
        .raffle-card-socials a { margin-right: 10px; text-decoration: none; color: var(--highlight-color-connected); font-weight: bold; }
        .raffle-card-socials a:hover { text-decoration: underline; }
        .raffle-card-cost { margin-top: 10px; font-size: 0.95em; }
        .raffle-card-cost .pv { color: var(--highlight-color-pv); } .raffle-card-cost .gold { color: var(--highlight-color-gold); } .raffle-card-cost .diamond { color: var(--highlight-color-diamond); }
        .raffle-card-status { margin-top: 10px; font-weight: bold; }
        .raffle-card-winners ul { list-style: disc; padding-left: 20px; margin-top: 5px;}
        .raffle-admin-actions button { margin-right: 10px; margin-top:5px; }

        #leaderboard-page { align-items: center; flex-direction: column; }
        .leaderboard-filters { margin-bottom: 20px; display:flex; gap: 10px; }
        .leaderboard-container { width: 100%; max-width: 700px; margin-bottom: 30px; background-color: var(--section-bg); padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; }
        .leaderboard-container h4 { font-size: 1.5em; color: var(--label-color); text-align: center; margin-bottom: 15px; }
        .leaderboard-list { list-style: none; padding: 0; margin: 0; }
        .leaderboard-list li { display: flex; justify-content: space-between; padding: 8px 5px; border-bottom: 1px solid var(--border-color); font-size: 1.1em; }
        .leaderboard-list li:last-child { border-bottom: none; }
        .leaderboard-list .rank { margin-right: 10px; color: var(--label-color); }
        .leaderboard-list .nickname { flex-grow: 1; }
        .leaderboard-list .score { font-weight: bold; }
        .leaderboard-list .score.pv { color: var(--highlight-color-pv); } .leaderboard-list .score.gold { color: var(--highlight-color-gold); } .leaderboard-list .score.diamond { color: var(--highlight-color-diamond); }

        /* Dungeons Page Specific Styles */
        #dungeons-page .help-gif-container img { /* Ensure the main image isn't too large */
            max-width: 600px; /* Or your preferred size */
            width: 90%; /* Responsive width */
            height: auto;
            border: 2px solid var(--border-color);
            border-radius: 8px;
        }
        .dungeon-entry {
            display: flex;
            align-items: center;
            gap: 20px;
            width: 100%;
            background-color: var(--adventure-block-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-sizing: border-box;
        }
        .dungeon-entry.locked {
            filter: grayscale(70%) opacity(0.8);
        }
        .dungeon-icon-placeholder {
            width: 80px;
            height: 80px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
            font-weight: bold;
        }
        .dungeon-info {
            flex-grow: 1;
        }
        .dungeon-info h3 {
            margin: 0 0 10px 0;
            font-size: 1.4em;
            color: var(--label-color);
        }
        .dungeon-info p {
            margin: 5px 0;
            font-size: 1em;
        }
        .dungeon-requirements {
            color: var(--highlight-color-danger);
            font-weight: bold;
        }
        .enter-dungeon-btn {
            padding: 8px 15px;
            font-size: 1.1em;
        }
    
        /* Tooltip Styles */
        #itemTooltip {
            position: fixed; 
            background-color: var(--section-bg);
            border: 2px solid var(--border-color);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            z-index: 10000; 
            font-size: 0.95em;
            line-height: 1.5;
            max-width: 320px; 
            display: none; 
            pointer-events: none; 
            font-family: 'VT323', monospace;
            color: var(--text-color);
        }
        #itemTooltip h5 { 
            margin: 0 0 8px 0; 
            color: var(--label-color); 
            font-size: 1.1em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        body.dark-mode #itemTooltip h5 { color: var(--orange-label); }
        #itemTooltip p { margin: 4px 0; }
        #itemTooltip ul { list-style: none; padding-left: 0; margin: 6px 0; }
        #itemTooltip ul li { margin-bottom: 3px; }
        #itemTooltip small { opacity: 0.9; display: block; margin-top: 3px;}
        #itemTooltip .perk-info { color: var(--highlight-color-pv); font-weight: bold;}
        body.dark-mode #itemTooltip .perk-info { color: var(--highlight-color-gold);}
        #itemTooltip .recipe-info { margin-top: 8px; font-size: 0.9em;}
        #itemTooltip .recipe-info strong { color: var(--label-color); }
        body.dark-mode #itemTooltip .recipe-info strong { color: var(--orange-label); }
         #dungeonCrawlerSelectionModalOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); /* Slightly darker than item selection */
            display: flex; 
            justify-content: center; align-items: center;
            z-index: 2010; /* Higher than item selection modal */
        }

        #dungeonCrawlerSelectionModal {
            background-color: var(--section-bg); border: 3px solid var(--border-color);
            padding: 20px; border-radius: 10px; 
            text-align: left; /* Align content to left for lists */
            min-width: 400px; max-width: 90%; width: auto; 
            box-shadow: 0 5px 25px rgba(0,0,0,0.5); font-family: 'VT323', monospace;
            color: var(--text-color); box-sizing: border-box;
            position: fixed; 
            top: 50%; left: 50%;
            transform: translate(-50%, -50%); 
            z-index: 2011;
            max-height: 80vh; /* Allow for more content */
            display: flex; /* Use flex for better internal layout */
            flex-direction: column;
        }

        #dungeonCrawlerSelectionModalTitle {
            font-size: 1.7em; margin-top: 0; margin-bottom: 10px;
            color: var(--label-color); 
            text-align: center;
        }

        #availableDungeonCrawlersList .crawler-item-btn,
        #selectedDungeonCrawlersDisplay .selected-crawler-tag {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--adventure-block-bg);
            border-radius: 4px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            font-size: 1em;
        }
        #availableDungeonCrawlersList .crawler-item-btn:hover {
            background-color: var(--button-bg-hover); /* You might need to define this variable or use a direct color */
        }
        body:not(.dark-mode) #availableDungeonCrawlersList .crawler-item-btn:hover { background-color: #f0f0f0; }
        body.dark-mode #availableDungeonCrawlersList .crawler-item-btn:hover { background-color: #4a4a4a; }


        #availableDungeonCrawlersList .crawler-item-btn.selected-for-dungeon {
            background-color: var(--highlight-color-connected) !important;
            color: white !important;
        }


        #selectedDungeonCrawlersDisplay .selected-crawler-tag {
            cursor: default;
            margin-right: 8px;
            margin-bottom: 8px; /* Add bottom margin for tags */
            display: inline-flex; /* Allow tags to sit next to each other */
        }
        #selectedDungeonCrawlersDisplay .selected-crawler-tag .remove-crawler-btn {
            margin-left: 10px;
            background: none;
            border: none;
            color: var(--highlight-color-danger);
            font-size: 1.1em;
            cursor: pointer;
            padding: 0 3px;
        }
    </style>
</head>
<body>
    <div id="itemTooltip"></div> <!-- Tooltip Element -->
    <div id="welcomeScreen">
        <img id="welcomeImageLarge" src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/ENTRY.gif" alt="Punk Voyage Adventures Welcome">
        <div id="authFormContainer">
            <h2 id="authFormTitle">Login to Punk Voyage Adventures</h2>
            <form id="loginRegisterForm">
                <div class="auth-form-field">
                    <label for="authEmail">Email:</label>
                    <input type="email" id="authEmail" autocomplete="email">
                </div>
                <div class="auth-form-field">
                    <label for="authPassword">Password:</label>
                    <input type="password" id="authPassword" autocomplete="current-password">
                <small style="display: block; font-size: 0.8em; opacity: 0.7; margin-top: 3px;">(Password must be at least 6 characters long.)</small>
                </div>
                <div class="auth-form-field hidden" id="authNicknameField">
                    <label for="authNickname">Nickname (for in-game display):</label>
                    <input type="text" id="authNickname" maxlength="20">
                </div>
                <div class="auth-buttons">
                    <button type="button" id="loginButton">Login</button>
                    <button type="button" id="registerButton" class="hidden">Register</button>
                </div>
            </form>
            <button type="button" id="googleSignInButton">
                <img src="https://beige-managing-snail-510.mypinata.cloud/ipfs/bafkreidpivlm24hjxcx7wlknozui7lgwpbtoaeio7dqqeg3b4drbcpwesu" alt="Google G Logo">
                Sign in with Google
            </button>
            <div class="auth-links-container">
                <a id="authToggleLink">Need an account? Register</a>
                <a id="forgotPasswordLink">Forgot Password?</a>
            </div>
        </div>
    </div>

    <div class="game-container hidden" id="gameContainer">
        <header> 
        <div class="header-title-container">
            <h1>PUNK VOYAGE ADVENTURES</h1>
            <span class="header-byline">by NV.Art</span>
        </div>
            <div class="header-controls"> 
                <div class="player-info-wallet"> 
                     <div class="player-stats" id="playerStats"> PLAYER <span id="playerNicknameDisplay">Voyager</span>, WELCOME<br> <span class="pv">PV = <span id="pvCount">0</span></span> , <span class="gold">GOLD = <span id="goldCount">0</span></span>, <span class="diamond">DIAMOND = <span id="diamondCount">0</span></span> <div class="wallet-address" id="walletAddressDisplay"></div> 
                    </div> 
                    <div class="wallet-connector"><button class="connect-wallet-btn" id="connectWalletBtn">CONNECT WALLET</button><ul class="wallet-dropdown" id="walletDropdown"><li data-wallet="xverse_provider">XVERSE</li><li data-wallet="unisat">UNISAT</li></ul>
                    </div> 
                </div>
                 <button id="signOutButton" class="hidden">Sign Out</button> 
                <nav class="socials-nav" id="headerSocialsNav"> 
                    <div class="social-title">SOCIALS</div> 
                    <div class="social-buttons"> 
                        <a href="https://x.com/nvart_" target="_blank" class="social-icon-link">
                            <img src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/twitter-x-logo.jpg" alt="X/Twitter">
                        </a> 
                        <a href="https://discord.com/invite/4CEtXAFf3x" target="_blank" class="social-icon-link">
                            <img src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/discordlogo.jpg" alt="Discord">
                        </a> 
                        <a href="https://magiceden.io/tr/ordinals/marketplace/punkvoyage" target="_blank" title="Punk Voyage on Magic Eden" class="social-icon-link">
                            <img src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/images.png" alt="Magic Eden">
                        </a>
                    </div> 
                </nav>
                <div class="dark-mode-switch"> 
                    <label for="darkModeToggle">Dark Mode</label> 
                    <label class="switch"> <input type="checkbox" id="darkModeToggle"> <span class="slider"></span> </label> 
                </div> 
            </div> 
        </header>
        <main class="main-content">
            <aside class="left-sidebar"> 
                <div id="availableAdventurersDisplay"> Available Adventurers: <span id="availableAdventurersCount">5</span> </div> 
                <div id="playerCombatStatsDisplay" class="materials-display" style="text-align:center;">
                    <h4>COMBAT STATS</h4>
                    <p>Attack: <span id="playerAttackStat">0</span></p>
                    <p>Defense: <span id="playerDefenseStat">0</span></p>
                </div>
                <div class="materials-display" id="materialsDisplay"> 
                    <h4 style="display: flex; justify-content: space-between; align-items: center;">
                        <span>MY MATERIALS</span>
                        <button id="toggleMaterialsBtn" class="action-button" style="font-size: 0.7em; padding: 2px 5px;">Hide</button>
                    </h4> 
                    <div id="materialsListContainer"></div>
                </div> 
                <div id="activeSpecialtiesDisplay" class="materials-display" style="text-align:left; margin-top: 20px;">
        <h4 style="display: flex; justify-content: space-between; align-items: center;">
            <span>ACTIVE SPECIALTIES</span>
            <button id="toggleSpecialtiesBtn" class="action-button" style="font-size: 0.7em; padding: 2px 5px;">Hide</button>
        </h4>
        <div id="specialtiesListContainer" style="padding-left: 10px;">
            <!-- Specialties will be listed here by JavaScript -->
            <ul><li>No active specialties. Equip items with perks!</li></ul>
        </div>
    </div>
                               <div id="userOrdinalsDisplay" class="materials-display" style="text-align:center; display: none; margin-top: 20px;">
                   <h4>MY PUNK VOYAGE ORDINALS</h4>
                   <div id="userOrdinalsList" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; max-height: 300px; overflow-y: auto; padding-top: 10px;">
                       <!-- Fetched Ordinals will be listed here -->
                   </div>
               </div>
                <div class="twitter-feed-container" id="twitter-widget-container"> <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/nvart_?ref_src=twsrc%5Etfw">Tweets by nvart_</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> </div> 
            </aside>
            <div class="main-content-area">
                <section id="adventures-page" class="page-content active"> 
                    <div class="player-character-area"> 
                        <div class="player-character" aria-label="Player Character Image"></div> 
                    </div> 
                    <div class="adventure-section-wrapper"> 
                        <h2 class="adventures-label">ADVENTURES</h2> 
                        <p id="adventureMilestoneInfo">Complete 100 adventures for a bonus of 50 Gold and 1 Diamond!</p>
                        <div class="adventure-locations"> 
                            <div class="adventure" id="adventure-1-block"> 
                                <div class="adventure-lock-overlay hidden"></div>
                                <div class="adventure-icon tree"></div> 
                                <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 1, SPIRIT FOREST<br> ADVENTURE TIME = 4 HOURS<br> <span class="prize">PRIZE = 50 PV TOKENS</span> </div> <div class="adventure-controls"> <label for="num-adventurers-1">ADVENTURERS:</label> 
                            <input type="number" id="num-adventurers-1" class="adventure-num-select" value="1" min="1">
                                <button class="adventure-send-btn active-adv1" data-adventure-id="1" data-adventure-name="Spirit Forest" data-duration-hours="4" data-pv-reward="25" data-gold-chance="0">SEND</button> </div> 
                                </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="1">DROPS</button> <div class="drops-popover" id="drops-popover-1"></div>  </div> </div> 
                            </div> 
                            <div class="adventure" id="adventure-2-block"> 
                                <div class="adventure-lock-overlay hidden"></div>
                                <div class="adventure-icon mountain"></div> <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 2, MOUNTAIN OF THE MAROWAN<br> ADVENTURE TIME = 8 HOURS<br> <span class="prize">PRIZE = 80 PV TOKENS</span> </div> <div class="adventure-controls"> <label for="num-adventurers-2">ADVENTURERS:</label> <input type="number" id="num-adventurers-2" class="adventure-num-select" value="1" min="1">
                                <button class="adventure-send-btn active-adv2" data-adventure-id="2" data-adventure-name="Mountain of the Marowan" data-duration-hours="8" data-pv-reward="40" data-gold-chance="0">SEND</button> </div> </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="2">DROPS</button> <div class="drops-popover" id="drops-popover-2"></div>  </div> </div> 
                            </div> 
                            <div class="adventure" id="adventure-3-block"> 
                                <div class="adventure-lock-overlay hidden"></div>
                                <div class="adventure-icon fire-fields"></div> <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 3, FIRE FIELDS OF FLYINALS<br> ADVENTURE TIME = 24 HOURS<br> <span class="prize">PRIZE = 200 PV TOKENS</span><br> <span class="chance-gold">%1 CHANCE OF GOLD</span> <div class="adventure-requirement">Requires: 2 Adventurers</div> </div> <div class="adventure-controls"> <label for="num-adventurers-3">ADVENTURERS:</label>
<input type="number" id="num-adventurers-3" class="adventure-num-select" value="1" min="1">
                                <button class="adventure-send-btn active-adv3" data-adventure-id="3" data-adventure-name="Fire Fields of Flyinals" data-duration-hours="24" data-pv-reward="100" data-gold-chance="0.01" data-adventurer-requirement="2">SEND</button> </div> </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="3">DROPS</button> <div class="drops-popover" id="drops-popover-3"></div>  </div> </div> 
                            </div>
                            <div class="adventure" id="adventure-4-block"> 
                                <div class="adventure-lock-overlay hidden"></div>
                                <div class="adventure-icon tomb"></div> <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 4, TOMB OF THE DEATH RIDERS<br> ADVENTURE TIME = 168 HOURS (1 WEEK)<br> <span class="prize">PRIZE = 1400 PV TOKENS</span><br> <span class="chance-gold">5% CHANCE OF GOLD</span><br> <span class="chance-diamond">1% CHANCE OF DIAMOND</span><div class="adventure-requirement">Requires: 5 Adventurers</div></div> <div class="adventure-controls"> <label for="num-adventurers-4">ADVENTURERS:</label>
<input type="number" id="num-adventurers-4" class="adventure-num-select" value="1" min="1">
                                <button class="adventure-send-btn active-adv4" data-adventure-id="4" data-adventure-name="Tomb of the Death Riders" data-duration-hours="168" data-pv-reward="700" data-gold-chance="0.05" data-diamond-chance="0.01" data-adventurer-requirement="5">SEND</button> </div> </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="4">DROPS</button> <div class="drops-popover" id="drops-popover-4"></div>  </div> </div> 
                            </div>
                            <div class="adventure" id="adventure-5-block"> 
                                <div class="adventure-lock-overlay hidden"> {/* Initially hidden, will be controlled by JS */}</div>
                                <div class="adventure-icon adventure-5-icon"></div>
                                <div class="adventure-main-info"> 
                                    <div class="adventure-content"> 
                                        <div class="adventure-details">
                                            ADVENTURE 5, THE CYBER VOID ECHO<br>
                                            ADVENTURE TIME = 720 HOURS (30 DAYS)<br>
                                            <span class="prize">PRIZE = 6250 PV TOKENS</span><br>
                                            <span class="gold">GUARANTEED = 5 GOLD</span><br>
                                            <span class="chance-diamond">10% CHANCE OF 3 DIAMONDS</span>
                                            <div class="adventure-requirement">Requires: 10 Adventurers</div>
                                        </div>
                                        <div class="adventure-controls">
                                            <label for="num-adventurers-5">ADVENTURERS:</label> 
                                            <input type="number" id="num-adventurers-5" class="adventure-num-select" value="1" min="1">
                                            <button class="adventure-send-btn" data-adventure-id="5" data-adventure-name="The Cyber Void Echo" data-duration-hours="720" data-pv-reward="3125" data-gold-guaranteed="5" data-diamond-chance="0.10" data-diamond-reward-multiplier="3" data-adventurer-requirement="10" style="background-color: #8A2BE2; color:white;">SEND</button> 
                                        </div> 
                                    </div> 
                                    <div class="adventure-drops-area"> 
                                        <button class="adventure-drops-button" data-adventure-id="5">DROPS</button> 
                                        <div class="drops-popover" id="drops-popover-5"></div>  
                                    </div> 
                                </div> 
                            </div>
                        </div> 
                    </div> 
                </section>
                <section id="dungeons-page" class="page-content">
                    <h2 class="page-title">DUNGEONS</h2>
                    <div class="help-gif-container" style="margin-bottom: 30px;">
                        <img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeifeareynjcio5d5grjduek3w4fsxrckxfylfdznnxcy6af2ew6uo4" alt="Dungeon Entrance Art">
                    </div>
                    <p style="text-align:center; margin-top: 5px; margin-bottom:15px; font-size:1em;">
                        Party Dungeons unlock when you have an adventurer on **Adventure 4 +**.<br> 
                        Entering a Party Dungeon uses **one** adventurer from your available pool.
                    </p>
                    <div id="dungeonListContainer" style="display: flex; flex-direction: column; align-items: center; gap: 20px; width:100%; max-width:700px; margin: 0 auto;">
                        <!-- Dungeon entries will be dynamically inserted here by JavaScript -->
                    </div>
                </section>
                <section id="quests-page" class="page-content"> <h2 class="page-title">QUESTS</h2> <div class="quest-list" id="questList"> </div> </section>
                <section id="daily-rewards-page" class="page-content"> <h2 class="page-title">DAILY LOGIN REWARDS</h2> <div class="rewards-grid" id="dailyRewardsGrid"> </div> </section>
                
                <section id="shop-page" class="page-content"> 
                    <h2 class="page-title">SHOP</h2> 
                     <div class="shop-top-section">
                        <div class="shop-image-container">
                         <img src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/SHOP.gif" alt="Shop Decorative Image">
                        </div>
                        <div class="swap-section-container"> 
                            <div class="swap-section">
                                <h3>Currency Swap</h3> 
                                <div class="swap-info" id="swapInfoDisplay">100 <span class="gold">GOLD</span> = 1 <span class="diamond">DIAMOND</span></div> 
                                 <div style="display: flex; flex-direction: column; gap: 10px; align-items: center; margin-top: 10px; margin-bottom: 10px;">
                                    <button id="swapBtn" class="action-button swap-btn">Swap Gold for Diamond</button>
                                    <button id="reverseSwapDirectionBtn" class="action-button" title="Reverse Swap Direction">
                                        <img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafkreigehaezkeralenqxjg5sk6q7s3flkxuz5iu7xlseztd5ptvxm2tnq" alt="Reverse Swap">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="shop-section-wrapper"> <h3>Buy Items</h3> <div class="shop-items" id="shopItems"></div> </div> 
                </section>

                <section id="crafting-page" class="page-content">
                    <h2 class="page-title">CRAFTING</h2>
                    <div class="crafting-gif-container">
                    <img src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/CRAFT.gif" alt="Crafting Anvil GIF">
                    </div>
                    <div class="crafting-section-wrapper"> 
                        <h3 >Craft Items</h3> 
                        <div class="crafting-items-container" id="craftingItemsContainer"> </div> 
                    </div> 
                </section>

                <section id="inventory-page" class="page-content"> 
                    <h2 class="page-title">INVENTORY</h2> 
                    <div class="equipment-slots-container"> 
                        <h4 >EQUIPPED ITEMS</h4> 
                        <div class="equipment-slots" id="equipmentSlotsDisplay"> </div> 
                    </div> 
                    <h4 >My Items</h4> 
                    <div class="inventory-items-container" id="inventoryItemsContainer"> </div> 
                </section>
                <section id="upgrade-page" class="page-content">
                    <h2 class="page-title">UPGRADE STATION</h2>
                    <div class="upgrade-main-image-container">
                        <img src="https://raw.githubusercontent.com/nvoiy/pvadventures/main/UPGRADE.gif" alt="Upgrade Anvil">
                    </div>
                     <p style="text-align:center; margin-top: 5px; margin-bottom:10px; font-size:0.9em;">Using a higher tier scroll than the item's base tier (for a compatible level upgrade) grants a +10% success chance bonus!</p>
                    <div class="upgrade-interface">
                        <div id="upgradeItemSlot" class="upgrade-slot">
                            <div id="selectedItemForUpgradeDisplay">Item: None</div>
                        </div>
                        <div id="upgradeScrollSlot" class="upgrade-slot">
                             <div id="selectedScrollForUpgradeDisplay">Scroll: None</div>
                        </div>
                        <button id="upgradeItemButton" class="action-button">Upgrade Item</button>
                        <div id="upgradeSuccessRateDisplay"></div>
                        <div id="upgradeResultDisplay"></div>
                    </div>
         <p style="text-align:center; margin-top: 15px; font-size:0.95em;">
            Item levels enhance their effectiveness. Each level applies an increasing percentage bonus directly to the item's base stats/perks: +15% at +1, +25% at +2, +35% at +3, +50% at +4, and a +70% at +5. Max level is +5. High risk, high reward! Failed upgrades will destroy the item
        </p>
        </section>
                <section id="leaderboard-page" class="page-content">
                    <h2 class="page-title">LEADERBOARDS</h2>
                    <div class="leaderboard-filters">
                        <button class="leaderboard-filter-btn active" data-resource="pvTokens">PV Tokens</button>
                        <button class="leaderboard-filter-btn" data-resource="gold">Gold</button>
                        <button class="leaderboard-filter-btn" data-resource="diamonds">Diamonds</button>
                    </div>
                    <div class="leaderboard-container">
                        <h4 id="leaderboardCurrentTypeTitle">PV Token Leaders</h4>
                        <ul id="leaderboardDisplayList" class="leaderboard-list">
                            <li>Click a filter above to load a leaderboard.</li>
                        </ul>
                    </div>
                     <p style="text-align:center; font-size:0.9em;">Note: If leaderboards show errors, your Firebase may be missing required indexes for 'pvTokens', 'gold', and 'diamonds' (descending) on the 'playerProgress' collection. Check Firebase console.</p>
                </section>
            <section id="whitelist-page" class="page-content">
                <h2 class="page-title">GIVEAWAYS</h2>

                <!-- +++ ADDED IMAGE CONTAINER AND IMAGE +++ -->
                <div class="help-gif-container" style="margin-bottom: 25px; margin-top: 10px;">
                    <img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeifgvccwywco2krikcarmjhoeosv44rt6njhxlfuegq5zngln7qnqe" alt="Giveaways Banner" style="max-width: 400px; width: 80%; height: auto; border-radius: 8px; border: 2px solid var(--border-color);">
                </div>
                <!-- +++ END OF ADDED IMAGE +++ -->

                <div id="adminRafflePanel" class="hidden">
                    <h3>Create New Raffle</h3>
                        <form id="createRaffleForm">
                            <div class="admin-form-group">
                                <label for="raffleName">Raffle Name:</label>
                                <input type="text" id="raffleName" required>
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleDescription">Description:</label>
                                <textarea id="raffleDescription" required></textarea>
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleImageUrl">Image URL:</label>
                                <input type="text" id="raffleImageUrl" placeholder="https://example.com/image.png">
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleSocialX">Project X/Twitter URL:</label>
                                <input type="text" id="raffleSocialX" placeholder="https://x.com/project">
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleSocialDiscord">Project Discord URL:</label>
                                <input type="text" id="raffleSocialDiscord" placeholder="https://discord.gg/project">
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleCostPV">Cost (PV Tokens):</label>
                                <input type="number" id="raffleCostPV" value="0" min="0">
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleCostGold">Cost (Gold):</label>
                                <input type="number" id="raffleCostGold" value="0" min="0">
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleCostDiamonds">Cost (Diamonds):</label>
                                <input type="number" id="raffleCostDiamonds" value="0" min="0">
                            </div>
                             <div class="admin-form-group">
                                <label for="raffleDurationHours">Duration (Hours - game time):</label>
                                <input type="number" id="raffleDurationHours" value="24" min="1" required>
                            </div>
                            <div class="admin-form-group">
                                <label for="raffleMaxWinners">Number of Winners:</label>
                                <input type="number" id="raffleMaxWinners" value="1" min="1" required>
                            </div>
                            <button type="submit" class="action-button">Create Raffle</button>
                        </form>
                    </div>
                    <div id="whitelistRafflesContainer">
                        <!-- Raffles will be dynamically inserted here -->
                    </div>
                </section>
                <section id="help-page" class="page-content"> 
                    <h2 class="page-title">PUNK VOYAGE HELP</h2> 
                    <div class="help-content"> 
                        <h3>Welcome, Voyager!</h3>
                        <p>Embark on an epic journey in Punk Voyage Adventures! This guide will help you navigate the cosmos of possibilities, from sending your brave adventurers on perilous quests to crafting legendary gear.</p>

                        <div class="help-gif-container">
                            <img src="https://beige-managing-snail-510.mypinata.cloud/ipfs/bafybeibyu3nj3yofxnngakyoyekde2vyffe73mnesrw3ogqmidrm3wgpli" alt="Helpful Guide GIF">
                        </div>

                        <h3>Getting Started</h3>
                        <ul>
                            <li><strong>Account:</strong> Create an account using Email/Password (don't forget to set a cool Nickname!) or sign in quickly with your Google account. Your game progress is saved automatically to the Firebase cloud, linked to your account.</li>
                            <li><strong>Nickname:</strong> Your chosen nickname will be your identity in the game world and for raffles.</li>
                            <li><strong>Interface:</strong> The game starts in Dark Mode. You can toggle to Light Mode using the switch in the top-right header. Use the main menu (usually on the right) to navigate between game sections.</li>
                        </ul>

                        <h3>The Core Voyage</h3>
                        <ul>
                            <li><strong>Adventurers:</strong> You have a set number of adventurers (initially 5). Below your adventurer count in the left sidebar, you'll see your current total Attack and Defense power derived from your equipped items.</li>
                            <li><strong>Adventures Page:</strong> This is where the action begins!
                                <ul>
                                    <li>Select an available adventure location.</li>
                                    <li>Choose how many of your available adventurers to send.</li>
                                    <li>Click "SEND". Some adventures have minimum adventurer requirements. If an adventure is already active, this button may change to "ADD MORE (+)" allowing you to send additional adventurers (this will reset the adventure timer).</li>
                                    <li><strong>Cancel Adventure:</strong> In the "ACTIVE ADVENTURES" list in the right sidebar, you can click the "" button next to an adventure to cancel it. Adventurers return immediately, but no rewards are given. A confirmation will be asked.</li>
                                    <li><strong>Progression:</strong> New, more challenging (and rewarding!) adventures unlock as you complete prerequisites, often by finishing earlier adventure series multiple times (e.g., "Complete Spirit Forest 5 times"). Locked adventures will show their unlock requirements.</li>
                                    <li><strong>Duration:</strong> Each adventure takes a set amount of time. Keep an eye on the "Active Adventures" list in the sidebar! (Remember: for testing, 1 game hour = 1 real second).</li>
                                    <li><strong>Rewards:</strong> Upon return, adventurers bring back <strong>PV Tokens</strong>, and have a chance to find <strong>Gold</strong>, rare <strong>Diamonds</strong>, and crafting <strong>Materials</strong>.</li>
                                    <li><strong>Milestone Reward:</strong> Every 100 adventures completed (any type, cumulative) will grant you a bonus of 50 Gold and 1 Diamond! This is noted on the Adventures page.</li>
                                    <li><strong>Drops:</strong> Hover over the "DROPS" button on an adventure card to see a list of potential material drops and their chances.</li>
                                </ul>
                            </li>
                            <li><strong>Materials:</strong> Gathered from adventures, these are essential for crafting items. View your current stash under "MY MATERIALS" in the left sidebar, now grouped by tier. You will also find your <strong>Upgrade Scroll</strong> counts here (Low, Middle, High), shown in green text.</li>
                        </ul>

                        <h3>Currencies & Economy</h3>
                        <ul>
                            <li><strong>PV Tokens:</strong> Earned primarily from adventures and quests. Used to buy items from the Shop.</li>
                            <li><strong>Gold:</strong> A rarer currency found on adventures, as special rewards, or from the 100-adventure milestone. Its main use currently is to swap for Diamonds.</li>
                            <li><strong>Diamonds:</strong> A premium currency. Obtainable by swapping Gold, as rare drops from high-level adventures, specific quest rewards, or from the 100-adventure milestone. Diamonds might be used for exclusive items or features in the future.</li>
                            <li><strong>Currency Swap:</strong> In the "Shop" page, you can swap 100 Gold for 1 Diamond, or 1 Diamond for 100 Gold.</li>
                        </ul>

                        <h3>Shop</h3>
                        <ul>
                             <li>Purchase consumable items like Potions and Upgrade Scrolls using PV Tokens.</li>
                             <li><strong>Potions:</strong> Provide temporary buffs. You cannot have multiple identical potions active simultaneously.</li>
                             <li><strong>Rider Scroll (Unlock):</strong> A one-time purchase from the shop for <strong>50,000 PV</strong>. This item goes to your inventory. You then "Use" it from the locked Ring 2 slot in your Equipment (Inventory page) to permanently unlock it.</li>
                             <li><strong>Upgrade Scrolls:</strong> Basic, Advanced, and Master scrolls are available for item upgrades. You can buy these in quantities of 1 to 10. Purchasing these adds to your scroll count (visible in "MY MATERIALS"). Scroll prices are 125 PV (Basic), 250 PV (Advanced), and 500 PV (Master).
                                <ul>
                                    <li><strong>Basic Upgrade Scroll (Tier 1 Scroll):</strong> Used for upgrading items from level +0 to +1. Cannot be used on items that are already +1 or higher.</li>
                                    <li><strong>Advanced Upgrade Scroll (Tier 2 Scroll):</strong> Used for upgrading items that are currently level +0, +1, or +2 (to become +1, +2, or +3 respectively).</li>
                                    <li><strong>Master Upgrade Scroll (Tier 3 Scroll):</strong> Used for upgrading items that are currently level +0, +1, +2, +3, or +4 (to become +1 up to +5 respectively).</li>
                                    <li>A +10% success chance bonus is applied if you use a scroll of a higher tier (Advanced or Master) on an item whose base tier is lower than the scroll's effective tier, provided the scroll is compatible with the item's current level. (e.g., Advanced Scroll on a Tier 0/1 item, or Master Scroll on a Tier 0/1/2 item).</li>
                                </ul>
                             </li>
                                </ul>
                             </li>
                        </ul>
                        <h3>Crafting</h3>
                        <ul>
                            <li>Visit the "Crafting" page. The crafting GIF is now located here.</li>
                            <li>Use materials collected from adventures to craft powerful equipment.</li>
                            <li>You'll see a list of craftable items and their required materials. Hover over an item to see its full stats and recipe.</li>
                            <li>You cannot craft an item if you already own an instance of that base item ID. If an item is destroyed during a failed upgrade, you can then craft a new +0 version. You will be prompted to craft the item again if an upgrade fails.</li>
                        </ul>
                        
                        <h3>Inventory & Equipment</h3>
                        <ul>
                            <li><strong>View Items:</strong> The Inventory page shows all items you've crafted or bought (excluding Upgrade Scrolls). Hover over items to see their details. Upgraded items will show their level (e.g., +1, +2).</li>
                            <li><strong>Equip Items:</strong> Equip your crafted gear to gain passive bonuses, which contribute to your Attack and Defense stats shown in the left sidebar.
                                <ul>
                                    <li><strong>Slots:</strong> Armour, Helmet, Boots, Amulet, Ring 1, Ring 2, Weapon, Misc 1, Misc 2.</li>
                                    <li><strong>Unlocking Ring 2:</strong> Purchase the "Rider Scroll (Unlock)" from the Shop. It appears in "My Items". Go to "Inventory", and in "EQUIPPED ITEMS", click "Use Rider Scroll" on the locked Ring 2 slot. This consumes the scroll and unlocks the slot.</li>
                                </ul>
                            </li>
                            <li><strong>Unequip:</strong> You can unequip items. They return to "My Items".</li>
                            <li><strong>Item Levels:</strong> Items start at +0. They can be upgraded up to +5. +4 items have an orange highlight, +5 items have a dark red highlight. Item levels enhance their base effectiveness (+0% at +0, +5% at +1, +10% at +2, +15% at +3, +20% at +4, +25% at +5).</li>
                        </ul>

                        <h3>Item Upgrading (Upgrade Station)</h3>
                        <ul>
                            <li>Visit the "Upgrade" page.</li>
                            <li>Select an equippable item (from +0 to +4) and an Upgrade Scroll type. The pop-up shows your scroll counts.</li>
                            <li><strong>Scroll Compatibility & Bonus:</strong>
                                <ul>
                                    <li><strong>Basic Upgrade Scrolls (Tier 1 Scroll):</strong> Can *only* be used to upgrade an item from +0 to +1. The item's base tier (0-4) does not prevent its use for this specific +0 to +1 upgrade.</li>
                                    <li><strong>Advanced Upgrade Scrolls (Tier 2 Scroll):</strong> Can be used if the item's current level is +0, +1, or +2. The item's base tier (0-4) does not prevent its use. A +10% success chance bonus is granted if the item's base tier is 0 or 1 (lower than the scroll's tier).</li>
                                    <li><strong>Master Upgrade Scrolls (Tier 3 Scroll):</strong> Can be used if the item's current level is +0, +1, +2, +3, or +4. The item's base tier (0-4) does not prevent its use. A +10% success chance bonus is granted if the item's base tier is 0, 1, or 2 (lower than the scroll's tier).</li>
                                </ul>
                            </li>
                            <li>The success chance for the upgrade will be displayed.</li>
                            <li>Attempting an upgrade:
                                <ul>
                                    <li><strong>Success:</strong> Item level increases (e.g., +0 becomes +1). The item remains in the upgrade slot.</li>
                                    <li><strong>Failure:</strong> Item is **DESTROYED**! You'll be asked if you want to craft a new +0 version (if you have materials). If the destroyed item was equipped, and you re-craft it, it will be automatically re-equipped to its previous slot.</li>
                                </ul>
                            </li>
                            <li>Base Upgrade Chances (before any +10% bonus from higher-tier scrolls): +0 to +1 (100%), +1 to +2 (85%), +2 to +3 (50%), +3 to +4 (35%), +4 to +5 (13%). Max level is +5.</li>
                        </ul>

                        <h3>Other Features</h3>
                        <ul>
                            <li><strong>Dungeons:</strong> (Coming Soon!) Placeholder dungeons are now visible.</li>
                            <li><strong>Quests:</strong> Complete objectives for rewards. Claim from the Quests page.</li>
                            <li><strong>Daily Login Rewards:</strong> Claim a reward every 24 hours.</li>
                            <li><strong>Whitelist Raffles:</strong> Participate in raffles.</li>
                            <li><strong>Leaderboards:</strong> See top players. (Index errors require Firebase console setup).</li>
                        </ul>

                        <h3>Community & Support</h3>
                        <ul>
                            <li><strong>Socials:</strong> Join our community! Links in header.</li>
                            <li><strong>Game Status:</strong> Punk Voyage Adventures is evolving. Feedback is valued!</li>
                        </ul>
                        <p>Good luck on your voyages, Voyager! May your hauls be plentiful and your Punks legendary!</p>
                    </div> 
                </section>
            </div>
            <aside class="right-sidebar-menu"> <nav class="main-menu-nav"> <div class="menu-button-container-fixed"><button class="menu-button" id="mainMenuToggleBtn">MENU</button></div> <div class="sidebar-content-area" id="sidebarContentArea"> <ul class="main-menu-nav-list" id="mainMenuList"> 
                <li data-page="adventures-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/adventures.jpg" alt="" class="menu-item-icon">ADVENTURES</li>  
                <li data-page="dungeons-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/dungeons.jpg" alt="" class="menu-item-icon">DUNGEONS</li> 
                <li data-page="quests-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/quest.jpg" alt="" class="menu-item-icon">QUESTS</li> 
                <li data-page="daily-rewards-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/reward.jpg" alt="" class="menu-item-icon">DAILY LOGIN REWARDS</li> 
                <li data-page="shop-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/shop.jpg" alt="" class="menu-item-icon">SHOP</li> 
                <li data-page="crafting-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/crafting.jpg" alt="" class="menu-item-icon">CRAFTING</li> 
                <li data-page="inventory-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/stash.jpg" alt="" class="menu-item-icon">INVENTORY</li>  
                <li data-page="upgrade-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/anvil.jpg" alt="" class="menu-item-icon">UPGRADE</li> 
                <li data-page="leaderboard-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/leaderboard.jpg" alt="" class="menu-item-icon">LEADERBOARD</li> 
                <li data-page="whitelist-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihen2etj7vabkt7rwtxsstvgqixhu7aww7eri7j3w5qcjux7ssxzm/star.jpg" alt="" class="menu-item-icon">GIVEAWAYS</li> 
                <li data-page="help-page" class="menu-list-item"><img src="https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/help.jpg" alt="" class="menu-item-icon">HELP</li> </ul> <div class="sidebar-active-adventures-container" id="sidebarActiveAdventuresDisplay"> <h3>ACTIVE ADVENTURES</h3> <div id="sidebarActiveAdventuresList"></div> </div> <div class="active-potions-display hidden" id="activePotionsDisplay"> <h4>ACTIVE POTIONS</h4> <div id="activePotionsList"></div> </div> </div> </nav> </aside>
        </main>
    </div>

    <div id="customPopupOverlay" class="hidden"></div>
    <div id="customPopup" class="hidden">
        <h3 id="customPopupTitle">Notification</h3>
        <div id="customPopupMessage"></div> 
        <div id="customPopupButtons">
            <button id="customPopupConfirmBtn" class="action-button hidden">Confirm</button>
            <button id="customPopupCancelBtn" class="action-button hidden">Cancel</button>
            <button id="customPopupCloseBtn" class="action-button">OK</button>
        </div>
    </div>

    <!-- Item Selection Modal for Upgrading -->
    <div id="itemSelectionModalOverlay" class="hidden"></div>
    <div id="itemSelectionModal" class="hidden">
        <h3 id="itemSelectionModalTitle">Select Item</h3>
        <div id="itemSelectionModalList"></div>
        <button id="itemSelectionModalCloseBtn" class="action-button">Cancel</button>
    </div>

    <!-- Item Selection Modal for Upgrading -->
    <div id="itemSelectionModalOverlay" class="hidden"></div>
    <div id="itemSelectionModal" class="hidden">
        <h3 id="itemSelectionModalTitle">Select Item</h3>
        <div id="itemSelectionModalList"></div>
        <button id="itemSelectionModalCloseBtn" class="action-button">Cancel</button>
    </div>

    <!-- +++ NEW: Dungeon Crawler Selection Modal +++ -->
    <div id="dungeonCrawlerSelectionModalOverlay" class="hidden"></div>
    <div id="dungeonCrawlerSelectionModal" class="hidden">
        <h3 id="dungeonCrawlerSelectionModalTitle">Select Dungeon Crawlers</h3>
        <p id="dungeonCrawlerSelectionModalInfo" style="font-size: 0.9em; margin-bottom: 10px;">Select up to <span id="dungeonCrawlerMaxSelectCount">0</span> crawlers for this dungeon. (Future: Their stats will aid you!)</p>
        <div id="availableDungeonCrawlersList" style="max-height: 300px; overflow-y: auto; margin-bottom: 15px; border: 1px solid var(--border-color); padding: 10px;">
            <!-- Available crawlers will be listed here -->
        </div>
        <h4>Selected Crawlers:</h4>
        <div id="selectedDungeonCrawlersDisplay" style="min-height: 50px; border: 1px dashed var(--border-color); padding: 10px; margin-bottom: 15px;">
            <!-- Selected crawlers will appear here -->
        </div>
        <div id="dungeonCrawlerSelectionModalButtons" style="display: flex; justify-content: center; gap: 15px;">
            <button id="dungeonCrawlerConfirmSelectionBtn" class="action-button">Confirm Selection</button>
            <button id="dungeonCrawlerCancelSelectionBtn" class="action-button">Cancel</button>
        </div>
    </div>
    <!-- +++ END OF NEW MODAL +++ -->

    <script type="module" id="firebaseModule">
        // ... your firebase script ...
    </script>

    <script type="module" id="firebaseModule">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, Timestamp, query, where, orderBy, getDocs, addDoc, runTransaction, updateDoc, deleteDoc, limit } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"; 
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";


        const firebaseConfig = {
            apiKey: "AIzaSyASoKVnbNVJBASSPEnWOvkocTwM16ijNxM", 
            authDomain: "punkvoyage.firebaseapp.com",
            projectId: "punkvoyage",
            storageBucket: "punkvoyage.appspot.com", 
            messagingSenderId: "929081617432",
            appId: "1:929081617432:web:1603e242f9cceb79ee676d",
            measurementId: "G-R5ESCD03L9"
        };
        

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const analytics = getAnalytics(app); 
            const auth = getAuth(app); 

            window.firebaseApp = app;
            window.firebaseDb = db;
            window.fbAuth = auth; 
            window.firebaseFirestore = { doc, getDoc, setDoc, collection, Timestamp, query, where, orderBy, getDocs, addDoc, runTransaction, updateDoc, deleteDoc, limit }; 
            window.firebaseAuthFunctions = { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup }; 
            
            document.dispatchEvent(new CustomEvent('firebaseReady'));
            console.log("Firebase Initialized Successfully (including Auth with Google) and 'firebaseReady' event dispatched.");

        } catch (error) {
            console.error("Firebase initialization failed:", error);
            setTimeout(() => { 
                const popupTitle = document.getElementById('customPopupTitle');
                const popupMessage = document.getElementById('customPopupMessage');
                const popupOverlay = document.getElementById('customPopupOverlay');
                const popupItself = document.getElementById('customPopup');
                if (popupTitle && popupMessage && popupOverlay && popupItself) {
                     popupTitle.textContent = "Critical Error";
                     popupMessage.innerHTML = "Failed to connect to game services. Please ensure your Firebase configuration is correct and you are online. Error: " + error.message;
                     popupOverlay.classList.remove('hidden');
                     popupItself.classList.remove('hidden');
                } else {
                    alert("CRITICAL FIREBASE ERROR: " + error.message + "\nCheck Firebase config and internet connection."); 
                }
            }, 100);
        }
    </script>

    <script>
        
        document.addEventListener('firebaseReady', async () => {
                   let punkVoyageIdsLoaded = false;
                    console.log("FirebaseReady event triggered. Starting main script logic.");
                const userOrdinalsDisplayElement = document.getElementById('userOrdinalsDisplay');
    const userOrdinalsListElement = document.getElementById('userOrdinalsList');
    let PUNK_VOYAGE_IDS_SET = new Set(); // To store your fixed inscription IDs for quick lookup
    const PUNK_VOYAGE_ID_IMAGE_CACHE = {}; // Simple cache for inscription images

function updateAdventureCardPvDisplay() {
            // The actual body of this function should start here.
            // For example, from your previous working code:
            console.log("Updating adventure card PV displays...");
            const adventureSendButtons = document.querySelectorAll('.adventure-send-btn');
            adventureSendButtons.forEach(button => {
                const adventureBlock = button.closest('.adventure');
                if (!adventureBlock) return;

                const detailsDiv = adventureBlock.querySelector('.adventure-details');
                if (!detailsDiv) return;

                const prizeSpan = detailsDiv.querySelector('.prize');
                if (prizeSpan && button.dataset.pvReward) {
                    const basePvFromButton = parseInt(button.dataset.pvReward);
                    const displayPv = basePvFromButton * 2; // Calculate the doubled PV for display
                    prizeSpan.innerHTML = prizeSpan.innerHTML.replace(/(PRIZE\s*=\s*)(\d+)(\s*PV TOKENS)/i, `$1${displayPv}$3`);
                    console.log(`Updated PV display for ${button.dataset.adventureName} to ${displayPv}`);
                }
            });
        } 
            console.log("'firebaseReady' event received by main script. Initializing game logic.");
            
            const db = window.firebaseDb;
            const auth = window.fbAuth; 
            const { doc, getDoc, setDoc, collection, Timestamp, query, where, orderBy, getDocs, addDoc, runTransaction, updateDoc, deleteDoc, limit } = window.firebaseFirestore;
            const { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut: fbSignOut, onAuthStateChanged, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup } = window.firebaseAuthFunctions; 

            const GAME_HOUR_IN_REAL_SECONDS = 1; 
            const TWENTY_FOUR_HOURS_MS = 24 * 60 * 60 * 1000;


            // --- HTML Element Constants ---
            const welcomeScreen = document.getElementById('welcomeScreen');
            const authFormContainer = document.getElementById('authFormContainer');
            const authFormTitle = document.getElementById('authFormTitle');
            const loginRegisterForm = document.getElementById('loginRegisterForm');
            const authEmailInput = document.getElementById('authEmail');
            const authPasswordInput = document.getElementById('authPassword');
            const authNicknameField = document.getElementById('authNicknameField');
            const authNicknameInput = document.getElementById('authNickname');
            const loginButton = document.getElementById('loginButton');
            const registerButton = document.getElementById('registerButton');
            const googleSignInButton = document.getElementById('googleSignInButton'); 
            const authToggleLink = document.getElementById('authToggleLink');
            const forgotPasswordLink = document.getElementById('forgotPasswordLink');
            const signOutButton = document.getElementById('signOutButton');

            const gameContainer = document.getElementById('gameContainer');
            const playerNicknameDisplay = document.getElementById('playerNicknameDisplay');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const body = document.body;
            const twitterWidgetContainer = document.getElementById('twitter-widget-container');
            const pvCountElement = document.getElementById('pvCount');
            const goldCountElement = document.getElementById('goldCount');
            const diamondCountElement = document.getElementById('diamondCount');
            const adventureSendButtons = document.querySelectorAll('.adventure-send-btn');
            const adventureDropButtons = document.querySelectorAll('.adventure-drops-button');
            
            const swapInfoDisplay = document.getElementById('swapInfoDisplay');
            const swapBtn = document.getElementById('swapBtn');
            const reverseSwapDirectionBtn = document.getElementById('reverseSwapDirectionBtn');

            const sidebarActiveAdventuresContainer = document.getElementById('sidebarActiveAdventuresDisplay'); 
            const sidebarActiveAdventuresList = document.getElementById('sidebarActiveAdventuresList');
            const activePotionsDisplay = document.getElementById('activePotionsDisplay');
            const activePotionsList = document.getElementById('activePotionsList');
            const availableAdventurersCountElement = document.getElementById('availableAdventurersCount');
            const playerAttackStatElement = document.getElementById('playerAttackStat');
            const playerDefenseStatElement = document.getElementById('playerDefenseStat');

            const menuItems = document.querySelectorAll('.right-sidebar-menu .main-menu-nav-list li');
            const pageContents = document.querySelectorAll('.main-content-area .page-content'); 
            const questListDiv = document.getElementById('questList');
            const shopItemsDiv = document.getElementById('shopItems');
            const materialsListContainer = document.getElementById('materialsListContainer'); 
            const craftingItemsContainer = document.getElementById('craftingItemsContainer');
            const inventoryItemsContainer = document.getElementById('inventoryItemsContainer');
            const equipmentSlotsDisplay = document.getElementById('equipmentSlotsDisplay');
            const dailyRewardsGrid = document.getElementById('dailyRewardsGrid');
            const customPopupOverlay = document.getElementById('customPopupOverlay');
            const customPopup = document.getElementById('customPopup');
            const customPopupTitleEl = document.getElementById('customPopupTitle');
            const customPopupMessageEl = document.getElementById('customPopupMessage');
            const customPopupButtonsEl = document.getElementById('customPopupButtons');
            const customPopupCloseBtn = document.getElementById('customPopupCloseBtn');
            const customPopupConfirmBtn = document.getElementById('customPopupConfirmBtn');
            const customPopupCancelBtn = document.getElementById('customPopupCancelBtn');
            const adminRafflePanel = document.getElementById('adminRafflePanel');
            const createRaffleForm = document.getElementById('createRaffleForm');
            const whitelistRafflesContainer = document.getElementById('whitelistRafflesContainer');
            const itemTooltipElement = document.getElementById('itemTooltip');


            // Leaderboard elements
            const leaderboardFilterButtons = document.querySelectorAll('.leaderboard-filter-btn');
            const leaderboardDisplayList = document.getElementById('leaderboardDisplayList');
            const leaderboardCurrentTypeTitle = document.getElementById('leaderboardCurrentTypeTitle');
            
            // Upgrade Page Elements
            const upgradeItemSlot = document.getElementById('upgradeItemSlot');
            const upgradeScrollSlot = document.getElementById('upgradeScrollSlot');
            const selectedItemForUpgradeDisplay = document.getElementById('selectedItemForUpgradeDisplay');
            const selectedScrollForUpgradeDisplay = document.getElementById('selectedScrollForUpgradeDisplay');
            const upgradeItemButton = document.getElementById('upgradeItemButton');
            const upgradeSuccessRateDisplay = document.getElementById('upgradeSuccessRateDisplay');
            const upgradeResultDisplay = document.getElementById('upgradeResultDisplay');
            const itemSelectionModalOverlay = document.getElementById('itemSelectionModalOverlay');
            const itemSelectionModal = document.getElementById('itemSelectionModal');
            const itemSelectionModalTitle = document.getElementById('itemSelectionModalTitle');
            const itemSelectionModalList = document.getElementById('itemSelectionModalList');
            const itemSelectionModalCloseBtn = document.getElementById('itemSelectionModalCloseBtn');
             const activeSpecialtiesDisplay = document.getElementById('activeSpecialtiesDisplay');
            const toggleSpecialtiesBtn = document.getElementById('toggleSpecialtiesBtn');
            const specialtiesListContainer = document.getElementById('specialtiesListContainer');
                const dungeonCrawlerSelectionModalOverlay = document.getElementById('dungeonCrawlerSelectionModalOverlay');
            const dungeonCrawlerSelectionModal = document.getElementById('dungeonCrawlerSelectionModal');
            const dungeonCrawlerSelectionModalTitle = document.getElementById('dungeonCrawlerSelectionModalTitle');
            const dungeonCrawlerSelectionModalInfo = document.getElementById('dungeonCrawlerSelectionModalInfo');
            const dungeonCrawlerMaxSelectCountSpan = document.getElementById('dungeonCrawlerMaxSelectCount');
            const availableDungeonCrawlersListDiv = document.getElementById('availableDungeonCrawlersList');
            const selectedDungeonCrawlersDisplayDiv = document.getElementById('selectedDungeonCrawlersDisplay');
            const dungeonCrawlerConfirmSelectionBtn = document.getElementById('dungeonCrawlerConfirmSelectionBtn');
            const dungeonCrawlerCancelSelectionBtn = document.getElementById('dungeonCrawlerCancelSelectionBtn');

            // --- Game State Variables ---
            let currentUser = null; 
            let userNickname = ''; 
            const MAX_PLAYER_ADVENTURERS = 1;
            let currentPvTokens = 0; let currentGold = 0; let currentDiamonds = 0;
            let activeAdventures = []; let nextActiveAdventureId = 0;
            let totalAvailableAdventurers = MAX_PLAYER_ADVENTURERS;
            let playerInventory = []; 
            let nextUniqueInstanceId = 0; 
            let playerScrolls = { low: 0, middle: 0, high: 0 };
            let playerHasPurchasedRiderScroll = false;
            let playerHasPurchasedPetWhistle = false;
            let totalAdventuresCompleted = 0;
            let ordinalBonusAdventurers = 0;
            let activeDungeons = [];


            const initialPlayerMaterials = { 
                "Leather": 0, "Wood": 0, "Clover": 0, "Fabric": 0, "Iron": 0, "Gizmo Tail": 0, 
                "Stone": 0, "Obsidian": 0, "Bitcoin": 0, "Bone": 0, "Flame Essence": 0, 
                "Essence of Death": 0, "Rider's Sigil": 0, "Ancient Tablet Fragment": 0, "Shadowgem": 0,                 "Glitch Fabric": 0, "Quantum Shard": 0
            };
            let playerMaterials = { ...initialPlayerMaterials };

            let equippedItems = {
                Armour: null, Helmet: null, Boots: null, Amulet: null,
                Ring1: null, Ring2: null, Weapon: null, Pet: null, // ADDED Pet: null
                Misc1: null, Misc2: null
            };
            let playerAdventurerLevel = 1; 
            let secondRingSlotUnlocked = false;
                    let petSlotUnlocked = false;
            let activePotions = [];
            let allRaffles = []; 
            let playerRaffleEntries = {}; 
            
let lastDailyRewardDayClaimed = 0;
            let lastDailyRewardClaimTimestamp = 0;

            // +++ NEW DUNGEON STATE VARIABLES +++
            let playerDungeonEntriesToday = { dungeon_1: 0, dungeon_2: 0 };
            let lastDungeonResetTimestamp = 0;
            let playerDungeonCrawlers = []; // To store owned Dungeon Crawler NFT instances
            const PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET = new Set(); // Will be populated later
            let dungeonCrawlerIdsLoaded = false;
            // +++ END OF NEW DUNGEON STATE VARIABLES +++

            let popupMessageQueue = [];
            let isPopupCurrentlyVisible = false;
            let currentPopupCraftCallback = null; 
            let currentPopupConfirmCallback = null;


            let selectedItemForUpgrade = null; 
            let selectedScrollForUpgrade = null; 
            let isGoldToDiamondSwap = true;
            let walletVerificationPendingForBonus = false;

            
            // --- Game Data ---
             const adventuresData = { 
                "1": { name: "Spirit Forest", drops: [ { name: "Leather", chance: 0.15, qty: 1}, { name: "Wood", chance: 0.20, qty: 1}, { name: "Clover", chance: 0.05, qty: 1}, { name: "Fabric", chance: 0.04, qty: 1} ] }, 
                "2": { name: "Mountain of the Marowan", drops: [ { name: "Iron", chance: 0.15, qty: 1}, { name: "Gizmo Tail", chance: 0.03, qty: 1}, { name: "Stone", chance: 0.20, qty: 1} ] }, 
                "3": { name: "Fire Fields of Flyinals", adventurerRequirement: 2, drops: [ { name: "Obsidian", chance: 0.15, qty: 1}, { name: "Bitcoin", chance: 0.001, qty: 1}, { name: "Flame Essence", chance: 0.085, qty: 1} ] }, 
                "4": { name: "Tomb of the Death Riders", adventurerRequirement: 5, drops: [ { name: "Bone", chance: 0.25, qty: 1}, { name: "Essence of Death", chance: 0.15, qty: 1}, { name: "Bitcoin", chance: 0.019, qty: 1},  { name: "Rider's Sigil", chance: 0.14, qty: 1}, { name: "Ancient Tablet Fragment", chance: 0.08, qty: 1}, { name: "Shadowgem", chance: 0.05, qty: 1} ] },
                            "5": { 
                name: "The Cyber Void Echo", 
                adventurerRequirement: 10, 
                drops: [ 
                    { name: "Glitch Fabric", chance: 0.05, qty: 1 }, // New Material 1
                    { name: "Quantum Shard", chance: 0.05, qty: 1 }  // New Material 2
                ] 
            },
            "5": { 
                    name: "The Cyber Void Echo", 
                    adventurerRequirement: 10,
                    guaranteedGold: 5, // Add this
                    diamondRewardMultiplier: 3, // Add this (applied if diamondChance hits)
                    drops: [ 
                        { name: "Glitch Fabric", chance: 0.05, qty: 1 }, 
                        { name: "Quantum Shard", chance: 0.05, qty: 1 }
                    ] 
                }
            };
            const materialTiers = {
                1: ["Leather", "Wood", "Clover", "Fabric"],
                2: ["Iron", "Gizmo Tail", "Stone"],
                3: ["Obsidian", "Bitcoin", "Flame Essence"], 
                4: ["Bone", "Essence of Death", "Rider's Sigil", "Ancient Tablet Fragment", "Shadowgem"],
                5: ["Glitch Fabric", "Quantum Shard"]
            };
                         const scrollData = { // scrollTier: 1=Basic (+0->+1), 2=Advanced (Up to +3), 3=Master (Up to +5)
                low: { name: "Basic Upgrade Scroll", descriptionName: "Basic Upgrade Scroll (+0 to +1)", icon: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/low%20upgrade%20scroll.jpg", tier: 1, shopId: "scroll_low" },
                middle: { name: "Advanced Upgrade Scroll", descriptionName: "Advanced Upgrade Scroll (Up to +3)", icon: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/middle%20upgrade%20scroll.jpg", tier: 2, shopId: "scroll_mid" },
                high: { name: "Master Upgrade Scroll", descriptionName: "Master Upgrade Scroll (Up to +5)", icon: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafkreicbt5kelkj3ph32jykjslocal24sn3srfjttq7pfg75bqjagrzlyi", tier: 3, shopId: "scroll_high"}
            };

            const craftableItemsData = [ // item tier: 0-4
                { id: "boots1", name: "Warped Boots", type: "Boots", description: "Reduces adventure time by 30 minutes.", perk: { type: "timeReduction", value: 1800 }, recipe: { "Leather": 5, "Fabric": 3 }, iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/boots.jpg", tier: 1 }, 
                { id: "amulet1", name: "Amulet of Greed", type: "Amulet", description: "Increases Gold find chance by +50% of current chance.", perk: { type: "goldChanceIncrease", value: 0.5 }, recipe: { "Iron": 3, "Gizmo Tail": 1 }, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafkreih7mmirdvzhdw3duyd67y6taqklq5qpcns6vw765msuafd74i44by", tier: 2 }, 
            { id: "rucksack1", name: "Efficient Rucksack", type: "Rucksack", description: "+10% PV tokens from adventures.", perk: { type: "pvBonus", value: 0.10 }, recipe: { "Fabric": 5, "Leather": 2 }, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihen2etj7vabkt7rwtxsstvgqixhu7aww7eri7j3w5qcjux7ssxzm/pouch.jpg", tier: 1 }, 
                { id: "trinket1", name: "Lucky Rabbit's Foot", type: "Trinket", description: "Increases material find chance by x1.3 (multiplicative).", perk: { type: "materialChanceMultiplier", value: 1.3 }, recipe: { "Clover": 3, "Bone": 2 }, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/rabbit%20foot.jpg", tier: 4 }, 
                { id: "weapon1", name: "Rider's Blade", type: "Weapon", description: "A blade echoing with the cries of the fallen. (+5 Attack)", perk: {type: "attackBoost", value: 5}, recipe: { "Rider's Sigil": 2, "Essence of Death": 3, "Iron": 5}, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/sword.jpg", tier: 4}, 
                { id: "armour1", name: "Shadow-Woven Armour", type: "Armour", description: "Provides moderate protection. (+10 Defense)", perk: {type: "defenseBoost", value: 10}, recipe: {"Obsidian": 5, "Essence of Death": 2, "Shadowgem": 1}, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/armour.jpg", tier: 4}, 
                { id: "helmet1", name: "Helm of the Silent Watcher", type: "Helmet", description: "Offers a gaze that pierces the veil. (+3 Defense)", perk: {type: "defenseBoost", value: 3}, recipe: {"Iron": 4, "Rider's Sigil": 1, "Shadowgem": 1}, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/helmet.jpg", tier: 4}, 
                { id: "ring_warding", name: "Ring of Minor Warding", type: "Ring", description: "Offers slight protection. (+1% Gold/Diamond find).", perk: {type: "flatCurrencyChanceBoost", goldBonus: 0.01, diamondBonus: 0.01}, recipe: {"Stone": 10, "Clover": 5}, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/ring1.jpeg", tier: 2}, 
                { id: "ring_swiftness", name: "Band of Swiftness", type: "Ring", description: "Slightly reduces adventure times. (-5 min)", perk: {type: "timeReduction", value: 300}, recipe: {"Leather": 8, "Gizmo Tail": 3}, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/ring2.jpeg", tier: 2}, 
            { id: "ring_cursedpower", name: "Cursed Ring of Power", type: "Ring", description: "Grants power, but at a cost. (+5 Attack, -2 Defense)", perk: {type: "statBoost", attack: 5, defense: -2}, recipe: {"Rider's Sigil": 3, "Shadowgem": 2, "Essence of Death": 1}, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeidvav6u7a4naahsxhqalytbmnr7mhmonhanqhcuerchy7fkldjiua/ring3.jpg", tier: 4},
{ // ADD THIS NEW PET
                id: "pet_gizmo",
                name: "Gizmo",
                type: "Pet",
                description: "A loyal and surprisingly resilient Gizmo. (+2 Attack, +2 Defense)",
                perk: { type: "statBoost", attack: 2, defense: 2 },
                recipe: { "Ancient Tablet Fragment": 1, "Flame Essence": 1, "Bitcoin": 1, "Wood": 10 },
                iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafkreig66h6ldt3ms7ochmu63ynuztayedsqma6ovj77bexarqb7be6qmy",
                tier: 3 
            },
            // +++ NEW DUNGEON SET & DROPS (NOT CRAFTABLE, NO RECIPES) +++
            {
                id: "dungeon_helmet", name: "Dungeon Helmet of Assault", type: "Helmet",
                description: "A sturdy helmet retrieved from the crypt. (+3 Attack)",
                perk: { type: "attackBoost", value: 3 },
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/dHELMET.jpg",
                tier: 2 // Example tier
            },
            {
                id: "dungeon_boots", name: "Dungeon Boots of Swiftness", type: "Boots",
                description: "Boots that have tread forgotten paths. (+3 Attack)",
                perk: { type: "attackBoost", value: 3 },
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/dBOOTS.jpg",
                tier: 2 // Example tier
            },
            {
                id: "dungeon_sword", name: "Crypt Lord's Blade", type: "Weapon",
                description: "A powerful sword, pulsing with dungeon energy. (+10 Attack)",
                perk: { type: "attackBoost", value: 10 },
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/dWEAPON.jpg",
                tier: 4 // Example tier
            },
            {
                id: "dungeon_armour", name: "Crypt Lord's Plate", type: "Armour",
                description: "Resilient armour forged in the depths. (+20 Defense)",
                perk: { type: "defenseBoost", value: 20 },
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/dARMOR.jpg",
                tier: 4 // Example tier
            },
 {
                id: "pizza_pendant", name: "Pizza Pendant of Greed", type: "Amulet", // Changed to Amulet for a free slot
                description: "Smells faintly of pepperoni. Grants +1 daily entry attempt to both Dungeon 1 & 2 if equipped.",
                perk: { type: "dungeonEntryBonus", dungeon1: 1, dungeon2: 1 },
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/pizzapendant.jpg",
                tier: 3
            },
            {
                id: "orb_of_haste", name: "Orb of Minor Haste", type: "Misc",
                description: "Swirls with temporal energies. Reduces adventure times by 5%.",
                perk: { type: "timeReductionPercent", value: 0.05 }, // 5% reduction
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/orbofhaste.jpg",
                tier: 3
            },
            {
                id: "pet_dog", name: "$DOG Pet", type: "Pet",
                description: "A good boy. After completing a dungeon, fetches 1 random adventure material.",
                perk: { type: "dungeonMaterialFetch", count: 1 },
                iconUrlOrColor: "https://raw.githubusercontent.com/nvoiy/pvadventures/main/pet3.jpg", // Example new icon for dog
                tier: 3 
            }
            // +++ END OF NEW DUNGEON ITEMS +++
        ];
            const shopItemsData = [ 
                { id: "potion2", name: "PV Doubler (1 Use)", description: "Doubles PV rewards from NEXT adventure.", price: 200, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/pv%20doubler.jpg", type: "buff", durationAdventures: 1, effect: { type: "pvMultiplier", value: 2 } }, 
                { id: "potion3", name: "Gold Magnet (3 Adventures)", description: "Adds +1% FLAT chance of finding gold on next 3 adventures.", price: 400, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihk33icq4ytbr5m54tor4qkibqwphgu72l3si5ydcmvkj2oav42i4/gold%20magnet.jpg", type: "buff", durationAdventures: 3, effect: { type: "goldChanceBonus", flatValue: 0.01 } }, 
                { id: "scroll_low", name: scrollData.low.descriptionName, description: "Used for upgrading items from level +0 to +1.", price: 125, iconUrlOrColor: scrollData.low.icon, type: "upgrade_scroll_purchase", scrollTypeKey: "low"},
                { id: "scroll_mid", name: scrollData.middle.descriptionName, description: "Used for items at +0, +1, or +2. Grants +10% success bonus if item's base tier is 0 or 1.", price: 250, iconUrlOrColor: scrollData.middle.icon, type: "upgrade_scroll_purchase", scrollTypeKey: "middle"},
                { id: "scroll_high", name: scrollData.high.descriptionName, description: "Used for items at +0 up to +4. Grants +10% success bonus if item's base tier is 0, 1, or 2.", price: 500, iconUrlOrColor: scrollData.high.icon, type: "upgrade_scroll_purchase", scrollTypeKey: "high"},
            { id: "rider_scroll_unlock", name: "Rider Scroll (Unlock)", description: "Permanently unlocks your second Ring Slot. One-time purchase, consumed on use from Equipment Slot.", price: 5000, iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihen2etj7vabkt7rwtxsstvgqixhu7aww7eri7j3w5qcjux7ssxzm/riders%20scroll.jpg", type: "unlockable_consumable" },
                { // ADD THIS NEW ITEM
                id: "pet_whistle_unlock",
                name: "Ancient Pet Whistle (Unlock)",
                description: "Permanently unlocks your Pet Slot. One-time purchase, consumed on use from Equipment Slot.",
                price: 5000,
                iconUrlOrColor: "https://green-tough-gopher-310.mypinata.cloud/ipfs/bafybeihen2etj7vabkt7rwtxsstvgqixhu7aww7eri7j3w5qcjux7ssxzm/petwhistle.jpg", // <-- UPDATED ICON
                type: "unlockable_consumable"
            }
        ];


            const quests = [ 
                { id: 1, text: "Complete Spirit Forest 5 times", reward: "50 PV", completed: false, progress: 0, target: 5, adventureName: "Spirit Forest" }, 
                { id: 2, text: "Complete Mountain of the Marowan 5 times", reward: "75 PV", completed: false, progress: 0, target: 5, adventureName: "Mountain of the Marowan"}, 
                { id: 3, text: "Complete Fire Fields of Flyinals 5 times", reward: "150 PV", completed: false, progress: 0, target: 5, adventureName: "Fire Fields of Flyinals"}, 
                { id: 4, text: "Venture into the Tomb of the Death Riders", reward: "250 PV, 1 Diamond", completed: false, progress: 0, target: 1, adventureName: "Tomb of the Death Riders"},
                { id: 5, text: "Craft any 3 items", reward: "100 PV", completed: false, progress: 0, target: 3, metric: "itemsCrafted" },
                { id: 6, text: "Accumulate 1000 PV Tokens", reward: "1 Gold", completed: false, progress: 0, target: 1000, metric: "pvBalance" }, 
                { id: 7, text: "Upgrade any item to +2", reward: "200 PV", completed: false, progress: 0, target: 1, metric: "itemUpgradedToPlus2" }, 
                { id: 8, text: "Collect 10 Iron materials", reward: "50 PV", completed: false, progress: 0, target: 10, metric: "materialCollected_Iron" },
                { id: 9, text: "Complete 25 total adventures (any type)", reward: "1 Diamond, 100 PV", completed: false, progress: 0, target: 25, metric: "totalAdventuresCompletedOverall" },
                { id: 10, text: "Equip a full set of Tier 1 gear (Boots, Rucksack)", reward: "150 PV", completed: false, progress: 0, target: 2, metric: "equippedTier1Set" },
                { id: 11, text: "Reach 10 Attack Power", reward: "1 Gold, 50 PV", completed: false, progress: 0, target: 10, metric: "attackPower" },
                { id: 12, text: "Successfully upgrade an item to +3", reward: "1 Diamond, 100 PV", completed: false, progress: 0, target: 1, metric: "itemUpgradedToPlus3" },
                { id: 13, text: "Use a PV Doubler Potion", reward: "25 PV", completed: false, progress: 0, target: 1, metric: "potionUsed_potion2" },
                { id: 14, text: "Find 5 Gold from adventures", reward: "100 PV, 1 Diamond", completed: false, progress: 0, target: 5, metric: "goldFoundAdventures" },
                { id: 15, text: "Complete Tomb of the Death Riders 5 times", reward: "500 PV, 2 Diamonds", completed: false, progress: 0, target: 5, adventureName: "Tomb of the Death Riders" }
            ];
        const dailyRewardsData = [];
        // Define material tiers for easier access in rewards
        const tier1Mats = ["Leather", "Wood", "Clover", "Fabric"];
        const tier2Mats = ["Iron", "Gizmo Tail", "Stone"];
        const tier3Mats = ["Obsidian", "Bitcoin", "Flame Essence"]; // Bitcoin is rare, use sparingly or replace
        const tier4Mats = ["Bone", "Essence of Death", "Rider's Sigil", "Ancient Tablet Fragment", "Shadowgem"];

        for (let day = 1; day <= 30; day++) {
            let pvReward = 75 + (day * 10); // Increased base PV and scaling
            let rewardsArray = [`${pvReward} PV`];
            let materialQuantity = Math.ceil(day / 5); // More materials as days go on

            // Add materials based on the day
            if (day <= 7) { // First week - Tier 1
                rewardsArray.push(`${materialQuantity} ${tier1Mats[day % tier1Mats.length]}`);
                if (day % 3 === 0) rewardsArray.push(`${materialQuantity} ${tier1Mats[(day + 1) % tier1Mats.length]}`);
            } else if (day <= 14) { // Second week - Tier 1 & 2
                rewardsArray.push(`${materialQuantity} ${tier1Mats[day % tier1Mats.length]}`);
                rewardsArray.push(`${Math.max(1, materialQuantity -1)} ${tier2Mats[day % tier2Mats.length]}`);
            } else if (day <= 21) { // Third week - Tier 2 & 3
                rewardsArray.push(`${materialQuantity} ${tier2Mats[day % tier2Mats.length]}`);
                if (day % 3 === 0 && tier3Mats.length > 0) rewardsArray.push(`${Math.max(1, materialQuantity - 2)} ${tier3Mats[day % tier3Mats.length]}`);
                if (day === 21) rewardsArray.push("1 Gold");
            } else if (day < 30) { // Fourth week - Tier 3 & 4
                rewardsArray.push(`${materialQuantity} ${tier3Mats[day % tier3Mats.length]}`);
                if (tier4Mats.length > 0) rewardsArray.push(`${Math.max(1, materialQuantity - 2)} ${tier4Mats[day % tier4Mats.length]}`);
            }

            // Special milestone rewards
            if (day === 7) rewardsArray.push("10 Gold");
            if (day === 14) rewardsArray.push("1 Diamond");
            if (day === 21) rewardsArray.push("25 Gold"); // Already added 1 Gold, this makes it 26
            if (day === 28) rewardsArray.push("2 Diamonds");
            if (day === 30) { // Grand prize for Day 30
                rewardsArray = [`${500 + day * 10} PV`, "50 Gold", "5 Diamonds"];
                if (tier4Mats.length > 0) rewardsArray.push(`5 ${tier4Mats[0]}`); // Example: 5 of the first T4 mat
                if (tier4Mats.length > 1) rewardsArray.push(`3 ${tier4Mats[1]}`); // Example: 3 of the second T4 mat
            }

            dailyRewardsData.push({ day: day, reward: rewardsArray.join(', ') });
        }
const dungeonsData = [
    { 
        id: "dungeon_1", 
        name: "Death Rider's Crypt Lvl 1", 
        description: "A solo challenge in a crypt. Requires 10 Attack & 10 Defense. Can be attempted 3 times daily.", 
        durationHours: 2, 
        requiredAdventureId: "4", // Player must have an adventurer on Adventure 4 to unlock dungeons
        attackRequirement: 10,
        defenseRequirement: 10,
        type: "solo",
        maxEntriesPerDay: 3,
        drops: [ // Rarer than Adventure 4
            { id: "dungeon_helmet", name: "Dungeon Helmet", chance: 0.99, qty: 1, type: "equipment" }, // Example rarity
            { id: "dungeon_boots", name: "Dungeon Boots", chance: 0.99, qty: 1, type: "equipment" }
        ],
        placeholderReward: "1000 PV, 10 Gold" // Base reward, drops are separate
    },
    { 
        id: "dungeon_2", 
        name: "Death Rider's Crypt Lvl 2", 
        description: "A party challenge (offline NPCs for now - Future Multiplayer!). Player requires 40 Attack & 40 Defense. Max 5 participants. Can be attempted 2 times daily.", 
        durationHours: 4, 
        requiredAdventureId: "4",
        attackRequirement: 15, 
        defenseRequirement: 15,
        type: "party_npc", 
        maxPartySize: 5,
        maxEntriesPerDay: 2,
        drops: [ // Even rarer
            { id: "dungeon_sword", name: "Dungeon Sword", chance: 0.99, qty: 1, type: "equipment" },
            { id: "dungeon_armour", name: "Dungeon Armour", chance: 0.92, qty: 1, type: "equipment" },
            { id: "pizza_pendant", name: "Pizza Pendant", chance: 0.095, qty: 1, type: "equipment" },
            { id: "orb_of_haste", name: "Orb of Haste", chance: 0.95, qty: 1, type: "equipment" },
            { id: "pet_dog", name: "$DOG Pet", chance: 0.91, qty: 1, type: "equipment" }
        ],
        placeholderReward: "2500 PV, 25 Gold, 1 Diamond"
    },
    {
        id: "dungeon_3",
        name: "ATH City (Coming Soon)",
        description: "The fabled city of All-Time Highs. Only the most seasoned voyagers dare to dream of its riches. (Currently inaccessible)",
        durationHours: 999, // Placeholder
        requiredAdventureId: "99", // Effectively locks it for now
        attackRequirement: 9999,
        defenseRequirement: 9999,
        type: "solo", // Or "party_npc" - TBD
        maxEntriesPerDay: 0,
        drops: [],
        placeholderReward: "??? PV, ??? Gold, ??? Diamonds",
        isLockedContent: true // Special flag to indicate it's a hard lock
    }
    // Add more dungeons here with increasing difficulty and rewards
];
            const adventureProgressionConfig = [ { id: "1", blockId: "adventure-1-block", unlockQuestId: null, unlockMessage: "" }, { id: "2", blockId: "adventure-2-block", unlockQuestId: 1, unlockMessage: "Complete 'Spirit Forest' 5 times to unlock." }, { id: "3", blockId: "adventure-3-block", unlockQuestId: 2, unlockMessage: "Complete 'Mountain of the Marowan' 5 times to unlock." }, { id: "4", blockId: "adventure-4-block", unlockQuestId: 3, unlockMessage: "Complete 'Fire Fields of Flyinals' 5 times to unlock." },{ id: "5", blockId: "adventure-5-block", unlockQuestId: 15, unlockMessage: "Complete 'Tomb of the Death Riders' 5 times to unlock." } ];
            const upgradeChances = [1, 0.85, 0.50, 0.35, 0.13]; // For +0->+1, +1->+2, ..., +4->+5
            const dungeonSetItemIds = ["dungeon_helmet", "dungeon_boots", "dungeon_sword", "dungeon_armour"];


            // --- Perk Scaling Function ---
            function getScaledItemPerk(itemMaster, itemLevel) {
                if (!itemMaster || !itemMaster.perk || itemLevel === undefined) {
                    return itemMaster ? itemMaster.perk : null;
                }
                if (itemLevel === 0) { return itemMaster.perk; }

                const scaleFactors = [1.00, 1.15, 1.25, 1.35, 1.50, 1.70]; // Index 0 for +0, 1 for +1, etc.
                const scaleFactor = scaleFactors[itemLevel] || 1.00; // Default to 1.00 if level out of bounds

                const scaledPerk = JSON.parse(JSON.stringify(itemMaster.perk)); // Deep copy to avoid modifying original

                switch (scaledPerk.type) {
                    case "timeReduction":
                    case "attackBoost":
                    case "defenseBoost":
                        scaledPerk.value = Math.round(itemMaster.perk.value * scaleFactor);
                        break;
                    case "pvBonus": // e.g., value: 0.10 for +10%
                    case "goldChanceIncrease": // e.g., value: 0.5 for +50% to chance factor
                        scaledPerk.value = parseFloat((itemMaster.perk.value * scaleFactor).toFixed(4));
                        break;
                    case "materialChanceMultiplier": // e.g., value: 1.3 for x1.3
                         scaledPerk.value = parseFloat((itemMaster.perk.value * scaleFactor).toFixed(4));
                        break;
                    case "flatCurrencyChanceBoost":
                        if (scaledPerk.goldBonus !== undefined) {
                            scaledPerk.goldBonus = parseFloat((itemMaster.perk.goldBonus * scaleFactor).toFixed(4));
                        }
                        if (scaledPerk.diamondBonus !== undefined) {
                            scaledPerk.diamondBonus = parseFloat((itemMaster.perk.diamondBonus * scaleFactor).toFixed(4));
                        }
                        break;
                    case "statBoost":
                        if (scaledPerk.attack !== undefined) {
                            scaledPerk.attack = Math.round(itemMaster.perk.attack * scaleFactor);
                        }
                        if (scaledPerk.defense !== undefined) {
                            scaledPerk.defense = Math.round(itemMaster.perk.defense * scaleFactor);
                        }
                        break;
                    // +++ ADD NEW PERK TYPES (THEY DON'T SCALE WITH ITEM LEVEL AS DEFINED) +++
                    case "dungeonEntryBonus":
                    case "timeReductionPercent":
                    case "dungeonMaterialFetch":
                        // These perks currently do not scale with item level in their definition.
                        // So, the original perk object (already copied into scaledPerk) is returned.
                        break;
                    // +++ END NEW PERK TYPES +++
                    default:
                        // No scaling for unknown perk types
                        break;
                }
                return scaledPerk;
            }


            // --- Tooltip Functions ---
            function showItemTooltip(event, itemData, isCraftable = false) {
                if (!itemTooltipElement || !itemData) return;

                const currentItemLevel = itemData.level || 0; // itemData might already have .level if it's an instance
                const baseItemMaster = craftableItemsData.find(ci => ci.id === itemData.id) || shopItemsData.find(si => si.id === itemData.id) || itemData; // Ensure we have the base master data for perks

                let contentHtml = `<h5>${itemData.name} <small>(${itemData.type || 'Item'})</small></h5>`;
                contentHtml += `<p>${itemData.description || 'No description.'}</p>`;

                if (baseItemMaster.perk) {
                    const scaledPerk = getScaledItemPerk(baseItemMaster, currentItemLevel); // This is the perk value at currentItemLevel
                    const basePerkForDisplay = baseItemMaster.perk; // This is the perk value at level 0

                    let perkString = "";
                    let baseString = "";

                    if (scaledPerk.type === "timeReduction") {
                        perkString = `Adventure time -${scaledPerk.value / 60} mins.`;
                        if (currentItemLevel > 0 && basePerkForDisplay.value !== scaledPerk.value) baseString = ` (Base: -${basePerkForDisplay.value / 60} mins)`;
                    } else if (scaledPerk.type === "goldChanceIncrease") {
                        perkString = `Gold find chance +${(scaledPerk.value * 100).toFixed(1)}%.`;
                        if (currentItemLevel > 0 && basePerkForDisplay.value !== scaledPerk.value) baseString = ` (Base: +${(basePerkForDisplay.value * 100).toFixed(1)}%)`;
                    } else if (scaledPerk.type === "pvBonus") {
                        perkString = `PV Tokens +${(scaledPerk.value * 100).toFixed(1)}%.`;
                        if (currentItemLevel > 0 && basePerkForDisplay.value !== scaledPerk.value) baseString = ` (Base: +${(basePerkForDisplay.value * 100).toFixed(1)}%)`;
                    } else if (scaledPerk.type === "materialChanceMultiplier") {
                        perkString = `Material find x${scaledPerk.value.toFixed(2)}.`;
                        if (currentItemLevel > 0 && basePerkForDisplay.value !== scaledPerk.value) baseString = ` (Base: x${basePerkForDisplay.value.toFixed(2)})`;
                    } else if (scaledPerk.type === "attackBoost") {
                        perkString = `Attack +${scaledPerk.value}.`;
                        if (currentItemLevel > 0 && basePerkForDisplay.value !== scaledPerk.value) baseString = ` (Base: +${basePerkForDisplay.value})`;
                    } else if (scaledPerk.type === "defenseBoost") {
                        perkString = `Defense +${scaledPerk.value}.`;
                        if (currentItemLevel > 0 && basePerkForDisplay.value !== scaledPerk.value) baseString = ` (Base: +${basePerkForDisplay.value})`;
                    } else if (scaledPerk.type === "flatCurrencyChanceBoost") {
                        perkString = `Gold/Diamond find +${(scaledPerk.goldBonus * 100).toFixed(1)}% / +${(scaledPerk.diamondBonus * 100).toFixed(1)}%.`;
                        if (currentItemLevel > 0 && (basePerkForDisplay.goldBonus !== scaledPerk.goldBonus || basePerkForDisplay.diamondBonus !== scaledPerk.diamondBonus)) {
                            baseString = ` (Base: +${(basePerkForDisplay.goldBonus * 100).toFixed(1)}% / +${(basePerkForDisplay.diamondBonus * 100).toFixed(1)}%)`;
                        }
                    } else if (scaledPerk.type === "statBoost") {
                        let currentStats = [];
                        if(scaledPerk.attack !== undefined) currentStats.push(`Attack ${scaledPerk.attack > 0 ? '+' : ''}${scaledPerk.attack}`);
                        if(scaledPerk.defense !== undefined) currentStats.push(`Defense ${scaledPerk.defense > 0 ? '+' : ''}${scaledPerk.defense}`);
                        perkString = currentStats.join(', ') + '.';

                          if (currentItemLevel > 0 && (basePerkForDisplay.attack !== scaledPerk.attack || basePerkForDisplay.defense !== scaledPerk.defense)) {
                            let baseStatsArr = [];
                            if(basePerkForDisplay.attack !== undefined) baseStatsArr.push(`Atk ${basePerkForDisplay.attack > 0 ? '+' : ''}${basePerkForDisplay.attack}`);
                            if(basePerkForDisplay.defense !== undefined) baseStatsArr.push(`Def ${basePerkForDisplay.defense > 0 ? '+' : ''}${basePerkForDisplay.defense}`);
                            baseString = ` (Base: ${baseStatsArr.join(', ')})`;
                        }
                    // +++ ADD DISPLAY FOR NEW PERKS +++
                    } else if (scaledPerk.type === "dungeonEntryBonus") {
                        let bonusStrings = [];
                        if (scaledPerk.dungeon1) bonusStrings.push(`D1: +${scaledPerk.dungeon1}`);
                        if (scaledPerk.dungeon2) bonusStrings.push(`D2: +${scaledPerk.dungeon2}`);
                        perkString = `Daily Dungeon Entries ${bonusStrings.join(', ')}.`;
                        // Base string not really applicable as these don't scale with level by default
                    } else if (scaledPerk.type === "timeReductionPercent") {
                        perkString = `Adventure Time -${(scaledPerk.value * 100).toFixed(0)}%.`;
                    } else if (scaledPerk.type === "dungeonMaterialFetch") {
                        perkString = `Fetches ${scaledPerk.count} random material(s) after dungeon.`;
                    }
                    // +++ END DISPLAY FOR NEW PERKS +++
                    contentHtml += `<p class="perk-info">Perk: ${perkString}${baseString}</p>`;
                }
                if (itemData.level > 0) { // Item level for +X display
                     contentHtml += `<p>Level: +${itemData.level}</p>`;
                }
                 if (itemData.tier !== undefined) { // Item base tier
                    contentHtml += `<p><small>Base Tier: ${itemData.tier}</small></p>`;
                }


                if (isCraftable && itemData.recipe) {
                    contentHtml += `<div class="recipe-info"><strong>Requires:</strong><ul>`;
                    for (const mat in itemData.recipe) {
                        contentHtml += `<li>${itemData.recipe[mat]} ${mat}</li>`;
                    }
                    contentHtml += `</ul></div>`;
                }
                 if (itemData.price) { 
                    contentHtml += `<p>Price: <span class="pv">${itemData.price} PV</span></p>`;
                }


                itemTooltipElement.innerHTML = contentHtml;
                itemTooltipElement.style.display = 'block';
                
                const targetElement = event.target.closest('.shop-item, .craftable-item-card, .inventory-item-card, .equipment-slot .equipped-item-container');
                if (!targetElement) return; 

                const rect = targetElement.getBoundingClientRect();
                let x = rect.right + 10; 
                let y = rect.top;

                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                const tooltipWidth = itemTooltipElement.offsetWidth;
                const tooltipHeight = itemTooltipElement.offsetHeight;

                if (x + tooltipWidth > screenWidth) {
                    x = rect.left - tooltipWidth - 10; 
                }
                if (x < 0) x = 5;


                if (y + tooltipHeight > screenHeight) {
                    y = screenHeight - tooltipHeight - 5;
                }
                 if (y < 0) y = 5;


                itemTooltipElement.style.left = x + 'px';
                itemTooltipElement.style.top = y + 'px';
            }
            function hideItemTooltip() {
                if (itemTooltipElement) itemTooltipElement.style.display = 'none';
            }


function processPopupQueue() {
    if (isPopupCurrentlyVisible || popupMessageQueue.length === 0) { return; }

    const isAuthContextPopup = welcomeScreen && !welcomeScreen.classList.contains('hidden');
    const { message, title, craftCallback, confirmCallback, secondaryActionCallback, secondaryActionText, confirmText, cancelText } = popupMessageQueue.shift();

    if (!isAuthContextPopup && (title.includes("Error") || title.includes("Failed"))) {
        console.warn("Stale auth popup suppressed. Original message:", title, message);
        isPopupCurrentlyVisible = false;
        processPopupQueue();
        return;
    }

    isPopupCurrentlyVisible = true;
    if (customPopupTitleEl) customPopupTitleEl.textContent = title;
    if (customPopupMessageEl) customPopupMessageEl.innerHTML = message;

    // Hide all buttons initially and remove previous dynamic ones
    customPopupCloseBtn.classList.add('hidden');
    customPopupConfirmBtn.classList.add('hidden');
    customPopupCancelBtn.classList.add('hidden');
    const existingCraftBtn = document.getElementById('popupCraftAgainBtn');
    if (existingCraftBtn) existingCraftBtn.remove();
    const existingSecondaryBtn = document.getElementById('popupSecondaryActionBtn');
    if (existingSecondaryBtn) existingSecondaryBtn.remove();


    currentPopupConfirmCallback = null;
    currentPopupCraftCallback = null;
    let currentPopupSecondaryActionCallback = null; // Store secondary callback

    if (craftCallback) {
        currentPopupCraftCallback = craftCallback;
        const craftAgainBtn = document.createElement('button');
        craftAgainBtn.id = 'popupCraftAgainBtn';
        craftAgainBtn.className = 'action-button';
        craftAgainBtn.textContent = 'Craft Again'; // Or make this an option
        craftAgainBtn.style.backgroundColor = 'var(--highlight-color-connected)';
        craftAgainBtn.style.color = 'white';
        customPopupButtonsEl.insertBefore(craftAgainBtn, customPopupCloseBtn);
        customPopupCloseBtn.textContent = cancelText || "No Thanks";
        customPopupCloseBtn.classList.remove('hidden');
    } else if (confirmCallback) { // Standard confirm/cancel or confirm/secondaryAction
        currentPopupConfirmCallback = confirmCallback;
        customPopupConfirmBtn.textContent = confirmText || "Confirm";
        customPopupConfirmBtn.classList.remove('hidden');

        if (secondaryActionCallback && secondaryActionText) {
            currentPopupSecondaryActionCallback = secondaryActionCallback;
            const secondaryBtn = document.createElement('button');
            secondaryBtn.id = 'popupSecondaryActionBtn';
            secondaryBtn.className = 'action-button'; // You might want a different style
            secondaryBtn.textContent = secondaryActionText;
            // Add listener for secondary button
            secondaryBtn.addEventListener('click', () => {
                if (currentPopupSecondaryActionCallback) {
                    currentPopupSecondaryActionCallback();
                }
                hideCustomPopup();
            }, { once: true }); // Ensure listener is added only once per show
            customPopupButtonsEl.insertBefore(secondaryBtn, customPopupCancelBtn.nextSibling); // Insert before any final "cancel/close"

            // If secondary action exists, the original 'cancel' button becomes the third option or is hidden
            // For now, let's assume customPopupCancelBtn acts as a general "close/cancel" if no specific cancelText
            if (cancelText) {
                customPopupCancelBtn.textContent = cancelText;
                customPopupCancelBtn.classList.remove('hidden');
            } else {
                customPopupCancelBtn.classList.add('hidden'); // Hide default cancel if we have confirm + secondary
            }

        } else { // Just confirm and cancel
            customPopupCancelBtn.textContent = cancelText || "Cancel";
            customPopupCancelBtn.classList.remove('hidden');
        }
    } else { // Simple notification
        customPopupCloseBtn.textContent = confirmText || "OK"; // confirmText can be "OK" for simple popups
        customPopupCloseBtn.classList.remove('hidden');
    }

    if (customPopupOverlay) customPopupOverlay.classList.remove('hidden');
    if (customPopup) customPopup.classList.remove('hidden');

    // Focus logic
    if (customPopupConfirmBtn && !customPopupConfirmBtn.classList.contains('hidden')) {
        customPopupConfirmBtn.focus();
    } else if (document.getElementById('popupCraftAgainBtn')) {
        document.getElementById('popupCraftAgainBtn').focus();
    } else if (document.getElementById('popupSecondaryActionBtn')) {
         document.getElementById('popupSecondaryActionBtn').focus();
    } else if (customPopupCloseBtn && !customPopupCloseBtn.classList.contains('hidden')) {
        customPopupCloseBtn.focus();
    }
}
function showCustomPopup(message, title = "Notification", options = {}) {
    const { craftCallback = null, confirmCallback = null, secondaryActionCallback = null, secondaryActionText = null, confirmText = null, cancelText = null } = options;
    popupMessageQueue.push({ message, title, craftCallback, confirmCallback, secondaryActionCallback, secondaryActionText, confirmText, cancelText });
    processPopupQueue();
}
            function hideCustomPopup() { 
                if (customPopupOverlay) customPopupOverlay.classList.add('hidden'); 
                if (customPopup) customPopup.classList.add('hidden'); 
                isPopupCurrentlyVisible = false; 
                currentPopupCraftCallback = null;
                currentPopupConfirmCallback = null;
                
                const existingCraftBtn = document.getElementById('popupCraftAgainBtn');
                if (existingCraftBtn) existingCraftBtn.remove();

            customPopupConfirmBtn.classList.add('hidden');
            customPopupCancelBtn.classList.add('hidden');
            customPopupCloseBtn.classList.remove('hidden'); // Ensure OK button is visible by default
            customPopupCloseBtn.textContent = "OK"; // Reset OK button text

            processPopupQueue(); 
            }

            if (customPopupCloseBtn) {
                customPopupCloseBtn.addEventListener('click', () => {
                    // If it's acting as "No Thanks" for a craft prompt, the craft callback shouldn't fire.
                    // If it's "OK" for a simple message, no callback is expected.
                    // If it was accidentally shown for a confirm prompt (which it shouldn't be with the new logic),
                    // treat it as a cancel if a confirm callback was somehow active.
                    if (currentPopupConfirmCallback && customPopupCloseBtn.textContent !== "OK") {
                         currentPopupConfirmCallback(false); // Treat "No Thanks" as cancel
                    }
                    hideCustomPopup();
                });
            }

            if (customPopupConfirmBtn) {
                customPopupConfirmBtn.addEventListener('click', () => {
                    if (currentPopupConfirmCallback) {
                        currentPopupConfirmCallback(true); // User confirmed
                    }
                    hideCustomPopup();
                });
            }

            if (customPopupCancelBtn) {
                customPopupCancelBtn.addEventListener('click', () => {
                    if (currentPopupConfirmCallback) {
                        currentPopupConfirmCallback(false); // User canceled
                    }
                    hideCustomPopup();
                });
            }
            
            // Listener for dynamically created "Craft Again" button
            // We need to use event delegation since the button is added/removed.
            if (customPopupButtonsEl) {
                customPopupButtonsEl.addEventListener('click', (event) => {
                    if (event.target.id === 'popupCraftAgainBtn') {
                        if (currentPopupCraftCallback) {
                            currentPopupCraftCallback();
                        }
                        hideCustomPopup();
                    }
                });
            }


            if (customPopupOverlay) {
                 customPopupOverlay.addEventListener('click', (event) => {
                    if (event.target === customPopupOverlay) {
                        // If a confirm prompt is open, clicking overlay should be like cancel
                        if (currentPopupConfirmCallback && !customPopupConfirmBtn.classList.contains('hidden')) {
                            currentPopupConfirmCallback(false);
                        }
                        hideCustomPopup();
                    }
                });
            }

            // --- Firebase Auth State Change Listener ---
            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                if (user) {
                    // User is signed in or has just signed up
                    console.log("Auth state changed: User is present.", user.uid, user.email);
                    welcomeScreen.classList.add('hidden');
                    gameContainer.classList.remove('hidden');
                    signOutButton.classList.remove('hidden');

                    if (user.email && user.email.toLowerCase() === 'nvoiysol@gmail.com' && adminRafflePanel) {
                        adminRafflePanel.classList.remove('hidden');
                    } else if (adminRafflePanel) {
                        adminRafflePanel.classList.add('hidden');
                    }

                    const currentThemeIsDark = body.classList.contains('dark-mode');
                    loadTwitterWidget(currentThemeIsDark ? 'dark' : 'light');

                    try {
                        const loadedState = await loadGameStateFromFirebase(user.uid);

                        if (loadedState) {
                            // EXISTING USER WITH SAVED DATA
                            console.log("User has existing game state. Applying it.", user.uid);
                            applyLoadedGameState(loadedState);
                        } else {
                            // NEW USER (or user whose data was not found/corrupted)
                            console.log("No existing game state found for user. Will create initial state.", user.uid);
                            let nicknameToUseForNewUser = "Voyager"; // Default

                            // This block should only be relevant if it's truly a new sign-up,
                            // and the welcomeScreen elements are still technically accessible.
                            if (authNicknameInput && authNicknameInput.value.trim() !== "") {
                                // This is the primary way to get nickname for new email/password registration
                                nicknameToUseForNewUser = authNicknameInput.value.trim();
                                console.log("Determined nickname for new user from authNicknameInput:", nicknameToUseForNewUser);
                            } else if (user.displayName && user.displayName.trim() !== "") {
                                // Fallback for Google Sign-In or if authNicknameInput was somehow cleared
                                nicknameToUseForNewUser = user.displayName.trim();
                                console.log("Determined nickname for new user from user.displayName:", nicknameToUseForNewUser);
                            } else {
                                console.log("Could not determine nickname from form or user.displayName. Defaulting to:", nicknameToUseForNewUser);
                            }

                            await createInitialGameState(user.uid, nicknameToUseForNewUser);

                            // Clear the auth form fields after successful use for a new user.
                            // This helps prevent stale data if the user logs out and then tries to register again in the same session.
                            if(loginRegisterForm) loginRegisterForm.reset();
                            if(authNicknameInput) authNicknameInput.value = ''; // Specifically clear nickname
                        }
                        showPage('adventures-page'); // Show the default game page
                        await loadPunkVoyageIds(); // Load the fixed list of IDs
                        await loadDungeonCrawlerIds();

                    } catch (error) {
                        console.error("Error during user state processing in onAuthStateChanged:", error);
                        showCustomPopup("An error occurred loading your game data. Please try logging out and back in. Details: " + error.message, "Load Error");
                        // Optionally, sign the user out if loading fails catastrophically
                        // await fbSignOut(auth);
                    }

                } else {
                    // User is signed out
                    console.log("Auth state changed: User is signed out.");
                    currentUser = null;
                    userNickname = ''; // Clear global nickname
                    welcomeScreen.classList.remove('hidden');
                    gameContainer.classList.add('hidden');
                    signOutButton.classList.add('hidden');
                    if (adminRafflePanel) adminRafflePanel.classList.add('hidden');

                    resetGameStateToDefaults(); // Reset all game variables to their initial empty/default states
                    updateStatsDisplay();       // Update UI to reflect reset state
                    updateWalletDisplay(null);  // Clear wallet display

                    // Reset the auth form to its default (login) state
                    if (authFormTitle) authFormTitle.textContent = "Login to Punk Voyage Adventures";
                    if (authNicknameField) authNicknameField.classList.add('hidden');
                    if (loginButton) loginButton.classList.remove('hidden');
                    if (registerButton) registerButton.classList.add('hidden');
                    if (authToggleLink) authToggleLink.textContent = "Need an account? Register";
                    if (loginRegisterForm) loginRegisterForm.reset(); // Clear any typed text
                }
            });
            
function resetGameStateToDefaults() {
    currentPvTokens = 0; currentGold = 0; currentDiamonds = 0;
    activeAdventures = []; nextActiveAdventureId = 0;
    // totalAvailableAdventurers will be set by recalculateTotalAvailableAdventurers
    playerInventory = []; nextUniqueInstanceId = 0;
    playerMaterials = { ...initialPlayerMaterials };
    playerScrolls = { low: 0, middle: 0, high: 0 };
    playerHasPurchasedRiderScroll = false;
    playerHasPurchasedPetWhistle = false;
    totalAdventuresCompleted = 0;
    ordinalBonusAdventurers = 0; // <<< ADDED THIS LINE

    equippedItems = { Armour: null, Helmet: null, Boots: null, Amulet: null, Ring1: null, Ring2: null, Weapon: null, Pet: null, Misc1: null, Misc2: null };
    playerAdventurerLevel = 1;
    secondRingSlotUnlocked = false;
    petSlotUnlocked = false;
    activePotions = [];
    allRaffles = [];
    playerRaffleEntries = {};
    quests.forEach(q => { q.progress = 0; q.completed = false; q.claimed = false; });
    lastDailyRewardDayClaimed = 0;
    lastDailyRewardClaimTimestamp = 0;
    selectedItemForUpgrade = null;
    selectedScrollForUpgrade = null;
    isGoldToDiamondSwap = true; updateSwapDisplay();

    activeDungeons = []; // <-- ADD THIS LINE

    if(sidebarActiveAdventuresList) sidebarActiveAdventuresList.innerHTML = '';
    if(activePotionsList) activePotionsList.innerHTML = '';
    if(materialsListContainer) materialsListContainer.innerHTML = '';
    if(inventoryItemsContainer) inventoryItemsContainer.innerHTML = '';
    if(equipmentSlotsDisplay) equipmentSlotsDisplay.innerHTML = '';
    if (whitelistRafflesContainer) whitelistRafflesContainer.innerHTML = '';
    if (dailyRewardsGrid) dailyRewardsGrid.innerHTML = '';
    if (leaderboardDisplayList) leaderboardDisplayList.innerHTML = '<li>Click a filter above to load a leaderboard.</li>';
    if (leaderboardCurrentTypeTitle) leaderboardCurrentTypeTitle.textContent = 'Leaderboard';
    if (upgradeResultDisplay) upgradeResultDisplay.textContent = '';
    if (selectedItemForUpgradeDisplay) selectedItemForUpgradeDisplay.innerHTML = 'Item: None';
    if (selectedScrollForUpgradeDisplay) selectedScrollForUpgradeDisplay.innerHTML = 'Scroll: None';
    if (upgradeSuccessRateDisplay) upgradeSuccessRateDisplay.textContent = '';
    if (document.getElementById('dungeonListContainer')) document.getElementById('dungeonListContainer').innerHTML = '';

    // +++ RESET DUNGEON STATE +++
    playerDungeonEntriesToday = { dungeon_1: 0, dungeon_2: 0 };
    lastDungeonResetTimestamp = 0;
    playerDungeonCrawlers = [];
    confirmedCrawlersForDungeons = {}; // <<< ADD THIS LINE
    dungeonCrawlerIdsLoaded = false;
    if (document.getElementById('dungeonCrawlerSelectionArea')) { // If UI exists, clear it
        document.getElementById('dungeonCrawlerSelectionArea').innerHTML = '';
        document.getElementById('dungeonCrawlerSelectionArea').style.display = 'none';
    }
    // +++ END RESET DUNGEON STATE +++

    recalculateTotalAvailableAdventurers(); // Call this to set totalAvailableAdventurers correctly after reset // Call this to set totalAvailableAdventurers correctly after reset
    updatePlayerCombatStatsDisplay();
    ordinalBonusAdventurers = 0;

}


            // --- Auth Form Toggle ---
            authToggleLink.addEventListener('click', () => {
                const isLoginModeCurrently = !registerButton.classList.contains('hidden'); // If register button is shown, we are in register mode
                loginRegisterForm.reset(); 
                if (isLoginModeCurrently) { // Switch to Login
                    authFormTitle.textContent = "Login to Punk Voyage Adventures";
                    authNicknameField.classList.add('hidden');
                    loginButton.classList.remove('hidden');
                    registerButton.classList.add('hidden');
                    authToggleLink.textContent = "Need an account? Register";
                } else { // Switch to Register
                    authFormTitle.textContent = "Register for Punk Voyage Adventures";
                    authNicknameField.classList.remove('hidden');
                    loginButton.classList.add('hidden');
                    registerButton.classList.remove('hidden');
                    authToggleLink.textContent = "Already have an account? Login";
                }
            });


            // --- Auth Event Listeners ---
            loginButton.addEventListener('click', async () => {
                const email = authEmailInput.value.trim();
                const password = authPasswordInput.value;
                if (!email || !password) {
                    showCustomPopup("Please enter both email and password.", "Login Error");
                    return;
                }
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    console.error("Login error:", error);
                    showCustomPopup(`Login failed: ${error.code} - ${error.message}`, "Login Error");
                }
            });

            registerButton.addEventListener('click', async () => {
                const email = authEmailInput.value.trim();
                const password = authPasswordInput.value;
                const nickname = authNicknameInput.value.trim();

                if (!email || !password || !nickname) {
                    showCustomPopup("Please fill in all fields: email, password, and nickname.", "Registration Error");
                    return;
                }
                if (password.length < 6) {
                     showCustomPopup("Password must be at least 6 characters long.", "Registration Error");
                    return;
                }
                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    console.error("Registration error:", error);
                    showCustomPopup(`Registration failed: ${error.code} - ${error.message}`, "Registration Error");
                }
            });

            googleSignInButton.addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Google Sign-In error:", error);
                    showCustomPopup(`Google Sign-In failed: ${error.code} - ${error.message}`, "Google Sign-In Error");
                }
            });

            signOutButton.addEventListener('click', async () => {
                try {
                    await fbSignOut(auth);
                } catch (error) {
                    console.error("Sign out error:", error);
                    showCustomPopup(`Sign out failed: ${error.message}`, "Sign Out Error");
                }
            });
            
            forgotPasswordLink.addEventListener('click', async () => {
                const email = authEmailInput.value.trim();
                if (!email) {
                    showCustomPopup("Please enter your email address in the email field to reset your password.", "Password Reset");
                    return;
                }
                try {
                    await sendPasswordResetEmail(auth, email);
                    showCustomPopup(`Password reset email sent to ${email}. Please check your inbox (and spam folder).`, "Password Reset");
                } catch (error) {
                    console.error("Password reset error:", error);
                    showCustomPopup(`Password reset failed: ${error.message}`, "Password Reset Error");
                }
            });


            // --- Firebase Save/Load ---
            async function saveGameStateToFirebase(userId, gameState) { 
                if (!userId) { console.error("Cannot save game: User ID (UID) is missing."); showCustomPopup("Error: User ID is missing. Cannot save progress.", "Save Error"); return; } 
                if (!db) { console.error("Firestore not initialized!"); showCustomPopup("Error: Database connection failed. Cannot save progress.", "Save Error"); return; } 
                try { 
                    const savableGameState = { ...gameState }; 
                    if (savableGameState.activeAdventures) { savableGameState.activeAdventures = savableGameState.activeAdventures.map(adv => ({ ...adv, returnTime: typeof adv.returnTime === 'number' ? adv.returnTime : (adv.returnTime instanceof Date ? Timestamp.fromDate(adv.returnTime) : Timestamp.now()) })); } 
                    if (savableGameState.activePotions) { savableGameState.activePotions = savableGameState.activePotions.map(p => ({ ...p, endTime: typeof p.endTime === 'number' ? p.endTime : (p.endTime instanceof Date ? Timestamp.fromDate(p.endTime) : null) })); } 
                    
                    savableGameState.nickname = userNickname || "Voyager";
                    savableGameState.lastDailyRewardDayClaimed = lastDailyRewardDayClaimed;
                    savableGameState.lastDailyRewardClaimTimestamp = lastDailyRewardClaimTimestamp;
                    savableGameState.nextUniqueInstanceId = nextUniqueInstanceId;


                    const playerDocRef = doc(collection(db, 'playerProgress'), userId); 
                    await setDoc(playerDocRef, savableGameState); 
                    console.log("Game state saved for user ID:", userId); 
                } catch (error) { 
                    console.error("Error saving game state: ", error); 
                    showCustomPopup(`Failed to save game progress: ${error.message}`, "Save Error");
                }
            }

            async function loadGameStateFromFirebase(userId) { 
                if (!userId) { console.error("Cannot load game: User ID (UID) is missing."); return null; } 
                if (!db) { console.error("Firestore not initialized!"); return null;} 
                try { 
                    const playerDocRef = doc(collection(db, 'playerProgress'), userId); 
                    const docSnap = await getDoc(playerDocRef); 
                    if (docSnap.exists()) { 
                        const loadedData = docSnap.data(); 
                        console.log("Raw loaded data from Firebase for UID", userId, JSON.parse(JSON.stringify(loadedData))); 
                        if (loadedData.activeAdventures) { loadedData.activeAdventures = loadedData.activeAdventures.map(adv => ({ ...adv, returnTime: adv.returnTime && typeof adv.returnTime.toDate === 'function' ? adv.returnTime.toDate().getTime() : (typeof adv.returnTime === 'number' ? adv.returnTime : Date.now()) })); } 
                        if (loadedData.activePotions) { loadedData.activePotions = loadedData.activePotions.map(p => ({ ...p, endTime: p.endTime && typeof p.endTime.toDate === 'function' ? p.endTime.toDate().getTime() : (typeof p.endTime === 'number' ? p.endTime : null) })); } 
                        console.log("Processed loaded data before apply:", JSON.parse(JSON.stringify(loadedData))); 
                        return loadedData; 
                    } else { 
                        console.log("No saved game state found for UID", userId); 
                        return null; 
                    } 
                } catch (error) { 
                    console.error("Error directly within loadGameStateFromFirebase:", error); 
                    showCustomPopup(`Failed to load game progress from Firebase: ${error.message}`, "DB Load Error"); 
                    return null;
                }
            }
            
            async function createInitialGameState(userId, nicknameToUse) {
                console.log("Creating initial game state for new user:", userId, "Nickname:", nicknameToUse);
                userNickname = nicknameToUse; 
                const initialGameState = {
                    nickname: nicknameToUse,
                    pvTokens: 0, 
                    gold: 0, 
                    diamonds: 0, 
                    activeAdventures: [],
                    totalAvailableAdventurers: MAX_PLAYER_ADVENTURERS,
                    playerInventory: [], 
                    nextUniqueInstanceId: 0,
                    playerMaterials: { ...initialPlayerMaterials },
                    playerScrolls: { low: 0, middle: 0, high: 0 },
                    playerHasPurchasedRiderScroll: false,
                    totalAdventuresCompleted: 0,
                    equippedItems: { Armour: null, Helmet: null, Boots: null, Amulet: null, Ring1: null, Ring2: null, Weapon: null, Pet: null, Misc1: null, Misc2: null },
                    quests: quests.map(q => ({ ...q, progress: 0, completed: false, claimed: false })), 
                    activePotions: [],
                    playerAdventurerLevel: 1,
                    secondRingSlotUnlocked: false,
                                petSlotUnlocked: false,
                    playerRaffleEntries: {},
                    lastDailyRewardDayClaimed: 0, 
                    lastDailyRewardClaimTimestamp: 0,
                    // +++ ADDED FOR DUNGEONS +++
                    playerDungeonEntriesToday: { dungeon_1: 0, dungeon_2: 0 },
                    lastDungeonResetTimestamp: 0,
                    playerDungeonCrawlers: [],
                    confirmedCrawlersForDungeons: {}, // <<< ADD THIS LINE
                    dungeonCrawlerIdsLoaded: false // Client will try to load on startup
                    // +++ END OF ADDED FOR DUNGEONS +++
                };
                await saveGameStateToFirebase(userId, initialGameState); 
                applyLoadedGameState(initialGameState); 
                checkAndResetDailyDungeonEntries(); // Initialize for new player
                showCustomPopup(`Welcome, ${nicknameToUse}! Your new voyage begins!`, "New Game Created");
            }
            
function getCurrentGameState() {
    return {
        nickname: userNickname || "Voyager",
        pvTokens: currentPvTokens || 0,
        gold: currentGold || 0,
        diamonds: currentDiamonds || 0,
        activeAdventures: Array.isArray(activeAdventures) ? activeAdventures.map(adv => ({ id: adv.id, originalAdventureId: adv.originalAdventureId, name: adv.name || "Unknown Adventure", adventurers: adv.adventurers || 0, returnTime: adv.returnTime || Date.now(), pvReward: adv.pvReward || 0, goldChance: adv.goldChance || 0, diamondChance: adv.diamondChance || 0 })) : [],
        activeDungeons: Array.isArray(activeDungeons) ? activeDungeons.map(dun => ({ 
            id: dun.id, 
            dungeonId: dun.dungeonId, 
            name: dun.name || "Unknown Dungeon", 
            adventurers: dun.adventurers || 0, 
            returnTime: dun.returnTime || Date.now(),
            npcCrawlers: Array.isArray(dun.npcCrawlers) ? dun.npcCrawlers : [] // Save selected NPC crawlers
        })) : [],
        confirmedCrawlersForDungeons: confirmedCrawlersForDungeons || {}, // <<< ADD THIS LINE
        playerInventory: Array.isArray(playerInventory) ? playerInventory : [],
        nextUniqueInstanceId: nextUniqueInstanceId,
        playerMaterials: playerMaterials || { ...initialPlayerMaterials },
        playerScrolls: playerScrolls || { low: 0, middle: 0, high: 0 },
        playerHasPurchasedRiderScroll: playerHasPurchasedRiderScroll || false,
        totalAdventuresCompleted: totalAdventuresCompleted || 0,
        equippedItems: equippedItems || { Armour: null, Helmet: null, Boots: null, Amulet: null, Ring1: null, Ring2: null, Weapon: null, Pet: null, Misc1: null, Misc2: null },
        quests: Array.isArray(quests) ? quests.map(q => ({ id: q.id, text: q.text || "UKN", reward: q.reward || "0", completed: q.completed || false, progress: q.progress || 0, target: q.target || 0, adventureName: q.adventureName || null, metric: q.metric || null, claimed: q.claimed || false })) : [],
        activePotions: Array.isArray(activePotions) ? activePotions.map(p => ({ id: p.id, endTime: p.endTime || null, adventuresLeft: p.adventuresLeft !== undefined ? p.adventuresLeft : null })).filter(p => p.id) : [],
        playerAdventurerLevel: playerAdventurerLevel || 1,
        secondRingSlotUnlocked: secondRingSlotUnlocked || false,
        petSlotUnlocked: petSlotUnlocked || false,
        playerHasPurchasedPetWhistle: playerHasPurchasedPetWhistle || false,
        playerRaffleEntries: playerRaffleEntries || {},
        lastDailyRewardDayClaimed: lastDailyRewardDayClaimed,
        lastDailyRewardClaimTimestamp: lastDailyRewardClaimTimestamp,
        ordinalBonusAdventurers: ordinalBonusAdventurers, // <<< ADD THIS LINE
        playerDungeonEntriesToday: playerDungeonEntriesToday || { dungeon_1: 0, dungeon_2: 0 },
        lastDungeonResetTimestamp: lastDungeonResetTimestamp || 0,
        playerDungeonCrawlers: Array.isArray(playerDungeonCrawlers) ? playerDungeonCrawlers : [],
        dungeonCrawlerIdsLoaded: dungeonCrawlerIdsLoaded || false // Though this is usually determined on client start
        // +++ END OF ADDED FOR DUNGEONS +++
    };
}

function applyLoadedGameState(loadedState) {
    console.log("Applying loaded game state:", JSON.parse(JSON.stringify(loadedState)));
    walletVerificationPendingForBonus = false; // Reset flag at the start of applying state

    if (!loadedState) {
        console.error("applyLoadedGameState called with null or undefined state.");
        showCustomPopup("No game data found to load. Starting fresh or try logging in again.", "Load Error");
        ordinalBonusAdventurers = 0; // Ensure it's reset if no state
        recalculateTotalAvailableAdventurers();
        return;
    }
    try {
        userNickname = loadedState.nickname || "Voyager";
        if (playerNicknameDisplay && userNickname) playerNicknameDisplay.textContent = userNickname;
        currentPvTokens = loadedState.pvTokens || 0;
        currentGold = loadedState.gold || 0;
        currentDiamonds = loadedState.diamonds || 0;

        const isWalletCurrentlyConnected = connectWalletBtn && connectWalletBtn.classList.contains('connected');

        // Wallet Bonus Handling
        if (loadedState.ordinalBonusAdventurers !== undefined && loadedState.ordinalBonusAdventurers > 0 && !isWalletCurrentlyConnected) {
            ordinalBonusAdventurers = loadedState.ordinalBonusAdventurers; // Temporarily use saved bonus
            walletVerificationPendingForBonus = true; // Set the flag for adventure sending check

            // Initial informational popup when game loads with a remembered bonus but no active wallet
            showCustomPopup(
                `Your game remembers an Ordinal Bonus of +${ordinalBonusAdventurers} adventurers from a previous session.<br><br>To ensure this bonus is current and to use it, please connect your wallet. If you attempt an adventure before connecting, you'll be prompted again.`,
                "Wallet Bonus Information",
                { // This popup is just informational, so a simple "OK" is fine.
                  // processPopupQueue will default to showing customPopupCloseBtn with "OK"
                }
            );
            // No need to set button text here, processPopupQueue default is fine.

        } else if (isWalletCurrentlyConnected) {
            // Wallet is already connected (e.g. auto-reconnect).
            // Bonus will be determined by fetchWalletInscriptions, called by updateWalletDisplay.
            ordinalBonusAdventurers = 0; // Set to 0, fetch will update.
            walletVerificationPendingForBonus = false;
        } else {
            // No saved bonus, or saved bonus was 0, and wallet not connected.
            ordinalBonusAdventurers = 0;
            walletVerificationPendingForBonus = false;
        }


        activeAdventures = Array.isArray(loadedState.activeAdventures) ? loadedState.activeAdventures.map(advData => {
            return {
                id: advData.id || nextActiveAdventureId++,
                originalAdventureId: advData.originalAdventureId || "1",
                name: advData.name || "Unknown Adventure",
                adventurers: advData.adventurers || 0,
                returnTime: typeof advData.returnTime === 'number' ? advData.returnTime : Date.now(),
                pvReward: advData.pvReward || 0,
                goldChance: advData.goldChance || 0,
                diamondChance: advData.diamondChance || 0
            };
        }) : [];
        // Recalculate nextActiveAdventureId based on both adventures and dungeons now
        let maxActiveId = activeAdventures.length > 0 ? Math.max(0, ...activeAdventures.map(a => a.id)) : 0;
        // nextActiveAdventureId = maxActiveId + 1; // This will be set later after processing dungeons too

        activeDungeons = Array.isArray(loadedState.activeDungeons) ? loadedState.activeDungeons.map(dunData => { // <-- ADD THIS BLOCK
             return {
                 id: dunData.id || nextActiveAdventureId++, // Use the same counter for unique instance IDs
                 dungeonId: dunData.dungeonId || "unknown_dungeon",
                 name: dunData.name || "Unknown Dungeon",
                 adventurers: dunData.adventurers || 0,
                 returnTime: typeof dunData.returnTime === 'number' ? dunData.returnTime : Date.now()
             };
         }) : [];
         nextActiveAdventureId = Math.max(maxActiveId, activeDungeons.length > 0 ? Math.max(0, ...activeDungeons.map(d => d.id)) : 0) + 1; // <-- Update counter after both lists


        totalAdventuresCompleted = loadedState.totalAdventuresCompleted || 0;
        nextUniqueInstanceId = loadedState.nextUniqueInstanceId || 0;
        playerInventory = [];
        if (Array.isArray(loadedState.playerInventory)) {
            loadedState.playerInventory.forEach(itemSource => {
                if (!itemSource) return;
                if (itemSource.id === "scroll_low" || itemSource.id === "scroll_mid" || itemSource.id === "scroll_high" || (itemSource.type && itemSource.type === "upgrade_scroll")) {
                    return;
                }
                let newItem = {};
                if (typeof itemSource === 'string') {
                    newItem = {
                        id: itemSource,
                        level: 0,
                        uniqueInstanceId: `legacy_${nextUniqueInstanceId++}`
                    };
                } else {
                    newItem = {
                        id: itemSource.id,
                        level: itemSource.level || 0,
                        uniqueInstanceId: itemSource.uniqueInstanceId || `loaded_${nextUniqueInstanceId++}`
                    };
                }
                if (newItem.id) {
                    playerInventory.push(newItem);
                } else {
                    console.warn("Loaded inventory item source without an ID:", itemSource);
                }
            });
        }
        playerMaterials = loadedState.playerMaterials || { ...initialPlayerMaterials };
        playerScrolls = loadedState.playerScrolls || { low: 0, middle: 0, high: 0 };
        playerHasPurchasedRiderScroll = loadedState.playerHasPurchasedRiderScroll || false;
        playerHasPurchasedPetWhistle = loadedState.playerHasPurchasedPetWhistle || false;
        // ordinalBonusAdventurers is handled above based on wallet connection state


        const defaultEquippedStructure = { Armour: null, Helmet: null, Boots: null, Amulet: null, Ring1: null, Ring2: null, Weapon: null, Pet: null, Misc1: null, Misc2: null };
        if (loadedState.equippedItems && typeof loadedState.equippedItems === 'object') {
            equippedItems = { ...defaultEquippedStructure, ...loadedState.equippedItems };
        } else {
            equippedItems = { ...defaultEquippedStructure };
        }
        playerAdventurerLevel = loadedState.playerAdventurerLevel || 1;
        secondRingSlotUnlocked = loadedState.secondRingSlotUnlocked || false;
        petSlotUnlocked = loadedState.petSlotUnlocked || false;
        playerRaffleEntries = loadedState.playerRaffleEntries || {};
        lastDailyRewardDayClaimed = loadedState.lastDailyRewardDayClaimed || 0;
        lastDailyRewardClaimTimestamp = loadedState.lastDailyRewardClaimTimestamp || 0;

        if (Array.isArray(loadedState.quests)) {
            quests.forEach(q_default => {
                const loaded_q = loadedState.quests.find(lq => lq && lq.id === q_default.id);
                if (loaded_q) {
                    q_default.completed = loaded_q.completed || false;
                    q_default.progress = loaded_q.progress || 0;
                    q_default.claimed = loaded_q.claimed || false;
                }
            });
        }
        if (Array.isArray(loadedState.activePotions)) {
            activePotions = loadedState.activePotions.map(pData => {
                if (!pData || !pData.id) return null;
                const potionBase = shopItemsData.find(shopItem => shopItem.id === pData.id);
                if (!potionBase) return null;
                return {
                    id: pData.id,
                    name: potionBase.name,
                    description: potionBase.description,
                    effect: potionBase.effect,
                    endTime: typeof pData.endTime === 'number' ? pData.endTime : null,
                    adventuresLeft: pData.adventuresLeft !== undefined ? pData.adventuresLeft : null
                };
            }).filter(p => p !== null);
            activePotions = activePotions.filter(p => (p.endTime && Date.now() < p.endTime) || (p.adventuresLeft !== undefined && p.adventuresLeft > 0) || (!p.endTime && p.adventuresLeft === undefined));
        }

        // +++ LOAD DUNGEON STATE +++
        playerDungeonEntriesToday = loadedState.playerDungeonEntriesToday || { dungeon_1: 0, dungeon_2: 0 };
        lastDungeonResetTimestamp = loadedState.lastDungeonResetTimestamp || 0;
        playerDungeonCrawlers = Array.isArray(loadedState.playerDungeonCrawlers) ? loadedState.playerDungeonCrawlers : [];
        playerDungeonCrawlers = Array.isArray(loadedState.playerDungeonCrawlers) ? loadedState.playerDungeonCrawlers : [];
        confirmedCrawlersForDungeons = loadedState.confirmedCrawlersForDungeons || {}; // <<< ADD THIS LINE
        // dungeonCrawlerIdsLoaded is generally set at client start, not loaded from save.
        // +++ END LOAD DUNGEON STATE +++
        
        // Ensure activeDungeons loads npcCrawlers correctly
        activeDungeons = Array.isArray(loadedState.activeDungeons) ? loadedState.activeDungeons.map(dunData => { 
             return {
                 id: dunData.id || nextActiveAdventureId++, 
                 dungeonId: dunData.dungeonId || "unknown_dungeon",
                 name: dunData.name || "Unknown Dungeon",
                 adventurers: dunData.adventurers || 0,
                 returnTime: typeof dunData.returnTime === 'number' ? dunData.returnTime : Date.now(),
                 npcCrawlers: Array.isArray(dunData.npcCrawlers) ? dunData.npcCrawlers : [] // <<< ADD THIS LINE
             };
         }) : [];
         // The nextActiveAdventureId recalculation after this block should still be fine.

        recalculateTotalAvailableAdventurers();

        updateStatsDisplay();
        updatePlayerCombatStatsDisplay();
        renderMaterials();
        renderActiveTasksInSidebar(); // Renamed renderActiveAdventuresInSidebar
        renderActivePotions();
        renderInventory();
        updateAdventureDisplayStates();
        updateSwapDisplay();

        // Re-render the currently active page
        const activePageElement = document.querySelector('.page-content.active');
        if (activePageElement) {
            const pageId = activePageElement.id;
            // Specific rendering logic moved into showPage
            showPage(pageId); // Call showPage to trigger specific render functions
        } else {
             // Default to showing the adventures page if no active page found
             showPage('adventures-page');
        }

        // +++ CHECK AND RESET DAILY DUNGEON ENTRIES +++
        checkAndResetDailyDungeonEntries();
        // +++ END CHECK +++

        console.log("Game state applied successfully.");
    } catch (error) {
        console.error("Error during applyLoadedGameState:", error, error.stack);
        showCustomPopup("Error applying loaded game data. Please try logging in again or contact support if this persists.", "Apply State Error");
    }
}
            

            // --- Theme and Page Navigation ---
            function initializeTheme() { const savedTheme = localStorage.getItem('theme'); if (savedTheme === 'light') { body.classList.remove('dark-mode'); body.classList.add('light-mode'); if(darkModeToggle) darkModeToggle.checked = false; if (gameContainer && !gameContainer.classList.contains('hidden')) loadTwitterWidget('light'); } else { body.classList.add('dark-mode'); body.classList.remove('light-mode'); if(darkModeToggle) darkModeToggle.checked = true; if (gameContainer && !gameContainer.classList.contains('hidden')) loadTwitterWidget('dark'); } }
            function loadTwitterWidget(theme) { if (twitterWidgetContainer) { twitterWidgetContainer.innerHTML = ''; const twitterLink = document.createElement('a'); twitterLink.className = 'twitter-timeline'; twitterLink.setAttribute('data-dnt', 'true'); twitterLink.href = 'https://twitter.com/nvart_?ref_src=twsrc%5Etfw'; twitterLink.setAttribute('data-theme', theme); twitterLink.setAttribute('data-height', '400'); twitterLink.textContent = 'Tweets by nvart_'; twitterWidgetContainer.appendChild(twitterLink); let twitterScript = document.querySelector('script[src="https://platform.twitter.com/widgets.js"]'); if (twitterScript) { twitterScript.remove(); } twitterScript = document.createElement('script'); twitterScript.async = true; twitterScript.src = 'https://platform.twitter.com/widgets.js'; twitterScript.charset = 'utf-8'; document.body.appendChild(twitterScript); } }
            
            if(darkModeToggle){ darkModeToggle.addEventListener('change', () => { if (darkModeToggle.checked) { body.classList.add('dark-mode'); body.classList.remove('light-mode'); localStorage.setItem('theme', 'dark'); loadTwitterWidget('dark'); } else { body.classList.remove('dark-mode'); body.classList.add('light-mode'); localStorage.setItem('theme', 'light'); loadTwitterWidget('light'); } });}
            async function showPage(pageIdToShow) { console.log("Switching to page:", pageIdToShow); if(!pageContents || pageContents.length === 0) { console.error("pageContents NodeList is empty or not found in showPage. Ensure HTML elements with class 'page-content' exist and are selected correctly."); return; } pageContents.forEach(page => { page.classList.remove('active'); }); const targetPage = document.getElementById(pageIdToShow); if (targetPage) { targetPage.classList.add('active'); if (pageIdToShow === 'quests-page') renderQuests(); else if (pageIdToShow === 'shop-page') renderShopItems(); else if (pageIdToShow === 'crafting-page') renderCraftingItems(); else if (pageIdToShow === 'inventory-page') renderInventory(); else if (pageIdToShow === 'daily-rewards-page') renderDailyRewards(); else if (pageIdToShow === 'whitelist-page') await fetchAndDisplayRaffles(); else if (pageIdToShow === 'upgrade-page') { /* placeholder for upgrade page specific logic if any needed on show */ } else if (pageIdToShow === 'leaderboard-page') await fetchAndDisplayLeaderboards('pvTokens'); else if (pageIdToShow === 'dungeons-page') { renderDungeonsPage(); } /* <-- ADD THIS LINE */ } else { console.error("Target page with ID '" + pageIdToShow + "' not found."); showPage('adventures-page'); }}
            if(menuItems){ menuItems.forEach(item => { item.addEventListener('click', () => { const targetPageId = item.dataset.page; if (targetPageId) { showPage(targetPageId); } }); });}
            

            // --- Core Game Logic Display & Updates ---
            updateStatsDisplay(); 
            
            function updateStatsDisplay() { if(pvCountElement) pvCountElement.textContent = currentPvTokens; if(goldCountElement) goldCountElement.textContent = currentGold; if(diamondCountElement) diamondCountElement.textContent = currentDiamonds; if(availableAdventurersCountElement) availableAdventurersCountElement.textContent = totalAvailableAdventurers; }
            function formatTimeLeft(milliseconds) { if (milliseconds <= 0) return "Ended"; let ts = Math.ceil(milliseconds / 1000); let h = Math.floor(ts / 3600); ts %= 3600; let m = Math.floor(ts / 60); let s = ts % 60; return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`; }
            
function recalculateTotalAvailableAdventurers() {
    // Calculate adventurers currently on adventures AND dungeons
    const adventurersOnAdventure = activeAdventures.reduce((sum, adv) => sum + adv.adventurers, 0);
    const adventurersOnDungeon = activeDungeons.reduce((sum, dun) => sum + dun.adventurers, 0); // <-- ADD THIS LINE
    const totalAdventurersBusy = adventurersOnAdventure + adventurersOnDungeon; // <-- MODIFY THIS LINE

    // Base adventurers + bonus from ordinals - those currently busy
    totalAvailableAdventurers = MAX_PLAYER_ADVENTURERS + ordinalBonusAdventurers - totalAdventurersBusy; // <-- MODIFY THIS LINE

    updateStatsDisplay(); // This will update the UI for available adventurers
    updateAdventureDisplayStates(); // Update adventure buttons based on new availability
    // We also need to update dungeon button states
    if (document.getElementById('dungeons-page').classList.contains('active')) { // <-- ADD THIS IF BLOCK
        renderDungeonsPage();
    }
    console.log(`Recalculated totalAvailableAdventurers: ${totalAvailableAdventurers} (Base: ${MAX_PLAYER_ADVENTURERS}, Bonus: ${ordinalBonusAdventurers}, Busy: ${totalAdventurersBusy})`); // <-- MODIFY LOG
}
            
            function renderDungeonsPage() {
                if (!dungeonListContainer) return;
                dungeonListContainer.innerHTML = '';

                const adventure4Active = activeAdventures.find(adv => adv.originalAdventureId === "4");
                const dungeonsGloballyUnlocked = !!adventure4Active;

                dungeonsData.forEach(dungeon => {
                    const dungeonDiv = document.createElement('div');
                    dungeonDiv.classList.add('dungeon-entry');
                    dungeonDiv.dataset.dungeonId = dungeon.id;

                    // --- Determine Lock Status ---
                    let isLockedForEntry = false; 
                    let canSelectCrawlers = true;  
                    let displayLockReason = "";

                    if (!dungeonsGloballyUnlocked) {
                        isLockedForEntry = true;
                        canSelectCrawlers = false; 
                        displayLockReason = "Unlock Requirement: Adventure 4 active.";
                        if (dungeon.id === "dungeon_2") console.log(`D2 Lock Reason: Adventure 4 not active.`);
                    }
                     else if (dungeon.isLockedContent) {
                        isLockedForEntry = true;
                        canSelectCrawlers = false;
                        displayLockReason = "Content Coming Soon!";
                        if (dungeon.id === "dungeon_3") console.log(`D3 Lock Reason: Coming Soon.`);
                    }

                    let effectiveMaxEntries = dungeon.maxEntriesPerDay;
                    const pizzaPendantEquipped = Object.values(equippedItems).some(instanceId => 
                        instanceId && playerInventory.find(invItem => invItem.uniqueInstanceId === instanceId && invItem.id === "pizza_pendant")
                    );
                    if (pizzaPendantEquipped) {
                        if (dungeon.id === "dungeon_1") effectiveMaxEntries++;
                        if (dungeon.id === "dungeon_2") effectiveMaxEntries++;
                    }
                    const entriesToday = playerDungeonEntriesToday[dungeon.id] || 0;

                    if (entriesToday >= effectiveMaxEntries) {
                        isLockedForEntry = true;
                        canSelectCrawlers = false; 
                        displayLockReason = `Daily limit reached (${entriesToday}/${effectiveMaxEntries}). Resets daily.`;
                        if (dungeon.id === "dungeon_2") console.log(`D2 Lock Reason: Daily limit ${entriesToday}/${effectiveMaxEntries}.`);
                    }
                    
                    const playerBaseAttack = parseInt(playerAttackStatElement.textContent) || 0;
                    const playerBaseDefense = parseInt(playerDefenseStatElement.textContent) || 0;
                    let partyAttack = playerBaseAttack; 
                    let partyDefense = playerBaseDefense; 
                    let partyStatContributionText = ""; 

                    if (dungeon.type === "party_npc" && !dungeon.isLockedContent) { 
                        const confirmedCrawlersForThisDungeon = confirmedCrawlersForDungeons[dungeon.id] || [];
                        let crawlerAttackBonus = 0;
                        let crawlerDefenseBonus = 0;

                        if (dungeon.id === "dungeon_2") { 
                            console.log(`D2: Confirmed Crawlers for stat calc:`, JSON.parse(JSON.stringify(confirmedCrawlersForThisDungeon)));
                            console.log(`D2: Full playerDungeonCrawlers list:`, JSON.parse(JSON.stringify(playerDungeonCrawlers)));
                        }

                        if (confirmedCrawlersForThisDungeon.length > 0) {
                            confirmedCrawlersForThisDungeon.forEach(crawlerInstanceId => {
                                const crawlerData = playerDungeonCrawlers.find(c => c.uniqueInstanceId === crawlerInstanceId);
                                if (crawlerData) {
                                    if (dungeon.id === "dungeon_2") console.log(`D2: Found crawler data for ${crawlerInstanceId}: ATK=${crawlerData.attack}, DEF=${crawlerData.defense}`);
                                    crawlerAttackBonus += (parseInt(crawlerData.attack) || 0);
                                    crawlerDefenseBonus += (parseInt(crawlerData.defense) || 0);
                                } else {
                                    if (dungeon.id === "dungeon_2") console.log(`D2: No crawler data found in playerDungeonCrawlers for instance ID: ${crawlerInstanceId}`);
                                }
                            });
                        }
                        partyAttack += crawlerAttackBonus; 
                        partyDefense += crawlerDefenseBonus; 
                        
                        partyStatContributionText = ` (Player: ${playerBaseAttack} ATK, ${playerBaseDefense} DEF`;
                        if (confirmedCrawlersForThisDungeon.length > 0) {
                             partyStatContributionText += ` + Crawlers: ${crawlerAttackBonus} ATK, ${crawlerDefenseBonus} DEF = Party Total: ${partyAttack} ATK, ${partyDefense} DEF`;
                        }
                        partyStatContributionText += `)`;
                        
                        if (dungeon.id === "dungeon_2") {
                            console.log(`D2: Crawler Bonus ATK/DEF: ${crawlerAttackBonus}/${crawlerDefenseBonus}`);
                            console.log(`D2 Calculated Party Stats for Check: ${partyAttack} ATK, ${partyDefense} DEF. Required: ${dungeon.attackRequirement}/${dungeon.defenseRequirement}`);
                        }
                    } else if (!dungeon.isLockedContent) { 
                        partyStatContributionText = ` (Player: ${playerBaseAttack} ATK, ${playerBaseDefense} DEF)`;
                        if (dungeon.id === "dungeon_1") console.log(`D1 Calculated Party (Player) Stats: ${partyAttack} ATK, ${partyDefense} DEF. Required: ${dungeon.attackRequirement}/${dungeon.defenseRequirement}`);
                    }

                    if (!isLockedForEntry) { 
                        if (partyAttack < dungeon.attackRequirement || partyDefense < dungeon.defenseRequirement) {
                            isLockedForEntry = true; 
                            if (!displayLockReason) { 
                               displayLockReason = `Requires: ${dungeon.attackRequirement} ATK & ${dungeon.defenseRequirement} DEF. (Your Party: ${partyAttack} ATK, ${partyDefense} DEF)`;
                            }
                            if (dungeon.id === "dungeon_2" || dungeon.id === "dungeon_1") console.log(`D${dungeon.id.slice(-1)} Lock Reason (for entry): Stats not met. Party: ${partyAttack}/${partyDefense}`);
                        }
                    }

                    if (!isLockedForEntry && totalAvailableAdventurers < 1) {
                        isLockedForEntry = true;
                         if (dungeon.id === "dungeon_2" || dungeon.id === "dungeon_1") console.log(`D${dungeon.id.slice(-1)} Lock Reason (for entry): No available adventurers.`);
                    }

                    let enterButtonDisabled = isLockedForEntry; 
                    let selectCrawlersButtonDisabled = !canSelectCrawlers; 

                    if (dungeon.id === "dungeon_2") {
                        console.log(`D2 Final Button States Before HTML: selectCrawlersButtonDisabled: ${selectCrawlersButtonDisabled}, enterButtonDisabled: ${enterButtonDisabled}`);
                        console.log(`D2 Display Lock Reason: "${displayLockReason}"`);
                    }
                    
                    if (isLockedForEntry || !canSelectCrawlers) {
                         dungeonDiv.classList.add('locked');
                    } else {
                        dungeonDiv.classList.remove('locked');
                    }

                    // +++ ICON HTML LOGIC WITH TEXT HIDING +++
                    let iconHtml;
                    if (dungeon.id === "dungeon_1") {
iconHtml = `<div class="dungeon-icon-placeholder" style="background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/dungeon1.jpg'); background-size: cover; background-position: center; color: transparent; font-size: 0;"></div>`;
                    } else if (dungeon.id === "dungeon_2") {
                        iconHtml = `<div class="dungeon-icon-placeholder" style="background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/dungeon2.jpg'); background-size: cover; background-position: center; color: transparent; font-size: 0;"></div>`;
                    } else if (dungeon.id === "dungeon_3") { // ATH City
                        iconHtml = `<div class="dungeon-icon-placeholder" style="background-image: url('https://raw.githubusercontent.com/nvoiy/pvadventures/main/imgnew%20(5).jpg'); background-size: cover; background-position: center; color: transparent; font-size: 0;"></div>`;
                    } else {
                        // Fallback for any other/new dungeons if not specified - THIS ONE WILL SHOW TEXT
                        iconHtml = `<div class="dungeon-icon-placeholder" style="background-color: #4A2A00;">${dungeon.id.replace('dungeon_', '').toUpperCase()}</div>`;
                    }
                    // +++ END OF ICON HTML LOGIC +++
                    
                    let additionalInfo = '';
                    if (dungeon.type === "party_npc") {
                        additionalInfo += `<p style="font-size:0.9em; color:var(--highlight-color-gold);"><em>This is an offline NPC-assisted dungeon. Multiplayer coming soon!</em></p>`;
                        additionalInfo += `<button class="action-button select-dungeon-crawlers-btn" data-dungeon-id="${dungeon.id}" ${selectCrawlersButtonDisabled ? 'disabled' : ''}>Select Crawlers (Max ${dungeon.maxPartySize -1})</button>`;
                        
                        let currentConfirmedForThisDungeon = confirmedCrawlersForDungeons[dungeon.id] || [];
                        let confirmedDisplayHtml = 'No crawlers selected.';
                        if (currentConfirmedForThisDungeon.length > 0) {
                             const names = currentConfirmedForThisDungeon.map(id => {
                                const crawler = playerDungeonCrawlers.find(c => c.uniqueInstanceId === id);
                                return crawler ? crawler.name : 'Unknown';
                            }).join(', ');
                            confirmedDisplayHtml = `Selected: ${names}`;
                        }
                        additionalInfo += `<div id="selectedCrawlersDisplay_${dungeon.id}" style="font-size:0.85em; margin-top:5px;">${confirmedDisplayHtml}</div>`;
                    }
                    
                    dungeonDiv.innerHTML = `
                        ${iconHtml} 
                        <div class="dungeon-info">
                            <h3>${dungeon.name}</h3>
                            <p>${dungeon.description}</p>
                            <p>Duration: ${dungeon.durationHours} Hours</p>
                            <p>Reqs: ${dungeon.attackRequirement} ATK, ${dungeon.defenseRequirement} DEF ${partyStatContributionText}</p>
                            <p>Daily Attempts: ${entriesToday} / ${effectiveMaxEntries}</p>
                            <p>Reward: ${dungeon.placeholderReward}</p>
                            ${displayLockReason ? `<p class="dungeon-requirements">${displayLockReason}</p>` : (dungeonsGloballyUnlocked ? `<p class="dungeon-requirements" style="color:var(--highlight-color-connected);">Unlocked!</p>` : '')}
                            ${additionalInfo}
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;"> 
                            <button class="action-button enter-dungeon-btn" data-dungeon-id="${dungeon.id}" ${enterButtonDisabled ? 'disabled' : ''}>Enter</button>
                            <div class="dungeon-drops-area"> 
                                <button class="action-button dungeon-drops-button" data-dungeon-id="${dungeon.id}">DROPS</button>
                                <div class="drops-popover" id="dungeon-drops-popover-${dungeon.id}"></div> 
                            </div>
                        </div>
                    `;
                    dungeonListContainer.appendChild(dungeonDiv);
                });

                // Re-add event listeners
                document.querySelectorAll('.enter-dungeon-btn:not([disabled])').forEach(button => {
                    button.addEventListener('click', handleEnterDungeon);
                });
                document.querySelectorAll('.select-dungeon-crawlers-btn:not([disabled])').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const dungeonId = event.target.dataset.dungeonId;
                        openDungeonCrawlerSelectionModal(dungeonId);
                    });
                });
                document.querySelectorAll('.dungeon-drops-button').forEach(button => {
                    button.addEventListener('mouseenter', (event) => {
                        const dungeonId = event.target.dataset.dungeonId;
                        const popover = document.getElementById(`dungeon-drops-popover-${dungeonId}`);
                        const dungeonInfo = dungeonsData.find(d => d.id === dungeonId);
                        
                        if (popover && dungeonInfo && dungeonInfo.drops && dungeonInfo.drops.length > 0) {
                            let dropsHtml = '<h5>Possible Drops:</h5><ul>';
                            dungeonInfo.drops.forEach(drop => {
                                const dItemMaster = craftableItemsData.find(ci => ci.id === drop.id);
                                dropsHtml += `<li>${drop.qty || 1}x ${dItemMaster ? dItemMaster.name : drop.name || drop.id} (${(drop.chance * 100).toFixed(3)}%)</li>`;
                            });
                            dropsHtml += '</ul>';
                            popover.innerHTML = dropsHtml;
                            popover.style.display = 'block'; 

                            const buttonRect = event.target.getBoundingClientRect();
                            const popoverRect = popover.getBoundingClientRect();
                            const viewportHeight = window.innerHeight;

                            popover.style.left = '50%'; 
                            popover.style.transform = 'translateX(-50%)'; 

                            if (buttonRect.bottom + popoverRect.height > viewportHeight - 10) { 
                                popover.style.top = `auto`;
                                popover.style.bottom = `calc(100% + 5px)`;
                            } else {
                                popover.style.bottom = `auto`;
                                popover.style.top = `calc(100% + 5px)`;
                            }
                        } else if (popover) {
                            popover.innerHTML = '<h5>No specific item drops listed for this dungeon.</h5>';
                            popover.style.display = 'block';
                            popover.style.left = '50%';
                            popover.style.transform = 'translateX(-50%)';
                            popover.style.top = `calc(100% + 5px)`;
                            popover.style.bottom = 'auto';
                        }
                    });
                    button.addEventListener('mouseleave', (event) => {
                        const dungeonId = event.target.dataset.dungeonId;
                        const popover = document.getElementById(`dungeon-drops-popover-${dungeonId}`);
                        if (popover) {
                            popover.style.display = 'none';
                        }
                    });
                });
            }
            
            function renderActiveTasksInSidebar() { // Renamed from renderActiveAdventuresInSidebar
                // +++ ADD LOG HERE +++
                console.log("renderActiveTasksInSidebar CALLED. activeAdventures:", JSON.parse(JSON.stringify(activeAdventures)), "activeDungeons:", JSON.parse(JSON.stringify(activeDungeons)));
                // +++ END LOG +++
                if (!sidebarActiveAdventuresList || !sidebarActiveAdventuresContainer) return;

                // Combine and sort active tasks
                const activeTasks = [
                    ...activeAdventures.map(adv => ({ type: 'adventure', ...adv })),
                    ...activeDungeons.map(dun => ({ type: 'dungeon', ...dun })) // <-- Add dungeons
                ];

                 // Sort by return time (earliest first)
                 activeTasks.sort((a, b) => a.returnTime - b.returnTime);

                sidebarActiveAdventuresList.innerHTML = ''; // Clear list

                if (activeTasks.length === 0) {
                    const p = document.createElement('p');
                    p.textContent = "No adventurers or dungeon parties currently busy."; // Updated text
                    p.style.textAlign = "center";
                    sidebarActiveAdventuresList.appendChild(p);
                } else {
                    activeTasks.forEach(task => {
                        const itemDiv = document.createElement('div');
                        itemDiv.classList.add('active-adventure-item'); // Reuse existing class for styling
                        itemDiv.dataset.instanceId = task.id; // Use the unique instance ID
                                            console.log(`Sidebar Render: Task Type: ${task.type}, ID: ${task.id}, Name: ${task.name}`);


                        const timeLeftMs = task.returnTime - Date.now();

                        const infoDiv = document.createElement('div');
                        infoDiv.classList.add('active-adventure-item-info');
                        const typeText = task.type === 'dungeon' ? 'Dungeon Party' : 'Adventurers'; // Label type
                        infoDiv.innerHTML = `<p><strong>${task.name}</strong></p><p>${typeText}: ${task.adventurers}</p><p>Time Left: <span class="timer">${formatTimeLeft(timeLeftMs)}</span></p>`;

                        // Add cancel button only for adventures, not dungeons (for this v1)
                         let cancelBtnHtml = '';
                         if (task.type === 'adventure') {
                              cancelBtnHtml = `<button class="cancel-adventure-btn" data-adventure-instance-id="${task.id}" title="Cancel Adventure"></button>`;
                         }


                        itemDiv.innerHTML = `
                            <div class="active-adventure-item-info">
                                <p><strong>${task.name}</strong></p>
                                <p>${typeText}: ${task.adventurers}</p>
                                <p>Time Left: <span class="timer">${formatTimeLeft(timeLeftMs)}</span></p>
                            </div>
                            ${cancelBtnHtml}
                        `;


                        sidebarActiveAdventuresList.appendChild(itemDiv);
                    });
                }
                sidebarActiveAdventuresContainer.classList.remove('hidden');
                 // Re-add listeners for cancel buttons (only needed if they exist)
                sidebarActiveAdventuresList.querySelectorAll('.cancel-adventure-btn').forEach(b => {
                    // Remove existing listeners to prevent duplicates if function is called multiple times
                     const oldListener = b._cancelListener; // Check if we stored a listener previously
                     if(oldListener) b.removeEventListener('click', oldListener);

                    const listener = () => handleCancelAdventure(parseInt(b.dataset.adventureInstanceId));
                     b.addEventListener('click', listener);
                     b._cancelListener = listener; // Store the listener reference

                });
            }

            function renderActivePotions() { if (!activePotionsList || !activePotionsDisplay) return; activePotionsList.innerHTML = ''; if (activePotions.length === 0) { activePotionsDisplay.classList.add('hidden'); return; } activePotionsDisplay.classList.remove('hidden'); activePotions.forEach(potion => { const itemDiv = document.createElement('div'); itemDiv.classList.add('potion-item'); let details = ''; if (potion.endTime) { const timeLeftMs = potion.endTime - Date.now(); details = `Time Left: <span class="timer">${formatTimeLeft(timeLeftMs)}</span>`; } else if (potion.adventuresLeft !== undefined) { details = `Adventures Left: ${potion.adventuresLeft}`; } itemDiv.innerHTML = `<p><strong>${potion.name}</strong></p><p>${potion.description}</p><p>${details}</p>`; activePotionsList.appendChild(itemDiv); });}
            
            function updatePlayerCombatStatsDisplay() {
                if (!playerAttackStatElement || !playerDefenseStatElement) return;
                let totalAttack = 0;
                let totalDefense = 0;

                Object.values(equippedItems).forEach(equippedInstanceId => {
                    if (!equippedInstanceId) return;
                    const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId);
                    if (invItem) {
                        const itemMaster = craftableItemsData.find(im => im.id === invItem.id);
                        if (itemMaster && itemMaster.perk) {
                            const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0);
                            if (scaledPerk) {
                                if (scaledPerk.type === "attackBoost") {
                                    totalAttack += scaledPerk.value;
                                } else if (scaledPerk.type === "defenseBoost") {
                                    totalDefense += scaledPerk.value;
                                } else if (scaledPerk.type === "statBoost") {
                                    totalAttack += (scaledPerk.attack || 0);
                                    totalDefense += (scaledPerk.defense || 0);
                                }
                            }
                        }
                    }
                });
                playerAttackStatElement.textContent = totalAttack;
                playerDefenseStatElement.textContent = totalDefense;
            }
            function getDungeonSetBonusTimeReduction() {
                let equippedSetPieces = 0;
                dungeonSetItemIds.forEach(setItemId => {
                    if (Object.values(equippedItems).some(instanceId => {
                        if (!instanceId) return false;
                        const item = playerInventory.find(invItem => invItem.uniqueInstanceId === instanceId);
                        return item && item.id === setItemId;
                    })) {
                        equippedSetPieces++;
                    }
                });

                if (equippedSetPieces >= 4) { // All 4 pieces equipped
                    return 0.20; // 20% time reduction
                }
                return 0; // No bonus
            }

            function renderMaterials() { 
                if (!materialsListContainer) return;
                materialsListContainer.innerHTML = ''; 

                for (const tier in materialTiers) {
                    const tierTitle = document.createElement('h5');
                    tierTitle.classList.add('material-tier-title');
                    tierTitle.textContent = `Tier ${tier} Materials:`;
                    materialsListContainer.appendChild(tierTitle);

                    const ul = document.createElement('ul');
                    let foundInTier = false;
                    materialTiers[tier].forEach(matName => {
                        if (playerMaterials.hasOwnProperty(matName) && playerMaterials[matName] > 0) {
                            const li = document.createElement('li');
                            li.textContent = `${matName}: ${playerMaterials[matName]}`;
                            ul.appendChild(li);
                            foundInTier = true;
                        }
                    });
                    if (!foundInTier) {
                         const li = document.createElement('li');
                         li.textContent = `No Tier ${tier} materials found.`;
                         ul.appendChild(li);
                    }
                    materialsListContainer.appendChild(ul);
                }
                const scrollsTitle = document.createElement('h5');
                scrollsTitle.classList.add('upgrade-scrolls-title');
                scrollsTitle.textContent = 'Upgrade Scrolls:';
                materialsListContainer.appendChild(scrollsTitle);
                const scrollsUl = document.createElement('ul');
                                scrollsUl.appendChild(createScrollListItem(scrollData.low.name, playerScrolls.low));
                scrollsUl.appendChild(createScrollListItem(scrollData.middle.name, playerScrolls.middle));
                scrollsUl.appendChild(createScrollListItem(scrollData.high.name, playerScrolls.high));
                materialsListContainer.appendChild(scrollsUl);
            }
            function createScrollListItem(name, count) {
                const li = document.createElement('li');
                li.textContent = `${name}: ${count}`;
                return li;
            }


             function getItemIconHTML(iconUrlOrColor, typeInitial = 'I', size = 'var(--item-icon-size)') {
                const isUrl = iconUrlOrColor && (iconUrlOrColor.startsWith('http') || iconUrlOrColor.startsWith('data:image') || iconUrlOrColor.startsWith('https://'));
                const iconContainer = document.createElement('div');
                iconContainer.style.width = size;
                iconContainer.style.height = size;
                iconContainer.style.display = 'flex';
                iconContainer.style.alignItems = 'center';
                iconContainer.style.justifyContent = 'center';
                iconContainer.style.marginRight = (size === 'var(--item-icon-size)') ? '10px' : '0'; 
                iconContainer.style.flexShrink = '0';
                iconContainer.style.overflow = 'hidden'; 
                iconContainer.style.borderRadius = '4px'; 


                if (isUrl) {
                    const img = document.createElement('img');
                    img.src = iconUrlOrColor;
                    img.alt = typeInitial;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '100%';
                    img.style.objectFit = 'contain'; 
                    iconContainer.appendChild(img);
                } else {
                    iconContainer.style.backgroundColor = iconUrlOrColor || '#555'; 
                    iconContainer.style.color = 'white';
                    let fontSizeNum = 0.4; 
                    try {
                        const sizeValue = getComputedStyle(document.documentElement).getPropertyValue('--item-icon-size').trim();
                        if (sizeValue.endsWith('px')) {
                           fontSizeNum = (parseInt(sizeValue) * 0.4) / parseInt(getComputedStyle(document.body).fontSize) ; 
                        }
                    } catch (e) { /* use default */ }
                    iconContainer.style.fontSize = `${fontSizeNum}em`; 
                    iconContainer.textContent = typeInitial ? typeInitial.substring(0,1).toUpperCase() : 'I';
                }
                return iconContainer.outerHTML;
            }


            function renderCraftingItems() { 
                if(!craftingItemsContainer) return; 
                craftingItemsContainer.innerHTML = ''; 
                craftableItemsData.forEach(item => { 
                    const alreadyOwned = playerInventory.some(invItem => invItem.id === item.id) || Object.values(equippedItems).some(equippedInstanceId => { 
                        const eqItem = playerInventory.find(pi => pi.uniqueInstanceId === equippedInstanceId); 
                        return eqItem && eqItem.id === item.id; 
                    }); 
                    const card = document.createElement('div'); 
                    card.className = 'craftable-item-card'; 
                    let recipeHtml = 'Requires: '; 
                    for(const mat in item.recipe){ recipeHtml += `${item.recipe[mat]} ${mat}, `; } 
                    recipeHtml = recipeHtml.slice(0, -2); 
                    card.innerHTML = `
                        <div class="item-icon-placeholder">${getItemIconHTML(item.iconUrlOrColor, item.type)}</div> 
                        <div class="item-info"> 
                            <p><strong>${item.name}</strong> (${item.type})</p> 
                            <small>${item.description}</small> 
                            <p class="crafting-cost"><small>${recipeHtml}</small></p> 
                        </div> 
                        <button class="action-button craft-button" data-item-id="${item.id}" ${alreadyOwned ? 'disabled title="You already own an instance of this base item."' : ''}>${alreadyOwned ? 'Owned' : 'Craft'}</button>`; 
                    craftingItemsContainer.appendChild(card); 
                    card.addEventListener('mousemove', (e) => showItemTooltip(e, item, true)); 
                    card.addEventListener('mouseleave', hideItemTooltip);
                }); 
                document.querySelectorAll('.craft-button:not([disabled])').forEach(b => b.addEventListener('click', e => craftItem(e.target.dataset.itemId))); 
            }
            
            function renderInventory() { 
                if (!inventoryItemsContainer || !equipmentSlotsDisplay) return; 
                
                equipmentSlotsDisplay.innerHTML = ''; 
            const slotTypes = [ { name: "Armour", id: "Armour" }, { name: "Helmet", id: "Helmet" }, { name: "Boots", id: "Boots" }, { name: "Amulet", id: "Amulet" }, { name: "Ring 1", id: "Ring1" }, { name: "Ring 2", id: "Ring2" }, { name: "Weapon", id: "Weapon" }, { name: "Pet", id: "Pet" }, { name: "Misc 1", id: "Misc1" }, { name: "Misc 2", id: "Misc2" } ];
        
        slotTypes.forEach(slot => { 
                    const slotDiv = document.createElement('div'); 
                    slotDiv.classList.add('equipment-slot'); 
                    
                    const equippedItemInstanceId = equippedItems[slot.id]; 
                    const equippedInvItem = playerInventory.find(invItem => invItem.uniqueInstanceId === equippedItemInstanceId);
                    const itemDataForSlot = equippedInvItem ? (craftableItemsData.find(i => i.id === equippedInvItem.id) || (equippedInvItem.id === "ring_cursedpower" ? craftableItemsData.find(i => i.id === "ring_cursedpower") : null)) : null;

                    let slotContent = `<div class="slot-name">${slot.name.toUpperCase()}</div>`; 
                    
                    if (slot.id === "Ring2" && !secondRingSlotUnlocked) {
                        slotDiv.classList.add('locked');
                        slotContent += `<div class="equipped-item-container"><div class="empty-slot-text">(Locked)</div>`; // Wrap for consistency
                        const riderScrollInInventory = playerInventory.find(item => item.id === 'rider_scroll_unlock');
                        if (riderScrollInInventory) {
                            slotContent += `<button class="action-button use-rider-scroll-btn" data-item-unique-id="${riderScrollInInventory.uniqueInstanceId}">Use Rider Scroll</button>`;
                        } else if (!playerHasPurchasedRiderScroll) { 
                             slotContent += `<div class="empty-slot-text" style="font-size:0.8em;">Purchase Rider Scroll from Shop</div>`;
                        }
                    slotContent += `</div>`;
                } else if (slot.id === "Pet" && !petSlotUnlocked) { // NEW ELSE IF BLOCK
                    slotDiv.classList.add('locked');
                    slotContent += `<div class="equipped-item-container"><div class="empty-slot-text">(Locked)</div>`;
                    const petWhistleInInventory = playerInventory.find(item => item.id === 'pet_whistle_unlock');
                    if (petWhistleInInventory) {
                        slotContent += `<button class="action-button use-pet-whistle-btn" data-item-unique-id="${petWhistleInInventory.uniqueInstanceId}">Use Pet Whistle</button>`;
                    } else if (!playerHasPurchasedPetWhistle) { // Check if it was ever purchased
                         slotContent += `<div class="empty-slot-text" style="font-size:0.8em;">Purchase Pet Whistle from Shop</div>`;
                    }
                    slotContent += `</div>`;
                } else {
                    slotContent += `<div class="equipped-item-container">`; // Container for tooltip target
                        if (itemDataForSlot && equippedInvItem) { 
                            const levelText = (equippedInvItem.level || 0) > 0 ? `(+${equippedInvItem.level || 0}) ` : '';
                            slotContent += `${getItemIconHTML(itemDataForSlot.iconUrlOrColor, itemDataForSlot.type, 'var(--item-icon-size)')} <div class="equipped-item-name">${levelText}${itemDataForSlot.name}</div> <button class="unequip-btn action-button" data-item-slot-id="${slot.id}">Unequip</button>`; 
                    if (equippedInvItem.level === 1) slotDiv.classList.add('item-level-plus1'); // NEW
                    if (equippedInvItem.level === 2) slotDiv.classList.add('item-level-plus2'); // NEW
                    if (equippedInvItem.level === 3) slotDiv.classList.add('item-level-plus3'); // NEW
                    if (equippedInvItem.level === 4) slotDiv.classList.add('item-level-plus4');
                    if (equippedInvItem.level === 5) slotDiv.classList.add('item-level-plus5');
                } else {  
                            slotContent += `<div class="empty-slot-text">(Empty Slot)</div>`; 
                        }
                        slotContent += `</div>`;
                    }
                    slotDiv.innerHTML = slotContent; 
                    equipmentSlotsDisplay.appendChild(slotDiv); 

                    // Add tooltip listener to the container if item is equipped
                    const itemContainerForTooltip = slotDiv.querySelector('.equipped-item-container');
                    if (itemDataForSlot && equippedInvItem && itemContainerForTooltip) {
                        itemContainerForTooltip.addEventListener('mousemove', (e) => showItemTooltip(e, { ...itemDataForSlot, level: equippedInvItem.level || 0 }));
                        itemContainerForTooltip.addEventListener('mouseleave', hideItemTooltip);
                    }
                }); 
            equipmentSlotsDisplay.querySelectorAll('.unequip-btn').forEach(b => b.addEventListener('click', e => { const itemSlotId = e.target.dataset.itemSlotId; unequipItem(itemSlotId); })); 
            equipmentSlotsDisplay.querySelectorAll('.use-rider-scroll-btn').forEach(b => b.addEventListener('click', e => useRiderScrollUnlock(e.target.dataset.itemUniqueId)));
            equipmentSlotsDisplay.querySelectorAll('.use-pet-whistle-btn').forEach(b => b.addEventListener('click', e => usePetWhistleUnlock(e.target.dataset.itemUniqueId))); // ADD THIS LINE
            
            inventoryItemsContainer.innerHTML = ''; 
                if (playerInventory.length === 0) { inventoryItemsContainer.innerHTML = '<p style="text-align:center;">Your bag is empty.</p>'; return; } 
                
                playerInventory.forEach(invItem => { 
                    let itemData = craftableItemsData.find(i => i.id === invItem.id); 
                    if (!itemData && invItem.id === "rider_scroll_unlock") { 
                        itemData = shopItemsData.find(si => si.id === "rider_scroll_unlock");
                    }
                    
                    if (itemData) { 
                        const card = document.createElement('div'); 
                card.className = 'inventory-item-card'; 
                if (invItem.level === 1) card.classList.add('item-level-plus1'); // NEW
                if (invItem.level === 2) card.classList.add('item-level-plus2'); // NEW
                if (invItem.level === 3) card.classList.add('item-level-plus3'); // NEW
                if (invItem.level === 4) card.classList.add('item-level-plus4');
                if (invItem.level === 5) card.classList.add('item-level-plus5');

            let actionsHtml = '';
                    const isEquipped = Object.values(equippedItems).includes(invItem.uniqueInstanceId);
                    const levelText = (invItem.level || 0) > 0 ? `(+${invItem.level || 0}) ` : '';

                // Prevent "Equip" button for specific non-equippable items
                if (itemData.type !== "Pet Unlock Consumable" && // Still keep this
                    itemData.type !== "Consumable" &&
                    itemData.type !== "upgrade_scroll_purchase" &&
                    itemData.type !== "unlockable_consumable" &&
                    !isEquipped ) {
                    // For Pet type, only show equip if the slot is unlocked
                    if (itemData.type === "Pet") {
                        if (petSlotUnlocked) {
                            actionsHtml += `<button class="equip-btn action-button" data-item-unique-id="${invItem.uniqueInstanceId}">Equip</button>`;
                        }
                    } else { // For other equippable types
                        actionsHtml += `<button class="equip-btn action-button" data-item-unique-id="${invItem.uniqueInstanceId}">Equip</button>`;
                    }
                } // The original `else if (itemData.type !== "Pet Unlock Consumable" ...)` closing brace was here
                    
                    card.innerHTML = ` 
                        <div class="item-icon-placeholder">${getItemIconHTML(itemData.iconUrlOrColor, itemData.type)}</div> 
                        <div class="item-info"> 
                            <p><strong>${levelText}${itemData.name}</strong> (${itemData.type || 'Item'})</p> 
                            <small class="item-perk">${itemData.description || ''}</small> 
                        </div> 
                        <div class="item-actions">${actionsHtml} ${isEquipped ? '<span class="equipped-status">Equipped</span>' : ''}</div>`; 
                        inventoryItemsContainer.appendChild(card); 
                        card.addEventListener('mousemove', (e) => showItemTooltip(e, { ...itemData, level: invItem.level || 0 }));
                        card.addEventListener('mouseleave', hideItemTooltip);
                    } 

            });
            inventoryItemsContainer.querySelectorAll('.equip-btn').forEach(b => b.addEventListener('click', e => equipItem(e.target.dataset.itemUniqueId)));
            updatePlayerCombatStatsDisplay();
            renderActiveSpecialties(); // <<< ADD THIS LINE
        }

            function useRiderScrollUnlock(itemUniqueId) {
                if (!currentUser) return;
                const itemIndex = playerInventory.findIndex(item => item.uniqueInstanceId === itemUniqueId && item.id === 'rider_scroll_unlock');
                if (itemIndex === -1) {
                    showCustomPopup("Rider Scroll not found in inventory or invalid item.", "Error");
                    return;
                }
                if (secondRingSlotUnlocked) {
                    showCustomPopup("Second Ring Slot is already unlocked.", "Info");
                    playerInventory.splice(itemIndex, 1); 
                    renderInventory();
                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                    return;
                }

                secondRingSlotUnlocked = true;
                playerInventory.splice(itemIndex, 1); 

                showCustomPopup("Second Ring Slot Unlocked!", "Unlock Successful");
                renderInventory(); 
                if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
            }

                 function handleEnterDungeon(event) {
                if (!currentUser) {
                    showCustomPopup("You must be logged in to enter a dungeon.", "Login Required");
                    return;
                }
                const dungeonId = event.target.dataset.dungeonId;
                const dungeon = dungeonsData.find(d => d.id === dungeonId);

                if (!dungeon) {
                    console.error("Dungeon data not found for ID:", dungeonId);
                    showCustomPopup("Error finding dungeon data.", "Dungeon Error");
                    return;
                }

                // 1. General Dungeon Unlock Check (Adventure 4 Active)
                const adventure4Active = activeAdventures.find(adv => adv.originalAdventureId === "4");
                if (!adventure4Active) {
                    showCustomPopup(`Dungeons are locked. You need an adventurer on Adventure 4.`, "Dungeon Locked");
                    renderDungeonsPage(); return;
                }

                // 2. Stat Requirements Check
                 // 2. Stat Requirements Check (with party contributions for party_npc dungeons)
               const playerBaseAttack = parseInt(playerAttackStatElement.textContent) || 0;
                const playerBaseDefense = parseInt(playerDefenseStatElement.textContent) || 0;
                let currentPartyAttack = playerBaseAttack;
                let currentPartyDefense = playerBaseDefense;

                if (dungeon.type === "party_npc") {
                    const confirmedCrawlers = confirmedCrawlersForDungeons[dungeon.id] || [];
                    if (dungeon.id === "dungeon_2") { // Specific logging for Dungeon 2
                        console.log(`D2 Enter Check: Confirmed Crawlers:`, JSON.parse(JSON.stringify(confirmedCrawlers)));
                        console.log(`D2 Enter Check: Full playerDungeonCrawlers list:`, JSON.parse(JSON.stringify(playerDungeonCrawlers)));
                    }
                    confirmedCrawlers.forEach(crawlerInstanceId => {
                        const crawlerData = playerDungeonCrawlers.find(c => c.uniqueInstanceId === crawlerInstanceId);
                        if (crawlerData) {
                            if (dungeon.id === "dungeon_2") console.log(`D2 Enter Check: Found crawler data for ${crawlerInstanceId}: ATK=${crawlerData.attack}, DEF=${crawlerData.defense}`);
                            currentPartyAttack += (parseInt(crawlerData.attack) || 0); // Ensure parsing
                            currentPartyDefense += (parseInt(crawlerData.defense) || 0); // Ensure parsing
                        } else {
                             if (dungeon.id === "dungeon_2") console.log(`D2 Enter Check: No crawler data found in playerDungeonCrawlers for instance ID: ${crawlerInstanceId}`);
                        }
                    });
                    if (dungeon.id === "dungeon_2") console.log(`D2 Enter Check: Final Party ATK/DEF: ${currentPartyAttack}/${currentPartyDefense}`);
                }

                if (currentPartyAttack < dungeon.attackRequirement || currentPartyDefense < dungeon.defenseRequirement) {
                    showCustomPopup(`Cannot enter ${dungeon.name}. Requires ${dungeon.attackRequirement} ATK & ${dungeon.defenseRequirement} DEF. Your current party total is ${currentPartyAttack} ATK & ${currentPartyDefense} DEF.`, "Requirements Not Met");
                    renderDungeonsPage(); 
                    return;
                }

                // 3. Daily Entry Limit Check (with Pizza Pendant bonus)
                let effectiveMaxEntries = dungeon.maxEntriesPerDay;
                const pizzaPendantEquipped = Object.values(equippedItems).some(instanceId => {
                    if (!instanceId) return false;
                    const item = playerInventory.find(invItem => invItem.uniqueInstanceId === instanceId);
                    return item && item.id === "pizza_pendant";
                });
                if (pizzaPendantEquipped) {
                    if (dungeon.id === "dungeon_1") effectiveMaxEntries++;
                    if (dungeon.id === "dungeon_2") effectiveMaxEntries++;
                }

                const entriesToday = playerDungeonEntriesToday[dungeon.id] || 0;
                if (entriesToday >= effectiveMaxEntries) {
                    showCustomPopup(`Daily limit for ${dungeon.name} reached (${entriesToday}/${effectiveMaxEntries}). Resets daily.`, "Limit Reached");
                    renderDungeonsPage(); return;
                }
                
                // 4. Available Adventurers Check
                if (totalAvailableAdventurers < 1) { // All dungeons currently cost 1 player adventurer
                    showCustomPopup("Not enough adventurers available to enter the dungeon.", "Adventurers Needed");
                    renderDungeonsPage(); return;
                }

                // For Dungeon 2 (party_npc):
                // For now, we simulate using 1 player adventurer and acknowledge future NPC/multiplayer.
                // Actual NPC selection and stat contribution will be a later feature.
                let adventurersForThisDungeon = 1; // Player always contributes 1
                let partyMembersInfo = "";
                if (dungeon.type === "party_npc") {
                    // In the future, `selectedCrawlers` would be an array of objects from a selection modal.
                    // For now, we can just acknowledge it.
                    // let selectedCrawlers = getCurrentlySelectedCrawlersForDungeon(dungeon.id); // Imaginary function
                    // adventurersForThisDungeon += selectedCrawlers.length; // If NPCs counted against a separate pool
                    partyMembersInfo = ` (Future: plus selected NPC crawlers)`;
                }
                
                // Dungeon entry cost confirmed, proceed
                playerDungeonEntriesToday[dungeon.id] = (playerDungeonEntriesToday[dungeon.id] || 0) + 1;

                let calculatedDurationMs = dungeon.durationHours * GAME_HOUR_IN_REAL_SECONDS * 1000;
                // Dungeon set bonus does NOT apply to dungeon duration, only adventures.
                // Orb of Haste does not apply to dungeon duration for now.

                const returnTime = Date.now() + calculatedDurationMs;

                const newActiveDungeon = {
                    id: nextActiveAdventureId++,
                    dungeonId: dungeon.id,
                    name: dungeon.name,
                    adventurers: adventurersForThisDungeon, // Player's adventurer
                    returnTime: returnTime,
                    // Include the instance IDs of confirmed NPC crawlers for this dungeon run
                    npcCrawlers: (dungeon.type === "party_npc" ? (confirmedCrawlersForDungeons[dungeon.id] || []) : []) 
                };
console.log("--- PREPARING TO START DUNGEON ---");
console.log("Dungeon Data:", JSON.parse(JSON.stringify(dungeon)));
console.log("Calculated Duration (ms):", calculatedDurationMs);
console.log("Return Time:", new Date(returnTime).toLocaleString());
console.log("newActiveDungeon object to be pushed:", JSON.parse(JSON.stringify(newActiveDungeon)));
console.log("Current activeAdventures BEFORE dungeon push:", JSON.parse(JSON.stringify(activeAdventures)));
console.log("Current activeDungeons BEFORE dungeon push:", JSON.parse(JSON.stringify(activeDungeons)));
                activeDungeons.push(newActiveDungeon);
                // +++ ADD LOGS HERE +++
                console.log("New dungeon pushed:", JSON.parse(JSON.stringify(newActiveDungeon)));
                console.log("Current activeDungeons array:", JSON.parse(JSON.stringify(activeDungeons)));

                console.log("Calling recalculateTotalAvailableAdventurers after new dungeon push...");
                recalculateTotalAvailableAdventurers(); 

                console.log("Explicitly calling renderActiveTasksInSidebar after new dungeon...");
                renderActiveTasksInSidebar(); 
                renderDungeonsPage(); 
                
                if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
            }

function usePetWhistleUnlock(itemUniqueId) {
    if (!currentUser) return;
    const itemIndex = playerInventory.findIndex(item => item.uniqueInstanceId === itemUniqueId && item.id === 'pet_whistle_unlock');
    if (itemIndex === -1) {
        showCustomPopup("Ancient Pet Whistle not found in inventory or invalid item.", "Error");
        return;
    }
    if (petSlotUnlocked) {
        showCustomPopup("Pet Slot is already unlocked.", "Info");
        // Optionally, still consume the item if they try to use it again
        playerInventory.splice(itemIndex, 1);
        renderInventory();
        if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
        return;
    }

    petSlotUnlocked = true;
    playerInventory.splice(itemIndex, 1); // Consume the whistle

    showCustomPopup("Pet Slot Unlocked! You can now equip a pet.", "Unlock Successful");
    renderInventory(); // Re-render to show the unlocked slot
    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
}
             function renderQuests() { 
                if (!questListDiv) return; 
                questListDiv.innerHTML = ''; 
            quests.forEach(quest => { 
                const qe = document.createElement('div'); 
                qe.classList.add('quest-item'); 

                // +++ ADD CLASS BASED ON QUEST STATUS +++
                if (quest.completed && quest.claimed) {
                    qe.classList.add('completed-and-claimed');
                } else if (quest.completed && !quest.claimed) {
                    qe.classList.add('available-to-claim');
                }
                // No special class if not completed yet

                qe.innerHTML = `
                    <div class="quest-info">
                            <p>${quest.text} (${quest.progress || 0}/${quest.target||'N/A'})</p>
                        </div>
                        <div class="quest-actions">
                            <span class="quest-reward">Reward: ${quest.reward}</span>
                            <button class="action-button claim-quest-btn" data-quest-id="${quest.id}" ${quest.completed && !(quest.claimed) ? '' : 'disabled'}>${quest.claimed ? 'Claimed' : 'Claim'}</button>
                        </div>`; 
                    questListDiv.appendChild(qe); 
                }); 
                document.querySelectorAll('.claim-quest-btn').forEach(b => { 
                    b.addEventListener('click', (e) => { 
                        if (!currentUser) return; 
                        const qId = parseInt(e.target.dataset.questId); 
                        const q = quests.find(q => q.id === qId); 
                        if(q && q.completed && !q.claimed){ 
                            q.claimed = true; 
                            e.target.disabled = true; 
                            e.target.textContent = 'Claimed'; 
                            const rewardParts = q.reward.split(','); 
                            let pvReward = 0; 
                            let diamondReward = 0; 
                            let goldReward = 0;
                            rewardParts.forEach(part => { 
                                if (part.includes("PV")) pvReward = parseInt(part.match(/(\d+) PV/)[1]); 
                                if (part.includes("Diamond")) diamondReward = parseInt(part.match(/(\d+) Diamond/)[1]); 
                                if (part.includes("Gold")) goldReward = parseInt(part.match(/(\d+) Gold/)[1]); 
                            }); 
                            currentPvTokens += pvReward; 
                            currentDiamonds += diamondReward; 
                            currentGold += goldReward;
                            updateStatsDisplay(); 
                            showCustomPopup(`Claimed reward: ${q.reward} for completing quest: "${q.text}"`, "Quest Reward Claimed"); 
                            if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState()); 
                            if ([1, 2, 3].includes(q.id)) { updateAdventureDisplayStates(); } 
                        } 
                    }); 
                }); 
            }
            
            function renderDailyRewards() {
                if (!dailyRewardsGrid) return;
                dailyRewardsGrid.innerHTML = '';
                const now = Date.now();
                let nextClaimableDay;

                if (lastDailyRewardDayClaimed === 0 || lastDailyRewardClaimTimestamp === 0) { 
                    nextClaimableDay = 1;
                } else if (now - lastDailyRewardClaimTimestamp >= TWENTY_FOUR_HOURS_MS) { 
                    if (lastDailyRewardDayClaimed >= 30) { 
                        nextClaimableDay = 1; 
                    } else {
                        nextClaimableDay = lastDailyRewardDayClaimed + 1;
                    }
                } else { 
                    nextClaimableDay = -1; 
                }

                let daysEffectivelyClaimedInThisCycle = lastDailyRewardDayClaimed;
                if (nextClaimableDay === 1 && lastDailyRewardDayClaimed >= 30 && (now - lastDailyRewardClaimTimestamp >= TWENTY_FOUR_HOURS_MS)) {
                    daysEffectivelyClaimedInThisCycle = 0;
                }


                dailyRewardsData.forEach(item => {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('reward-day');
                    let rewardText = item.reward;
                    if (item.day === 30) rewardText = `<strong style="color:var(--highlight-color-gold);">${item.reward}</strong>`;

                    const canClaimThisItem = (item.day === nextClaimableDay);
                    const isClaimedForDisplay = item.day <= daysEffectivelyClaimedInThisCycle && !canClaimThisItem;
                    
                    dayDiv.innerHTML = `<h5>Day ${item.day}</h5><p>${rewardText}</p>
                                        <button class="action-button claim-daily-reward-btn" data-day="${item.day}" 
                                                ${canClaimThisItem ? '' : 'disabled'}>
                                            ${isClaimedForDisplay ? 'Claimed' : (canClaimThisItem ? 'Claim' : 'Locked')}
                                        </button>`;
                    dailyRewardsGrid.appendChild(dayDiv);
                });

                document.querySelectorAll('.claim-daily-reward-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        if (!currentUser) return;
                        const dayToClaim = parseInt(e.target.dataset.day);
                        
                        const currentNow = Date.now();
                        let recheckNextClaimableDay;
                        if (lastDailyRewardDayClaimed === 0 || lastDailyRewardClaimTimestamp === 0) {
                            recheckNextClaimableDay = 1;
                        } else if (currentNow - lastDailyRewardClaimTimestamp >= TWENTY_FOUR_HOURS_MS) {
                            if (lastDailyRewardDayClaimed >= 30) recheckNextClaimableDay = 1;
                            else recheckNextClaimableDay = lastDailyRewardDayClaimed + 1;
                        } else {
                            recheckNextClaimableDay = -1;
                        }

                        if (dayToClaim !== recheckNextClaimableDay) {
                            showCustomPopup("Not eligible to claim this reward now.", "Claim Error");
                            renderDailyRewards(); 
                            return;
                        }

                        const rewardItem = dailyRewardsData.find(d => d.day === dayToClaim);
                        if (!rewardItem) return;

                        if (lastDailyRewardDayClaimed >= 30 && dayToClaim === 1) { 
                             lastDailyRewardDayClaimed = dayToClaim;
                        } else {
                             lastDailyRewardDayClaimed = dayToClaim;
                        }
                        lastDailyRewardClaimTimestamp = Date.now();

                        const rewardInfoString = rewardItem.reward;
                        const rewardParts = rewardInfoString.split(',').map(s => s.trim());
                        let gainedItemsSummary = [];

                        rewardParts.forEach(part => {
                            const pvMatch = part.match(/(\d+)\s*PV/i);
                            const goldMatch = part.match(/(\d+)\s*Gold/i);
                            const diamondMatch = part.match(/(\d+)\s*Diamond/i);
                            // Material match: e.g., "5 Leather" or "1 Rider's Sigil"
                            const materialMatch = part.match(/(\d+)\s*(.+)/); // Catches quantity and name

                            if (pvMatch) {
                                currentPvTokens += parseInt(pvMatch[1]);
                                gainedItemsSummary.push(pvMatch[0]);
                            } else if (goldMatch) {
                                currentGold += parseInt(goldMatch[1]);
                                gainedItemsSummary.push(goldMatch[0]);
                            } else if (diamondMatch) {
                                currentDiamonds += parseInt(diamondMatch[1]);
                                gainedItemsSummary.push(diamondMatch[0]);
                            } else if (materialMatch) {
                                const quantity = parseInt(materialMatch[1]);
                                const materialName = materialMatch[2].trim();
                                // Check if it's a known material
                                if (playerMaterials.hasOwnProperty(materialName)) {
                                    playerMaterials[materialName] = (playerMaterials[materialName] || 0) + quantity;
                                    gainedItemsSummary.push(`${quantity} ${materialName}`);
                                } else {
                                    console.warn("Unknown material in daily reward:", materialName);
                                    gainedItemsSummary.push(part); // Add as is if unknown, for display
                                }
                            } else {
                                gainedItemsSummary.push(part); // Add unknown parts for display
                            }
                        });
                        
                        updateStatsDisplay();
                        renderMaterials(); // Re-render materials list
                        renderDailyRewards(); 
                        showCustomPopup(`Claimed reward for Day ${dayToClaim}: ${gainedItemsSummary.join(', ')}`, "Daily Reward Claimed");
                        
                        updateStatsDisplay();
                        renderDailyRewards(); 
                        showCustomPopup(`Claimed reward for Day ${dayToClaim}: ${rewardItem.reward}`, "Daily Reward Claimed");
                        if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                    });
                });
            }
            // INSERT THIS NEW FUNCTION (e.g., after renderDailyRewards around line 2145)

            function checkAndResetDailyDungeonEntries() {
                const now = Date.now();
                if (!lastDungeonResetTimestamp || (now - lastDungeonResetTimestamp >= TWENTY_FOUR_HOURS_MS)) {
                    console.log("Resetting daily dungeon entries.");
                    playerDungeonEntriesToday = { dungeon_1: 0, dungeon_2: 0 };
                    lastDungeonResetTimestamp = now; // Set to the beginning of the current 24h cycle for consistency
                    
                    // If the dungeons page is active, re-render it to show updated entry counts
                    if (document.getElementById('dungeons-page') && document.getElementById('dungeons-page').classList.contains('active')) {
                        renderDungeonsPage();
                    }
                    // Save the game state after reset
                    if (currentUser && currentUser.uid) {
                        saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                    }
                }
            }
            function renderShopItems() { 
                if (!shopItemsDiv) return; 
                shopItemsDiv.innerHTML = ''; 
                shopItemsData.forEach(item => { 
                    const ie = document.createElement('div'); 
                    ie.classList.add('shop-item'); 
                    let buyButtonDisabled = '';
                    let buyButtonText = 'Buy';
                if (item.id === 'rider_scroll_unlock' && (playerHasPurchasedRiderScroll || playerInventory.some(invItem => invItem.id === 'rider_scroll_unlock'))) {
                    buyButtonDisabled = 'disabled title="You have already purchased this."';
                    buyButtonText = 'Owned';
                } else if (item.id === 'pet_whistle_unlock' && (playerHasPurchasedPetWhistle || playerInventory.some(invItem => invItem.id === 'pet_whistle_unlock'))) { // NEW ELSE IF
                    buyButtonDisabled = 'disabled title="You have already purchased this."';
                    buyButtonText = 'Owned';
                }

                    let quantityInputHtml = '';
                    if (item.type === "upgrade_scroll_purchase") {
                        quantityInputHtml = `<input type="number" class="quantity-selector scroll-quantity-input" data-item-id="${item.id}" min="1" max="10" value="1">`;
                    }

                    ie.innerHTML = `
                        <div class="item-icon-placeholder">${getItemIconHTML(item.iconUrlOrColor, item.name)}</div>
                        <div>
                            <p><strong>${item.name}</strong></p>
                            <p><small>${item.description}</small></p>
                        </div>
                        <div class="shop-details" style="display:flex; align-items:center;">
                            ${quantityInputHtml}
                            <span class="shop-price" style="margin-right:10px;">${item.price} PV</span>
                            <button class="action-button buy-item-btn" data-item-id="${item.id}" data-price="${item.price}" ${buyButtonDisabled}>${buyButtonText}</button>
                        </div>`; 
                    shopItemsDiv.appendChild(ie); 
                     ie.addEventListener('mousemove', (e) => showItemTooltip(e, item));
                     ie.addEventListener('mouseleave', hideItemTooltip);
                }); 
                document.querySelectorAll('.buy-item-btn:not([disabled])').forEach(b => { b.addEventListener('click', (e) => { 
                    if(!currentUser) return; 
                    const itemId = e.target.dataset.itemId; 
                    const itemPrice = parseInt(e.target.dataset.price); 
                    const itemData = shopItemsData.find(it => it.id === itemId); 
                    if (!itemData) return; 

                    let quantity = 1;
                    if (itemData.type === "upgrade_scroll_purchase") {
                        const quantityInput = e.target.closest('.shop-details').querySelector(`.scroll-quantity-input[data-item-id="${itemId}"]`);
                        if (quantityInput) quantity = parseInt(quantityInput.value) || 1;
                    }
                    const totalCost = itemPrice * quantity;

                    if (currentPvTokens >= totalCost) { 
                        currentPvTokens -= totalCost; updateStatsDisplay(); 
                        showCustomPopup(`Successfully bought ${quantity}x ${itemData.name} for ${totalCost} PV.`, "Purchase Complete"); 
                        
                        if (itemData.type === "buff" && itemData.effect) { 
                            const existingPotion = activePotions.find(p => p.id === itemData.id && (p.endTime || p.adventuresLeft)); 
                            if (existingPotion) { 
                                showCustomPopup(`${itemData.name} is already active or you have one of its kind. Finish it first.`, "Potion Active"); 
                                currentPvTokens += totalCost; updateStatsDisplay(); return; 
                            } 
                            let newPotion = { id: itemData.id, name: itemData.name, description: itemData.description, effect: itemData.effect }; 
                            if (itemData.durationSeconds) { 
                                const originalHours = itemData.durationSeconds / 3600;
                                newPotion.endTime = Date.now() + (originalHours * GAME_HOUR_IN_REAL_SECONDS * 1000);
                            } else if (itemData.durationAdventures) { newPotion.adventuresLeft = itemData.durationAdventures; } 
                            activePotions.push(newPotion); 
                            renderActivePotions(); 
                            quests.forEach(q => { if (q.metric === `potionUsed_${itemData.id}` && !q.completed && !q.claimed) {q.progress = (q.progress || 0) + 1; if (q.progress >= q.target) { q.completed = true; showCustomPopup(`Quest Completed: ${q.text}`, "Quest Complete!");}} });
                            if(document.getElementById('quests-page').classList.contains('active')) renderQuests();
                        } else if (itemData.type === "upgrade_scroll_purchase" && itemData.scrollTypeKey) { 
                            playerScrolls[itemData.scrollTypeKey] = (playerScrolls[itemData.scrollTypeKey] || 0) + quantity;
                            renderMaterials(); 
                        } else if (itemData.type === "unlockable_consumable" && itemData.id === "rider_scroll_unlock") {
                             if (!playerHasPurchasedRiderScroll && !playerInventory.some(invItem => invItem.id === 'rider_scroll_unlock')) {
                                playerInventory.push({ id: "rider_scroll_unlock", uniqueInstanceId: `unlock_${nextUniqueInstanceId++}` });
                            playerHasPurchasedRiderScroll = true; 
                            renderInventory(); 
                            e.target.disabled = true; 
                            e.target.textContent = 'Owned';
                        }
                    } else if (itemData.id === "pet_whistle_unlock") { // NEW ELSE IF
                        if (!playerHasPurchasedPetWhistle && !playerInventory.some(invItem => invItem.id === 'pet_whistle_unlock')) {
                            playerInventory.push({ id: "pet_whistle_unlock", uniqueInstanceId: `unlock_pet_${nextUniqueInstanceId++}` });
                            playerHasPurchasedPetWhistle = true; // Mark as purchased
                            renderInventory(); // Update inventory display
                            e.target.disabled = true; // Disable buy button
                            e.target.textContent = 'Owned';
                        }
                    }
                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState()); 
                    } else { 
                        showCustomPopup(`Not enough PV Tokens to buy ${quantity}x ${itemData.name}! You need ${totalCost} PV.`, "Transaction Failed"); 
                    } 
                }); }); 
            }
            
             function craftItem(itemId, fromPopup = false, originalSlotIdIfEquipped = null) { 
                if(!currentUser) return false; 
                const itemToCraft = craftableItemsData.find(i => i.id === itemId); 
                if (!itemToCraft) return false; 
                
                const alreadyOwned = playerInventory.some(invItem => invItem.id === itemToCraft.id) || 
                                   Object.values(equippedItems).some(equippedInstanceId => {
                                       const eqItem = playerInventory.find(pi => pi.uniqueInstanceId === equippedInstanceId);
                                       return eqItem && eqItem.id === itemToCraft.id;
                                   });

                if (alreadyOwned && !fromPopup) { 
                    showCustomPopup(`You already own an instance of ${itemToCraft.name}. You cannot craft another unless the existing one is destroyed.`, "Crafting Failed"); 
                    return false; 
                } 
                
                let canCraft = true; 
                let missingMatDetails = ""; 
                for (const mat in itemToCraft.recipe) { 
                    if ((playerMaterials[mat] || 0) < itemToCraft.recipe[mat]) { 
                        canCraft = false; 
                        missingMatDetails += `${itemToCraft.recipe[mat]} ${mat}, `;
                    } 
                } 
                if (canCraft) { 
                    for (const mat in itemToCraft.recipe) { playerMaterials[mat] -= itemToCraft.recipe[mat]; } 
                    const newItemInstanceId = `item_${nextUniqueInstanceId++}`;
                    playerInventory.push({ id: itemToCraft.id, level: 0, uniqueInstanceId: newItemInstanceId }); 
                    
                    if (fromPopup && originalSlotIdIfEquipped) {
                        equipItem(newItemInstanceId, originalSlotIdIfEquipped); 
                        showCustomPopup(`Successfully re-crafted and equipped ${itemToCraft.name}!`, "Item Crafted & Equipped"); 
                    } else {
                        showCustomPopup(`Successfully crafted ${itemToCraft.name}!`, "Item Crafted"); 
                    }
                    
                    quests.forEach(q => { if (q.metric === "itemsCrafted" && !q.completed && !q.claimed) {q.progress = (q.progress || 0) + 1; if (q.progress >= q.target) { q.completed = true; showCustomPopup(`Quest Completed: ${q.text}`, "Quest Complete!");}} });
                    if(document.getElementById('quests-page').classList.contains('active')) renderQuests();

                    renderMaterials(); renderInventory(); renderCraftingItems(); 
                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                    return true;
                } else { 
                    missingMatDetails = missingMatDetails.slice(0, -2); 
                    showCustomPopup(`Not enough materials! You need: ${missingMatDetails} to craft ${itemToCraft.name}.`, "Crafting Failed"); 
                    return false;
                } 
            }

            function promptToCraftAgain(destroyedItemMaster, originalSlotId) {
                if (!destroyedItemMaster || !destroyedItemMaster.recipe) return;

                let recipeHtml = "<ul>";
                for (const mat in destroyedItemMaster.recipe) {
                    recipeHtml += `<li>${destroyedItemMaster.recipe[mat]} ${mat} (You have: ${playerMaterials[mat] || 0})</li>`;
                }
                recipeHtml += "</ul>";

                const message = `Your ${destroyedItemMaster.name} was destroyed!<br><br>Would you like to craft it again?<br><br><strong>Requires:</strong>${recipeHtml}`;
                
                showCustomPopup(message, "Craft Item Again?", { craftCallback: () => {
                    craftItem(destroyedItemMaster.id, true, originalSlotId); 
                }});
            }

            function equipItem(itemUniqueId, specificSlotId = null) { 
                if(!currentUser) return; 
                const invItemToEquip = playerInventory.find(invItem => invItem.uniqueInstanceId === itemUniqueId);
                if (!invItemToEquip) { console.error("Item to equip not found in inventory:", itemUniqueId); return;}

                const itemData = craftableItemsData.find(i => i.id === invItemToEquip.id) || (invItemToEquip.id === "ring_cursedpower" ? craftableItemsData.find(i => i.id === "ring_cursedpower") : null) ; 
                if (!itemData || !itemData.type) { console.error("Cannot equip item without a type:", itemData); return; } 
                
                let targetSlotId = specificSlotId; 

                if (!targetSlotId) { 
                    if (itemData.type === "Ring") { 
                        if (!equippedItems.Ring1) targetSlotId = "Ring1"; 
                        else if (secondRingSlotUnlocked && !equippedItems.Ring2) targetSlotId = "Ring2"; 
                        else showCustomPopup("Both ring slots are full or second slot is locked/unavailable.", "Equip Failed"); 
            } else if (itemData.type === "Trinket" || itemData.type === "Rucksack") { 
                if (!equippedItems.Misc1) targetSlotId = "Misc1"; 
                else if (!equippedItems.Misc2) targetSlotId = "Misc2"; 
                else showCustomPopup("Both miscellaneous slots are full.", "Equip Failed"); 
            } else if (itemData.type === "Pet") { // Explicitly check for Pet type
                if (petSlotUnlocked) { // Only allow equipping if slot is unlocked
                    if (!equippedItems.Pet) {
                        targetSlotId = "Pet";
                    } else {
                        showCustomPopup("Pet slot is already occupied.", "Equip Failed");
                    }
                } else {
                    showCustomPopup("Pet slot is locked. Unlock it first.", "Equip Failed");
                }
            } else if (equippedItems.hasOwnProperty(itemData.type)) { 
                targetSlotId = itemData.type; 
            } 
                }
                
                if (targetSlotId) { 
                    if (equippedItems[targetSlotId] && equippedItems[targetSlotId] !== invItemToEquip.uniqueInstanceId) {
                        // An item is already in the target slot, it remains in inventory.
                    }
                    equippedItems[targetSlotId] = invItemToEquip.uniqueInstanceId; 
                    renderInventory(); 
                    renderActiveSpecialties();
                    console.log("Equipped:", equippedItems); 
                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState()); 
                } else if (!specificSlotId && !equippedItems.hasOwnProperty(itemData.type) && itemData.type !== "Ring" && itemData.type !== "Trinket" && itemData.type !== "Rucksack") { 
                    showCustomPopup(`No available slot for item type: ${itemData.type}`, "Equip Failed"); 
                }
            }

            function unequipItem(itemSlotId) { 
                if(!currentUser) return; 
                if (equippedItems.hasOwnProperty(itemSlotId) && equippedItems[itemSlotId]) { 
                    equippedItems[itemSlotId] = null; 
                    renderInventory(); 
                      renderActiveSpecialties();
                    console.log("Equipped:", equippedItems); 
                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                } 
            }
            
            function generateRandomQuests() { /* Using predefined quests */ }
            
                        function completeAdventure(instanceId) {
                // ... (keep your existing completeAdventure function body here)
            }

            function completeDungeon(instanceId) {
                if (!currentUser) return;
                const dunIdx = activeDungeons.findIndex(dun => dun.id === instanceId);
                if (dunIdx === -1) return;

                const completedDun = { ...activeDungeons[dunIdx] };
                const dungeonMasterData = dungeonsData.find(d => d.id === completedDun.dungeonId);

                activeDungeons.splice(dunIdx, 1);
                recalculateTotalAvailableAdventurers();

                let gainedCurrencySummary = [];
                let gainedItemsSummary = []; // For actual item drops

                // --- Currency Rewards (from placeholderReward string) ---
                if (dungeonMasterData && dungeonMasterData.placeholderReward) {
                    const rewardParts = dungeonMasterData.placeholderReward.split(',').map(s => s.trim());
                    rewardParts.forEach(part => {
                        const pvMatch = part.match(/(\d+)\s*PV/i);
                        const goldMatch = part.match(/(\d+)\s*Gold/i);
                        const diamondMatch = part.match(/(\d+)\s*Diamond/i);
                        if (pvMatch) { currentPvTokens += parseInt(pvMatch[1]); gainedCurrencySummary.push(pvMatch[0]); }
                        else if (goldMatch) { currentGold += parseInt(goldMatch[1]); gainedCurrencySummary.push(goldMatch[0]); }
                        else if (diamondMatch) { currentDiamonds += parseInt(diamondMatch[1]); gainedCurrencySummary.push(diamondMatch[0]); }
                    });
                }

                // --- Item Drops (from dungeonMasterData.drops array) ---
                if (dungeonMasterData && Array.isArray(dungeonMasterData.drops)) {
                    dungeonMasterData.drops.forEach(dropAttempt => {
                        if (Math.random() < dropAttempt.chance) {
                            const itemMaster = craftableItemsData.find(ci => ci.id === dropAttempt.id);
                            if (itemMaster) {
                                // Check if player already owns this base item
                                const alreadyOwned = playerInventory.some(invItem => invItem.id === itemMaster.id) ||
                                    Object.values(equippedItems).some(equippedInstanceId => {
                                        if (!equippedInstanceId) return false;
                                        const eqItem = playerInventory.find(pi => pi.uniqueInstanceId === equippedInstanceId);
                                        return eqItem && eqItem.id === itemMaster.id;
                                    });

                                if (!alreadyOwned) {
                                    playerInventory.push({ id: itemMaster.id, level: 0, uniqueInstanceId: `item_${nextUniqueInstanceId++}` });
                                    gainedItemsSummary.push(`1x ${itemMaster.name}`);
                                } else {
                                    console.log(`Attempted to drop ${itemMaster.name}, but player already owns it.`);
                                    // Optionally, give a small PV compensation or nothing
                                    // gainedItemsSummary.push(`(Duplicate ${itemMaster.name} - Converted to 25 PV)`); currentPvTokens += 25; 
                                }
                            }
                        }
                    });
                }
                
                // --- $DOG Pet Effect ---
                const dogPetEquipped = Object.values(equippedItems).some(instanceId => {
                    if (!instanceId) return false;
                    const item = playerInventory.find(invItem => invItem.uniqueInstanceId === instanceId);
                    return item && item.id === "pet_dog";
                });

                if (dogPetEquipped) {
                    const allPossibleAdventureMaterials = [];
                    Object.values(adventuresData).forEach(adv => {
                        if (adv.drops) {
                            adv.drops.forEach(drop => {
                                // Ensure it's a material and not an item like 'ring_cursedpower'
                                if (playerMaterials.hasOwnProperty(drop.name)) {
                                    allPossibleAdventureMaterials.push(drop.name);
                                }
                            });
                        }
                    });
                    if (allPossibleAdventureMaterials.length > 0) {
                        const randomMaterialIndex = Math.floor(Math.random() * allPossibleAdventureMaterials.length);
                        const fetchedMaterial = allPossibleAdventureMaterials[randomMaterialIndex];
                        playerMaterials[fetchedMaterial] = (playerMaterials[fetchedMaterial] || 0) + 1;
                        gainedItemsSummary.push(`$DOG fetched: 1x ${fetchedMaterial}`);
                    }
                }


                // --- Popup Message Construction ---
                let partyCompositionMessage = `${completedDun.adventurers} player adventurer(s)`;
                if (completedDun.npcCrawlers && completedDun.npcCrawlers.length > 0) {
                    const crawlerNames = completedDun.npcCrawlers.map(id => {
                        const crawlerData = playerDungeonCrawlers.find(c => c.uniqueInstanceId === id);
                        return crawlerData ? crawlerData.name : "Unknown Crawler";
                    }).join(', ');
                    partyCompositionMessage += ` (and NPC Crawlers: ${crawlerNames})`;
                }

                let popupMessage = `${partyCompositionMessage} returned from ${completedDun.name}!\n\nRewards:`;
                if (gainedCurrencySummary.length > 0) {
                    popupMessage += `\n- ${gainedCurrencySummary.join(', ')}`;
                } else {
                    popupMessage += `\n- No base currency rewards this time.`;
                }
                if (gainedItemsSummary.length > 0) {
                    popupMessage += `\n\nItems Found/Fetched:`;
                    gainedItemsSummary.forEach(itemStr => {
                        popupMessage += `\n  - ${itemStr}`;
                    });
                }
                showCustomPopup(popupMessage, "Dungeon Complete!");

                // Update UI and save state
                renderActiveTasksInSidebar();
                if (document.getElementById('dungeons-page').classList.contains('active')) {
                    renderDungeonsPage();
                }
                if (gainedItemsSummary.length > 0) { // Re-render inventory if items were gained
                    renderInventory();
                }
                renderMaterials(); // If $DOG fetched a material
                updateStatsDisplay(); 

                if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
            }
            
            function completeAdventure(instanceId) {
                if(!currentUser) return;
                const advIdx = activeAdventures.findIndex(adv => adv.id === instanceId);
                if (advIdx === -1) {
                    console.warn(`completeAdventure: Could not find active adventure with instanceId ${instanceId}. Already completed or invalid.`);
                    // It's possible it was already processed if multiple timer ticks landed very close.
                    // To prevent errors, try to ensure renderActiveTasksInSidebar is robust.
                    if (activeAdventures.length === 0 && sidebarActiveAdventuresList) { // If no adventures left, clear sidebar
                        renderActiveTasksInSidebar();
                    }
                    return; 
                }
                
                const completedAdv = { ...activeAdventures[advIdx] }; // Make a copy before splicing

                // --- Reward Calculation ---
                let basePvReward = completedAdv.pvReward; // This is already the PER ADVENTURER base from button
                let pvMultiplierFromPotions = 1; 
                let pvBonusAdditiveEffect = 0;

                activePotions.forEach(p => { 
                    if(p.effect && p.effect.type === "pvMultiplier" && p.adventuresLeft > 0) { 
                        pvMultiplierFromPotions *= p.effect.value; 
                    }
                });

                Object.values(equippedItems).forEach(equippedInstanceId => { 
                    if (!equippedInstanceId) return; 
                    const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId); 
                    if (invItem) { 
                        const itemMaster = craftableItemsData.find(im => im.id === invItem.id); 
                        if (itemMaster && itemMaster.perk) { 
                            const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0); 
                            if (scaledPerk && scaledPerk.type === "pvBonus") { 
                                pvBonusAdditiveEffect += scaledPerk.value; 
                            }
                        }
                    }
                });
                
                let earnedPvThisTrip = Math.floor(basePvReward * completedAdv.adventurers * (1 + pvBonusAdditiveEffect) * pvMultiplierFromPotions); 
                currentPvTokens += earnedPvThisTrip;

                let totalGoldFoundThisTrip = 0; 
                let totalDiamondsFoundThisTrip = 0; 
                let allFoundDrops = {}; // For popup summary

                let totalGoldChanceIncreaseBonus = 0; 
                let flatGoldBonusFromPotions = 0; 
                let flatGoldBonusFromItems = 0; 
                let flatDiamondBonusFromItems = 0; 
                let materialChanceEffectiveMultiplier = 1;

                activePotions.forEach(p => { 
                    if(p.effect && p.effect.type === "goldChanceBonus" && p.adventuresLeft > 0) { 
                        flatGoldBonusFromPotions += p.effect.flatValue || 0; 
                    }
                });

                Object.values(equippedItems).forEach(equippedInstanceId => { 
                    if (!equippedInstanceId) return; 
                    const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId); 
                    if(invItem) { 
                        const itemMaster = craftableItemsData.find(im => im.id === invItem.id); 
                        if (itemMaster && itemMaster.perk) { 
                            const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0); 
                            if (scaledPerk) { 
                                if (scaledPerk.type === "goldChanceIncrease") totalGoldChanceIncreaseBonus += scaledPerk.value; 
                                if (scaledPerk.type === "flatCurrencyChanceBoost") { 
                                    flatGoldBonusFromItems += (scaledPerk.goldBonus || 0); 
                                    flatDiamondBonusFromItems += (scaledPerk.diamondBonus || 0); 
                                } 
                                if (scaledPerk.type === "materialChanceMultiplier") materialChanceEffectiveMultiplier *= scaledPerk.value; 
                            }
                        }
                    }
                });

                const adventureMasterData = adventuresData[completedAdv.originalAdventureId];

                // Guaranteed Gold (e.g., for Adventure 5)
                if (adventureMasterData && adventureMasterData.guaranteedGold) {
                    const guaranteedGoldAmount = adventureMasterData.guaranteedGold * completedAdv.adventurers;
                    currentGold += guaranteedGoldAmount;
                    totalGoldFoundThisTrip += guaranteedGoldAmount;
                }

                // Per-adventurer chance-based rewards
                for (let i = 0; i < completedAdv.adventurers; i++) { 
                    // Gold Chance (if not guaranteed or if it's an additional chance component)
                    if (!adventureMasterData || !adventureMasterData.guaranteedGold || (adventureMasterData.guaranteedGold && completedAdv.goldChance > 0)) {
                        const finalGoldChance = (completedAdv.goldChance * (1 + totalGoldChanceIncreaseBonus)) + flatGoldBonusFromPotions + flatGoldBonusFromItems; 
                        if (completedAdv.goldChance > 0 && Math.random() < finalGoldChance) { 
                            currentGold += 1; 
                            totalGoldFoundThisTrip += 1; 
                        } 
                    }

                    // Diamond Chance (with potential multiplier)
                    const finalDiamondChance = completedAdv.diamondChance + flatDiamondBonusFromItems; 
                    if (completedAdv.diamondChance > 0 && Math.random() < finalDiamondChance) {
                        let diamondsAwarded = 1;
                        if (adventureMasterData && adventureMasterData.diamondRewardMultiplier) {
                            diamondsAwarded = adventureMasterData.diamondRewardMultiplier;
                        }
                        currentDiamonds += diamondsAwarded; 
                        totalDiamondsFoundThisTrip += diamondsAwarded; 
                    }
                    
                    // Material Drops
                    if (adventureMasterData && adventureMasterData.drops) { 
                        adventureMasterData.drops.forEach(drop => { 
                            if (Math.random() < (drop.chance * materialChanceEffectiveMultiplier)) { 
                                if (playerMaterials.hasOwnProperty(drop.name)) { 
                                    playerMaterials[drop.name] = (playerMaterials[drop.name] || 0) + (drop.qty || 1); 
                                    allFoundDrops[drop.name] = (allFoundDrops[drop.name] || 0) + (drop.qty || 1); 
                                    quests.forEach(q => { 
                                        if (q.metric === `materialCollected_${drop.name}` && !q.completed && !q.claimed) {
                                            q.progress = (q.progress || 0) + (drop.qty || 1); 
                                            if (q.progress >= q.target) { 
                                                q.completed = true; 
                                                if (!q.claimed) showCustomPopup(`Quest Completed: ${q.text}`, "Quest Complete!");
                                            }
                                        } 
                                    });
                                } else { // Potentially an equippable item drop
                                     const itemMasterInfo = craftableItemsData.find(ci => ci.id === drop.name);
                                     if (itemMasterInfo) { 
                                        const itemExistsInInv = playerInventory.some(invItem => invItem.id === itemMasterInfo.id) || 
                                                               Object.values(equippedItems).some(eqId => {
                                                                    if(!eqId) return false;
                                                                    const eqInvItem = playerInventory.find(pi => pi.uniqueInstanceId === eqId);
                                                                    return eqInvItem && eqInvItem.id === itemMasterInfo.id;
                                                                });
                                        if (!itemExistsInInv) {
                                            playerInventory.push({id: itemMasterInfo.id, level: 0, uniqueInstanceId: `item_${nextUniqueInstanceId++}`});
                                            allFoundDrops[itemMasterInfo.name] = (allFoundDrops[itemMasterInfo.name] || 0) + (drop.qty || 1);
                                        }
                                     } else {
                                        console.warn("Unknown item drop defined in adventuresData that is not a material:", drop.name);
                                     }
                                }
                            }
                        });
                    }
                } // End of per-adventurer loop

                totalAdventuresCompleted++;

                // Update Potions
                activePotions.forEach(p => { 
                    if(p.adventuresLeft !== undefined && p.adventuresLeft > 0) { 
                        // Only decrement if the potion's effect was actually applied in this adventure type
                        if ( (p.effect.type === "pvMultiplier" && pvMultiplierFromPotions > 1) || 
                             (p.effect.type === "goldChanceBonus" && flatGoldBonusFromPotions > 0) ) { 
                            p.adventuresLeft--; 
                        }
                    }
                });
                activePotions = activePotions.filter(p => (p.endTime && Date.now() < p.endTime) || (p.adventuresLeft !== undefined && p.adventuresLeft > 0) );
                
                // --- Remove adventure from active list ---
                activeAdventures.splice(advIdx, 1); 

                // --- Recalculate available adventurers (important after splice) ---
                recalculateTotalAvailableAdventurers(); 
                
                // --- Construct Popup Message ---
                let popupMessage = `${completedAdv.adventurers} adventurer(s) returned from ${completedAdv.name}!\n\nRewards:\n- ${earnedPvThisTrip} PV Tokens`;
                if(totalGoldFoundThisTrip > 0) { popupMessage += `\n- ${totalGoldFoundThisTrip} Gold`; }
                if(totalDiamondsFoundThisTrip > 0) { popupMessage += `\n- ${totalDiamondsFoundThisTrip} Diamond(s)`;}
                const foundDropNames = Object.keys(allFoundDrops);
                if (foundDropNames.length > 0) {
                    popupMessage += `\n\nMaterials/Items Found:`; // Changed from "Materials Found"
                    foundDropNames.forEach(dropNameKey => { // dropNameKey could be material name or item name now
                        popupMessage += `\n  - ${allFoundDrops[dropNameKey]}x ${dropNameKey}`;
                    });
                }
                if (totalAdventuresCompleted > 0 && totalAdventuresCompleted % 100 === 0) {
                    currentGold += 50; currentDiamonds += 1;
                    popupMessage += `\n\n**Milestone!** 100 Adventures Completed! +50 Gold, +1 Diamond!`;
                }
                showCustomPopup(popupMessage, "Adventure Complete!");
                
                // --- Quest Updates ---
                quests.forEach(quest => {  
                    if (!quest.completed && !quest.claimed) { 
                        let progressChanged = false;
                        if (quest.adventureName === completedAdv.name) { quest.progress = (quest.progress || 0) + completedAdv.adventurers; progressChanged = true; }
                        if (quest.metric === "pvBalance") { quest.progress = currentPvTokens; progressChanged = true; } // Check actual balance
                        if (quest.metric === "totalAdventuresCompletedOverall") { quest.progress = totalAdventuresCompleted; progressChanged = true; }
                        if (quest.metric === "goldFoundAdventures") { quest.progress = (quest.progress || 0) + totalGoldFoundThisTrip; progressChanged = true; }
                        
                        if (quest.metric === "equippedTier1Set") { 
                            const bootsEquipped = Object.values(equippedItems).some(id => id && playerInventory.find(i => i.uniqueInstanceId === id && i.id === "boots1")); 
                            const rucksackEquipped = Object.values(equippedItems).some(id => id && playerInventory.find(i => i.uniqueInstanceId === id && i.id === "rucksack1")); 
                            quest.progress = (bootsEquipped ? 1 : 0) + (rucksackEquipped ? 1 : 0); progressChanged = true;
                        }
                        if (quest.metric === "attackPower"){ 
                            let currentAttack = 0; 
                            Object.values(equippedItems).forEach(eqId => { 
                                if(!eqId) return; 
                                const invI = playerInventory.find(i=>i.uniqueInstanceId === eqId); 
                                if(invI) { 
                                    const mI = craftableItemsData.find(mi => mi.id === invI.id); 
                                    if (mI && mI.perk) { 
                                        const scaledPerk = getScaledItemPerk(mI, invI.level || 0); 
                                        if(scaledPerk.type === "attackBoost") currentAttack += scaledPerk.value; 
                                        if(scaledPerk.type === "statBoost" && scaledPerk.attack) currentAttack += scaledPerk.attack; 
                                    } 
                                }
                            }); 
                            quest.progress = currentAttack; progressChanged = true;
                        }

                        if (progressChanged && quest.progress >= quest.target && !quest.completed) { 
                            quest.completed = true; 
                            if(!quest.claimed) showCustomPopup(`Quest Completed: ${q.text}`, "Quest Complete!"); 
                            if ([1,2,3,15].includes(quest.id)) { updateAdventureDisplayStates(); } // Include quest 15 for Adv 5
                        }
                    }
                });
                
                // --- Final UI Updates ---
                renderActivePotions(); // After potion adventure counts are updated
                updateAdventureDisplayStates(); // After adventure might unlock next one via quest
                // updateStatsDisplay(); // Called by recalculateTotalAvailableAdventurers
                // renderActiveTasksInSidebar(); // Called by recalculateTotalAvailableAdventurers (if list changes) or by updateTimers
                renderMaterials(); // If materials were found
                if (foundDropNames.some(name => craftableItemsData.find(ci => ci.name === name))) { // Re-render if an equippable item dropped
                    renderInventory();
                }

                if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
            }
            
function updateAdventureDisplayStates() {
    adventureProgressionConfig.forEach(advConfig => {
        const adventureBlock = document.getElementById(advConfig.blockId);
        if (!adventureBlock) return;

        const sendBtnElement = adventureBlock.querySelector('.adventure-send-btn');
        const numInput = adventureBlock.querySelector('.adventure-num-select'); // Changed variable name
        const lockOverlay = adventureBlock.querySelector('.adventure-lock-overlay');

        let isLockedByProgression = false;
        if (advConfig.unlockQuestId) {
            const unlockingQuest = quests.find(q => q.id === advConfig.unlockQuestId);
            if (!unlockingQuest || !unlockingQuest.completed) {
                isLockedByProgression = true;
            }
        }
        const existingActiveAdventure = activeAdventures.find(adv => adv.originalAdventureId === advConfig.id);

        if (sendBtnElement) {
            if (existingActiveAdventure) {
                sendBtnElement.textContent = "ADD MORE (+)";
                // Can add if player has adventurers AND input is not disabled by lock
                sendBtnElement.disabled = totalAvailableAdventurers <= 0 || (isLockedByProgression && !existingActiveAdventure);
            } else {
                sendBtnElement.textContent = "SEND";
                sendBtnElement.disabled = isLockedByProgression;
            }
        }

        if (numInput) {
            numInput.disabled = isLockedByProgression && !existingActiveAdventure;
            numInput.max = totalAvailableAdventurers; // Set max based on currently available

            // If current value exceeds new max, reset it (optional, but good UX)
            if (parseInt(numInput.value) > totalAvailableAdventurers && totalAvailableAdventurers > 0) {
                numInput.value = totalAvailableAdventurers;
            } else if (totalAvailableAdventurers === 0 && parseInt(numInput.value) > 0) {
                numInput.value = 0; // Or 1 if you want to always default to 1 if possible
            } else if (parseInt(numInput.value) < 1 && totalAvailableAdventurers > 0) {
                 numInput.value = 1; // Ensure it's at least 1 if adventurers are available
            }
             // Ensure value is not less than min (1) if it was somehow set lower
            if (parseInt(numInput.value) < parseInt(numInput.min)) {
                numInput.value = numInput.min;
            }

        }

        adventureBlock.classList.toggle('locked-by-progression', isLockedByProgression && !existingActiveAdventure);

        if (lockOverlay) {
            if (isLockedByProgression && !existingActiveAdventure) {
                lockOverlay.textContent = advConfig.unlockMessage;
                lockOverlay.classList.remove('hidden');
            } else {
                lockOverlay.classList.add('hidden');
            }
        }
    });
}
            
            function handleCancelAdventure(adventureInstanceId) {
                if (!currentUser) return;
                const adventureToCancel = activeAdventures.find(adv => adv.id === adventureInstanceId);
                if (!adventureToCancel) return;

                showCustomPopup(
                    `Are you sure you want to cancel the adventure "${adventureToCancel.name}"? Your ${adventureToCancel.adventurers} adventurer(s) will return immediately, but you will receive no rewards.`,
                    "Confirm Cancel Adventure",
                    { 
                            confirmCallback: (confirmed) => {
                                if (confirmed) {
                                    const adventureToCancel = activeAdventures.find(adv => adv.id === adventureInstanceId); // Good to re-find it just in case
                                    if (!adventureToCancel) return; // Safety check if it was already removed

                                    // Step 1: Update the activeAdventures list by removing the cancelled one
                                    activeAdventures = activeAdventures.filter(adv => adv.id !== adventureInstanceId);
                                    
                                    // Step 2: Now that activeAdventures is updated, recalculate the available count
                                    recalculateTotalAvailableAdventurers();
                                    // The line 'totalAvailableAdventurers += adventureToCancel.adventurers;' has been REMOVED.

                                    showCustomPopup(`Adventure "${adventureToCancel.name}" has been cancelled. Adventurers have returned.`, "Adventure Cancelled");
                                    updateStatsDisplay();
                                    renderActiveTasksInSidebar();
                                    updateAdventureDisplayStates();
                                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                                }
                            }
                    }
                );
            }


            function updateTimers() {
                let taskCompletedThisTick = false;
                const now = Date.now(); // Get current time once per tick

                // --- Process Active Adventures (iterate backwards for safe removal) ---
                for (let i = activeAdventures.length - 1; i >= 0; i--) {
                    const adv = activeAdventures[i];
                    const timeLeftMs = adv.returnTime - now;
                    
                    const adventureTimerElements = document.querySelectorAll(`.active-adventure-item[data-instance-id="${adv.id}"] .timer`);
                    adventureTimerElements.forEach(timerSpan => {
                        if (timerSpan) timerSpan.textContent = formatTimeLeft(timeLeftMs);
                    });

                    if (timeLeftMs <= 0) {
                        console.log(`Timer: Adventure ${adv.name} (ID: ${adv.id}) ended. Calling completeAdventure.`);
                        completeAdventure(adv.id); // This will splice from activeAdventures
                        taskCompletedThisTick = true;
                    }
                }

                // --- Process Active Dungeons (iterate backwards for safe removal) ---
                for (let i = activeDungeons.length - 1; i >= 0; i--) {
                    const dun = activeDungeons[i];
                    const timeLeftMs = dun.returnTime - now;

                    const dungeonTimerElements = document.querySelectorAll(`.active-adventure-item[data-instance-id="${dun.id}"] .timer`);
                     dungeonTimerElements.forEach(timerSpan => {
                        if (timerSpan) timerSpan.textContent = formatTimeLeft(timeLeftMs);
                    });

                    if (timeLeftMs <= 0) {
                        console.log(`Timer: Dungeon ${dun.name} (ID: ${dun.id}) ended. Calling completeDungeon.`);
                        completeDungeon(dun.id); // This will splice from activeDungeons
                        taskCompletedThisTick = true;
                    }
                }

                // If any task completed, the completion functions themselves would have called
                // recalculateTotalAvailableAdventurers, which in turn calls renderDungeonsPage (if active)
                // and updateAdventureDisplayStates. They also call renderActiveTasksInSidebar implicitly
                // via recalculate. However, a direct call here ensures it happens if other UI elements
                // were relying on this specific call pattern.
                if (taskCompletedThisTick) {
                    console.log("Task completed this tick, re-rendering active tasks sidebar.");
                    renderActiveTasksInSidebar(); 
                }

                // --- Process Active Potions ---
                let potionsChanged = false;
                activePotions.forEach(potion => { // This loop doesn't modify activePotions directly, so forEach is fine
                    if (potion.endTime) {
                        if (now >= potion.endTime) potionsChanged = true;
                        const potionItemDiv = Array.from(activePotionsList.children).find(child => child.innerHTML.includes(`<strong>${potion.name}</strong>`));
                        if (potionItemDiv) {
                            const timerSpan = potionItemDiv.querySelector('.timer');
                            if (timerSpan) timerSpan.textContent = formatTimeLeft(potion.endTime - now);
                        }
                    }
                });
                if (potionsChanged) {
                    activePotions = activePotions.filter(p => p.endTime ? p.endTime > now : true);
                    activePotions = activePotions.filter(p => p.adventuresLeft === undefined || p.adventuresLeft > 0);
                    renderActivePotions();
                }

                // --- Process Raffles ---
                 let rafflesUpdatedByTimer = false;
                 allRaffles.forEach(raffle => { // This loop doesn't modify allRaffles directly
                     if (raffle.status === 'active') {
                         const timeLeftMs = raffle.endTime - now;
                         const raffleCard = whitelistRafflesContainer.querySelector(`.raffle-card[data-raffle-id="${raffle.id}"]`);
                         if (raffleCard) {
                              const timerSpan = raffleCard.querySelector('.raffle-timer');
                              if (timerSpan) timerSpan.textContent = formatTimeLeft(timeLeftMs);
                         }
                         if (timeLeftMs <= 0) {
                             raffle.status = 'ended'; 
                             rafflesUpdatedByTimer = true;
                         }
                     }
                 });
                 if (rafflesUpdatedByTimer && document.getElementById('whitelist-page').classList.contains('active')) {
                     renderWhitelistRaffles();
                 }
            }
            
            adventureSendButtons.forEach(button => {
                button.addEventListener('click', () => {
          if (walletVerificationPendingForBonus) {
            showCustomPopup(
                `Your game remembers a bonus of +${ordinalBonusAdventurers} adventurers from your Ordinals.<br><br>Tap <b>Connect Wallet</b> to verify your current Ordinal holdings and use this bonus.<br><br>Or, tap <b>Use Base Adventurers</b> to proceed with only your base ${MAX_PLAYER_ADVENTURERS} adventurer(s) and forfeit the remembered bonus for now.`,
                "Wallet Verification Needed",
                {
                    // confirmCallback is for the "Connect Wallet" action (customPopupConfirmBtn)
                    confirmCallback: (confirmed) => {
                        if (confirmed) { // User clicked "Connect Wallet"
                            console.log("User chose to Connect Wallet from adventure send prompt.");
                            if (connectWalletBtn && walletDropdown) {
                                walletDropdown.style.display = 'block';
                            } else if (connectWalletBtn) {
                                connectWalletBtn.click();
                            }
                            // Adventure does not proceed yet. User connects, then clicks SEND again.
                            // The `walletVerificationPendingForBonus` flag will be cleared by `updateWalletDisplay` upon successful connection.
                        } else { // User clicked "Use Base Adventurers" (which is customPopupCancelBtn)
                            console.log("User chose to Use Base Adventurers (Forfeit Bonus).");
                            let previousBonus = ordinalBonusAdventurers;
                            ordinalBonusAdventurers = 0;
                            walletVerificationPendingForBonus = false;
                            recalculateTotalAvailableAdventurers();
                            updateAdventureDisplayStates();
                            if (currentUser && currentUser.uid && previousBonus > 0) {
                                saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                            }
                            // Re-simulate the original button click to send with base adventurers
                            button.click();
                        }
                    }
                }
            );
            // Manually set the button texts because processPopupQueue uses confirmCallback
            // to decide to show customPopupConfirmBtn and customPopupCancelBtn
            if (customPopupConfirmBtn) customPopupConfirmBtn.textContent = "Connect Wallet";
            if (customPopupCancelBtn) {
                customPopupCancelBtn.textContent = "Use Base Adventurers";
                customPopupCancelBtn.classList.remove('hidden'); // Make sure it's visible
            }
            if (customPopupCloseBtn) customPopupCloseBtn.classList.add('hidden'); // Hide the default "OK" button

            return; // Stop this adventure send attempt; action will be handled by popup
        }
                    
                    if(!currentUser) return;
                    const adventureIdBase = button.dataset.adventureId;
                    const adventureName = button.dataset.adventureName;
                    const originalDurationHours = parseInt(button.dataset.durationHours);
                    let pvReward = parseInt(button.dataset.pvReward);
                    let actualPvRewardForAdventure = pvReward * 2;
                    const goldChance = parseFloat(button.dataset.goldChance);
                    const diamondChance = parseFloat(button.dataset.diamondChance) || 0;
                    const selectElement = document.getElementById(`num-adventurers-${adventureIdBase}`);
                    const numAdventurersToSend = parseInt(selectElement.value);

                    if (numAdventurersToSend <= 0) { showCustomPopup("Please select at least one adventurer.", "Action Needed"); return; }
                    // This check is important: it uses the *current* correct count of available adventurers
                    if (numAdventurersToSend > totalAvailableAdventurers) { showCustomPopup(`Not enough adventurers available! You only have ${totalAvailableAdventurers}.`, "Adventurers Needed"); return; }
                    
                    const existingActiveAdventureIndex = activeAdventures.findIndex(adv => adv.originalAdventureId === adventureIdBase);

                    if (existingActiveAdventureIndex !== -1) { // Adding to existing adventure
                        showCustomPopup(
                            `Adding ${numAdventurersToSend} adventurer(s) to "${adventureName}" will reset its timer to the full ${originalDurationHours} hours. Continue?`,
                            "Confirm Add Adventurers",
                            {
                                confirmCallback: (confirmed) => {
                                    if (confirmed) {
                                         console.log("Confirmed ADD MORE. Processing...");
                                        // Step 1: Update the adventure in the activeAdventures list
                                        const advInstance = activeAdventures[existingActiveAdventureIndex];
                                        advInstance.adventurers += numAdventurersToSend; // Add more adventurers to it
                                        
                                                          let baseDurationMs = originalDurationHours * GAME_HOUR_IN_REAL_SECONDS * 1000;
                        let calculatedDurationMs = baseDurationMs;
                        let totalPercentageReduction = 0;
                        let flatTimeReductionSeconds = 0;

                        // 1. Apply percentage reductions first (Set Bonus, Orb of Haste)
                        totalPercentageReduction += getDungeonSetBonusTimeReduction(); // Dungeon Set Bonus

                        Object.values(equippedItems).forEach(equippedInstanceId => {
                            if (!equippedInstanceId) return;
                            const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId);
                            if (invItem) {
                                const itemMaster = craftableItemsData.find(im => im.id === invItem.id);
                                if (itemMaster && itemMaster.perk) {
                                    const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0);
                                    if (scaledPerk.type === "timeReductionPercent") { // Like Orb of Haste
                                        totalPercentageReduction += scaledPerk.value;
                                    }
                                }
                            }
                        });
                        calculatedDurationMs = baseDurationMs * (1 - totalPercentageReduction);
                        
                        // 2. Then apply flat time reductions (like Warped Boots)
                        Object.values(equippedItems).forEach(equippedInstanceId => {
                            if (!equippedInstanceId) return;
                            const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId);
                            if (invItem) {
                                const itemMaster = craftableItemsData.find(im => im.id === invItem.id);
                                if (itemMaster && itemMaster.perk) {
                                    const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0);
                                     if (scaledPerk.type === "timeReduction") { // Flat reduction from items like boots
                                        flatTimeReductionSeconds += scaledPerk.value;
                                    }
                                }
                            }
                        });
                        const flatReductionMs = (flatTimeReductionSeconds / 3600) * (GAME_HOUR_IN_REAL_SECONDS * 1000) ;
                        calculatedDurationMs = Math.max(1000, calculatedDurationMs - flatReductionMs);
                                        advInstance.returnTime = Date.now() + calculatedDurationMs; // Reset its timer

                                        // Step 2: Now that activeAdventures is updated, recalculate the available count
                                        recalculateTotalAvailableAdventurers(); 

                                        // Update UI
                                        updateStatsDisplay(); 
                                        renderActiveTasksInSidebar(); 
                                        updateAdventureDisplayStates(); 
                                        if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                                        showCustomPopup(`${numAdventurersToSend} adventurer(s) added to "${adventureName}". Timer reset.`, "Adventurers Added");
                                    }
                                }
                            }
                        );
                    } else { // Starting a new adventure
                        const advConfig = adventureProgressionConfig.find(ac => ac.id === adventureIdBase);
                        if (advConfig && advConfig.unlockQuestId) {
                            const unlockingQuest = quests.find(q => q.id === advConfig.unlockQuestId);
                            if (!unlockingQuest || !unlockingQuest.completed) {
                                showCustomPopup(advConfig.unlockMessage, "Adventure Locked");
                                return;
                            }
                        }
                        // We DON'T directly change totalAvailableAdventurers here anymore.
                        const requiredAdventurers = parseInt(button.dataset.adventurerRequirement) || 0;
                        if (requiredAdventurers > 0 && numAdventurersToSend < requiredAdventurers) {
                            showCustomPopup(`This adventure ("${adventureName}") requires at least ${requiredAdventurers} adventurer(s). You selected ${numAdventurersToSend}.`, "Requirements Not Met");
                            return; // Stop processing
                        }
                         let baseDurationMs = originalDurationHours * GAME_HOUR_IN_REAL_SECONDS * 1000;
                        let calculatedDurationMs = baseDurationMs;
                        let totalPercentageReduction = 0;
                        let flatTimeReductionSeconds = 0;

                        // 1. Apply percentage reductions first (Set Bonus, Orb of Haste)
                        totalPercentageReduction += getDungeonSetBonusTimeReduction(); // Dungeon Set Bonus

                        Object.values(equippedItems).forEach(equippedInstanceId => {
                            if (!equippedInstanceId) return;
                            const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId);
                            if (invItem) {
                                const itemMaster = craftableItemsData.find(im => im.id === invItem.id);
                                if (itemMaster && itemMaster.perk) {
                                    const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0);
                                    if (scaledPerk.type === "timeReductionPercent") { // Like Orb of Haste
                                        totalPercentageReduction += scaledPerk.value;
                                    }
                                }
                            }
                        });
                        calculatedDurationMs = baseDurationMs * (1 - totalPercentageReduction);
                        
                        // 2. Then apply flat time reductions (like Warped Boots)
                        Object.values(equippedItems).forEach(equippedInstanceId => {
                            if (!equippedInstanceId) return;
                            const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId);
                            if (invItem) {
                                const itemMaster = craftableItemsData.find(im => im.id === invItem.id);
                                if (itemMaster && itemMaster.perk) {
                                    const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0);
                                     if (scaledPerk.type === "timeReduction") { // Flat reduction from items like boots
                                        flatTimeReductionSeconds += scaledPerk.value;
                                    }
                                }
                            }
                        });
                        const flatReductionMs = (flatTimeReductionSeconds / 3600) * (GAME_HOUR_IN_REAL_SECONDS * 1000) ;
                        calculatedDurationMs = Math.max(1000, calculatedDurationMs - flatReductionMs);
                        
                        const returnTime = Date.now() + calculatedDurationMs; 
                        const newActiveAdventure = { id: nextActiveAdventureId++, originalAdventureId: adventureIdBase, name: adventureName, adventurers: numAdventurersToSend, returnTime: returnTime, pvReward: actualPvRewardForAdventure, goldChance: goldChance, diamondChance: diamondChance }; 
                        
                        // Step 1: Add the new adventure to our list
                        activeAdventures.push(newActiveAdventure); 
                        console.log("New adventure pushed:", JSON.parse(JSON.stringify(newActiveAdventure)));
                        console.log("Current activeAdventures array:", JSON.parse(JSON.stringify(activeAdventures)));
                        
                        // Step 2: Now that activeAdventures is updated, recalculate the available count
                        recalculateTotalAvailableAdventurers();

                        // Update UI
                        updateStatsDisplay(); 
                        renderActiveTasksInSidebar(); 
                        updateAdventureDisplayStates(); 
                        if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                    }
                }); 
            });
            adventureDropButtons.forEach(button => { button.addEventListener('mouseenter', (event) => { const adventureId = event.target.dataset.adventureId; const popover = document.getElementById(`drops-popover-${adventureId}`); const adventureInfo = adventuresData[adventureId]; if (popover && adventureInfo && adventureInfo.drops) { let dropsHtml = '<h5>Possible Drops:</h5><ul>'; adventureInfo.drops.forEach(drop => { const dItem = craftableItemsData.find(cd => cd.id === drop.name); dropsHtml += `<li>${drop.qty}x ${dItem ? dItem.name : drop.name} (${(drop.chance * 100).toFixed(3)}%)</li>`; }); dropsHtml += '</ul>'; popover.innerHTML = dropsHtml; popover.style.display = 'block'; } }); button.addEventListener('mouseleave', (event) => { const adventureId = event.target.dataset.adventureId; const popover = document.getElementById(`drops-popover-${adventureId}`); if (popover) { popover.style.display = 'none'; } }); });
            
            // --- Currency Swap Logic ---
            function updateSwapDisplay() {
                if (!swapInfoDisplay || !swapBtn || !reverseSwapDirectionBtn) return;
                if (isGoldToDiamondSwap) {
                    swapInfoDisplay.innerHTML = `100 <span class="gold">GOLD</span> = 1 <span class="diamond">DIAMOND</span>`;
                    swapBtn.textContent = "Swap Gold for Diamond";
                } else {
                    swapInfoDisplay.innerHTML = `1 <span class="diamond">DIAMOND</span> = 100 <span class="gold">GOLD</span>`;
                    swapBtn.textContent = "Swap Diamond for Gold";
                }
            }

            if (reverseSwapDirectionBtn) {
                reverseSwapDirectionBtn.addEventListener('click', () => {
                    isGoldToDiamondSwap = !isGoldToDiamondSwap;
                    updateSwapDisplay();
                });
            }

            if (swapBtn) {
                swapBtn.addEventListener('click', () => {
                    if (!currentUser) return;
                    let costGold = 0, rewardDiamond = 0, costDiamond = 0, rewardGold = 0;
                    let message = "";

                    if (isGoldToDiamondSwap) {
                        costGold = 100;
                        rewardDiamond = 1;
                        if (currentGold >= costGold) {
                            currentGold -= costGold;
                            currentDiamonds += rewardDiamond;
                            message = `Swapped ${costGold} Gold for ${rewardDiamond} Diamond!`;
                        } else {
                            showCustomPopup(`Not enough Gold! You need ${costGold} Gold.`, "Swap Failed");
                            return;
                        }
                    } else { // Diamond to Gold
                        costDiamond = 1;
                        rewardGold = 100;
                        if (currentDiamonds >= costDiamond) {
                            currentDiamonds -= costDiamond;
                            currentGold += rewardGold;
                            message = `Swapped ${costDiamond} Diamond for ${rewardGold} Gold!`;
                        } else {
                            showCustomPopup(`Not enough Diamonds! You need ${costDiamond} Diamond.`, "Swap Failed");
                            return;
                        }
                    }
                    updateStatsDisplay();
                    showCustomPopup(message, "Swap Successful");
                    if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                });
            }
            updateSwapDisplay(); // Initialize display on load


            // --- Whitelist Raffle Logic ---
            async function fetchAndDisplayRaffles() {
                if (!db) { console.error("Firestore not initialized for fetching raffles."); allRaffles = []; renderWhitelistRaffles(); return; }
                const rafflesCol = collection(db, "raffles");
                const q_raffles = query(rafflesCol, where("status", "in", ["active", "ended", "drawing_winners", "winners_announced"]), orderBy("endTime", "desc"));
                try {
                    const querySnapshot = await getDocs(q_raffles); const fetchedRaffles = [];
                    for (const docSnap of querySnapshot.docs) { 
                        const raffleData = docSnap.data();
                        fetchedRaffles.push({ id: docSnap.id, ...raffleData, startTime: raffleData.startTime.toDate().getTime(), endTime: raffleData.endTime.toDate().getTime() });
                    }
                    allRaffles = fetchedRaffles; renderWhitelistRaffles(); console.log("Fetched raffles from Firestore:", allRaffles);
                } catch (error) { console.error("Error fetching raffles: ", error); showCustomPopup("Could not load raffles. Check console (missing index or rules?).", "Raffle Error"); allRaffles = []; renderWhitelistRaffles(); }
            }
            if (createRaffleForm) { createRaffleForm.addEventListener('submit', async (e) => {  e.preventDefault(); if (!db || !currentUser || (currentUser.email && currentUser.email.toLowerCase() !== 'nvoiysol@gmail.com')) { showCustomPopup("Admin action failed.", "Admin Error"); return; } const name = document.getElementById('raffleName').value; const description = document.getElementById('raffleDescription').value; const imageUrl = document.getElementById('raffleImageUrl').value || ''; const socialX = document.getElementById('raffleSocialX').value; const socialDiscord = document.getElementById('raffleSocialDiscord').value; const costPV = parseInt(document.getElementById('raffleCostPV').value) || 0; const costGold = parseInt(document.getElementById('raffleCostGold').value) || 0; const costDiamonds = parseInt(document.getElementById('raffleCostDiamonds').value) || 0; const durationHours = parseInt(document.getElementById('raffleDurationHours').value) || 24; const maxWinners = parseInt(document.getElementById('raffleMaxWinners').value) || 1; const nowMs = Date.now(); const startTime = Timestamp.fromDate(new Date(nowMs)); const endTime = Timestamp.fromDate(new Date(nowMs + durationHours * GAME_HOUR_IN_REAL_SECONDS * 1000)); const newRaffleData = { name, description, imageUrl, socials: { x: socialX, discord: socialDiscord }, entryCost: { pv: costPV, gold: costGold, diamonds: costDiamonds }, durationHours, maxWinners, startTime, endTime, status: 'active', createdByEmail: currentUser.email, createdAt: Timestamp.now(), winners: [], entryCount: 0 }; try { const newRaffleRef = await addDoc(collection(db, "raffles"), newRaffleData); showCustomPopup(`Raffle "${name}" created!`, "Admin Action"); createRaffleForm.reset(); await fetchAndDisplayRaffles(); } catch (error) { console.error("Error creating raffle: ", error); showCustomPopup("Failed to create raffle.", "Admin Error"); } }); }
            async function renderWhitelistRaffles() {  if (!whitelistRafflesContainer) return; whitelistRafflesContainer.innerHTML = ''; if (allRaffles.length === 0) { whitelistRafflesContainer.innerHTML = '<p style="text-align:center;">No active raffles.</p>'; return; } allRaffles.sort((a, b) => b.startTime - a.startTime);  for (const raffle of allRaffles) {  const card = document.createElement('div'); card.className = 'raffle-card'; card.dataset.raffleId = raffle.id; const timeLeftMs = raffle.endTime - Date.now(); let costHtml = ''; if (raffle.entryCost.pv > 0) costHtml += `${raffle.entryCost.pv} <span class="pv">PV</span> `; if (raffle.entryCost.gold > 0) costHtml += `${raffle.entryCost.gold} <span class="gold">GOLD</span> `; if (raffle.entryCost.diamonds > 0) costHtml += `${raffle.entryCost.diamonds} <span class="diamond">DIAMONDS</span>`; if (costHtml === '') costHtml = 'Free Entry'; else costHtml = 'Cost: ' + costHtml; const alreadyEntered = currentUser && playerRaffleEntries && playerRaffleEntries[raffle.id];  let adminActionsHtml = ''; if (currentUser && currentUser.email && currentUser.email.toLowerCase() === 'nvoiysol@gmail.com') { adminActionsHtml += `<button class="action-button raffle-action-btn delete-raffle-btn" data-raffle-id="${raffle.id}">Delete</button>`; if (raffle.status === 'active' && timeLeftMs > 0) { adminActionsHtml += `<button class="action-button raffle-action-btn draw-now-btn" data-raffle-id="${raffle.id}">Draw Now</button>`; } else if ((raffle.status === 'ended' || (raffle.status === 'active' && timeLeftMs <=0) ) && (!raffle.winners || raffle.winners.length === 0)) { adminActionsHtml += `<button class="action-button raffle-action-btn draw-winners-btn" data-raffle-id="${raffle.id}">Draw Winners</button>`; } } card.innerHTML = ` <div class="raffle-card-image ${raffle.imageUrl ? '' : 'placeholder'}" style="${raffle.imageUrl ? 'background-image: url('+raffle.imageUrl+');' : ''}"> ${!raffle.imageUrl ? 'No Image' : ''} </div> <div class="raffle-card-content"> <h4>${raffle.name}</h4> <p class="raffle-card-description">${raffle.description}</p> <div class="raffle-card-socials"> ${raffle.socials.x ? `<a href="${raffle.socials.x}" target="_blank">Project X</a>` : ''} ${raffle.socials.discord ? `<a href="${raffle.socials.discord}" target="_blank">Project Discord</a>` : ''} </div> <p class="raffle-card-cost">${costHtml}</p> <p class="raffle-card-status">Status: ${raffle.status.replace('_', ' ')}</p> <p>Time Left: <span class="raffle-timer">${timeLeftMs > 0 ? formatTimeLeft(timeLeftMs) : 'Ended'}</span></p> <p>Entries: ${raffle.entryCount || 0}</p> ${currentUser && raffle.status === 'active' && timeLeftMs > 0 && !alreadyEntered ? `<button class="action-button enter-raffle-btn raffle-action-btn" data-raffle-id="${raffle.id}">Enter Raffle</button>` : ''} ${alreadyEntered ? '<p><strong>You have entered this raffle!</strong></p>' : ''} <div class="raffle-admin-actions">${adminActionsHtml}</div> ${raffle.winners && raffle.winners.length > 0 ? `<div><strong>Winners (${raffle.winners.length}/${raffle.maxWinners}):</strong><ul>${raffle.winners.map(w => `<li>${w}</li>`).join('')}</ul></div>` : ''} </div> `; whitelistRafflesContainer.appendChild(card); } whitelistRafflesContainer.querySelectorAll('.enter-raffle-btn').forEach(btn => btn.addEventListener('click', handleEnterRaffle)); whitelistRafflesContainer.querySelectorAll('.draw-winners-btn').forEach(btn => btn.addEventListener('click', handleDrawWinners)); whitelistRafflesContainer.querySelectorAll('.draw-now-btn').forEach(btn => btn.addEventListener('click', handleDrawNow)); whitelistRafflesContainer.querySelectorAll('.delete-raffle-btn').forEach(btn => btn.addEventListener('click', handleDeleteRaffle)); }
            async function handleEnterRaffle(event) {  if (!currentUser) { showCustomPopup("You must be logged in to enter a raffle.", "Login Required"); return; } const raffleId = event.target.dataset.raffleId; const raffle = allRaffles.find(r => r.id === raffleId); if (!raffle || raffle.status !== 'active' || (raffle.endTime - Date.now() <= 0) ) { showCustomPopup("Raffle is not active or has ended.", "Entry Failed"); await fetchAndDisplayRaffles(); return; } if (playerRaffleEntries[raffle.id]) {  showCustomPopup("You have already entered this raffle.", "Entry Failed"); return; } if (currentPvTokens < raffle.entryCost.pv || currentGold < raffle.entryCost.gold || currentDiamonds < raffle.entryCost.diamonds) { showCustomPopup("Not enough currency to enter this raffle.", "Entry Failed"); return; } const playerProgressRef = doc(db, "playerProgress", currentUser.uid); const raffleEntryRef = doc(db, "raffles", raffleId, "entries", currentUser.uid); const mainRaffleDocRef = doc(db, "raffles", raffleId); try { await runTransaction(db, async (transaction) => { const playerDoc = await transaction.get(playerProgressRef); if (!playerDoc.exists()) throw "Player document does not exist!"; const mainRaffleSnap = await transaction.get(mainRaffleDocRef); if (!mainRaffleSnap.exists()) throw "Raffle document does not exist!"; const currentPlayerData = playerDoc.data(); const currentRaffleData = mainRaffleSnap.data(); if (currentRaffleData.status !== 'active' || (currentRaffleData.endTime.toDate().getTime() - Date.now() <= 0)) throw "Raffle is no longer active."; const newPv = (currentPlayerData.pvTokens || 0) - raffle.entryCost.pv; const newGold = (currentPlayerData.gold || 0) - raffle.entryCost.gold; const newDiamonds = (currentPlayerData.diamonds || 0) - raffle.entryCost.diamonds; if (newPv < 0 || newGold < 0 || newDiamonds < 0) throw "Insufficient funds."; const entryDoc = await transaction.get(raffleEntryRef); if (entryDoc.exists()) throw "Player already entered."; let updatedPlayerRaffleEntries = { ... (currentPlayerData.playerRaffleEntries || {}), [raffleId]: true }; transaction.update(playerProgressRef, { pvTokens: newPv, gold: newGold, diamonds: newDiamonds, playerRaffleEntries: updatedPlayerRaffleEntries }); transaction.set(raffleEntryRef, { timestamp: Timestamp.now(), nickname: userNickname }); transaction.update(mainRaffleDocRef, { entryCount: (currentRaffleData.entryCount || 0) + 1 }); }); currentPvTokens -= raffle.entryCost.pv; currentGold -= raffle.entryCost.gold; currentDiamonds -= raffle.entryCost.diamonds; playerRaffleEntries[raffle.id] = true;  const raffleInClientArray = allRaffles.find(r => r.id === raffleId); if (raffleInClientArray) raffleInClientArray.entryCount = (raffleInClientArray.entryCount || 0) + 1; updateStatsDisplay(); renderWhitelistRaffles(); showCustomPopup(`Successfully entered raffle: ${raffle.name}!`, "Raffle Entry"); if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState()); } catch (error) { console.error("Raffle entry transaction failed: ", error); showCustomPopup(`Raffle entry failed: ${error.toString()}`, "Entry Error"); await fetchAndDisplayRaffles(); } }
            async function drawRaffleWinners(raffleId, isDrawingNow = false) { if (!currentUser || !currentUser.email || currentUser.email.toLowerCase() !== 'nvoiysol@gmail.com' || !db) return; const raffleDocRef = doc(db, "raffles", raffleId); try { const raffleDocSnap = await getDoc(raffleDocRef); if (!raffleDocSnap.exists()) { showCustomPopup("Raffle document not found.", "Admin Error"); return false; } const raffleData = raffleDocSnap.data(); if (!isDrawingNow && raffleData.status === 'active' && raffleData.endTime.toDate().getTime() > Date.now()) { showCustomPopup("Raffle not ended yet.", "Admin Action Failed"); return false; } if (raffleData.winners && raffleData.winners.length > 0) { showCustomPopup("Winners already drawn.", "Admin Info"); return false; } await updateDoc(raffleDocRef, { status: 'drawing_winners', endTime: Timestamp.now() }); const localRaffle = allRaffles.find(r => r.id === raffleId); if(localRaffle) { localRaffle.status = 'drawing_winners'; localRaffle.endTime = Date.now(); } renderWhitelistRaffles(); const entriesColRef = collection(db, "raffles", raffleId, "entries"); const entriesSnapshot = await getDocs(entriesColRef); const allEntryNicknames = []; entriesSnapshot.forEach(entryDoc => allEntryNicknames.push(entryDoc.data().nickname || entryDoc.id)); if (allEntryNicknames.length === 0) { await updateDoc(raffleDocRef, { status: 'winners_announced', winners: [] }); if(localRaffle) { localRaffle.status = 'winners_announced'; localRaffle.winners = [];} showCustomPopup(`No entries for ${raffleData.name}.`, "Raffle Result"); renderWhitelistRaffles(); return true; } let potentialWinners = [...new Set(allEntryNicknames)]; const drawnWinners = []; for (let i = 0; i < raffleData.maxWinners && potentialWinners.length > 0; i++) { const winnerIndex = Math.floor(Math.random() * potentialWinners.length); drawnWinners.push(potentialWinners.splice(winnerIndex, 1)[0]); } await updateDoc(raffleDocRef, { winners: drawnWinners, status: 'winners_announced' }); if(localRaffle) { localRaffle.winners = drawnWinners; localRaffle.status = 'winners_announced'; } showCustomPopup(`Winners drawn for ${raffleData.name}!`, "Raffle Result"); renderWhitelistRaffles(); return true; } catch (error) { console.error("Error drawing winners: ", error); showCustomPopup("Failed to draw winners.", "Admin Error"); const localRaffle = allRaffles.find(r => r.id === raffleId); if(localRaffle && localRaffle.status === 'drawing_winners') localRaffle.status = (localRaffle.endTime > Date.now() ? 'active' : 'ended');  renderWhitelistRaffles(); return false; } }
            async function handleDrawWinners(event) { await drawRaffleWinners(event.target.dataset.raffleId, false); }
            async function handleDrawNow(event) { await drawRaffleWinners(event.target.dataset.raffleId, true); }
            async function handleDeleteRaffle(event) { if (!currentUser || !currentUser.email || currentUser.email.toLowerCase() !== 'nvoiysol@gmail.com' || !db) return; const raffleId = event.target.dataset.raffleId; const raffleName = allRaffles.find(r => r.id === raffleId)?.name || "this raffle"; if (confirm(`Are you sure you want to delete "${raffleName}"? This cannot be undone.`)) { const raffleDocRef = doc(db, "raffles", raffleId); try { await deleteDoc(raffleDocRef); showCustomPopup(`Raffle "${raffleName}" deleted.`, "Admin Action"); await fetchAndDisplayRaffles(); } catch (error) { console.error("Error deleting raffle:", error); showCustomPopup("Failed to delete raffle.", "Admin Error"); } }}
async function loadPunkVoyageIds() { // This was originally line 2414
    console.log("loadPunkVoyageIds: Loading embedded Punk Voyage inscription IDs.");
    try {
        // PASTE YOUR 1665 IDs HERE, formatted as a JavaScript array
        // It should look like: const idsArray = [ "id1", "id2", "id3", ... ];
        const idsArray = [
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i527",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i554",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i775",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1012",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i577",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i114",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i178",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i875",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i547",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i773",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i250",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1024",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i451",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i621",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i943",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1084",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i736",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i333",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i110",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i457",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i912",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i369",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i438",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i953",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i476",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i216",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i277",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i424",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i672",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i116",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i442",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i309",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i751",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i672",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i286",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i742",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i631",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i314",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i761",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i641",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i532",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i319",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i96",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i561",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i806",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i337",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i288",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i535",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i184",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i322",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i390",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i65",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i853",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i694",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i7",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i785",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i472",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i384",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i230",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i442",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i79",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1108",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i938",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i676",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i188",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i900",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i663",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i565",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i489",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i613",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i538",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i943",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i918",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i270",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i61",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i866",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i71",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i335",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i455",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i600",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i421",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i549",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i350",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i363",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i342",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i925",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i43",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1028",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i739",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i179",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i501",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i903",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i252",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i848",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i244",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i500",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i206",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i33",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i187",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i965",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i285",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i430",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i344",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i973",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i721",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i306",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i884",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i511",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i920",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i182",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i78",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i417",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i276",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i988",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1032",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i450",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i771",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i370",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i746",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i514",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i745",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i462",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1018",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i57",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i14",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i720",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i232",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i240",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1086",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1061",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i408",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i681",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i201",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i610",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i365",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i808",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i799",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i854",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i747",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i382",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i69",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i262",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1101",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i790",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i166",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1046",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i178",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i383",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i512",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i798",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i431",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i644",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i655",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i40",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i540",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i618",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i221",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i400",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i711",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i155",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i117",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i653",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i758",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i56",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i444",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i278",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1029",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i656",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i356",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i224",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i683",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i581",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i578",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i354",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1026",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i359",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1047",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1008",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i20",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i680",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i623",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i506",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1051",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i176",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i890",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i223",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i704",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i684",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i521",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i924",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1073",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1076",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i376",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i786",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i147",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i702",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i153",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i266",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i920",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i482",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i745",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i222",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i372",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i718",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i126",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1030",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i174",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i575",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i568",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i850",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i867",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i219",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i319",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i260",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i476",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i814",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i373",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i105",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i66",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i994",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i330",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i193",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i217",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i46",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i847",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i135",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i763",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1058",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i919",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i301",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i813",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i979",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i117",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1096",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i608",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i171",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i866",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i305",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i152",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i762",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i535",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i381",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i739",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i399",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i564",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1013",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i960",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i809",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i764",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i214",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1080",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i833",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1101",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i539",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1020",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i27",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i113",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i361",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i632",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i396",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i627",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i571",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i207",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i111",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i395",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i885",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i589",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i846",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i115",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i92",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i892",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i47",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i774",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i951",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1091",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i410",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i114",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i479",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i160",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i47",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1022",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i172",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i904",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i510",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i286",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i211",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i136",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i996",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i642",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i417",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i127",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i42",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i443",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i310",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i817",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i428",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i645",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i72",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i170",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i507",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i458",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i80",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i850",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i548",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i764",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i112",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i625",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i351",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1078",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i805",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i658",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i599",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i480",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i812",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i281",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i946",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i490",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i506",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i159",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i183",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i844",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1038",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i108",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i38",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i437",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i119",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i386",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i985",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i555",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i220",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i100",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1036",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i699",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i168",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i88",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i985",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i376",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i748",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i434",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i760",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i401",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i890",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i878",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i93",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i156",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i151",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i57",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i421",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i738",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i841",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i134",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i388",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i392",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i618",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i851",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i637",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i970",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i237",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i299",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i336",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i999",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i142",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i125",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i802",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i315",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i70",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i16",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i107",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i925",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i546",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1105",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i803",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i13",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i825",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i144",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i678",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i958",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i80",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i301",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i498",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i550",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1035",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i239",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i860",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i52",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i891",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i82",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i685",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i773",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i362",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i410",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1035",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1106",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1110",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i59",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i706",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i413",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i987",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i35",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i220",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1107",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i243",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i566",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i62",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i31",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1042",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i922",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i355",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i320",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i127",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i505",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i234",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i199",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1060",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i689",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i654",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i661",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i179",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i991",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i435",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1010",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i714",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i290",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i606",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i723",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i203",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i15",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i139",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i734",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i491",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i218",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i475",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i362",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i259",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1050",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i175",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i97",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i334",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i987",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i282",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i707",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1079",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i723",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i826",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1049",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i318",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i791",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i343",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i558",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i513",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i788",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1017",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i142",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i984",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i835",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i183",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i20",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i246",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i857",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i195",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i388",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i341",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i120",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i23",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i652",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i821",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i839",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i257",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i783",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i374",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i779",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i682",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i555",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i45",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i430",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i921",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1075",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i997",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i754",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i703",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i945",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i62",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i668",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i859",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i774",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i208",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1110",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1094",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i496",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i251",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i642",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i857",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i300",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1013",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i329",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i976",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i623",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i822",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i603",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i934",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i933",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i267",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i327",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1077",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i258",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i252",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i772",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i536",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i325",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i807",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i368",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i687",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i636",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i949",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i180",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i938",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i715",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i427",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1063",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i621",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i674",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i481",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1097",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i73",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i518",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i418",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i470",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i547",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i861",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i990",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i55",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i323",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i805",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i44",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i463",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1104",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i365",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i153",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i961",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i703",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i991",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i268",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i468",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i602",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i227",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i759",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i525",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i342",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i228",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i346",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1059",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i617",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1000",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i308",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i909",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i392",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i757",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i133",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i6",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i945",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i357",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i929",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i146",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i530",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i346",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i229",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i982",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1109",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i614",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i963",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i95",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i356",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i177",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i219",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i130",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i121",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i827",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i419",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i406",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i592",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i473",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i257",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1090",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i681",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i593",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1016",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i288",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i380",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1086",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i435",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i901",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i783",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i910",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i41",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i222",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i509",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i170",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i154",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i972",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i968",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i740",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i162",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i502",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i646",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i385",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i277",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i780",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i713",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i452",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i217",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i752",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i602",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i229",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i158",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i965",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i679",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i245",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i154",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i643",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i896",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i407",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i67",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i853",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i545",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i927",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i39",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i469",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1098",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i831",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i942",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i670",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i797",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i595",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i244",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i505",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i687",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i495",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i367",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i321",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i166",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i582",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i844",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i803",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i751",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i381",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i815",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i962",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i124",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1042",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i522",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i504",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i779",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i614",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i897",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i358",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i197",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i784",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i30",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i225",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i126",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i944",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i267",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i711",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i562",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i627",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i724",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i538",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i272",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i713",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1062",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i733",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i276",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i701",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i567",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i366",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1033",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i802",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i462",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i295",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i897",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i507",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i786",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i542",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i524",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i509",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i996",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i840",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i694",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1028",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i167",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i345",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i954",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i788",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i708",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i574",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i994",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i873",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i232",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i211",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i163",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i605",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i629",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1107",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i235",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i635",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i864",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i917",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i185",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i233",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i680",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i499",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i81",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i425",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i719",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i722",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i48",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i926",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i42",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1065",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i29",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i348",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i382",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i191",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1040",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i380",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i477",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i573",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i641",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i669",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1103",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1054",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i937",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i989",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i411",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i387",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i796",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i604",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i496",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i560",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i38",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i54",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i631",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1048",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i224",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i52",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i742",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i37",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i210",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i928",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i794",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i99",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1011",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i461",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i831",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i34",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1004",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i415",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i389",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i367",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i162",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i6",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1088",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1089",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1090",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1091",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1092",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1093",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i393",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i394",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i395",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i396",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i397",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i398",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i399",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i400",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i401",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i402",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i0",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i2",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i10",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i11",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i12",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i14",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i101",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i102",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i103",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i104",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i105",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i109",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i110",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i112",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i120",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i197",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i198",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i199",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i200",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i202",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i204",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i205",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i212",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i213",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i215",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i221",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i223",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i226",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i228",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i231",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i234",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i236",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i238",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i239",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i241",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i242",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i243",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i246",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i247",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i248",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i249",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i250",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i253",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i254",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i255",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i256",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i258",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i259",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i261",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i263",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i264",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i265",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i266",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i268",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i269",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i271",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i273",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i274",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i275",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i278",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i279",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i280",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i281",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i282",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i283",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i284",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i287",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i289",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i290",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i291",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i292",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i293",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i294",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i295",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i296",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i297",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i298",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i299",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i302",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i303",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i304",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i307",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i308",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i309",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i310",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i311",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i312",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i313",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i314",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i315",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i316",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i317",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i320",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i322",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i324",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i325",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i326",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i328",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i331",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i332",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i333",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i334",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i335",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i336",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i337",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i338",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i339",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i340",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i341",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i343",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i347",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i349",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i350",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i352",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i353",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i355",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i357",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i358",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i359",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i360",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i364",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i366",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i370",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i371",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i374",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i375",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i377",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i378",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i379",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i384",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i385",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i386",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i391",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i393",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i394",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i397",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i398",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i402",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i403",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i404",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i405",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i406",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i409",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i412",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i413",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i414",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i416",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i419",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i420",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i422",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i423",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i426",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i428",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i429",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i431",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i432",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i433",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i434",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i436",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i438",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i439",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i440",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i441",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i444",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i445",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i446",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i447",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i448",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i449",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i452",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i453",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i454",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i456",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i457",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i458",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i459",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i460",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i461",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i464",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i465",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i466",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i467",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i468",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i469",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i470",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i471",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i473",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i474",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i477",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i478",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i480",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i481",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i482",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i483",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i484",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i485",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i486",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i487",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i488",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i490",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i491",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i492",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i493",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i494",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i495",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i497",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i498",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i499",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i500",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i501",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i503",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i508",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i510",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i512",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i513",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i515",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i516",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i517",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i518",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i519",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i520",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i523",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i524",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i525",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i526",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i528",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i529",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i531",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i532",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i533",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i534",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i537",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i540",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i541",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i543",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i544",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i546",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i551",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i552",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i553",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i556",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i557",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i558",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i559",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i560",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i561",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i563",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i566",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i568",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i569",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i570",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i572",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i574",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i575",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i576",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i577",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i578",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i579",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i580",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i583",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i584",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i585",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i586",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i587",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i588",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i589",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i590",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i591",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i594",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i595",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i596",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i597",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i598",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i601",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i603",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i604",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i607",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i609",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i611",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i612",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i613",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i615",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i616",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i617",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i619",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i620",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i622",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i624",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i626",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i628",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i630",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i633",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i634",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i635",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i636",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i638",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i639",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i640",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i643",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i645",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i647",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i648",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i649",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i650",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i651",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i652",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i653",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i654",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i655",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i656",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i657",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i658",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i659",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i660",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i661",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i662",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i663",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i664",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i665",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i666",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i667",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i671",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i673",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i674",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i675",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i676",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i677",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i679",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i682",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i686",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i688",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i690",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i691",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i692",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i693",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i695",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i696",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i697",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i698",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i700",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i701",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i705",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i706",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i707",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i709",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i710",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i712",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i714",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i716",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i717",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i720",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i722",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i725",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i726",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i727",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i728",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i729",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i730",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i731",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i732",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i733",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i735",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i736",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i737",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i740",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i741",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i743",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i744",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i746",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i747",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i748",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i749",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i750",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i753",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i754",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i755",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i756",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i757",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i759",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i760",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i762",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i765",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i766",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i767",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i768",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i769",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i770",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i771",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i776",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i777",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i778",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i781",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i782",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i784",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i787",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i789",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i790",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i791",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i792",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i793",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i794",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i795",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i798",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i800",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i801",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i804",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i806",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i810",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i811",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i812",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i813",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i814",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i815",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i816",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i818",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i819",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i820",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i823",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i824",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i827",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i828",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i829",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i830",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i832",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i833",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i834",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i835",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i836",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i837",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i838",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i839",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i840",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i842",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i843",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i845",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i846",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i848",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i849",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i852",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i854",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i855",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i856",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i858",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i860",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i862",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i863",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i864",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i865",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i867",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i868",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i869",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i870",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i871",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i872",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i873",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i874",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i875",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i876",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i877",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i879",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i880",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i881",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i882",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i883",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i884",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i885",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i886",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i887",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i888",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i889",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i891",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i892",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i893",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i894",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i895",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i898",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i899",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i901",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i902",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i903",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i905",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i906",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i907",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i908",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i909",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i911",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i913",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i914",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i915",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i916",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i917",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i919",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i922",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i923",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i928",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i930",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i931",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i932",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i935",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i936",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i939",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i940",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i941",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i942",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i944",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i947",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i948",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i950",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i951",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i952",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i954",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i955",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i956",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i957",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i959",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i964",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i966",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i967",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i968",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i969",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i971",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i972",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i973",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i974",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i975",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i977",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i978",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i979",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i980",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i981",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i983",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i986",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i988",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i992",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i993",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i995",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i998",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i999",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1000",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1001",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1002",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1003",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1005",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1006",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1007",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1009",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1010",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1012",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1014",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1015",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1016",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1019",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1020",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1021",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1023",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1024",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1025",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1027",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1029",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1031",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1033",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1034",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1036",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1037",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1039",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1041",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1043",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1044",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1045",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1049",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1050",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1052",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1053",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1054",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1055",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1056",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1057",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1059",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1060",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1061",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1062",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1063",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1064",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1065",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1066",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1067",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1068",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1069",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1070",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1071",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1072",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1073",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1074",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1076",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1077",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1078",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1079",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1081",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1082",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1083",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1085",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1087",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1088",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1089",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1092",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1093",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1094",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1095",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1096",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1097",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1099",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1100",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1102",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1108",
"0bad7bab126b907355c767d29128b2d762999b8d50acd8f5eebb31418ce7b485i1109",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i0",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i1",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i2",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i3",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i4",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i5",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i8",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i9",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i10",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i11",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i12",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i15",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i17",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i18",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i19",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i21",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i22",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i24",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i25",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i26",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i27",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i28",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i32",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i33",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i34",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i36",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i41",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i44",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i45",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i48",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i49",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i50",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i51",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i53",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i55",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i56",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i58",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i59",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i60",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i61",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i63",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i64",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i66",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i68",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i70",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i73",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i74",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i75",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i76",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i77",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i78",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i79",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i81",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i83",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i84",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i85",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i86",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i87",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i88",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i89",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i90",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i91",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i94",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i97",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i98",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i101",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i102",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i103",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i104",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i106",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i107",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i108",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i109",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i111",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i113",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i115",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i116",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i118",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i119",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i121",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i122",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i123",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i124",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i125",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i128",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i129",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i131",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i132",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i134",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i136",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i137",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i138",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i139",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i140",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i141",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i143",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i145",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i148",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i149",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i150",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i151",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i156",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i157",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i159",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i161",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i163",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i164",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i165",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i167",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i168",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i169",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i171",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i172",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i173",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i176",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i177",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i180",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i181",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i182",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i184",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i186",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i187",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i189",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i190",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i191",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i192",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i193",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i194",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i195",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i196",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i198",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i200",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i201",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i202",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i203",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i204",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i205",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i206",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i208",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i209",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i210",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i212",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i213",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i214",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i215",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i216",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i218",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i225",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i226",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i227",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i230",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i231",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i233",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i235",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i236",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i237",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i238",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i240",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i241",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i242",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i245",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i247",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i248",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i249",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i251",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i253",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i254",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i255",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i256",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i260",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i261",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i262",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i263",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i264",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i265",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i269",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i270",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i271",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i272",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i273",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i274",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i275",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i279",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i280",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i283",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i284",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i285",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i287",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i289",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i291",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i292",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i293",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i294",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i296",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i297",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i298",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i300",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i302",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i303",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i304",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i305",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i306",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i307",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i311",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i312",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i313",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i316",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i317",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i318",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i321",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i323",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i324",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i326",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i327",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i328",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i329",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i330",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i331",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i332",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i338",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i339",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i340",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i344",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i345",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i347",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i348",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i349",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i351",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i352",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i353",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i354",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i360",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i361",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i363",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i364",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i368",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i369",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i371",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i372",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i373",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i375",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i377",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i378",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i379",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i383",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i387",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i389",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i390",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i391",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i403",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i404",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i405",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i407",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i408",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i409",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i411",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i412",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i414",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i415",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i416",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i418",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i420",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i422",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i423",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i424",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i425",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i426",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i427",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i429",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i432",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i433",
"f217c636d35a75756e4965135547a72b4b35bd9527cd6510d25a56153d3a1398i436"
]; // The closing bracket for your array of IDs

        if (!Array.isArray(idsArray) || idsArray.length === 0) {
            console.error("loadPunkVoyageIds: Embedded idsArray is not a valid non-empty array. Make sure you pasted your IDs correctly between the brackets [ ... ] and that each ID is a string in quotes, separated by commas.");
            if(userOrdinalsDisplayElement) userOrdinalsDisplayElement.style.display = 'block';
            if(userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>Error: Collection ID list is empty or invalid. Please check the code.</p>`;
            PUNK_VOYAGE_IDS_SET = new Set();
            punkVoyageIdsLoaded = false; // Explicitly set flag
            return false;
        }

        PUNK_VOYAGE_IDS_SET = new Set(idsArray);
        console.log(`loadPunkVoyageIds: Successfully loaded ${PUNK_VOYAGE_IDS_SET.size} Punk Voyage inscription IDs from embedded array.`);
        punkVoyageIdsLoaded = true; // Explicitly set flag
        return true;
    } catch (error) {
        console.error('loadPunkVoyageIds: Error processing embedded IDs:', error);
        if(userOrdinalsDisplayElement) userOrdinalsDisplayElement.style.display = 'block';
        if(userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>Error: Could not process embedded collection ID list. Error: ${error.message}</p>`;
        PUNK_VOYAGE_IDS_SET = new Set();
        punkVoyageIdsLoaded = false; // Explicitly set flag
        return false;
    }
} // This was originally line 2444

   async function loadDungeonCrawlerIds() {
        console.log("loadDungeonCrawlerIds: Attempting to load Dungeon Crawler inscription IDs.");
        try {
            // PASTE YOUR DUNGEON CRAWLER NFT IDs HERE, formatted as a JavaScript array
            // It should look like: const crawlerIdsArray = [ "crawler_id1", "crawler_id2", ... ];
            const crawlerIdsArray = [
                // EXAMPLE: "some_crawler_inscription_id_1i0",
                // EXAMPLE: "another_crawler_inscription_id_2i0"
            ]; // <<<<------ YOU WILL ADD YOUR IDs HERE LATER

            if (!Array.isArray(crawlerIdsArray) /* || crawlerIdsArray.length === 0 */) { // Allow empty for now
                console.warn("loadDungeonCrawlerIds: Embedded crawlerIdsArray is not a valid array or is empty. Dungeon Crawler feature might be limited.");
                // No critical error if empty, just means no crawlers defined yet
                PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.clear(); // Use .clear() to empty the Set
                dungeonCrawlerIdsLoaded = true; // Mark as "loaded" (even if empty) to prevent re-attempts
                return true; // Still return true as the process completed without error
            }

            PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.clear(); // Clear before adding new ones
            crawlerIdsArray.forEach(id => PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.add(id));

            console.log(`loadDungeonCrawlerIds: Successfully loaded ${PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.size} Dungeon Crawler inscription IDs.`);
            dungeonCrawlerIdsLoaded = true;
            return true;
        } catch (error) {
            console.error('loadDungeonCrawlerIds: Error processing embedded IDs:', error);
            PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.clear();
            dungeonCrawlerIdsLoaded = false; // Mark as failed
            return false;
        }
    }

        function renderActiveSpecialties() {
            if (!specialtiesListContainer) {
                console.warn("Specialties list container not found.");
                return;
            }

            specialtiesListContainer.innerHTML = ''; // Clear previous
            let specialtiesHtml = '<ul>';
            let foundSpecialties = false;

            // 1. Perks from equipped items
            Object.keys(equippedItems).forEach(slotId => {
                const equippedInstanceId = equippedItems[slotId];
                if (!equippedInstanceId) return;

                const invItem = playerInventory.find(i => i.uniqueInstanceId === equippedInstanceId);
                if (invItem) {
                    const itemMaster = craftableItemsData.find(im => im.id === invItem.id);
                    if (itemMaster && itemMaster.perk) {
                        const scaledPerk = getScaledItemPerk(itemMaster, invItem.level || 0);
                        let perkText = '';
                        let perkIsSpecialty = true; // Assume it's a displayable specialty

                        switch (scaledPerk.type) {
                            case "timeReduction":
                                perkText = `Adventure Time Reduction: ${scaledPerk.value / 60} minutes`;
                                break;
                            case "goldChanceIncrease":
                                perkText = `Gold Find Chance Multiplier: +${(scaledPerk.value * 100).toFixed(1)}%`;
                                break;
                            case "pvBonus":
                                perkText = `PV Token Bonus (Adventures): +${(scaledPerk.value * 100).toFixed(1)}%`;
                                break;
                            case "materialChanceMultiplier":
                                perkText = `Material Find Chance Multiplier: x${scaledPerk.value.toFixed(2)}`;
                                break;
                            case "flatCurrencyChanceBoost":
                                let currencyBonuses = [];
                                if (scaledPerk.goldBonus) currencyBonuses.push(`Gold Find (Flat): +${(scaledPerk.goldBonus * 100).toFixed(1)}%`);
                                if (scaledPerk.diamondBonus) currencyBonuses.push(`Diamond Find (Flat): +${(scaledPerk.diamondBonus * 100).toFixed(1)}%`);
                                perkText = currencyBonuses.join('<br>');
                                break;
                            case "dungeonEntryBonus": // Pizza Pendant
                                let entryBonuses = [];
                                if (scaledPerk.dungeon1) entryBonuses.push(`Dungeon 1: +${scaledPerk.dungeon1} daily entry`);
                                if (scaledPerk.dungeon2) entryBonuses.push(`Dungeon 2: +${scaledPerk.dungeon2} daily entry`);
                                perkText = entryBonuses.join('<br>');
                                break;
                            case "timeReductionPercent": // Orb of Haste
                                perkText = `Adventure Time Reduction: ${(scaledPerk.value * 100).toFixed(0)}%`;
                                break;
                            case "dungeonMaterialFetch": // $DOG Pet
                                perkText = `$DOG Pet: Fetches ${scaledPerk.count} random material(s) after dungeon.`;
                                break;
                            // These perks directly contribute to Attack/Defense, not listed as separate "specialties" here
                            case "attackBoost":
                            case "defenseBoost":
                            case "statBoost":
                                perkIsSpecialty = false;
                                break;
                            default:
                                console.warn("Unknown perk type for specialty display:", scaledPerk.type);
                                perkIsSpecialty = false;
                                break;
                        }

                        if (perkText && perkIsSpecialty) {
                            const itemLevelText = (invItem.level || 0) > 0 ? ` +${invItem.level}` : '';
                            specialtiesHtml += `<li>${perkText} <span class="specialty-source">(from ${itemMaster.name}${itemLevelText})</span></li>`;
                            foundSpecialties = true;
                        }
                    }
                }
            });

            // 2. Dungeon Set Bonus
            const dungeonSetReduction = getDungeonSetBonusTimeReduction(); // You already have this function
            if (dungeonSetReduction > 0) {
                specialtiesHtml += `<li>Dungeon Set Bonus: Adventure Time Reduction: ${(dungeonSetReduction * 100).toFixed(0)}%</li>`;
                foundSpecialties = true;
            }

            if (!foundSpecialties) {
                specialtiesHtml += '<li>No active specialty perks. Equip items or complete sets!</li>';
            }
            specialtiesHtml += '</ul>';
            specialtiesListContainer.innerHTML = specialtiesHtml;
        }

async function fetchWalletInscriptions(userAddress, walletName) {
    if (userOrdinalsDisplayElement) userOrdinalsDisplayElement.style.display = 'block';
    if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>Loading your inscriptions...</p>`;

    let walletInscriptionIds = [];
    let inscriptionDetailsForRendering = [];
    let previousBonusAdventurers = ordinalBonusAdventurers; // Store current bonus

    try {
        if (walletName === 'UniSat' && typeof window.unisat !== 'undefined') {
            const unisatInscriptions = await window.unisat.getInscriptions(0, 200);
            if (unisatInscriptions && unisatInscriptions.list) {
                walletInscriptionIds = unisatInscriptions.list.map(insc => insc.inscriptionId);
            } else {
                console.warn("UniSat: No inscriptions found or unexpected response format.");
            }
        } else if (walletName === 'Xverse' || walletName === 'UniSat') { // This part is used by Xverse direct and as fallback for UniSat
            walletInscriptionIds = []; // Initialize as empty to accumulate from pages
            let currentOffset = 0;
            const pageLimit = 60; // Hiro's max limit per page
            let hasMore = true;
            let totalFetchedSoFar = 0;
            const MAX_TOTAL_FETCH_LIMIT = 500; // Safety limit to prevent infinite loops or excessive API calls

            console.log(`Fetching inscriptions for ${userAddress} from Hiro API with pagination.`);

            while (hasMore && totalFetchedSoFar < MAX_TOTAL_FETCH_LIMIT) {
                const hiroApiUrl = `https://api.hiro.so/ordinals/v1/inscriptions?address=${userAddress}&limit=${pageLimit}&offset=${currentOffset}`;
                console.log(`Fetching page: ${hiroApiUrl}`);
                try {
                    const response = await fetch(hiroApiUrl);
                    if (!response.ok) {
                        console.error(`Hiro API error for ${userAddress} (offset ${currentOffset}): ${response.statusText}`);
                        // Optionally, break or handle error differently if a page fails.
                        // For now, we'll stop fetching if a page fails.
                        hasMore = false; // Stop trying to fetch more pages
                        if (walletInscriptionIds.length === 0 && userOrdinalsListElement) { // Only show error if no inscriptions were fetched at all
                             userOrdinalsListElement.innerHTML = `<p>Error fetching inscriptions via public API on page. Status: ${response.statusText}</p>`;
                        }
                        break; // Exit the while loop
                    }
                    const data = await response.json();

                    if (data.results && data.results.length > 0) {
                        const idsFromPage = data.results.map(insc => insc.id);
                        walletInscriptionIds.push(...idsFromPage);
                        totalFetchedSoFar += idsFromPage.length;
                    }

                    if (data.total > walletInscriptionIds.length && data.results && data.results.length === pageLimit) {
                        currentOffset += pageLimit;
                        hasMore = true;
                    } else {
                        hasMore = false; // No more pages or fewer results than limit means it's the last page
                    }
                     console.log(`Fetched ${data.results ? data.results.length : 0} inscriptions from this page. Total fetched so far: ${walletInscriptionIds.length}. API reports total: ${data.total}`);

                } catch (pageError) {
                    console.error(`Network or other error fetching page (offset ${currentOffset}) for ${userAddress}:`, pageError);
                    hasMore = false; // Stop on network errors
                    if (walletInscriptionIds.length === 0 && userOrdinalsListElement) {
                        userOrdinalsListElement.innerHTML = `<p>Network error fetching inscriptions. Please check your connection.</p>`;
                    }
                    break; // Exit the while loop
                }
            }
            if (totalFetchedSoFar >= MAX_TOTAL_FETCH_LIMIT) {
                console.warn(`Reached MAX_TOTAL_FETCH_LIMIT (${MAX_TOTAL_FETCH_LIMIT}) for address ${userAddress}. Some inscriptions might be missing if user owns more.`);
                if (userOrdinalsListElement) {
                    const p = userOrdinalsListElement.querySelector('p') || document.createElement('p');
                    p.innerHTML += `<br><small>(Note: Display limited to the first ${MAX_TOTAL_FETCH_LIMIT} inscriptions due to high volume.)</small>`;
                    if (!userOrdinalsListElement.querySelector('p')) userOrdinalsListElement.appendChild(p);
                }
            }
            console.log(`Finished fetching from Hiro API. Total inscriptions found: ${walletInscriptionIds.length}`);
        } else {
            if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>Wallet type not supported for direct inscription listing.</p>`;
            ordinalBonusAdventurers = 0; // Reset bonus
            recalculateTotalAvailableAdventurers();
            return;
        }

        if (walletInscriptionIds.length === 0) {
            if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>No inscriptions found in this wallet via ${walletName} provider/API.</p>`;
            ordinalBonusAdventurers = 0;
            recalculateTotalAvailableAdventurers();
            return;
        }

        const ownedPunkVoyageIds = walletInscriptionIds.filter(id => PUNK_VOYAGE_IDS_SET.has(id));

        if (ownedPunkVoyageIds.length === 0) {
            if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>No Punk Voyage Ordinals from your collection found in this wallet.</p>`;
            ordinalBonusAdventurers = 0;
            recalculateTotalAvailableAdventurers();
            return;
        }

// --- BONUS LOGIC ---
// Each owned Punk Voyage Ordinal gives +1 adventurer.
ordinalBonusAdventurers = ownedPunkVoyageIds.length;
// --- END BONUS LOGIC ---


        if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>Found ${ownedPunkVoyageIds.length} Punk Voyage Ordinal(s). Fetching details... You get ${ordinalBonusAdventurers} bonus adventurer(s)!</p>`;
        
        for (const inscriptionId of ownedPunkVoyageIds) {
            if (PUNK_VOYAGE_ID_IMAGE_CACHE[inscriptionId]) {
                inscriptionDetailsForRendering.push(PUNK_VOYAGE_ID_IMAGE_CACHE[inscriptionId]);
                continue;
            }
            try {
                const detailUrl = `https://api.hiro.so/ordinals/v1/inscriptions/${inscriptionId}`;
                const contentUrl = `https://api.hiro.so/ordinals/v1/inscriptions/${inscriptionId}/content`;
                
                const detailResponse = await fetch(detailUrl);
                let name = `#${inscriptionId.slice(0,4)}...`;
                if(detailResponse.ok){
                    const detailData = await detailResponse.json();
                    name = `#${detailData.number || inscriptionId.slice(0,4)}`;
                }

                PUNK_VOYAGE_ID_IMAGE_CACHE[inscriptionId] = { id: inscriptionId, name: name, imageUrl: contentUrl };
                inscriptionDetailsForRendering.push(PUNK_VOYAGE_ID_IMAGE_CACHE[inscriptionId]);
            } catch (detailError) {
                console.error(`Error fetching details for inscription ${inscriptionId}:`, detailError);
                inscriptionDetailsForRendering.push({ id: inscriptionId, name: `ID ${inscriptionId.slice(0,6)}...`, imageUrl: null });
            }
        }
        renderOwnedPunkVoyageOrdinals(inscriptionDetailsForRendering);

    } catch (error) {
        console.error(`Error in fetchWalletInscriptions for ${walletName}:`, error);
        if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = `<p>An error occurred while checking your Ordinals.</p>`;
        ordinalBonusAdventurers = 0; // Reset bonus on error
    } finally {
        recalculateTotalAvailableAdventurers(); // Always recalculate
        if (ordinalBonusAdventurers !== previousBonusAdventurers && currentUser && currentUser.uid) {
            // Save game state only if the bonus actually changed
            saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
        }
    }
}

function renderOwnedPunkVoyageOrdinals(ownedInscriptions) { // ownedInscriptions is an array of {id, name, imageUrl}
    if (!userOrdinalsDisplayElement || !userOrdinalsListElement) return;

    userOrdinalsListElement.innerHTML = ''; // Clear previous list items

    // Get the <h4> element for the title, or create it if it doesn't exist
    let titleElement = userOrdinalsDisplayElement.querySelector('h4');
    if (!titleElement) {
        titleElement = document.createElement('h4');
        // Ensure the title is the first child of userOrdinalsDisplayElement, before userOrdinalsListElement
        if (userOrdinalsDisplayElement.firstChild) {
            userOrdinalsDisplayElement.insertBefore(titleElement, userOrdinalsDisplayElement.firstChild);
        } else {
            userOrdinalsDisplayElement.appendChild(titleElement);
        }
    }

    if (!ownedInscriptions || ownedInscriptions.length === 0) {
        titleElement.textContent = "MY PUNK VOYAGE ORDINALS (0)";
        userOrdinalsListElement.innerHTML = `<p style="text-align:center; font-size:0.9em;">You don't own any Punk Voyage Ordinals from this collection in the connected wallet.</p>`;
        userOrdinalsDisplayElement.style.display = 'block'; // Ensure the section is visible to show the "0" count
        return;
    }

    titleElement.textContent = `MY PUNK VOYAGE ORDINALS (${ownedInscriptions.length})`;

    const ul = document.createElement('ul');
    ul.style.listStyleType = 'none'; // Remove bullet points
    ul.style.paddingLeft = '0';
    ul.style.textAlign = 'center'; // Center the list items

    ownedInscriptions.forEach(insc => {
        const li = document.createElement('li');
        li.textContent = insc.name; // insc.name already includes '#' from fetchWalletInscriptions
        li.style.fontSize = '0.9em';
        li.style.marginBottom = '3px';
        ul.appendChild(li);
    });
    userOrdinalsListElement.appendChild(ul);
    userOrdinalsDisplayElement.style.display = 'block'; // Make sure the section is visible
}
async function fetchPlayerDungeonCrawlers(userAddress, walletName) {
    if (!dungeonCrawlerIdsLoaded) {
        console.warn("Dungeon Crawler ID list not loaded. Cannot fetch player's crawlers.");
        playerDungeonCrawlers = [];
        return;
    }

    console.log(`Fetching Dungeon Crawlers for ${userAddress} via ${walletName}... (Currently Placeholder)`);
    // This will be similar to fetchWalletInscriptions but will use PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET
    // For now, let's simulate owning a few if the main Punk Voyage collection is used as a stand-in, or add dummy data
    
    playerDungeonCrawlers = []; // Clear previous

    // --- SIMULATION / PLACEHOLDER ---
    // If you want to test with some dummy data:
    // Temporarily add some dummy crawlers if the set is empty for UI testing
    if (PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.size === 0) { // <<< MODIFIED THIS CONDITION FOR TESTING
        console.log("DEV MODE: Adding dummy crawlers for UI testing as actual ID set is empty.");
        playerDungeonCrawlers.push({ 
            id: "dummy_crawler_1i0", 
            uniqueInstanceId: "crawler_dummy1", 
            name: "Test Crawler Alpha", 
            imageUrl: "https://via.placeholder.com/30/FF0000/FFFFFF?Text=C1", 
            attack: 10, 
            defense: 5 
        });
        playerDungeonCrawlers.push({ 
            id: "dummy_crawler_2i0", 
            uniqueInstanceId: "crawler_dummy2", 
            name: "Test Crawler Beta", 
            imageUrl: "https://via.placeholder.com/30/00FF00/FFFFFF?Text=C2", 
            attack: 7, 
            defense: 8 
        });
        playerDungeonCrawlers.push({ 
            id: "dummy_crawler_3i0", 
            uniqueInstanceId: "crawler_dummy3", 
            name: "Test Crawler Gamma", 
            imageUrl: "https://via.placeholder.com/30/0000FF/FFFFFF?Text=C3", 
            attack: 5, 
            defense: 10 
        });
    } else if (PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.size > 0) { 
        let count = 0;
        PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET.forEach(id => {
            if (count < 5) { 
                playerDungeonCrawlers.push({ 
                    id: id, 
                    uniqueInstanceId: `crawler_${id.slice(0,8)}`, 
                    name: `Crawler #${id.slice(0,4)}`, 
                    imageUrl: `https://api.hiro.so/ordinals/v1/inscriptions/${id}/content`, 
                    attack: Math.floor(Math.random() * 10) + 5, 
                    defense: Math.floor(Math.random() * 10) + 5
                });
                count++;
            }
        });
         console.log("Simulated owning Dungeon Crawlers:", playerDungeonCrawlers);
    } else {
        console.log("No Dungeon Crawler IDs defined in PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET. Player will have no crawlers.");
    }
    // --- END SIMULATION ---

    // In the real version, you'd:
    // 1. Fetch all inscriptions from the user's wallet (like in fetchWalletInscriptions)
    // 2. Filter those against PUNK_VOYAGE_DUNGEON_CRAWLER_IDS_SET
    // 3. For each owned crawler, fetch its metadata (name, image, and importantly, its ATK/DEF stats if they are part of the inscription metadata)
    // 4. Populate playerDungeonCrawlers with objects containing { id, uniqueInstanceId, name, imageUrl, attack, defense }
    
    // For now, we assume it's populated (e.g., by the simulation above or if you manually add to playerDungeonCrawlers for testing)
    if (currentUser.uid) { // Save if state changed (e.g. simulated crawlers were added)
        saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
    }
}
// Call this function after wallet connection in updateWalletDisplay if crawler IDs are loaded
            // --- Leaderboard Logic ---
            async function fetchAndDisplayLeaderboards(resourceType = 'pvTokens') {
                if (!db) { console.error("Firestore not initialized for fetching leaderboards."); return; }
                if (!leaderboardDisplayList || !leaderboardCurrentTypeTitle) return;

                leaderboardDisplayList.innerHTML = '<li>Loading...</li>';
                let titleText = 'Leaderboard';
                let scoreClass = '';
                if (resourceType === 'pvTokens') { titleText = 'PV Token Leaders'; scoreClass = 'pv'; }
                else if (resourceType === 'gold') { titleText = 'Gold Leaders'; scoreClass = 'gold'; }
                else if (resourceType === 'diamonds') { titleText = 'Diamond Leaders'; scoreClass = 'diamond'; }
                leaderboardCurrentTypeTitle.textContent = titleText;

                leaderboardFilterButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.resource === resourceType);
                });

                try {
                    const q_leaderboard = query(collection(db, "playerProgress"), orderBy(resourceType, "desc"), limit(50));
                    const querySnapshot = await getDocs(q_leaderboard);
                    
                    leaderboardDisplayList.innerHTML = ''; 
                    let rank = 1;
                    if (querySnapshot.empty) {
                        leaderboardDisplayList.innerHTML = '<li>No players on this leaderboard yet.</li>';
                    }
                    querySnapshot.forEach((docSnap) => {
                        const playerData = docSnap.data();
                        const li = document.createElement('li');
                        li.innerHTML = `<span class="rank">${rank}.</span> <span class="nickname">${playerData.nickname || 'Anonymous'}</span> <span class="score ${scoreClass}">${playerData[resourceType] || 0}</span>`;
                        leaderboardDisplayList.appendChild(li);
                        rank++;
                    });
                } catch (error) {
                    console.error(`Error fetching ${resourceType} leaderboard: `, error);
                    leaderboardDisplayList.innerHTML = `<li>Error loading ${resourceType} leaderboard.</li>`;
                     if (error.message.toLowerCase().includes("index")) { 
                        showCustomPopup(`Leaderboard Error: Firestore index likely missing for '${resourceType}'. Please go to your Firebase console > Firestore Database > Indexes, and create a single-field, descending index for '${resourceType}' on the 'playerProgress' collection.`, "DB Index Error");
                    }
                }
            }
            if (leaderboardFilterButtons) {
                leaderboardFilterButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        fetchAndDisplayLeaderboards(e.target.dataset.resource);
                    });
                });
            }


            // --- Item Upgrade Logic ---
            function updateUpgradeSuccessRateDisplay() {
                if (!upgradeSuccessRateDisplay) return;
                if (!selectedItemForUpgrade || !selectedScrollForUpgrade) {
                    upgradeSuccessRateDisplay.textContent = ""; return;
                }
                
                const itemBaseTier = selectedItemForUpgrade.tier === undefined ? 0 : selectedItemForUpgrade.tier; // Item's intrinsic tier (0-4)
                const scrollTier = selectedScrollForUpgrade.scrollTier; // Scroll's tier (1=Low, 2=Mid, 3=High)
                const itemCurrentLevel = selectedItemForUpgrade.currentLevel || 0; // Item's +X level
                
                let compatibleForLevel = false;
                if (scrollTier === 1 && itemCurrentLevel === 0) compatibleForLevel = true; // Low scroll only for +0 items
                else if (scrollTier === 2 && (itemCurrentLevel >= 0 && itemCurrentLevel <= 2)) compatibleForLevel = true; // Mid scroll for +0, +1, +2 items
                else if (scrollTier === 3 && (itemCurrentLevel >= 0 && itemCurrentLevel <= 4)) compatibleForLevel = true; // High scroll for +0 to +4 items

                if (!compatibleForLevel) { 
                                        if (scrollTier === 1 && itemCurrentLevel > 0) {
                        upgradeSuccessRateDisplay.textContent = `Basic Upgrade Scrolls can only be used on +0 items. This item is +${itemCurrentLevel}.`;
                    } else {
                        upgradeSuccessRateDisplay.textContent = `This scroll (${selectedScrollForUpgrade.name}) is not for upgrading an item at +${itemCurrentLevel}.`; 
                    }
                    return; 
                }
                
                if (itemCurrentLevel >= 5) { upgradeSuccessRateDisplay.textContent = "Item is at max level (+5)."; return; }
                
                let successChance = upgradeChances[itemCurrentLevel]; // Base chance for the item's current level
                let bonusText = "";
                if (scrollTier > itemBaseTier) { // Check if scroll tier is higher than item's base tier
                     // Specific tier conditions for bonus:
                    if ((scrollTier === 2 && itemBaseTier <= 1) || // Mid scroll on Tier 0 or 1 item
                        (scrollTier === 3 && itemBaseTier <= 2)) { // High scroll on Tier 0, 1, or 2 item
                        successChance += 0.10;
                        successChance = Math.min(successChance, 1); 
                        bonusText = " (+10% bonus)";
                    }
                }
                upgradeSuccessRateDisplay.textContent = `Upgrade Success Chance: ${(successChance * 100).toFixed(0)}%${bonusText}`;
            }

            function openItemSelectionModal(purpose) { 
                itemSelectionModalList.innerHTML = '';
                itemSelectionModalOverlay.classList.remove('hidden');
                itemSelectionModal.classList.remove('hidden');

                if (purpose === 'item') {
                    itemSelectionModalTitle.textContent = "Select Item to Upgrade";
                    const equippableItemsInInventory = playerInventory.filter(invItem => {
                        const itemMaster = craftableItemsData.find(ci => ci.id === invItem.id);
                        return itemMaster && itemMaster.type !== "Consumable" && itemMaster.type !== "upgrade_scroll_purchase" && itemMaster.type !== "unlockable_consumable" && (invItem.level || 0) < 5; 
                    });
                    if (equippableItemsInInventory.length === 0) { itemSelectionModalList.innerHTML = "<p>No upgradable items (non-max level) in inventory.</p>"; return; }
                    equippableItemsInInventory.forEach(invItem => {
                        const itemMaster = craftableItemsData.find(ci => ci.id === invItem.id);
                        const btn = document.createElement('button'); btn.classList.add('action-button'); btn.style.width = '100%'; btn.style.marginBottom = '5px'; btn.style.display = 'flex'; btn.style.alignItems = 'center';
                        const levelText = (invItem.level || 0) > 0 ? `(+${invItem.level || 0}) ` : '';
                        const itemTierDisplay = itemMaster.tier === undefined ? 0 : itemMaster.tier;
                        btn.innerHTML = `${getItemIconHTML(itemMaster.iconUrlOrColor, itemMaster.type, '20px')} <span style="margin-left: 5px;">${levelText}${itemMaster.name} (Tier ${itemTierDisplay})</span>`;
                        btn.onclick = () => {
                            selectedItemForUpgrade = { ...itemMaster, ...invItem, uniqueInstanceId: invItem.uniqueInstanceId, currentLevel: invItem.level || 0, tier: itemMaster.tier }; // Ensure tier is passed
                            selectedItemForUpgradeDisplay.innerHTML = `Item: ${getItemIconHTML(selectedItemForUpgrade.iconUrlOrColor, selectedItemForUpgrade.type, '30px')} ${levelText}${selectedItemForUpgrade.name}`;
                            closeItemSelectionModal(); updateUpgradeSuccessRateDisplay();
                        };
                        itemSelectionModalList.appendChild(btn);
                    });
                } else if (purpose === 'scroll') {
                    itemSelectionModalTitle.textContent = "Select Upgrade Scroll Type";
                    let hasScrolls = false;
                    Object.keys(scrollData).forEach(scrollTypeKey => { // Iterate using keys from scrollData
                        const count = playerScrolls[scrollTypeKey] || 0;
                        if (count > 0) hasScrolls = true;
                        const scrollMaster = scrollData[scrollTypeKey];
                        const btn = document.createElement('button'); btn.classList.add('action-button'); btn.style.width = '100%'; btn.style.marginBottom = '5px'; btn.style.display = 'flex'; btn.style.alignItems = 'center';
                        btn.innerHTML = `${getItemIconHTML(scrollMaster.icon, 'S', '20px')} <span style="margin-left: 5px;">${scrollMaster.name} (Count: ${count})</span>`;
                        if (count === 0) btn.disabled = true;
                        btn.onclick = () => {
                            if (count > 0) {
                                selectedScrollForUpgrade = { type: scrollTypeKey, name: scrollMaster.name, scrollTier: scrollMaster.tier, iconUrlOrColor: scrollMaster.icon }; 
                                selectedScrollForUpgradeDisplay.innerHTML = `Scroll: ${getItemIconHTML(selectedScrollForUpgrade.iconUrlOrColor, 'S', '30px')} ${selectedScrollForUpgrade.name}`;
                                closeItemSelectionModal(); updateUpgradeSuccessRateDisplay();
                            }
                        };
                        itemSelectionModalList.appendChild(btn);
                    });
                     if (!hasScrolls) { itemSelectionModalList.innerHTML = "<p>No upgrade scrolls available.</p>";}
                }
            }
            function closeItemSelectionModal() { itemSelectionModalOverlay.classList.add('hidden'); itemSelectionModal.classList.add('hidden'); }
            if (upgradeItemSlot) upgradeItemSlot.addEventListener('click', () => openItemSelectionModal('item'));
            if (upgradeScrollSlot) upgradeScrollSlot.addEventListener('click', () => openItemSelectionModal('scroll'));
            if (itemSelectionModalCloseBtn) itemSelectionModalCloseBtn.addEventListener('click', closeItemSelectionModal);
            if (itemSelectionModalOverlay) itemSelectionModalOverlay.addEventListener('click', (event) => { if(event.target === itemSelectionModalOverlay) closeItemSelectionModal(); });
            let currentDungeonIdForCrawlerSelection = null;
            let tempSelectedCrawlers = []; // Store uniqueInstanceIds of crawlers selected in the modal
                        let confirmedCrawlersForDungeons = {};

            function openDungeonCrawlerSelectionModal(dungeonId) {
                currentDungeonIdForCrawlerSelection = dungeonId;
                const dungeon = dungeonsData.find(d => d.id === dungeonId);
                if (!dungeon || dungeon.type !== "party_npc") {
                    console.error("Invalid dungeon or not a party dungeon for crawler selection:", dungeonId);
                    return;
                }

                tempSelectedCrawlers = []; // Reset temporary selection
                dungeonCrawlerMaxSelectCountSpan.textContent = dungeon.maxPartySize - 1; // Player is 1, rest are crawlers

                availableDungeonCrawlersListDiv.innerHTML = '';
                if (playerDungeonCrawlers.length === 0) {
                    availableDungeonCrawlersListDiv.innerHTML = "<p>You don't own any Dungeon Crawler NFTs.</p>";
                } else {
                    playerDungeonCrawlers.forEach(crawler => {
                        // In the future, you'd also check if this crawler is already busy in another dungeon party
                        const crawlerBtn = document.createElement('button');
                        crawlerBtn.classList.add('crawler-item-btn');
                        crawlerBtn.dataset.crawlerInstanceId = crawler.uniqueInstanceId;
                        // Basic display: Name (ATK/DEF) - You'd style this better
                        crawlerBtn.innerHTML = `
                            <img src="${crawler.imageUrl || 'https://via.placeholder.com/30'}" alt="C" style="width:30px; height:30px; margin-right:8px; border-radius:3px;">
                            ${crawler.name} (ATK: ${crawler.attack || 'N/A'}, DEF: ${crawler.defense || 'N/A'})
                        `;
                        crawlerBtn.onclick = () => toggleCrawlerSelection(crawler, crawlerBtn, dungeon.maxPartySize - 1);
                        availableDungeonCrawlersListDiv.appendChild(crawlerBtn);
                    });
                }

                updateSelectedCrawlersDisplay(); // Clear and update the "Selected Crawlers" display
                dungeonCrawlerSelectionModalOverlay.classList.remove('hidden');
                dungeonCrawlerSelectionModal.classList.remove('hidden');
            }

            function toggleCrawlerSelection(crawler, buttonElement, maxSelect) {
                const index = tempSelectedCrawlers.findIndex(cId => cId === crawler.uniqueInstanceId);
                if (index > -1) { // Already selected, so deselect
                    tempSelectedCrawlers.splice(index, 1);
                    buttonElement.classList.remove('selected-for-dungeon');
                } else { // Not selected, try to select
                    if (tempSelectedCrawlers.length < maxSelect) {
                        tempSelectedCrawlers.push(crawler.uniqueInstanceId);
                        buttonElement.classList.add('selected-for-dungeon');
                    } else {
                        showCustomPopup(`You can select a maximum of ${maxSelect} crawlers for this dungeon.`, "Selection Limit Reached");
                    }
                }
                updateSelectedCrawlersDisplay();
            }

            function updateSelectedCrawlersDisplay() {
                selectedDungeonCrawlersDisplayDiv.innerHTML = '';
                if (tempSelectedCrawlers.length === 0) {
                    selectedDungeonCrawlersDisplayDiv.innerHTML = '<p style="font-size:0.9em; opacity:0.7;">No crawlers selected.</p>';
                    return;
                }
                tempSelectedCrawlers.forEach(crawlerInstanceId => {
                    const crawlerData = playerDungeonCrawlers.find(c => c.uniqueInstanceId === crawlerInstanceId);
                    if (crawlerData) {
                        const tag = document.createElement('span');
                        tag.classList.add('selected-crawler-tag');
                        tag.textContent = `${crawlerData.name}`;
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.classList.add('remove-crawler-btn');
                        removeBtn.innerHTML = ''; // Multiplication sign as an X
                        removeBtn.title = `Remove ${crawlerData.name}`;
                        removeBtn.onclick = (event) => {
                            event.stopPropagation(); // Prevent card click if nested
                            const crawlerButtonInList = availableDungeonCrawlersListDiv.querySelector(`.crawler-item-btn[data-crawler-instance-id="${crawlerInstanceId}"]`);
                            toggleCrawlerSelection(crawlerData, crawlerButtonInList, parseInt(dungeonCrawlerMaxSelectCountSpan.textContent));
                        };
                        tag.appendChild(removeBtn);
                        selectedDungeonCrawlersDisplayDiv.appendChild(tag);
                    }
                });
            }

            function closeDungeonCrawlerSelectionModal() {
                dungeonCrawlerSelectionModalOverlay.classList.add('hidden');
                dungeonCrawlerSelectionModal.classList.add('hidden');
                currentDungeonIdForCrawlerSelection = null;
                tempSelectedCrawlers = [];
            }

            if (dungeonCrawlerConfirmSelectionBtn) {
                dungeonCrawlerConfirmSelectionBtn.addEventListener('click', () => {
                    if (currentDungeonIdForCrawlerSelection) {
                        // Store the confirmed selection for this dungeon
                        confirmedCrawlersForDungeons[currentDungeonIdForCrawlerSelection] = [...tempSelectedCrawlers]; // Store a copy

                        console.log(`Confirmed selection for dungeon ${currentDungeonIdForCrawlerSelection}:`, confirmedCrawlersForDungeons[currentDungeonIdForCrawlerSelection]);
                        
                        // Update the display on the main dungeons page
                        // This will now be handled by the renderDungeonsPage call below,
                        // but keeping the direct update for selectedCrawlersDisplayOnPage is fine too.
                        const selectedCrawlersDisplayOnPage = document.getElementById(`selectedCrawlersDisplay_${currentDungeonIdForCrawlerSelection}`);
                        if (selectedCrawlersDisplayOnPage) {
                            if (confirmedCrawlersForDungeons[currentDungeonIdForCrawlerSelection].length > 0) {
                                const names = confirmedCrawlersForDungeons[currentDungeonIdForCrawlerSelection].map(id => {
                                    const crawler = playerDungeonCrawlers.find(c => c.uniqueInstanceId === id);
                                    return crawler ? crawler.name : 'Unknown';
                                }).join(', ');
                                selectedCrawlersDisplayOnPage.textContent = `Selected: ${names}`;
                            } else {
                                selectedCrawlersDisplayOnPage.textContent = 'No crawlers selected.';
                            }
                        }
                        closeDungeonCrawlerSelectionModal();
                        // +++ ADD THIS LINE TO FORCE RE-RENDER +++
                        if (document.getElementById('dungeons-page') && document.getElementById('dungeons-page').classList.contains('active')) {
                            renderDungeonsPage();
                        }
                        // +++ END OF ADDED LINE +++
                    }
                });
            }
            if (dungeonCrawlerCancelSelectionBtn) {
                dungeonCrawlerCancelSelectionBtn.addEventListener('click', closeDungeonCrawlerSelectionModal);
            }
            if (dungeonCrawlerSelectionModalOverlay) {
                dungeonCrawlerSelectionModalOverlay.addEventListener('click', (event) => {
                    if (event.target === dungeonCrawlerSelectionModalOverlay) closeDungeonCrawlerSelectionModal();
                });
            }

            if (upgradeItemButton) {
                upgradeItemButton.addEventListener('click', () => {
                    if (!currentUser) return;
                    if (!selectedItemForUpgrade || !selectedScrollForUpgrade) { upgradeResultDisplay.textContent = "Please select an item and a scroll."; return; }
                    
                    const itemBaseTier = selectedItemForUpgrade.tier === undefined ? 0 : selectedItemForUpgrade.tier;
                    const scrollTier = selectedScrollForUpgrade.scrollTier;
                    const itemCurrentLevel = selectedItemForUpgrade.currentLevel || 0;

                    let compatibleForLevel = false;
                    if (scrollTier === 1 && itemCurrentLevel === 0) compatibleForLevel = true;
                    else if (scrollTier === 2 && (itemCurrentLevel >= 0 && itemCurrentLevel <= 2)) compatibleForLevel = true;
                    else if (scrollTier === 3 && (itemCurrentLevel >= 0 && itemCurrentLevel <= 4)) compatibleForLevel = true;

                    if (!compatibleForLevel) { 
                        if (scrollTier === 1 && itemCurrentLevel > 0) {
                            upgradeResultDisplay.textContent = `Low Class Scrolls can only be used on +0 items. This item is +${itemCurrentLevel}.`;
                        } else {
                             upgradeResultDisplay.textContent = `This scroll (Tier ${scrollTier}) is not suitable for upgrading an item at +${itemCurrentLevel}.`; 
                        }
                        return; 
                    }
                    
                    if (playerScrolls[selectedScrollForUpgrade.type] <= 0) {
                         upgradeResultDisplay.textContent = `You don't have any ${selectedScrollForUpgrade.name}.`; return;
                    }
                    if (itemCurrentLevel >= 5) { upgradeResultDisplay.textContent = "Item is at max level (+5)."; return; }
                    
                    let successChance = upgradeChances[itemCurrentLevel];
                    if (scrollTier > itemBaseTier) {
                         if ((scrollTier === 2 && itemBaseTier <= 1) || (scrollTier === 3 && itemBaseTier <= 2)) {
                            successChance += 0.10;
                            successChance = Math.min(successChance, 1);
                        }
                    }

                    upgradeResultDisplay.textContent = `Attempting to upgrade ${selectedItemForUpgrade.name} from +${itemCurrentLevel} to +${itemCurrentLevel + 1}. Chance: ${(successChance * 100).toFixed(0)}%...`;
                    upgradeItemButton.disabled = true; 
                    
                    playerScrolls[selectedScrollForUpgrade.type]--; 

                    const originalSlotId = Object.keys(equippedItems).find(slot => equippedItems[slot] === selectedItemForUpgrade.uniqueInstanceId);

                    setTimeout(async () => { 
                        const destroyedItemMasterData = { ...selectedItemForUpgrade }; // Capture for potential re-craft
                        if (Math.random() < successChance) {
                            const itemInvIndex = playerInventory.findIndex(invItem => invItem.uniqueInstanceId === selectedItemForUpgrade.uniqueInstanceId);
                            if (itemInvIndex > -1) {
                                playerInventory[itemInvIndex].level = (playerInventory[itemInvIndex].level || 0) + 1;
                                const updatedItem = playerInventory[itemInvIndex];
                                upgradeResultDisplay.textContent = `SUCCESS! ${selectedItemForUpgrade.name} upgraded to +${updatedItem.level}!`;
                                
                                // Keep item in slot after successful upgrade
                                selectedItemForUpgrade = { ...selectedItemForUpgrade, ...updatedItem, currentLevel: updatedItem.level }; // Update selectedItemForUpgrade with new level
                                const levelText = (updatedItem.level || 0) > 0 ? `(+${updatedItem.level || 0}) ` : '';
                                selectedItemForUpgradeDisplay.innerHTML = `Item: ${getItemIconHTML(selectedItemForUpgrade.iconUrlOrColor, selectedItemForUpgrade.type, '30px')} ${levelText}${selectedItemForUpgrade.name}`;
                                
                                quests.forEach(q => { 
                                    if (q.metric === "itemUpgradedToPlus2" && updatedItem.level >= 2 && !q.completed && !q.claimed) { q.progress = 1; q.completed = true; if(!q.claimed) showCustomPopup(`Quest Completed: ${q.text}`, "Quest Complete!");} 
                                    if (q.metric === "itemUpgradedToPlus3" && updatedItem.level >= 3 && !q.completed && !q.claimed) { q.progress = 1; q.completed = true; if(!q.claimed) showCustomPopup(`Quest Completed: ${q.text}`, "Quest Complete!");} 
                                });
                                if(document.getElementById('quests-page').classList.contains('active')) renderQuests();
                            } else { upgradeResultDisplay.textContent = "Error: Item vanished post-scroll consumption."; }
                        } else {
                            const itemInvIndex = playerInventory.findIndex(invItem => invItem.uniqueInstanceId === selectedItemForUpgrade.uniqueInstanceId);
                            if (itemInvIndex > -1) {
                                if (originalSlotId) { equippedItems[originalSlotId] = null; } 
                                playerInventory.splice(itemInvIndex, 1); 
                                upgradeResultDisplay.textContent = `FAILURE! ${destroyedItemMasterData.name} +${itemCurrentLevel} was destroyed.`;
                                promptToCraftAgain(destroyedItemMasterData, originalSlotId);
                            } else { upgradeResultDisplay.textContent = "Error: Failed item not found for destruction."; }
                            selectedItemForUpgrade = null; // Clear item slot on failure
                            selectedItemForUpgradeDisplay.innerHTML = `Item: None`;
                        }
                        
                        selectedScrollForUpgrade = null; // Always clear scroll slot
                        selectedScrollForUpgradeDisplay.innerHTML = `Scroll: None`;
                        updateUpgradeSuccessRateDisplay(); renderInventory(); renderCraftingItems(); renderMaterials();
                        renderActiveSpecialties();
                        upgradeItemButton.disabled = false;
                        if (currentUser.uid) saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                    }, 1000);
                });
            }


            // --- Final Initializations ---
            initializeTheme(); 
            setInterval(updateTimers, 1000);
            document.querySelectorAll('.adventure-num-select').forEach(select => { select.value = "5"; });
            
            const connectWalletBtn = document.getElementById('connectWalletBtn'); const walletDropdown = document.getElementById('walletDropdown'); const walletOptions = walletDropdown.querySelectorAll('li'); const walletAddressDisplay = document.getElementById('walletAddressDisplay');
            let connectedAccount = null; let connectedWalletName = null;
// --- START OF FULL updateWalletDisplay FUNCTION TO REPLACE ---
// (This will replace your existing function from approx. line 5407 to its end)



function updateWalletDisplay(account, walletName = '') {
    if (account) {
        const shortAddress = `${account.substring(0, 6)}...${account.substring(account.length - 4)}`;
        if (connectWalletBtn) {
            connectWalletBtn.textContent = `${walletName}: ${shortAddress}`;
            connectWalletBtn.classList.add('connected');
        }
        if (walletAddressDisplay) walletAddressDisplay.textContent = `Wallet: ${account}`;

        // Wallet is now connected, so verification is no longer pending from a previous state.
        walletVerificationPendingForBonus = false;

        // Hide any wallet verification related popups that might have been shown
        if (customPopup && !customPopup.classList.contains('hidden') && customPopupTitleEl) {
            const currentPopupTitle = customPopupTitleEl.textContent;
            if (currentPopupTitle === "Wallet Bonus Information" ||
                currentPopupTitle === "Wallet Connection Required" || // Kept for safety from older states
                currentPopupTitle === "Verify Wallet Bonus" ||      // Kept for safety
                currentPopupTitle === "Wallet Verification Needed") {
                hideCustomPopup();
            }
        }

        // Now that wallet is connected and flags are cleared, fetch inscriptions
        if (punkVoyageIdsLoaded && connectedAccount && connectedWalletName) {
            console.log(`DEBUG updateWalletDisplay: punkVoyageIdsLoaded: ${punkVoyageIdsLoaded}, PUNK_VOYAGE_IDS_SET size: ${PUNK_VOYAGE_IDS_SET ? PUNK_VOYAGE_IDS_SET.size : 'undefined'}`);
            fetchWalletInscriptions(connectedAccount, connectedWalletName);
            // fetchWalletInscriptions will update ordinalBonusAdventurers, call recalculateTotalAvailableAdventurers, and save.
            
            // +++ FETCH DUNGEON CRAWLERS +++
            if (dungeonCrawlerIdsLoaded) {
                fetchPlayerDungeonCrawlers(connectedAccount, connectedWalletName);
            } else {
                console.warn("Dungeon Crawler IDs not loaded, skipping fetch for them.");
            }
            // +++ END FETCH DUNGEON CRAWLERS +++
        } else {
            console.warn("Wallet connected, but Punk Voyage IDs not loaded or connectedAccount/Name is an issue. Ordinal check skipped. Bonus will be 0.");
            if (userOrdinalsDisplayElement) {
                 userOrdinalsDisplayElement.style.display = 'block';
                 if(userOrdinalsListElement) userOrdinalsListElement.innerHTML = "<p>Could not check Ordinals: Game's collection ID list not ready.</p>";
            }
            // If we can't check, assume no bonus for safety in this session part
            let previousBonus = ordinalBonusAdventurers;
            ordinalBonusAdventurers = 0;
            if (previousBonus > 0) { // Only recalc if it actually changes
                 recalculateTotalAvailableAdventurers(); // This updates UI
                 if (currentUser && currentUser.uid) { // Save the new 0 bonus state
                    saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
                 }
            }
        }

    } else { // Wallet disconnected or not present
        if (connectWalletBtn) {
            connectWalletBtn.textContent = 'CONNECT WALLET';
            connectWalletBtn.classList.remove('connected');
        }
        if (walletAddressDisplay) walletAddressDisplay.textContent = '';

        if (userOrdinalsDisplayElement) userOrdinalsDisplayElement.style.display = 'none';
        if (userOrdinalsListElement) userOrdinalsListElement.innerHTML = '';

        // If wallet disconnects, the saved bonus might make walletVerificationPendingForBonus = true on next load.
        // For the current session, if wallet disconnects, active bonus is lost.
        if (connectedAccount !== null || connectedWalletName !== null) { // only if there WAS a connection
            let previousBonusBeforeDisconnect = ordinalBonusAdventurers;
            ordinalBonusAdventurers = 0;
            // walletVerificationPendingForBonus will be determined on next app load/login if a bonus was saved
            recalculateTotalAvailableAdventurers();
            if (currentUser && currentUser.uid && previousBonusBeforeDisconnect !== 0) {
                saveGameStateToFirebase(currentUser.uid, getCurrentGameState());
            }
        }
        connectedAccount = null;
        connectedWalletName = null;
    }
}
// --- END OF FULL updateWalletDisplay FUNCTION TO REPLACE ---
            if(connectWalletBtn && walletDropdown) { connectWalletBtn.addEventListener('click', (event) => { event.stopPropagation(); walletDropdown.style.display = walletDropdown.style.display === 'block' ? 'none' : 'block'; }); document.addEventListener('click', (event) => { if (walletDropdown && connectWalletBtn && !connectWalletBtn.contains(event.target) && !walletDropdown.contains(event.target)) { walletDropdown.style.display = 'none'; } }); }
       async function connectWithSatsConnect(walletTypeHint = null) {
        // Check for SatsConnect availability right when the function is called
        if (typeof SatsConnect === 'undefined' || typeof SatsConnect.getAddresses === 'undefined') {
            console.error("SatsConnect object is not available. The library might not have loaded yet or failed to load.");
            showCustomPopup('Sats Connect library is not ready. Please try again in a moment or ensure it is loaded.', "Wallet Error");
            return;
        }

        try {
            SatsConnect.getAddresses({
                payload: {
                    purposes: ['ordinals', 'payment'],
                    message: 'Connect to Punk Voyage Adventures',
                    network: { type: 'Mainnet' },
                },
                onFinish: (response) => {
                    const ordAddress = response.addresses.find(a => a.purpose === 'ordinals');
                    const payAddress = response.addresses.find(a => a.purpose === 'payment');
                    let addr = ordAddress ? ordAddress.address : (payAddress ? payAddress.address : null);
                    if (addr) {
                        connectedAccount = addr;
                        let name = walletTypeHint ? walletTypeHint.replace('satsconnect_', '').toUpperCase() : "BTC";
                        if (name === "GENERAL") name = "BTC";
                        connectedWalletName = name;
                        updateWalletDisplay(connectedAccount, connectedWalletName); // This will trigger fetchWalletInscriptions if conditions are met
                    } else {
                        showCustomPopup('No suitable Bitcoin address found via SatsConnect.', 'Wallet Error');
                    }
                },
                onCancel: () => {
                    console.log('SatsConnect connection canceled by user.');
                },
            });
        } catch (e) {
            console.error('Error during SatsConnect.getAddresses call:', e);
            showCustomPopup(`An error occurred with SatsConnect: ${e.message || 'Unknown error'}`, 'Wallet Error');
        }
    }         
    async function connectUnisat() {
    try {
        if (typeof window.unisat !== 'undefined') {
            const accounts = await window.unisat.requestAccounts();
            if (accounts && accounts.length > 0) {
                connectedAccount = accounts[0];
                connectedWalletName = 'UniSat';
                updateWalletDisplay(connectedAccount, 'UniSat');
                // ADD THIS LINE:
                if (punkVoyageIdsLoaded) fetchWalletInscriptions(connectedAccount, connectedWalletName);
                                if (dungeonCrawlerIdsLoaded && connectedAccount) fetchPlayerDungeonCrawlers(connectedAccount, connectedWalletName);


                window.unisat.on('accountsChanged', (newAccs) => {
                    if (connectedWalletName === 'UniSat') {
                        connectedAccount = (newAccs && newAccs.length > 0) ? newAccs[0] : null;
                        if (!connectedAccount) connectedWalletName = null;
                        updateWalletDisplay(connectedAccount, connectedAccount ? 'UniSat' : '');
                        // ADD THIS LINE (for account changes):
                        if (punkVoyageIdsLoaded && connectedAccount) fetchWalletInscriptions(connectedAccount, connectedWalletName);
                                                if (dungeonCrawlerIdsLoaded && connectedAccount) fetchPlayerDungeonCrawlers(connectedAccount, connectedWalletName);

                        else if (userOrdinalsDisplayElement) userOrdinalsDisplayElement.style.display = 'none'; // Hide if no account
                    }
                });
            }
        } else {
            window.open('https://unisat.io/', '_blank');
        }
    } catch (e) {
        console.error('UniSat error:', e);
        showCustomPopup('An error occurred with UniSat Wallet.', 'Wallet Error');
    }
}
if (walletOptions) {
    walletOptions.forEach(option => {
        option.addEventListener('click', async (event) => {
            const walletType = event.target.dataset.wallet;
            if(walletDropdown) walletDropdown.style.display = 'none';
            connectedAccount = null;
            connectedWalletName = null;
            updateWalletDisplay(null);

            if (walletType === 'unisat') {
                await connectUnisat();
            } else if (walletType === 'xverse_provider') { // <<< ADD THIS ELSE IF BLOCK
                await connectXverseProvider();
            } else if (walletType && walletType.startsWith('satsconnect_')) {
                // This will now handle 'satsconnect_magiceden' and 'satsconnect_general'
                // and any other 'satsconnect_whatever' you might add.
                // The original 'satsconnect_xverse' is effectively replaced by 'xverse_provider'
                // unless you kept/added another list item for it.
                const satsConnectHint = walletType.substring('satsconnect_'.length);
                await connectWithSatsConnect(satsConnectHint);
            }
        });
    });
}
            async function connectXverseProvider() {
    let xverseBitcoinProvider; // Specific variable for Xverse provider
    if (typeof window !== "undefined") {
        const anyWindow = window; // Use 'any' to access potentially non-standard window properties
        if (anyWindow?.XverseProviders?.BitcoinProvider) {
            xverseBitcoinProvider = anyWindow.XverseProviders.BitcoinProvider;
        }
    }

    if (!xverseBitcoinProvider) {
        showCustomPopup('Xverse Wallet provider not found. Please ensure Xverse Wallet is installed and enabled.', "Wallet Error");
        // Consider adding a link to Xverse website: window.open('https://www.xverse.app/', '_blank');
        return;
    }

    try {
        // Using 'wallet_connect' as per your snippet
        const response = await xverseBitcoinProvider.request('wallet_connect', { addresses: ['ordinals', 'payment'] });

        if (response.error) {
            console.error('Xverse connection error in response:', response.error);
            showCustomPopup(response.error.message || 'Xverse connection failed.', 'Wallet Error');
            return;
        }

        // Processing the response as per your snippet
        if (response.result && response.result.addresses && response.result.addresses.length > 0) {
            const addresses = response.result.addresses
                .filter(address => address.addressType !== "stacks"); // Filter out Stacks addresses as per your snippet

            const ordAddressInfo = addresses.find(a => a.purpose === 'ordinals');
            const payAddressInfo = addresses.find(a => a.purpose === 'payment');

            let addrToUse = null;
            // Prioritize ordinals address if available
            if (ordAddressInfo) {
                addrToUse = ordAddressInfo.address;
            } else if (payAddressInfo) {
                addrToUse = payAddressInfo.address;
            }
            
            if (addrToUse) {
                connectedAccount = addrToUse;
                connectedWalletName = 'Xverse'; // Set wallet name
                updateWalletDisplay(connectedAccount, connectedWalletName);
                  if (punkVoyageIdsLoaded) fetchWalletInscriptions(connectedAccount, connectedWalletName);
                                  if (dungeonCrawlerIdsLoaded && connectedAccount) fetchPlayerDungeonCrawlers(connectedAccount, connectedWalletName);

                // You might want to check Xverse documentation for an 'accountsChanged' event
                // to handle account switches in the wallet, similar to UniSat.
            } else {
                showCustomPopup('Could not retrieve a suitable Bitcoin address from Xverse Wallet.', 'Wallet Error');
            }
        } else {
            showCustomPopup('No suitable addresses returned from Xverse Wallet.', 'Wallet Error');
        }

    } catch (e) { // Catch errors from the provider.request call itself or other issues
        console.error('Xverse Wallet connection exception:', e);
        let errorMessage = 'An error occurred with Xverse Wallet.';
        if (e && e.message) {
            errorMessage = e.message;
        } else if (typeof e === 'string') {
            errorMessage = e; // Some providers might throw string errors
        }
        showCustomPopup(errorMessage, 'Wallet Error');
    }
}
            const toggleMaterialsBtn = document.getElementById('toggleMaterialsBtn');
            if (toggleMaterialsBtn && materialsListContainer) {
                // Check local storage for saved state
                const isMaterialsHidden = localStorage.getItem('materialsHidden') === 'true';
                if (isMaterialsHidden) {
                    materialsListContainer.classList.add('hidden');
                    toggleMaterialsBtn.textContent = 'Show';
                }

                toggleMaterialsBtn.addEventListener('click', () => {
                    materialsListContainer.classList.toggle('hidden');
                    if (materialsListContainer.classList.contains('hidden')) {
                        toggleMaterialsBtn.textContent = 'Show';
                        localStorage.setItem('materialsHidden', 'true');
                    } else {
                        toggleMaterialsBtn.textContent = 'Hide';
                        localStorage.setItem('materialsHidden', 'false');
                        
                    }
                });
            }
             if (toggleSpecialtiesBtn && specialtiesListContainer) {
            const isSpecialtiesHidden = localStorage.getItem('specialtiesHidden') === 'true';
            if (isSpecialtiesHidden) {
                specialtiesListContainer.classList.add('hidden');
                toggleSpecialtiesBtn.textContent = 'Show';
            } else {
                 // Ensure it's visible by default if not explicitly hidden
                specialtiesListContainer.classList.remove('hidden');
                toggleSpecialtiesBtn.textContent = 'Hide';
            }

            toggleSpecialtiesBtn.addEventListener('click', () => {
                specialtiesListContainer.classList.toggle('hidden');
                if (specialtiesListContainer.classList.contains('hidden')) {
                    toggleSpecialtiesBtn.textContent = 'Show';
                    localStorage.setItem('specialtiesHidden', 'true');
                } else {
                    toggleSpecialtiesBtn.textContent = 'Hide';
                    localStorage.setItem('specialtiesHidden', 'false');
                }
            });
        }
        }); // End of 'firebaseReady' event listener
    </script>
</body>
</html>