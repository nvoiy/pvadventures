<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punk Voyage Adventures</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@sats-connect/core@latest/dist/bundles/sats-connect.js"></script>
    <style>
        :root {
            --body-bg-image-url: url('https://beige-managing-snail-510.mypinata.cloud/ipfs/bafybeigsu7ak3jbbia6w66slcz2rnk6b6ysundurmgz5etoq6xh23vsbpm');
            --border-color: #000000;
            --text-color: #000000;
            --label-color: #333333; 
            --header-text-color: #333333;
            --game-container-bg: rgba(255, 255, 255, 0.9); 
            --section-bg: rgba(255, 255, 255, 0.8);
            --adventure-block-bg: rgba(255, 255, 255, 0.75);
            --button-bg: #E0E0E0;
            --button-text-color: #000000;
            --button-border: #000000;
            --dropdown-bg: #FFFFFF;
            --twitter-feed-bg: rgba(255, 255, 255, 0.7);
            --highlight-color-pv: #00FF00; 
            --highlight-color-gold: #FFFF00;
            --highlight-color-danger: #FF0000; 
            --highlight-color-connected: #4CAF50;
            --orange-label: #FFA500; 
            --base-font-size: 18px;
            --item-placeholder-boots: #8B4513; --item-placeholder-amulet: #FFD700; 
            --item-placeholder-rucksack: #A9A9A9; --item-placeholder-trinket: #ADD8E6;
            --item-placeholder-armour: #C0C0C0; --item-placeholder-helmet: #A9A9A9;
            --item-placeholder-ring: #B8860B; --item-placeholder-weapon: #778899;
            --item-placeholder-potion2: #90EE90; 
            --item-placeholder-potion3: #FFB6C1;
            /* Removed --welcome-screen-bg-image-url as image is now an element */
        }

        body {
            font-family: 'VT323', monospace;
            background-image: var(--body-bg-image-url); 
            background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed; 
            color: var(--text-color); 
            margin: 0; font-size: var(--base-font-size); 
            display: flex; flex-direction: column; 
            align-items: center; min-height: 100vh; box-sizing: border-box; 
            transition: color 0.3s, background-color 0.3s;
        }

        body.dark-mode {
            --border-color: #777777; 
            --text-color: #FFFFFF;
            --label-color: var(--orange-label); 
            --header-text-color: var(--orange-label); 
            --game-container-bg: rgba(20, 20, 20, 0.9); 
            --section-bg: rgba(30, 30, 30, 0.85);
            --adventure-block-bg: rgba(40, 40, 40, 0.8);
            --button-bg: #444444;
            --button-text-color: #FFFFFF;
            --button-border: #666666;
            --dropdown-bg: #333333;
            --twitter-feed-bg: rgba(25, 25, 25, 0.7);
        }
        
        #welcomeScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /* Background image removed from here, image is now an element */
            background-color: var(--game-container-bg); /* Adapts with theme */
            display: flex; 
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; text-align: center; padding: 20px; box-sizing: border-box;
            overflow-y: auto; /* In case content is too tall on small screens */
        }
        #welcomeImageLarge {
            display: block;
            margin: 0 auto 30px auto; /* Center and add space below */
            max-width: 85%; /* Responsive width */
            max-height: 65vh; /* Responsive height, prevents excessive tallness */
            object-fit: contain; /* Show whole image without cropping */
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        #nicknameInputContainer {
            background-color: var(--section-bg); 
            padding: 30px 40px;
            border-radius: 10px;
            border: 2px solid var(--border-color); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: background-color 0.3s, border-color 0.3s;
            z-index: 1001; 
        }
        #nicknameInputContainer label {
            display: block; margin-bottom: 15px; font-size: 1.8em;
            color: var(--label-color); 
            font-weight: bold;
            transition: color 0.3s;
        }
        body.dark-mode #nicknameInputContainer label { 
             color: var(--orange-label);
        }
        #nicknameInputContainer div { display: flex; align-items: center; justify-content: center; } 
        #nicknameInput {
            font-family: 'VT323', monospace; font-size: 1.5em; padding: 12px;
            border: 2px solid var(--border-color); 
            background-color: var(--dropdown-bg); 
            color: var(--text-color); 
            border-radius: 5px; margin-right: 15px; width: 300px; text-align: center;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        #enterGameButton {
            font-family: 'VT323', monospace; font-size: 1.5em; padding: 12px 25px; cursor: pointer;
            background-color: var(--highlight-color-connected); 
            color: #FFFFFF; 
            border: 2px solid #3c8c3c; 
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #enterGameButton:hover { background-color: #3e8e41; }
        .hidden { display: none !important; }

        /* Custom Popup Styles */
        #customPopupOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: flex; 
            justify-content: center;
            align-items: center;
        }
        #customPopup {
            position: fixed; 
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--section-bg);
            border: 3px solid var(--border-color);
            padding: 25px;
            border-radius: 10px;
            z-index: 2001;
            text-align: center;
            min-width: 350px;
            max-width: 90%; 
            width: auto; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            font-family: 'VT323', monospace;
            color: var(--text-color);
            box-sizing: border-box;
        }
        #customPopupTitle {
            font-size: 1.8em;
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--label-color); 
        }
        #customPopupMessage {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.6;
            white-space: pre-wrap; 
            text-align: left; /* For better readability of lists */
        }
        #customPopupCloseBtn {
            font-size: 1.2em;
            padding: 10px 20px;
            min-width: 100px;
        }


        .game-container { width: 95%; max-width: 1600px; margin: 20px auto; border: 3px solid var(--border-color); padding: 15px; background-color: var(--game-container-bg); box-shadow: 0px 0px 15px rgba(0,0,0,0.5); box-sizing: border-box; display: flex; flex-direction: column; transition: background-color 0.3s, border-color 0.3s; }
        header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); margin-bottom: 15px; width: 100%; transition: border-color 0.3s; }
        header h1 { font-size: 2.5em; margin: 0; letter-spacing: 2px; color: var(--header-text-color); transition: color 0.3s;}
        .header-controls { display: flex; align-items: center; gap: 20px; }
        .player-info-wallet { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
        .player-stats { text-align: right; font-size: 1em; } .player-stats .pv { color: var(--highlight-color-pv); font-weight: bold; } .player-stats .gold { color: var(--highlight-color-gold); font-weight: bold; } .player-stats .wallet-address { font-size: 0.9em; color: var(--highlight-color-connected); word-break: break-all; }
        .wallet-connector { position: relative; }
        .connect-wallet-btn, .menu-button, .social-btn-link button, .adventure-send-btn, .action-button, .craft-button, .equip-btn, .unequip-btn { background-color: var(--button-bg); border: 2px solid var(--button-border); padding: 6px 12px; color: var(--button-text-color); cursor: pointer; font-family: 'VT323', monospace; font-size: 1em; text-align: center; transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
        .connect-wallet-btn, .menu-button { min-width: 160px; }
        body:not(.dark-mode) .connect-wallet-btn:hover, body:not(.dark-mode) .menu-button:hover, body:not(.dark-mode) .social-btn-link button:hover, body:not(.dark-mode) .adventure-send-btn:hover, body:not(.dark-mode) .action-button:hover, body:not(.dark-mode) .craft-button:hover, body:not(.dark-mode) .equip-btn:hover, body:not(.dark-mode) .unequip-btn:hover { background-color: #cccccc; }
        body.dark-mode .connect-wallet-btn:hover, body.dark-mode .menu-button:hover, body.dark-mode .social-btn-link button:hover, body.dark-mode .adventure-send-btn:hover, body.dark-mode .action-button:hover, body.dark-mode .craft-button:hover, body.dark-mode .equip-btn:hover, body.dark-mode .unequip-btn:hover { background-color: #555555;}
        .connect-wallet-btn.connected { background-color: var(--highlight-color-connected); color: white; border-color: var(--highlight-color-connected); }
        .wallet-dropdown { display: none; position: absolute; top: 100%; right: 0; background-color: var(--dropdown-bg); color: var(--text-color); border: 2px solid var(--border-color); list-style: none; padding: 0; margin: 5px 0 0 0; width: 100%; z-index: 10; box-shadow: 0px 3px 7px rgba(0,0,0,0.2); transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
        .wallet-dropdown li { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid var(--border-color); text-align: center; transition: background-color 0.3s, border-color 0.3s; } .wallet-dropdown li:last-child { border-bottom: none; }
        body:not(.dark-mode) .wallet-dropdown li:hover { background-color: #f0f0f0; } body.dark-mode .wallet-dropdown li:hover { background-color: #4a4a4a; }
        .main-content { display: flex; gap: 20px; width: 100%; flex-grow: 1; }
        .left-sidebar { width: 300px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0; }
        .twitter-feed-container { border: 2px solid var(--border-color); padding: 10px; background-color: var(--twitter-feed-bg); height: 400px; min-height: 300px; overflow-y: auto; display: flex; flex-direction: column; transition: background-color 0.3s, border-color 0.3s; }
        .twitter-feed-container .twitter-timeline { width: 100% !important; }
        #availableAdventurersDisplay, .socials-nav, .materials-display { border: 2px solid var(--border-color); padding: 10px; background-color: var(--section-bg); transition: background-color 0.3s, border-color 0.3s; }
        #availableAdventurersDisplay { text-align:center; font-size: 1.2em; margin-top: 10px;}
        .socials-nav .social-title, .adventure-controls label, .page-title, .materials-display h4, .adventures-label, #activeAdventuresDisplay_page h3, 
        .equipment-slots-container h4, #inventory-page > h4, .shop-section-wrapper h3, .crafting-section-wrapper h3 { 
            color: var(--label-color); font-weight: bold; transition: color 0.3s; 
        }
        .socials-nav .social-title { font-size: 1.2em; } .materials-display h4 {font-size: 1.2em; margin-top:0; margin-bottom: 8px;} .materials-display ul { list-style: none; padding: 0; margin: 5px 0 0 0; font-size: 1em; } .materials-display li { margin-bottom: 3px; }
        .socials-nav .social-buttons { display: flex; justify-content: space-around; } .social-btn-link { text-decoration: none; width: 45%; } .social-btn-link button { width: 100%; min-width: auto; padding: 5px;}
        .main-content-area { flex-grow: 1; display: flex; }
        .page-content { display: none; width: 100%; flex-direction: column; padding: 0 15px; box-sizing: border-box; overflow-y: auto; flex-grow: 1;} .page-content.active { display: flex; }
        #adventures-page { flex-direction: row; align-items: flex-start; gap: 25px; padding:0; }
        .player-character-area { flex-shrink: 0; margin-top: 15px; } .player-character { width: 90px; height: 90px; background-image: url('https://beige-managing-snail-510.mypinata.cloud/ipfs/bafkreige4cba5c3bwwknrhupt3upkz5he7orgz2m7ygilbqmhmb2bsmd5q'); background-size: contain; background-position: center; background-repeat: no-repeat; }
        .adventure-section-wrapper { display: flex; flex-direction: column; flex-grow: 1; align-items: center; } .adventures-label { font-size: 2em; margin-bottom: 20px; text-align: center; width: 100%; }
        .adventure-locations { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .adventure { display: flex; align-items: center; gap: 20px; width: 100%; max-width: 800px; background-color: var(--adventure-block-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); box-sizing: border-box; transition: background-color 0.3s, border-color 0.3s; position: relative; }
        .adventure-icon { width: 150px; height: 150px; border: 2px solid var(--border-color); background-size: cover; background-position: center; background-repeat: no-repeat; flex-shrink: 0; border-radius: 5px; transition: border-color 0.3s; }
        .adventure-icon.tree { background-image: url('https://beige-managing-snail-510.mypinata.cloud/ipfs/bafybeiblzgkncylseo57qr7kyhsxdgb3bq2aghcmj6gdf2ihhagpxp3uoy/adventure1.png'); } .adventure-icon.mountain { background-image: url('https://beige-managing-snail-510.mypinata.cloud/ipfs/bafybeiblzgkncylseo57qr7kyhsxdgb3bq2aghcmj6gdf2ihhagpxp3uoy/adventure2.png'); } .adventure-icon.fire-fields { background-image: url('https://beige-managing-snail-510.mypinata.cloud/ipfs/bafybeiblzgkncylseo57qr7kyhsxdgb3bq2aghcmj6gdf2ihhagpxp3uoy/adventure3.png'); }
        .adventure-main-info { flex-grow: 1; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; } 
        .adventure-content { display: flex; flex-direction: column; gap: 10px; } 
        .adventure-details { font-size: 1.1em; line-height: 1.5; } 
        .adventure-details .prize { color: var(--highlight-color-pv); font-weight: bold; } 
        .adventure-details .chance-gold { color: var(--highlight-color-gold); font-weight: bold; } 
        .adventure-controls { display: flex; align-items: center; gap: 12px; margin-top: 10px; } 
        .adventure-controls label { font-size: 1.1em; } 
        .adventure-num-select { font-family: 'VT323', monospace; font-size: 1em; padding: 4px; border: 2px solid var(--border-color); background-color: var(--dropdown-bg); color: var(--text-color); min-width: 40px; transition: background-color 0.3s, border-color 0.3s, color 0.3s; } 
        .adventure-send-btn { padding: 6px 10px; font-size: 1em; } 
        .adventure-send-btn.active-adv1 { background-color: var(--highlight-color-pv); color: black;} 
        .adventure-send-btn.active-adv2 { background-color: var(--highlight-color-gold); color: black;} 
        .adventure-send-btn.active-adv3 { background-color: var(--highlight-color-danger); color: white;}
        
        .adventure-drops-area { position: relative; align-self: flex-start; min-height: 100px; } 
        .adventure-drops-button { font-size: 1em; padding: 4px 10px; } 
        .drops-popover { 
            display: none; 
            position: absolute; 
            top: calc(100% + 5px); 
            left: 50%; 
            transform: translateX(-50%); 
            background-color: var(--section-bg); 
            border: 1px solid var(--border-color); 
            padding: 10px; 
            border-radius: 5px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
            z-index: 20; 
            width: 220px; 
            min-width: 180px;
            font-size: 1em; 
            text-align: left;
            transition: background-color 0.3s, border-color 0.3s; 
        } 
        .drops-popover h5 { margin: 0 0 5px 0; color: var(--label-color); transition: color 0.3s;} 
        .drops-popover ul { list-style: none; padding: 0; margin: 0; } 
        .drops-popover li { margin-bottom: 3px; }
        
        #active-adventures-page .active-adventures-container { margin-top: 0; width:100%; max-width:none; padding: 10px; border: none; background-color: transparent; box-shadow:none; }
        #active-adventures-page .active-adventures-container h3 { font-size: 1.6em; text-align:left; margin-bottom:10px;}
        #active-adventures-page .active-adventure-item { font-size:1em; padding:10px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 8px;}
        #active-adventures-page .active-adventure-item p { margin: 4px 0; font-size: 1.1em; line-height: 1.6; }
        
        .right-sidebar-menu { width: 300px; flex-shrink: 0; display: flex; flex-direction: column; gap: 0; border: 2px solid var(--border-color); background-color: var(--section-bg); padding: 10px; box-sizing: border-box; transition: background-color 0.3s, border-color 0.3s; }
        .right-sidebar-menu .menu-button-container-fixed { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .right-sidebar-menu .menu-button { min-width: auto; width: 85%; padding: 10px 15px; font-size: 1.4em; }
        .sidebar-content-area { flex-grow: 1; overflow-y: auto; }
        .main-menu-nav-list { list-style: none; padding: 0; margin: 0; }
        .main-menu-nav-list li { padding: 12px 8px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: border-color 0.3s, background-color 0.3s; font-size: 1.25em; text-align: center; }
        .main-menu-nav-list li:last-child { border-bottom: none; } body:not(.dark-mode) .main-menu-nav-list li:hover { background-color: #f0f0f0; } body.dark-mode .main-menu-nav-list li:hover { background-color: #4a4a4a; }
        
        .sidebar-active-adventures-container { padding-top: 10px; } 
        .sidebar-active-adventures-container h3 { font-size: 1.3em; text-align: center; margin-bottom: 10px; color: var(--label-color); }
        .sidebar-active-adventures-container .active-adventure-item { font-size: 0.95em; padding: 8px; margin-bottom: 8px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 4px; }
        .sidebar-active-adventures-container .active-adventure-item p { margin: 3px 0; }

        .active-potions-display { padding-top: 15px; margin-top: 15px; border-top: 1px solid var(--border-color); }
        .active-potions-display h4 { font-size: 1.3em; text-align: center; margin-bottom: 10px; color: var(--label-color); }
        .active-potions-display .potion-item { font-size: 0.95em; padding: 8px; margin-bottom: 8px; background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); border-radius: 4px; }
        .active-potions-display .potion-item p { margin: 3px 0; }

        .dark-mode-switch { display: flex; align-items: center; gap: 8px; } .dark-mode-switch label { font-size: 1em; color: var(--text-color); cursor: pointer; transition: color 0.3s; } .switch { position: relative; display: inline-block; width: 50px; height: 24px; } .switch input { opacity: 0; width: 0; height: 0; } .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; } .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; } input:checked + .slider { background-color: var(--highlight-color-connected); } input:focus + .slider { box-shadow: 0 0 1px var(--highlight-color-connected); } input:checked + .slider:before { transform: translateX(26px); }
        .page-title { font-size: 2.2em; margin-bottom: 25px; text-align:center; width:100%; }
        #shop-page { align-items: center; } .shop-section-wrapper, .crafting-section-wrapper { width: 100%; max-width: 800px; margin-bottom:30px;} .shop-section-wrapper h3, .crafting-section-wrapper h3 { font-size: 1.8em; text-align: center; margin-bottom: 20px; }
        .quest-list, .shop-items, .crafting-items-container, .inventory-items-container { display: flex; flex-direction: column; gap: 18px; width:100%; max-width:800px; margin:0 auto; }
        .quest-item, .shop-item, .craftable-item-card, .inventory-item-card { background-color: var(--adventure-block-bg); border: 1px solid var(--border-color); padding: 18px; border-radius: 8px; display: flex; align-items: center; transition: background-color 0.3s, border-color 0.3s; gap: 15px; }
        .quest-item p, .shop-item p, .craftable-item-card p, .inventory-item-card p { font-size: 1.05em; margin:3px 0; }
        .quest-item .quest-reward, .shop-item .shop-price, .craftable-item-card .crafting-cost, .inventory-item-card .item-type { margin-left: auto; white-space: nowrap; text-align: right; }
        .shop-item .shop-price { color: var(--highlight-color-pv); } .action-button { padding: 6px 12px; font-size: 0.9em; } .help-content p { font-size: 1.05em; margin-bottom: 10px; line-height: 1.6; }
        .item-icon-placeholder { width: 45px; height: 45px; border: 1px solid var(--border-color); border-radius: 4px; margin-right: 10px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 0.7em; background-color: #555; color: white; }
        .craftable-item-card .item-info, .inventory-item-card .item-info { flex-grow: 1; }
        .crafting-cost small, .item-perk small { display: block; font-size: 0.9em; opacity: 0.8; }
        .equip-btn, .unequip-btn { font-size: 0.9em; padding: 4px 8px; margin-left: 5px; }
        .inventory-item-card .equipped-status { font-size: 0.9em; color: var(--highlight-color-connected); margin-left: 10px; }
        .equipment-slots-container { margin-bottom: 30px; padding: 15px; border: 1px dashed var(--border-color); border-radius: 5px; width: 100%; max-width: 800px; box-sizing: border-box; margin-left:auto; margin-right:auto; }
        .equipment-slots-container h4 { margin-top: 0; margin-bottom: 15px; text-align: center; color: var(--label-color); font-size: 1.8em; }
        .equipment-slots { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 12px; }
        .equipment-slot { border: 1px solid var(--border-color); background-color: var(--adventure-block-bg); padding: 10px; border-radius: 4px; text-align: center; min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: background-color 0.3s, border-color 0.3s; }
        .equipment-slot .slot-name { font-size: 1em; margin-bottom: 8px; color: var(--label-color); font-weight:normal; }
        .equipment-slot .item-icon-placeholder { margin-bottom: 5px; width: 40px; height: 40px; font-size: 0.7em; }
        .equipment-slot .equipped-item-name { font-size: 0.95em; font-weight: bold; margin-bottom: 5px; }
        .equipment-slot .empty-slot-text { font-size: 0.9em; opacity: 0.7; }
        #inventory-page > h4 { font-size: 1.8em; color: var(--label-color); margin-top: 25px; margin-bottom: 15px; text-align: center; width: 100%; max-width: 800px; margin-left:auto; margin-right:auto; }
        #daily-rewards-page .rewards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        #daily-rewards-page .reward-day { border: 1px solid var(--border-color); background-color: var(--adventure-block-bg); padding: 10px; border-radius: 5px; text-align: center; }
        #daily-rewards-page .reward-day h5 { margin: 0 0 5px 0; color: var(--label-color); }
        #daily-rewards-page .reward-day p { margin: 0; font-size: 0.9em; }
        #daily-rewards-page .reward-day button { margin-top: 8px; }
    </style>
</head>
<body>
    <div id="welcomeScreen">
        <img id="welcomeImageLarge" src="https://beige-managing-snail-510.mypinata.cloud/ipfs/bafybeiblrc356d6jb72bgbxmo475c7si4ae5gmugw3nlb2citjiz4jzibm" alt="Punk Voyage Adventures Welcome">
        <div id="nicknameInputContainer">
            <label for="nicknameInput">Enter Your Nickname:</label>
            <div>
                <input type="text" id="nicknameInput" maxlength="20" placeholder="Voyager Name">
                <button id="enterGameButton">Enter Voyage</button>
            </div>
        </div>
    </div>
    <div class="game-container hidden" id="gameContainer">
        <header> <h1>PUNK VOYAGE ADVENTURES</h1> <div class="header-controls"> <div class="player-info-wallet"> <div class="player-stats" id="playerStats"> PLAYER <span id="playerNicknameDisplay">Voyager</span>, WELCOME<br> <span class="pv">PV = <span id="pvCount">0</span></span> , <span class="gold">GOLD = <span id="goldCount">0</span></span> <div class="wallet-address" id="walletAddressDisplay"></div> </div> <div class="wallet-connector"><button class="connect-wallet-btn" id="connectWalletBtn">CONNECT WALLET</button><ul class="wallet-dropdown" id="walletDropdown"><li data-wallet="satsconnect_xverse">XVERSE</li><li data-wallet="unisat">UNISAT</li><li data-wallet="satsconnect_magiceden">MAGIC EDEN</li><li data-wallet="satsconnect_general">ANY BTC WALLET</li></ul></div> </div> <div class="dark-mode-switch"> <label for="darkModeToggle">Dark Mode</label> <label class="switch"> <input type="checkbox" id="darkModeToggle"> <span class="slider"></span> </label> </div> </div> </header>
        <main class="main-content">
            <aside class="left-sidebar"> <div class="twitter-feed-container" id="twitter-widget-container"> <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/nvart_?ref_src=twsrc%5Etfw">Tweets by nvart_</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> </div> <div id="availableAdventurersDisplay"> Available Adventurers: <span id="availableAdventurersCount">5</span> </div> <div class="materials-display" id="materialsDisplay"> <h4>MY MATERIALS</h4> <ul id="materialsList"></ul> </div> <nav class="socials-nav"> <div class="social-title">SOCIALS</div> <div class="social-buttons"> <a href="https://x.com/nvart_" target="_blank" class="social-btn-link"><button>X</button></a> <a href="https://discord.com/invite/4CEtXAFf3x" target="_blank" class="social-btn-link"><button>DISCORD</button></a> </div> </nav> </aside>
            <div class="main-content-area">
                <section id="adventures-page" class="page-content active"> <div class="player-character-area"> <div class="player-character" aria-label="Player Character Image"></div> </div> <div class="adventure-section-wrapper"> <h2 class="adventures-label">ADVENTURES</h2> <div class="adventure-locations"> <div class="adventure" id="adventure-1-block"> <div class="adventure-icon tree"></div> <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 1, SPIRIT FOREST<br> ADVENTURE TIME = 4 HOURS<br> <span class="prize">PRIZE = 25 PV TOKENS</span> </div> <div class="adventure-controls"> <label for="num-adventurers-1">ADVENTURERS:</label> <select id="num-adventurers-1" class="adventure-num-select"> <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option> </select> <button class="adventure-send-btn active-adv1" data-adventure-id="1" data-adventure-name="Spirit Forest" data-duration-hours="4" data-pv-reward="25" data-gold-chance="0">SEND</button> </div> </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="1">DROPS</button> <div class="drops-popover" id="drops-popover-1"></div>  </div> </div> </div> <div class="adventure" id="adventure-2-block"> <div class="adventure-icon mountain"></div> <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 2, MOUNTAIN OF THE MAROWAN<br> ADVENTURE TIME = 8 HOURS<br> <span class="prize">PRIZE = 40 PV TOKENS</span> </div> <div class="adventure-controls"> <label for="num-adventurers-2">ADVENTURERS:</label> <select id="num-adventurers-2" class="adventure-num-select"> <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option> </select> <button class="adventure-send-btn active-adv2" data-adventure-id="2" data-adventure-name="Mountain of the Marowan" data-duration-hours="8" data-pv-reward="40" data-gold-chance="0">SEND</button> </div> </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="2">DROPS</button> <div class="drops-popover" id="drops-popover-2"></div>  </div> </div> </div> <div class="adventure" id="adventure-3-block"> <div class="adventure-icon fire-fields"></div> <div class="adventure-main-info"> <div class="adventure-content"> <div class="adventure-details"> ADVENTURE 3, FIRE FIELDS OF FLYINALS<br> ADVENTURE TIME = 24 HOURS<br> <span class="prize">PRIZE = 100 PV TOKENS</span><br> <span class="chance-gold">%1 CHANCE OF GOLD</span> </div> <div class="adventure-controls"> <label for="num-adventurers-3">ADVENTURERS:</label> <select id="num-adventurers-3" class="adventure-num-select"> <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5" selected>5</option> </select> <button class="adventure-send-btn active-adv3" data-adventure-id="3" data-adventure-name="Fire Fields of Flyinals" data-duration-hours="24" data-pv-reward="100" data-gold-chance="0.01">SEND</button> </div> </div> <div class="adventure-drops-area"> <button class="adventure-drops-button" data-adventure-id="3">DROPS</button> <div class="drops-popover" id="drops-popover-3"></div>  </div> </div> </div> </div> </div> </section>
                <section id="quests-page" class="page-content"> <h2 class="page-title">QUESTS</h2> <div class="quest-list" id="questList"> </div> </section>
                <section id="daily-rewards-page" class="page-content"> <h2 class="page-title">DAILY LOGIN REWARDS</h2> <div class="rewards-grid" id="dailyRewardsGrid"> </div> </section>
                <section id="shop-page" class="page-content"> <h2 class="page-title">SHOP & CRAFTING</h2> <div class="shop-section-wrapper"> <h3 >Buy Items</h3> <div class="shop-items" id="shopItems"></div> </div> <div class="crafting-section-wrapper"> <h3 >Craft Items</h3> <div class="crafting-items-container" id="craftingItemsContainer"> </div> </div> </section>
                <section id="inventory-page" class="page-content"> <h2 class="page-title">INVENTORY</h2> <div class="equipment-slots-container"> <h4 >EQUIPPED ITEMS</h4> <div class="equipment-slots" id="equipmentSlotsDisplay"> </div> </div> <h4 >My Items</h4> <div class="inventory-items-container" id="inventoryItemsContainer"> </div> </section>
                <section id="help-page" class="page-content"> <h2 class="page-title">HELP</h2> <div class="help-content"> <p>Welcome to Punk Voyage Adventures!</p>  <p><strong>Objective:</strong> Send your adventurers on exciting quests to earn PV Tokens and Gold, and gather materials to craft powerful items.</p> <p><strong>How to Play:</strong></p> <ul> <li>Enter your nickname to start.</li> <li>The game defaults to Dark Mode. Use the toggle in the header to switch to Light Mode.</li> <li>Use the right-hand menu to navigate between Adventures, Quests, Shop/Crafting, Inventory, etc.</li> <li>On the ADVENTURES page, select an adventure, choose the number of adventurers, and click SEND.</li> <li>Hover over the "DROPS" button on adventures to see potential materials.</li><li>Active adventures and potions are displayed in the right sidebar.</li> <li>Your adventurers will return after the specified time, bringing rewards and possibly materials. Potions provide timed or counted buffs.</li> <li>Use collected materials to CRAFT items in the Shop & Crafting page.</li> <li>View and EQUIP/UNEQUIP your crafted items from the INVENTORY page. Equipped items provide passive bonuses.</li> <li>Complete QUESTS for extra rewards.</li> </ul> <p>This is a demo. Wallet integration and persistent data storage are not yet implemented.</p> </div> </section>
            </div>
            <aside class="right-sidebar-menu"> <nav class="main-menu-nav"> <div class="menu-button-container-fixed"><button class="menu-button" id="mainMenuToggleBtn">MENU</button></div> <div class="sidebar-content-area" id="sidebarContentArea"> <ul class="main-menu-nav-list" id="mainMenuList"> <li data-page="adventures-page" class="menu-list-item">ADVENTURES</li>  <li data-page="quests-page" class="menu-list-item">QUESTS</li> <li data-page="daily-rewards-page" class="menu-list-item">DAILY LOGIN REWARDS</li> <li data-page="shop-page" class="menu-list-item">SHOP & CRAFTING</li> <li data-page="inventory-page" class="menu-list-item">INVENTORY</li>  <li data-page="help-page" class="menu-list-item">HELP</li> </ul> <div class="sidebar-active-adventures-container" id="sidebarActiveAdventuresDisplay"> <h3>ACTIVE ADVENTURES</h3> <div id="sidebarActiveAdventuresList"></div> </div> <div class="active-potions-display hidden" id="activePotionsDisplay"> <h4>ACTIVE POTIONS</h4> <div id="activePotionsList"></div> </div> </div> </nav> </aside>
        </main>
    </div>

    <div id="customPopupOverlay" class="hidden"></div>
    <div id="customPopup" class="hidden">
        <h3 id="customPopupTitle">Notification</h3>
        <p id="customPopupMessage"></p>
        <button id="customPopupCloseBtn" class="action-button">OK</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const nicknameInputElement = document.getElementById('nicknameInput');
            const enterGameButton = document.getElementById('enterGameButton');
            const gameContainer = document.getElementById('gameContainer');
            const playerNicknameDisplay = document.getElementById('playerNicknameDisplay');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const body = document.body;
            const twitterWidgetContainer = document.getElementById('twitter-widget-container');
            let userNickname = '';

            const pvCountElement = document.getElementById('pvCount');
            const goldCountElement = document.getElementById('goldCount');
            const adventureSendButtons = document.querySelectorAll('.adventure-send-btn');
            const adventureDropButtons = document.querySelectorAll('.adventure-drops-button');
            
            const sidebarActiveAdventuresContainer = document.getElementById('sidebarActiveAdventuresDisplay'); 
            const sidebarActiveAdventuresList = document.getElementById('sidebarActiveAdventuresList');
            const activePotionsDisplay = document.getElementById('activePotionsDisplay');
            const activePotionsList = document.getElementById('activePotionsList');

            const availableAdventurersCountElement = document.getElementById('availableAdventurersCount');
            const menuItems = document.querySelectorAll('.right-sidebar-menu .main-menu-nav-list li');
            const pageContents = document.querySelectorAll('.main-content-area .page-content');
            const questListDiv = document.getElementById('questList');
            const shopItemsDiv = document.getElementById('shopItems');
            const materialsListDiv = document.getElementById('materialsList');
            const craftingItemsContainer = document.getElementById('craftingItemsContainer');
            const inventoryItemsContainer = document.getElementById('inventoryItemsContainer');
            const equipmentSlotsDisplay = document.getElementById('equipmentSlotsDisplay');
            const dailyRewardsGrid = document.getElementById('dailyRewardsGrid');

            const customPopupOverlay = document.getElementById('customPopupOverlay');
            const customPopup = document.getElementById('customPopup');
            const customPopupTitleEl = document.getElementById('customPopupTitle');
            const customPopupMessageEl = document.getElementById('customPopupMessage');
            const customPopupCloseBtn = document.getElementById('customPopupCloseBtn');
            
            const MAX_PLAYER_ADVENTURERS = 5;
            let currentPvTokens = 0; let currentGold = 0;
            let activeAdventures = []; let nextActiveAdventureId = 0;
            let totalAvailableAdventurers = MAX_PLAYER_ADVENTURERS;
            let playerInventory = [];
            let playerMaterials = { "Leather": 0, "Wood": 0, "Clover": 0, "Fabric": 0, "Iron": 0, "Gizmo Tail": 0, "Stone": 0, "Obsidian": 0, "Bitcoin": 0, "Bone": 0, "Flame Essence": 0 };
            let equippedItems = { Armour: null, Helmet: null, Boots: null, Amulet: null, Ring: null, Weapon: null };
            let activePotions = [];
            
            const adventuresData = { "1": { name: "Spirit Forest", drops: [ { name: "Leather", chance: 0.05, qty: 1}, { name: "Wood", chance: 0.10, qty: 1}, { name: "Clover", chance: 0.01, qty: 1}, { name: "Fabric", chance: 0.03, qty: 1} ] }, "2": { name: "Mountain of the Marowan", drops: [ { name: "Iron", chance: 0.05, qty: 1}, { name: "Gizmo Tail", chance: 0.01, qty: 1}, { name: "Stone", chance: 0.10, qty: 1} ] }, "3": { name: "Fire Fields of Flyinals", drops: [ { name: "Obsidian", chance: 0.01, qty: 1}, { name: "Bitcoin", chance: 0.00001, qty: 1}, { name: "Bone", chance: 0.02, qty: 1}, { name: "Flame Essence", chance: 0.05, qty: 1} ] } };
            const craftableItemsData = [ { id: "boots1", name: "Warped Boots", type: "Boots", description: "Reduces adventure time by 5 minutes.", perk: { type: "timeReduction", value: 300 }, recipe: { "Leather": 5, "Fabric": 3 }, imgColor: "var(--item-placeholder-boots)" }, { id: "amulet1", name: "Amulet of Greed", type: "Amulet", description: "Increases Gold find chance by +50% of current chance.", perk: { type: "goldChanceIncrease", multiplier: 0.5 }, recipe: { "Iron": 3, "Gizmo Tail": 1 }, imgColor: "var(--item-placeholder-amulet)" }, { id: "rucksack1", name: "Efficient Rucksack", type: "Rucksack", description: "+5% PV tokens from adventures.", perk: { type: "pvBonus", multiplier: 0.05 }, recipe: { "Fabric": 5, "Leather": 2 }, imgColor: "var(--item-placeholder-rucksack)" }, { id: "trinket1", name: "Lucky Rabbit's Foot", type: "Trinket", description: "Increases material find chance by +30% (additive).", perk: { type: "materialChanceIncrease", additive: 0.30 }, recipe: { "Clover": 3, "Bone": 2 }, imgColor: "var(--item-placeholder-trinket)" } ];
            const shopItemsData = [ { id: "potion2", name: "PV Doubler (1 Hour)", description: "Doubles PV rewards from adventures for 1 hour.", price: 200, imgColor: "var(--item-placeholder-potion2)", type: "buff", durationSeconds: 3600, effect: { type: "pvMultiplier", value: 2 } }, { id: "potion3", name: "Gold Magnet (3 Adventures)", description: "Adds +5% flat chance of finding gold on next 3 adventures.", price: 150, imgColor: "var(--item-placeholder-potion3)", type: "buff", durationAdventures: 3, effect: { type: "goldChanceBonus", flatValue: 0.05 } }, ];
            const quests = [ { id: 1, text: "Complete Spirit Forest 5 times", reward: "50 PV", completed: false, progress: 0, target: 5, adventureName: "Spirit Forest" }, { id: 2, text: "Complete Mountain of the Marowan 5 times", reward: "75 PV", completed: false, progress: 0, target: 5, adventureName: "Mountain of the Marowan"}, { id: 3, text: "Complete Fire Fields of Flyinals 5 times", reward: "150 PV", completed: false, progress: 0, target: 5, adventureName: "Fire Fields of Flyinals"}, ];
            const dailyRewardsData = []; for (let i = 1; i <= 30; i++) { let reward = `${50 + (i * 5)} PV`; if (i % 7 === 0 && Object.keys(playerMaterials).length > 0) reward += `, 1 ${Object.keys(playerMaterials)[i % Object.keys(playerMaterials).length]}`; if (i === 30) reward = "1 Gold, 300 PV"; dailyRewardsData.push({ day: i, reward: reward });}
            let lastClaimedDay = parseInt(localStorage.getItem('lastClaimedDayPVA')) || 0;

            function showCustomPopup(message, title = "Notification") {
                if (customPopupTitleEl) customPopupTitleEl.textContent = title;
                if (customPopupMessageEl) customPopupMessageEl.textContent = message;
                if (customPopupOverlay) customPopupOverlay.classList.remove('hidden');
                if (customPopup) customPopup.classList.remove('hidden');
                if (customPopupCloseBtn) customPopupCloseBtn.focus();
            }
            function hideCustomPopup() {
                if (customPopupOverlay) customPopupOverlay.classList.add('hidden');
                if (customPopup) customPopup.classList.add('hidden');
            }
            if (customPopupCloseBtn) customPopupCloseBtn.addEventListener('click', hideCustomPopup);
            if (customPopupOverlay) customPopupOverlay.addEventListener('click', hideCustomPopup); 


            function initializeTheme() { const savedTheme = localStorage.getItem('theme'); if (savedTheme === 'light') { body.classList.remove('dark-mode'); body.classList.add('light-mode'); if(darkModeToggle) darkModeToggle.checked = false; if (gameContainer && !gameContainer.classList.contains('hidden')) loadTwitterWidget('light'); } else { body.classList.add('dark-mode'); body.classList.remove('light-mode'); if(darkModeToggle) darkModeToggle.checked = true; if (gameContainer && !gameContainer.classList.contains('hidden')) loadTwitterWidget('dark'); } }
            function loadTwitterWidget(theme) { if (twitterWidgetContainer) { twitterWidgetContainer.innerHTML = ''; const twitterLink = document.createElement('a'); twitterLink.className = 'twitter-timeline'; twitterLink.setAttribute('data-dnt', 'true'); twitterLink.href = 'https://twitter.com/nvart_?ref_src=twsrc%5Etfw'; twitterLink.setAttribute('data-theme', theme); twitterLink.setAttribute('data-height', '400'); twitterLink.textContent = 'Tweets by nvart_'; twitterWidgetContainer.appendChild(twitterLink); let twitterScript = document.querySelector('script[src="https://platform.twitter.com/widgets.js"]'); if (twitterScript) { twitterScript.remove(); } twitterScript = document.createElement('script'); twitterScript.async = true; twitterScript.src = 'https://platform.twitter.com/widgets.js'; twitterScript.charset = 'utf-8'; document.body.appendChild(twitterScript); } }
            initializeTheme(); 
            if(enterGameButton && nicknameInputElement && welcomeScreen && gameContainer && playerNicknameDisplay){ enterGameButton.addEventListener('click', () => { userNickname = nicknameInputElement.value.trim(); if (userNickname) { playerNicknameDisplay.textContent = userNickname; welcomeScreen.classList.add('hidden'); gameContainer.classList.remove('hidden'); const currentThemeIsDark = body.classList.contains('dark-mode'); loadTwitterWidget(currentThemeIsDark ? 'dark' : 'light'); showPage('adventures-page'); renderMaterials(); renderActiveAdventuresInSidebar(); renderActivePotions(); } else { showCustomPopup("Please enter a nickname to start your voyage!", "Nickname Required"); } }); nicknameInputElement.addEventListener('keypress', (event) => { if (event.key === 'Enter') { enterGameButton.click(); } });}
            if(darkModeToggle){ darkModeToggle.addEventListener('change', () => { if (darkModeToggle.checked) { body.classList.add('dark-mode'); body.classList.remove('light-mode'); localStorage.setItem('theme', 'dark'); loadTwitterWidget('dark'); } else { body.classList.remove('dark-mode'); body.classList.add('light-mode'); localStorage.setItem('theme', 'light'); loadTwitterWidget('light'); } });}
            
            function showPage(pageIdToShow) { if(!pageContents) return; pageContents.forEach(page => { if (page.id === pageIdToShow) { page.classList.add('active'); if (pageIdToShow === 'quests-page') renderQuests(); else if (pageIdToShow === 'shop-page') {renderShopItems(); renderCraftingItems();} else if (pageIdToShow === 'inventory-page') renderInventory(); else if (pageIdToShow === 'daily-rewards-page') renderDailyRewards(); } else { page.classList.remove('active'); } }); }
            if(menuItems){ menuItems.forEach(item => { item.addEventListener('click', () => { const targetPageId = item.dataset.page; if (targetPageId) { showPage(targetPageId); } }); });}
            
            function updateStatsDisplay() { if(pvCountElement) pvCountElement.textContent = currentPvTokens; if(goldCountElement) goldCountElement.textContent = currentGold; if(availableAdventurersCountElement) availableAdventurersCountElement.textContent = totalAvailableAdventurers; }
            function formatTimeLeft(milliseconds) { if (milliseconds <= 0) return "Returning!"; let ts = Math.ceil(milliseconds / 1000); let h = Math.floor(ts / 3600); ts %= 3600; let m = Math.floor(ts / 60); let s = ts % 60; return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`; }
            
            function renderActiveAdventuresInSidebar() { if (!sidebarActiveAdventuresList || !sidebarActiveAdventuresContainer) return; sidebarActiveAdventuresList.innerHTML = ''; if (activeAdventures.length === 0) { const p = document.createElement('p'); p.textContent = "No adventurers currently on an adventure."; p.style.textAlign = "center"; sidebarActiveAdventuresList.appendChild(p); } else { activeAdventures.forEach(adv => { const itemDiv = document.createElement('div'); itemDiv.classList.add('active-adventure-item'); itemDiv.dataset.instanceId = adv.id; const timeLeftMs = adv.returnTime - Date.now(); itemDiv.innerHTML = `<p><strong>${adv.name}</strong></p><p>Adventurers: ${adv.adventurers}</p><p>Time Left: <span class="timer">${formatTimeLeft(timeLeftMs)}</span></p>`; sidebarActiveAdventuresList.appendChild(itemDiv); }); } sidebarActiveAdventuresContainer.classList.remove('hidden'); }

            function renderActivePotions() { if (!activePotionsList || !activePotionsDisplay) return; activePotionsList.innerHTML = ''; if (activePotions.length === 0) { activePotionsDisplay.classList.add('hidden'); return; } activePotionsDisplay.classList.remove('hidden'); activePotions.forEach(potion => { const itemDiv = document.createElement('div'); itemDiv.classList.add('potion-item'); let details = ''; if (potion.endTime) { const timeLeftMs = potion.endTime - Date.now(); details = `Time Left: <span class="timer">${formatTimeLeft(timeLeftMs)}</span>`; } else if (potion.adventuresLeft !== undefined) { details = `Adventures Left: ${potion.adventuresLeft}`; } itemDiv.innerHTML = `<p><strong>${potion.name}</strong></p><p>${potion.description}</p><p>${details}</p>`; activePotionsList.appendChild(itemDiv); });}

            function renderMaterials() { if(!materialsListDiv) return; materialsListDiv.innerHTML = ''; let materialCount = 0; for (const mat in playerMaterials) { if (playerMaterials.hasOwnProperty(mat)) { materialCount++; const li = document.createElement('li'); li.textContent = `${mat}: ${playerMaterials[mat]}`; materialsListDiv.appendChild(li); } } if (materialCount === 0 && Object.keys(playerMaterials).length > 0) { Object.keys(playerMaterials).forEach(mat => {const li = document.createElement('li'); li.textContent = `${mat}: 0`; materialsListDiv.appendChild(li);});} else if (Object.keys(playerMaterials).length === 0) {const li = document.createElement('li'); li.textContent = "No materials discovered yet."; li.style.fontStyle = "italic"; materialsListDiv.appendChild(li); }}
            function renderCraftingItems() { if(!craftingItemsContainer) return; craftingItemsContainer.innerHTML = ''; craftableItemsData.forEach(item => { const card = document.createElement('div'); card.className = 'craftable-item-card'; let recipeHtml = 'Requires: '; for(const mat in item.recipe){ recipeHtml += `${item.recipe[mat]} ${mat}, `; } recipeHtml = recipeHtml.slice(0, -2); card.innerHTML = `<div class="item-icon-placeholder" style="background-color: ${item.imgColor || '#555'};">${item.type.substring(0,1)}</div> <div class="item-info"> <p><strong>${item.name}</strong> (${item.type})</p> <small>${item.description}</small> <p class="crafting-cost"><small>${recipeHtml}</small></p> </div> <button class="action-button craft-button" data-item-id="${item.id}">Craft</button>`; craftingItemsContainer.appendChild(card); }); document.querySelectorAll('.craft-button').forEach(b => b.addEventListener('click', e => craftItem(e.target.dataset.itemId))); }
            function renderInventory() { if (!inventoryItemsContainer || !equipmentSlotsDisplay) return; equipmentSlotsDisplay.innerHTML = ''; const slotTypes = ["Armour", "Helmet", "Boots", "Amulet", "Ring", "Weapon"]; slotTypes.forEach(slotType => { const slotDiv = document.createElement('div'); slotDiv.classList.add('equipment-slot'); let slotContent = `<div class="slot-name">${slotType.toUpperCase()}</div>`; const equippedItemId = equippedItems[slotType]; if (equippedItemId) { const itemData = craftableItemsData.find(i => i.id === equippedItemId); if (itemData) { slotContent += `<div class="item-icon-placeholder" style="background-color: ${itemData.imgColor || '#ccc'};">${itemData.type ? itemData.type.substring(0,1) : '?'}</div> <div class="equipped-item-name">${itemData.name}</div> <button class="unequip-btn action-button" data-item-type="${itemData.type}">Unequip</button>`; } } else { slotContent += `<div class="empty-slot-text">(Empty Slot)</div>`; } slotDiv.innerHTML = slotContent; equipmentSlotsDisplay.appendChild(slotDiv); }); equipmentSlotsDisplay.querySelectorAll('.unequip-btn').forEach(b => b.addEventListener('click', e => unequipItem(e.target.dataset.itemType))); inventoryItemsContainer.innerHTML = ''; if (playerInventory.length === 0) { inventoryItemsContainer.innerHTML = '<p style="text-align:center;">Your bag is empty.</p>'; return; } playerInventory.forEach(itemId => { const itemData = craftableItemsData.find(i => i.id === itemId); if (itemData) { const card = document.createElement('div'); card.className = 'inventory-item-card'; card.innerHTML = `<div class="item-icon-placeholder" style="background-color: ${itemData.imgColor || '#ccc'};">${itemData.type ? itemData.type.substring(0,1) : '?'}</div> <div class="item-info"> <p><strong>${itemData.name}</strong> (${itemData.type || 'Item'})</p <small class="item-perk">${itemData.description}</small> </div> <div class="item-actions"> <button class="equip-btn action-button" data-item-id="${itemId}">Equip</button> </div>`; inventoryItemsContainer.appendChild(card); } }); inventoryItemsContainer.querySelectorAll('.equip-btn').forEach(b => b.addEventListener('click', e => equipItem(e.target.dataset.itemId)));}
            function renderQuests() { if (!questListDiv) return; questListDiv.innerHTML = ''; quests.forEach(quest => { const qe = document.createElement('div'); qe.classList.add('quest-item'); qe.innerHTML = `<p>${quest.text} (${quest.progress || 0}/${quest.target||'N/A'})</p><div class="quest-details"><span class="quest-reward">Reward: ${quest.reward}</span><button class="action-button claim-quest-btn" data-quest-id="${quest.id}" ${quest.completed && !(quest.claimed) ? '' : 'disabled'}>${quest.claimed ? 'Claimed' : 'Claim'}</button></div>`; questListDiv.appendChild(qe); }); document.querySelectorAll('.claim-quest-btn').forEach(b => { b.addEventListener('click', (e) => { const qId = parseInt(e.target.dataset.questId); const q = quests.find(q => q.id === qId); if(q && q.completed && !q.claimed){ q.claimed = true; e.target.disabled = true; e.target.textContent = 'Claimed'; const rewardAmount = parseInt(q.reward.split(" ")[0]); currentPvTokens += rewardAmount; updateStatsDisplay(); showCustomPopup(`Claimed reward: ${q.reward} for completing quest: "${q.text}"`, "Quest Reward Claimed"); } }); }); }
            function renderDailyRewards() { if (!dailyRewardsGrid) return; dailyRewardsGrid.innerHTML = ''; let todayForStreak = (localStorage.getItem('currentStreakDayPVA') || 0) * 1; dailyRewardsData.forEach(item => { const dayDiv = document.createElement('div'); dayDiv.classList.add('reward-day'); let rewardText = item.reward; if (item.day === 30) rewardText = `<strong style="color:var(--highlight-color-gold);">${item.reward}</strong>`; const canClaim = (todayForStreak + 1 === item.day) && (lastClaimedDay < item.day); const isClaimed = lastClaimedDay >= item.day; dayDiv.innerHTML = `<h5>Day ${item.day}</h5><p>${rewardText}</p><button class="action-button claim-daily-reward-btn" data-day="${item.day}" ${canClaim ? '' : 'disabled'}>${isClaimed ? 'Claimed' : (canClaim ? 'Claim' : 'Locked')}</button>`; dailyRewardsGrid.appendChild(dayDiv); }); document.querySelectorAll('.claim-daily-reward-btn').forEach(button => { button.addEventListener('click', (e) => { const dayToClaim = parseInt(e.target.dataset.day); const rewardItem = dailyRewardsData.find(d=>d.day===dayToClaim); if (!rewardItem) return; lastClaimedDay = dayToClaim; localStorage.setItem('lastClaimedDayPVA', lastClaimedDay); localStorage.setItem('currentStreakDayPVA', dayToClaim); const rewardInfo = rewardItem.reward; if (rewardInfo.includes("PV")) currentPvTokens += parseInt(rewardInfo.match(/(\d+) PV/)[1]); if (rewardInfo.includes("Gold")) currentGold += parseInt(rewardInfo.match(/(\d+) Gold/)[1]); updateStatsDisplay(); renderDailyRewards(); showCustomPopup(`Claimed reward for Day ${dayToClaim}: ${rewardItem.reward}`, "Daily Reward Claimed"); }); }); }
            
            function renderShopItems() { if (!shopItemsDiv) return; shopItemsDiv.innerHTML = ''; shopItemsData.forEach(item => { const ie = document.createElement('div'); ie.classList.add('shop-item'); ie.innerHTML = `<div class="item-icon-placeholder" style="background-color: ${item.imgColor || '#777'};">P</div><div><p><strong>${item.name}</strong></p><p><small>${item.description}</small></p></div><div class="shop-details"><span class="shop-price">${item.price} PV</span><button class="action-button buy-item-btn" data-item-id="${item.id}" data-price="${item.price}">Buy</button></div>`; shopItemsDiv.appendChild(ie); }); document.querySelectorAll('.buy-item-btn').forEach(b => { b.addEventListener('click', (e) => { const itemId = e.target.dataset.itemId; const itemPrice = parseInt(e.target.dataset.price); const itemData = shopItemsData.find(it => it.id === itemId); if (!itemData) return; if (currentPvTokens >= itemPrice) { currentPvTokens -= itemPrice; updateStatsDisplay(); showCustomPopup(`Successfully bought ${itemData.name} for ${itemPrice} PV.`, "Purchase Complete"); if (itemData.type === "buff" && itemData.effect) { const existingPotion = activePotions.find(p => p.id === itemData.id && (p.endTime || p.adventuresLeft)); if (existingPotion) { showCustomPopup(`${itemData.name} is already active or you have one of its kind. Finish it first.`, "Potion Active"); currentPvTokens += itemPrice; updateStatsDisplay(); return; } let newPotion = { id: itemData.id, name: itemData.name, description: itemData.description, effect: itemData.effect }; if (itemData.durationSeconds) { newPotion.endTime = Date.now() + itemData.durationSeconds * 1000; newPotion.originalDurationSeconds = itemData.durationSeconds; } else if (itemData.durationAdventures) { newPotion.adventuresLeft = itemData.durationAdventures; } activePotions.push(newPotion); renderActivePotions(); } } else { showCustomPopup("Not enough PV Tokens to buy this item!", "Transaction Failed"); } }); }); }

            function craftItem(itemId) { const itemToCraft = craftableItemsData.find(i => i.id === itemId); if (!itemToCraft) return; let canCraft = true; let missingMat = ""; for (const mat in itemToCraft.recipe) { if ((playerMaterials[mat] || 0) < itemToCraft.recipe[mat]) { canCraft = false; missingMat = mat; break; } } if (canCraft) { for (const mat in itemToCraft.recipe) { playerMaterials[mat] -= itemToCraft.recipe[mat]; } playerInventory.push(itemId); showCustomPopup(`Successfully crafted ${itemToCraft.name}!`, "Item Crafted"); renderMaterials(); renderInventory(); renderCraftingItems(); } else { showCustomPopup(`Not enough ${missingMat}! You need ${itemToCraft.recipe[missingMat]} of ${missingMat} to craft ${itemToCraft.name}.`, "Crafting Failed"); } }
            function equipItem(itemId) { const itemData = craftableItemsData.find(i => i.id === itemId); if (!itemData || !itemData.type) { console.error("Cannot equip item without a type:", itemData); return; } if (equippedItems.hasOwnProperty(itemData.type)) { if (equippedItems[itemData.type]) { playerInventory.push(equippedItems[itemData.type]); } equippedItems[itemData.type] = itemId; playerInventory = playerInventory.filter(id => id !== itemId); renderInventory(); console.log("Equipped:", equippedItems); } else { console.warn(`Unknown equipment slot type: ${itemData.type} for item ${itemId}`);} }
            function unequipItem(itemType) { if (equippedItems.hasOwnProperty(itemType) && equippedItems[itemType]) { playerInventory.push(equippedItems[itemType]); equippedItems[itemType] = null; renderInventory(); console.log("Equipped:", equippedItems); } }
            function generateRandomQuests() { if (quests.length >= 5) return; const templates = [ { baseText: "Collect X PV Tokens", type: "collectPV", min: 100, max: 500, rewardBase: 20 }, { baseText: "Send Y adventurers on any Z quests", type: "sendAdventurers", minA: 3, maxA: 10, minQ: 1, maxQ: 3, rewardBase: 30 }, { baseText: "Earn Z Gold", type: "collectGold", min: 1, max: 5, rewardBase: 50}, ]; while(quests.length < 5) { const t = templates[Math.floor(Math.random() * templates.length)]; let txt = t.baseText; let rA = t.rewardBase; let nq = { id: quests.length + 1, completed: false, progress: 0 }; if (t.type === "collectPV") { const tpv = Math.floor(Math.random()*(t.max-t.min+1)+t.min); txt=txt.replace("X",tpv); rA+=Math.floor(tpv/10); nq.target=tpv; nq.metric="pvCollected"; } else if (t.type === "sendAdventurers") { const ta=Math.floor(Math.random()*(t.maxA-t.minA+1)+t.minA); const tq=Math.floor(Math.random()*(t.maxQ-t.minQ+1)+t.minQ); txt=txt.replace("Y",ta).replace("Z",tq); rA+=ta*2+tq*5; nq.target=ta; nq.metric="adventurersSentOnQuests"; } else if (t.type === "collectGold") { const tg=Math.floor(Math.random()*(t.max-t.min+1)+t.min); txt=txt.replace("Z",tg); rA+=tg*20; nq.target=tg; nq.metric="goldCollected"; } nq.text=txt; nq.reward=`${rA} PV`; quests.push(nq); } }
            
            function completeAdventure(instanceId) { const advIdx = activeAdventures.findIndex(adv => adv.id === instanceId); if (advIdx === -1) return; const completedAdv = activeAdventures[advIdx]; 
                let basePvReward = completedAdv.pvReward; 
                let pvMultiplierFromPotions = 1;
                activePotions.forEach(p => { if(p.effect && p.effect.type === "pvMultiplier" && (p.endTime && Date.now() < p.endTime || p.adventuresLeft > 0)) { pvMultiplierFromPotions *= p.effect.value; }});
                let pvBonusMultiplierFromItems = 1; 
                if (equippedItems.Rucksack) { const rD = craftableItemsData.find(i=>i.id===equippedItems.Rucksack); if(rD && rD.perk.type==="pvBonus") pvBonusMultiplierFromItems += rD.perk.multiplier; } 
                let earnedPvThisTrip = Math.floor(basePvReward * completedAdv.adventurers * pvBonusMultiplierFromItems * pvMultiplierFromPotions); 
                currentPvTokens += earnedPvThisTrip; 
                
                let goldChanceMultiplierFromItems = 1; 
                if (equippedItems.Amulet) { const aD = craftableItemsData.find(i=>i.id===equippedItems.Amulet); if(aD && aD.perk.type==="goldChanceIncrease") goldChanceMultiplierFromItems += aD.perk.multiplier; } 
                let flatGoldBonusFromPotions = 0;
                activePotions.forEach(p => { if(p.effect && p.effect.type === "goldChanceBonus" && (p.endTime && Date.now() < p.endTime || p.adventuresLeft > 0)) { flatGoldBonusFromPotions += p.effect.flatValue || 0; }});

                let totalGoldFoundThisTrip = 0; 
                let materialChanceAdditive = 0; 
                if (equippedItems.Trinket) { const tD = craftableItemsData.find(i=>i.id===equippedItems.Trinket); if(tD && tD.perk.type==="materialChanceIncrease") materialChanceAdditive = tD.perk.additive; } 
                let allFoundDrops = {}; 
                for (let i = 0; i < completedAdv.adventurers; i++) { 
                    const finalGoldChance = (completedAdv.goldChance * goldChanceMultiplierFromItems) + flatGoldBonusFromPotions;
                    if (completedAdv.goldChance > 0 && Math.random() < finalGoldChance) { currentGold += 1; totalGoldFoundThisTrip++; } 
                    const adventureBaseData = adventuresData[completedAdv.originalAdventureId]; 
                    if (adventureBaseData && adventureBaseData.drops) { adventureBaseData.drops.forEach(drop => { if (Math.random() < (drop.chance + materialChanceAdditive)) { playerMaterials[drop.name] = (playerMaterials[drop.name] || 0) + (drop.qty || 1); allFoundDrops[drop.name] = (allFoundDrops[drop.name] || 0) + (drop.qty || 1); } }); } 
                } 
                
                activePotions.forEach(p => { if(p.adventuresLeft !== undefined) { p.adventuresLeft--; }});
                activePotions = activePotions.filter(p => (p.endTime && Date.now() < p.endTime) || (p.adventuresLeft !== undefined && p.adventuresLeft > 0) || (!p.endTime && p.adventuresLeft === undefined) ); 
                renderActivePotions();

                let popupMessage = `${completedAdv.adventurers} adventurer(s) returned from ${completedAdv.name}!\n\nRewards:\n- ${earnedPvThisTrip} PV Tokens`;
                if(totalGoldFoundThisTrip > 0) {
                    popupMessage += `\n- ${totalGoldFoundThisTrip} Gold`;
                }
                const foundDropNames = Object.keys(allFoundDrops); 
                if (foundDropNames.length > 0) { 
                    popupMessage += `\n\nMaterials Found:`;
                    foundDropNames.forEach(dropName => { 
                        popupMessage += `\n  - ${allFoundDrops[dropName]}x ${dropName}`;
                    });
                    renderMaterials(); 
                } 
                totalAvailableAdventurers += completedAdv.adventurers; 
                showCustomPopup(popupMessage, "Adventure Complete!"); 
                activeAdventures.splice(advIdx, 1); 
                
                const adventureBlock = document.getElementById(`adventure-${completedAdv.originalAdventureId}-block`); 
                if (adventureBlock) { const sendBtn = adventureBlock.querySelector('.adventure-send-btn'); const numSelect = adventureBlock.querySelector('.adventure-num-select'); if (sendBtn) sendBtn.disabled = false; if (numSelect) numSelect.disabled = false; } 
                quests.forEach(quest => { if (!quest.completed && !quest.claimed) { if (quest.adventureName === completedAdv.name) quest.progress = (quest.progress || 0) + completedAdv.adventurers; if (quest.metric === "pvCollected") quest.progress = Math.min(quest.target, (quest.progress || 0) + earnedPvThisTrip); if (quest.metric === "goldCollected") quest.progress = Math.min(quest.target, (quest.progress || 0) + totalGoldFoundThisTrip); if (quest.metric === "adventurersSentOnQuests") quest.progress = (quest.progress || 0) + completedAdv.adventurers; if (quest.progress >= quest.target) { quest.completed = true; showCustomPopup(`Quest Completed: ${quest.text}`, "Quest Complete!"); } } }); 
                if(document.getElementById('quests-page').classList.contains('active')) { renderQuests(); } 
                updateStatsDisplay(); renderActiveAdventuresInSidebar(); 
            }
            
            function updateTimers() { 
                let adventureCompletedThisTick = false;
                activeAdventures.forEach(adv => { 
                    const timeLeftMs = adv.returnTime - Date.now(); 
                    document.querySelectorAll(`.active-adventure-item[data-instance-id="${adv.id}"] .timer`).forEach(timerSpan => { if(timerSpan) timerSpan.textContent = formatTimeLeft(timeLeftMs); }); 
                    if (timeLeftMs <= 0) { completeAdventure(adv.id); adventureCompletedThisTick = true; } 
                }); 
                if (adventureCompletedThisTick && activeAdventures.length === 0 && sidebarActiveAdventuresList) {
                    renderActiveAdventuresInSidebar(); 
                }

                let potionsChanged = false;
                const now = Date.now();
                activePotions.forEach(potion => {
                    if (potion.endTime) {
                        if (now >= potion.endTime) potionsChanged = true;
                        const potionItemDiv = Array.from(activePotionsList.children).find(child => child.innerHTML.includes(`<strong>${potion.name}</strong>`));
                        if (potionItemDiv) {
                            const timerSpan = potionItemDiv.querySelector('.timer');
                            if (timerSpan) timerSpan.textContent = formatTimeLeft(potion.endTime - now);
                        }
                    }
                });
                if (potionsChanged) {
                    activePotions = activePotions.filter(p => p.endTime ? p.endTime > now : true);
                    renderActivePotions();
                }
            }

            adventureSendButtons.forEach(button => { button.addEventListener('click', () => { 
                const adventureIdBase = button.dataset.adventureId; 
                const adventureName = button.dataset.adventureName; 
                const durationHoursAsSeconds = parseInt(button.dataset.durationHours); 
                const pvReward = parseInt(button.dataset.pvReward); 
                const goldChance = parseFloat(button.dataset.goldChance); 
                const selectElement = document.getElementById(`num-adventurers-${adventureIdBase}`); 
                const numAdventurersToSend = parseInt(selectElement.value); 
                if (numAdventurersToSend <= 0) { showCustomPopup("Please select at least one adventurer.", "Action Needed"); return; } 
                if (numAdventurersToSend > totalAvailableAdventurers) { showCustomPopup(`Not enough adventurers available! You only have ${totalAvailableAdventurers}.`, "Adventurers Needed"); return; } 
                totalAvailableAdventurers -= numAdventurersToSend; 
                
                let baseDurationSeconds = durationHoursAsSeconds; 
                if(equippedItems.Boots){ 
                    const bootsData = craftableItemsData.find(item => item.id === equippedItems.Boots); 
                    if(bootsData && bootsData.perk.type === "timeReduction") { 
                        baseDurationSeconds = Math.max(1, baseDurationSeconds - bootsData.perk.value); 
                    }
                }
                const returnTime = Date.now() + baseDurationSeconds * 1000;

                const newActiveAdventure = { id: nextActiveAdventureId++, originalAdventureId: adventureIdBase, name: adventureName, adventurers: numAdventurersToSend, returnTime: returnTime, pvReward: pvReward, goldChance: goldChance }; 
                activeAdventures.push(newActiveAdventure); 
                updateStatsDisplay(); 
                renderActiveAdventuresInSidebar(); 
                button.disabled = true; if(selectElement) selectElement.disabled = true; 
            }); });

            adventureDropButtons.forEach(button => {
                button.addEventListener('mouseenter', (event) => {
                    const adventureId = event.target.dataset.adventureId;
                    const popover = document.getElementById(`drops-popover-${adventureId}`);
                    const adventureInfo = adventuresData[adventureId];
                    if (popover && adventureInfo && adventureInfo.drops) {
                        let dropsHtml = '<h5>Possible Drops:</h5><ul>';
                        adventureInfo.drops.forEach(drop => {
                            dropsHtml += `<li>${drop.qty}x ${drop.name} (${(drop.chance * 100).toFixed(2)}%)</li>`;
                        });
                        dropsHtml += '</ul>';
                        popover.innerHTML = dropsHtml;
                        popover.style.display = 'block';
                    }
                });
                button.addEventListener('mouseleave', (event) => {
                    const adventureId = event.target.dataset.adventureId;
                    const popover = document.getElementById(`drops-popover-${adventureId}`);
                    if (popover) {
                        popover.style.display = 'none';
                    }
                });
            });
            
            updateStatsDisplay(); renderMaterials(); generateRandomQuests(); renderActiveAdventuresInSidebar(); renderActivePotions();
            setInterval(updateTimers, 1000);
            document.querySelectorAll('.adventure-num-select').forEach(select => { select.value = "5"; });
            if(!gameContainer.classList.contains('hidden')) { showPage('adventures-page'); }

            const connectWalletBtn = document.getElementById('connectWalletBtn'); const walletDropdown = document.getElementById('walletDropdown'); const walletOptions = walletDropdown.querySelectorAll('li'); const walletAddressDisplay = document.getElementById('walletAddressDisplay');
            let connectedAccount = null; let connectedWalletName = null;
            function updateWalletDisplay(account, walletName = '') { if (account) { const shortAddress = `${account.substring(0, 6)}...${account.substring(account.length - 4)}`; if(connectWalletBtn) { connectWalletBtn.textContent = `${walletName}: ${shortAddress}`; connectWalletBtn.classList.add('connected'); } if(walletAddressDisplay) walletAddressDisplay.textContent = `Wallet: ${account}`; } else { if(connectWalletBtn) { connectWalletBtn.textContent = 'CONNECT WALLET'; connectWalletBtn.classList.remove('connected'); } if(walletAddressDisplay) walletAddressDisplay.textContent = ''; } }
            if(connectWalletBtn && walletDropdown) { connectWalletBtn.addEventListener('click', (event) => { event.stopPropagation(); walletDropdown.style.display = walletDropdown.style.display === 'block' ? 'none' : 'block'; }); document.addEventListener('click', (event) => { if (walletDropdown && connectWalletBtn && !connectWalletBtn.contains(event.target) && !walletDropdown.contains(event.target)) { walletDropdown.style.display = 'none'; } }); }
            async function connectWithSatsConnect(walletTypeHint = null) { if (typeof SatsConnect === 'undefined' || typeof SatsConnect.getAddresses === 'undefined') { showCustomPopup('Sats Connect library not loaded or not ready.', "Wallet Error"); return; } try { SatsConnect.getAddresses({ payload: { purposes: ['ordinals', 'payment'], message: 'Connect to Punk Voyage Adventures', network: { type: 'Mainnet' }, }, onFinish: (response) => { const ordAddress = response.addresses.find(a => a.purpose === 'ordinals'); const payAddress = response.addresses.find(a => a.purpose === 'payment'); let addr = ordAddress ? ordAddress.address : (payAddress ? payAddress.address : null); if (addr) { connectedAccount = addr; let name = walletTypeHint ? walletTypeHint.replace('satsconnect_', '').toUpperCase() : "BTC"; if (name === "GENERAL") name = "BTC"; connectedWalletName = name; updateWalletDisplay(connectedAccount, connectedWalletName); } }, onCancel: () => console.log('SatsConnect canceled.'), }); } catch (e) { console.error('SatsConnect error:', e); showCustomPopup('An error occurred with SatsConnect.', 'Wallet Error');} }
            async function connectUnisat() { try { if (typeof window.unisat !== 'undefined') { const accounts = await window.unisat.requestAccounts(); if (accounts && accounts.length > 0) { connectedAccount = accounts[0]; connectedWalletName = 'UniSat'; updateWalletDisplay(connectedAccount, 'UniSat'); window.unisat.on('accountsChanged', (newAccs) => { if (connectedWalletName === 'UniSat') { connectedAccount = (newAccs && newAccs.length > 0) ? newAccs[0] : null; if (!connectedAccount) connectedWalletName = null; updateWalletDisplay(connectedAccount, connectedAccount ? 'UniSat' : ''); } }); } } else { window.open('https://unisat.io/', '_blank'); } } catch (e) { console.error('UniSat error:', e); showCustomPopup('An error occurred with UniSat Wallet.', 'Wallet Error'); } }
            if (walletOptions) { walletOptions.forEach(option => { option.addEventListener('click', async (event) => { const walletType = event.target.dataset.wallet; if(walletDropdown) walletDropdown.style.display = 'none'; connectedAccount = null; connectedWalletName = null; updateWalletDisplay(null); if (walletType === 'unisat') await connectUnisat(); else if (walletType && walletType.startsWith('satsconnect_')) { await connectWithSatsConnect(walletType.split('_')[1]); } }); }); }

        });
    </script>
</body>
</html>